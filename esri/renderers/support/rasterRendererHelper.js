// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.22/esri/copyright.txt for details.
//>>built
define("exports ../../Color ../../rasterRenderers ../../core/maybe ../../core/unitUtils ../../layers/support/Field ../../layers/support/RasterInfo ./AuthoringInfo ./ClassBreakInfo ./colorRampUtils ./UniqueValueInfo ../../rest/support/AlgorithmicColorRamp ../../rest/support/ClassBreaksDefinition ../../rest/support/generateRendererUtils ../../rest/support/MultipartColorRamp ../RasterStretchRenderer ../UniqueValueRenderer ../RasterColormapRenderer ../RasterShadedReliefRenderer ../ClassBreaksRenderer ../VectorFieldRenderer".split(" "),
function(l,x,ra,h,aa,ba,ca,K,da,C,L,ea,fa,ha,E,ia,ja,ka,la,ma,na){function M(a,b){var d,c,e,f;a=N(a,null==b?void 0:b.variableName);const {bandCount:k}=a;let {bandIds:m,stretchType:q}=b||{};null!=(d=m)&&d.some(u=>u>=k)&&(m=null);let t=h.unwrap(a.statistics),r=h.unwrap(a.histograms);if(1<k){var v;m=null!=(v=m)&&v.length?m:O(a);t=null==t?null:m.map(u=>t[u]);r=null==r?null:m.map(u=>r[u])}else m=[0];null==q&&(q=oa(a));d=!1;switch(q){case "none":d=!1;break;case "percent-clip":d=!(null!=(c=r)&&c.length);
break;default:d=!(null!=(e=t)&&e.length)}({dataType:c}=a);c=1===(null==(f=m)?void 0:f.length)&&P.has(c)?Q:null;f=new ia({stretchType:q,dynamicRangeAdjustment:d,colorRamp:c,outputMin:0,outputMax:255,gamma:1===m.length?[1]:[1,1,1],useGamma:!1});"percent-clip"===q?f.maxPercent=f.minPercent=.25:"standard-deviation"===q&&(f.numberOfStandardDeviations=2);if(!d&&(h.isSome(a.multidimensionalInfo)||null!=b&&b.includeStatisticsInStretch))if("percent-clip"===q)f.histograms=r;else if("min-max"===q||"standard-deviation"===
q)f.statistics=t;return f}function N(a,b){if(null==b)return a;let d=h.unwrap(a.statistics),c=h.unwrap(a.histograms);const {multidimensionalInfo:e}=a;if(b&&h.isSome(e)){const {statistics:f,histograms:k}=e.variables.find(m=>m.name===b);null!=f&&f.length&&(d=f);null!=k&&k.length&&(c=k)}return ca.fromJSON({...a.toJSON(),statistics:d,histograms:c})}function O(a){const b=a.bandCount;if(1===b)return null;if(2===b)return[0];a=a.keyProperties&&a.keyProperties.BandProperties;let d;if(a&&a.length===b){const {red:c,
green:e,blue:f,nir:k}=R(a);null!=c&&null!=e&&null!=f?d=[c,e,f]:null!=k&&null!=c&&null!=e&&(d=[k,c,e])}!d&&3<=b&&(d=[0,1,2]);return d}function R(a){const b={};for(let f=0;f<a.length;f++){var d,c=a[f],e=null==(d=c.BandName)?void 0:d.toLowerCase();"red"===e?b.red=f:"green"===e?b.green=f:"blue"===e?b.blue=f:"nearinfrared"===e||"nearinfrared_1"===e||"nir"===e?b.nir=f:c.WavelengthMax&&c.WavelengthMin&&(e=c.WavelengthMin,c=c.WavelengthMax,null==b.blue&&410<=e&&480>=e&&480<=c&&540>=c?b.blue=f:null==b.green&&
490<=e&&560>=e&&560<=c&&610>=c?b.green=f:null==b.red&&595<=e&&670>=e&&660<=c&&730>=c?b.red=f:null==b.nir&&700<=e&&860>=e&&800<=c&&950>=c&&(b.nir=f))}return b}function oa(a){let b="percent-clip";const {pixelType:d,dataType:c,histograms:e,statistics:f}=a;"u8"!==d||"processed"!==c&&h.isSome(e)&&h.isSome(f)?"u8"===d||"elevation"===c||P.has(c)?b="min-max":h.isSome(e)?b="percent-clip":h.isSome(f)&&(b=b="min-max"):b="none";return b}function S(a,b,d,c){if(!F(a,b))return null;const {attributeTable:e,statistics:f}=
a,k=G(e,b),m=y(e,"red"),q=y(e,"green"),t=y(e,"blue");a=new K;const r=[],v=new Set,u=!!(m&&q&&t);if(h.isSome(e))e.features.forEach(g=>{var n=g.attributes[k.name];v.has(g.attributes[k.name])||null==n||(v.add(n),n=!u||"single"!==m.type&&"double"!==m.type||"single"!==q.type&&"double"!==q.type||"single"!==t.type&&"double"!==t.type||e.features.some(p=>1<p.attributes[m.name]||1<p.attributes[q.name]||1<p.attributes[t.name])?1:255,r.push(new L({value:g.attributes[k.name],label:g.attributes[k.name]+"",symbol:{type:"simple-fill",
style:"solid",outline:null,color:u?new x([g.attributes[m.name]*n,g.attributes[q.name]*n,g.attributes[t.name]*n,1]):new x([0,0,0,0])}})))});else if(null!=f&&f[0])for(b=f[0].min;b<=f[0].max;b++)r.push(new L({value:b,label:b.toString(),symbol:{type:"simple-fill",style:"solid",outline:null,color:new x([0,0,0,0])}}));r.sort((g,n)=>g.value&&"string"===typeof g.value.valueOf()?0:g.value>n.value?1:-1);if(!u){const g=C.convertColorRampToColormap(T,r.length);r.forEach((n,p)=>n.symbol.color=new x(g[p].slice(1,
4)));a.colorRamp=T}if(d||c){const g=d||C.convertColorRampToColormap(c,r.length).map(n=>n.slice(1));r.forEach((n,p)=>n.symbol.color=new x(g[p]));a.colorRamp=c}return new ja({field:k.name,uniqueValueInfos:r,authoringInfo:a})}function G(a,b,d){let c;h.isSome(a)?(c=b?a.fields.find(e=>b.toLowerCase()===e.name.toLowerCase()):pa(a.fields),c||(d||(c=a.fields.find(e=>"string"===e.type)),c||(c=y(a,"value")))):c=new ba({name:"value"});return c}function pa(a){let b;for(let d=0;d<a.length;d++){const c=a[d].name.toLowerCase();
if("string"===a[d].type){if(c.startsWith("class")){b=a[d];break}null==b&&(c.endsWith("name")||c.endsWith("type"))&&(b=a[d])}}return b}function y(a,b){return h.isSome(a)?a.fields.find(d=>d.name.toLowerCase()===b):null}function F(a,b){const {attributeTable:d,bandCount:c}=a;return!h.isSome(d)&&U(a)?!0:!h.isSome(d)||1<c||b&&null==d.fields.find(e=>e.name.toLowerCase()===b.toLowerCase())?!1:!0}function H(a){const {bandCount:b,colormap:d}=a;return h.isSome(d)&&d.length&&1===b}function V(a){if(!H(a))return null;
let b;const {attributeTable:d,colormap:c}=a;if(h.isSome(d)){const e=y(d,"value"),f=G(d,null,!0);"string"===f.type&&(b={},d.features.forEach(k=>{k=k.attributes;b[k[e.name]]=f?k[f.name]:k[e.name]}))}return ka.createFromColormap(h.unwrap(c),b)}function I(a){return"elevation"===a.dataType}function J(a){const {attributeTable:b,bandCount:d}=a;return 1===d&&(h.isSome(b)||h.isSome(a.histograms))}function U(a){var b,d,c;return-1<["u8","s8"].indexOf(a.pixelType)&&null!=(null==(b=a.statistics)?void 0:null==
(d=b[0])?void 0:d.min)&&null!=(null==(c=a.statistics[0])?void 0:c.max)&&1===a.bandCount}function D(a){({dataType:a}=a);return"vector-uv"===a||"vector-magdir"===a}function W(a){({dataType:a}=a);return"vector-uv"===a||"vector-magdir"===a}function X(a){if(!D(a))return null;if(h.isSome(a.statistics)&&a.statistics.length){var b="vector-uv"===a.dataType;const {min:d,max:c}=a.statistics[0];b=[{type:"size",field:"Magnitude",minSize:10,maxSize:40,minDataValue:b?Math.min(Math.abs(d),Math.abs(c)):d,maxDataValue:b?
Math.max(Math.abs(d),Math.abs(c)):c}]}a=h.isSome(a.multidimensionalInfo)?qa.get(a.multidimensionalInfo.variables[0].unit):null;a=new na({visualVariables:b,inputUnit:a,rotationType:"geographic"});a.visualVariables=[...a.sizeVariables,...a.rotationVariables];return a}function Y(a){var b;return{color:null==(b=a.symbolLayers[0].material)?void 0:b.color,type:"esriSFS",style:"esriSFSSolid"}}const Q=E.fromJSON({type:"multipart",colorRamps:[{fromColor:[0,0,255],toColor:[0,255,255]},{fromColor:[0,255,255],
toColor:[255,255,0]},{fromColor:[255,255,0],toColor:[255,0,0]}]}),T=E.fromJSON(C.PREDEFINED_JSON_COLOR_RAMPS[0]),P=new Set("scientific standard-time vector-uv vector-magdir vector-u vector-v vector-magnitude vector-direction".split(" ")),qa=new Map([["m/s","meter-per-second"],["km/h","kilometer-per-hour"],["knots","knots"],["ft/s","feet-per-second"],["mph","mile-per-hour"]]);l.createClassBreaksRenderer=function(a,b){a=N(a,null==b?void 0:b.variableName);const {attributeTable:d}=a;if(!J(a))return null;
const c=h.isSome(a.histograms)?a.histograms[0]:null;var e=(null==b?void 0:b.numClasses)||5;const f=new K({classificationMethod:null==b?void 0:b.classificationMethod,colorRamp:null==b?void 0:b.colorRamp});let k=(null==b?void 0:b.field)||"value";const m=[],q=[],t=h.isSome(d),r=t&&d.fields.find(g=>"count"===g.name.toLowerCase()),v=t&&d.fields.find(g=>g.name.toLowerCase()===k.toLowerCase());if(v&&r){k=v.name;const g=d.features.length;let n=0;d.features.forEach(p=>n+=p.attributes[r.name]/g);d.features.forEach(p=>
{const z=p.attributes[v.name];p=p.attributes[r.name];if(0<p){q.push(p);p=Math.max(1,Math.round(p/g/n*1E3));for(let A=0;A<p;A++)m.push(z)}})}else{({pixelType:a}=a);const g=(c.max-c.min)/c.size,n=(a=-1<a.indexOf("s")||-1<a.indexOf("u"))&&1===g?Math.floor(c.min+.5):c.min,p=a&&1===g?Math.floor(c.max-.5):c.max,z=c.size;let A=0;c.counts.forEach(w=>A+=w/z);c.counts.forEach((w,B)=>{if(0<w){q.push(w);w=Math.max(1,Math.round(w/z/A*1E3));B=0===B?n:B===z-1?p:c.min+g*(B+.5);for(let Z=0;Z<w;Z++)m.push(B)}})}e=
ha.createGenerateRendererClassBreaks({values:m,valueFrequency:q,normalizationTotal:null,definition:new fa({classificationMethod:(null==b?void 0:b.classificationMethod)||"natural-breaks",breakCount:e,definedInterval:null==b?void 0:b.definedInterval})});let u=null==b?void 0:b.colors;u||(b=(null==b?void 0:b.colorRamp)||Q,f.colorRamp=b,u=C.convertColorRampToColormap(b,e.classBreaks.length,!0).map(g=>g.slice(1)));b=e.classBreaks.map((g,n)=>new da({minValue:g.minValue,maxValue:g.maxValue,label:g.label,
symbol:{type:"simple-fill",color:u[n]}}));return new ma({field:k,classBreakInfos:b,authoringInfo:f})};l.createColorRamp=function(a){const b=[];for(let d=0;d<a.length-1;d++)b[d]=new ea({algorithm:"hsv",fromColor:a[d],toColor:a[d+1]||new x({r:255,g:255,b:255,a:1})});return 2<a.length?new E({colorRamps:b}):b[0]};l.createColormapRenderer=V;l.createDefaultRenderer=function(a,b){const {attributeTable:d,colormap:c}=a;if(D(a)){var e=X(a);if(h.isSome(e))return e}return h.isSome(c)&&(e=V(a),h.isSome(e))||h.isSome(d)&&
(e=S(a),h.isSome(e))?e:M(a,b)};l.createShadedReliefRenderer=function(a,b){var d;if(!I(a))return null;({extent:a}=a);a=a.width*aa.getMetersPerUnitForSR(a.spatialReference);b=null!=(d=b)?d:"multi-directional";return new la({hillshadeType:b,scalingType:5E6<a?"adjusted":"none"})};l.createStretchRenderer=M;l.createUVRenderer=S;l.createVectorFieldRenderer=X;l.getBandNames=function(a,b){var d;const c=a.keyProperties&&a.keyProperties.BandProperties;b=null!=(d=b)&&d.length?b:Array.from(Array(a.bandCount).keys());
return b.map(e=>c&&c.length===a.bandCount?c[e]&&c[e].BandName||"band_"+(e+1):"band_"+(e+1))};l.getClassField=G;l.getDefaultBandCombination=O;l.getDefaultInterpolation=function(a,b,d){const c=["nearest","bilinear","cubic","majority"].find(e=>e===(null==d?void 0:d.toLowerCase()));return"Map"===b?null!=c?c:"bilinear":"standard-time"===a.dataType?null!=c?c:"nearest":"thematic"===a.dataType||a.attributeTable||a.colormap?"nearest"===c||"majority"===c?c:"nearest":null!=c?c:"bilinear"};l.getField=y;l.getSupportedRendererTypes=
function(a){const b=["raster-stretch"];H(a)&&b.push("raster-colormap");F(a)&&b.push("unique-value");J(a)&&b.push("class-breaks");I(a)&&b.push("raster-shaded-relief");D(a)&&b.push("vector-field");W(a)&&b.push("animated-flow");return b};l.getWellKnownBandIndexes=R;l.isAnimatedFlowRendererSupported=W;l.isClassBreaksSupported=J;l.isColormapRendererSupported=H;l.isShadedReliefRendererSupported=I;l.isSingleBand8BitRasterWithStats=U;l.isUVRendererSupported=F;l.isVectorFieldRendererSupported=D;l.normalizeRendererJSON=
function(a){if("uniqueValue"===a.type){var b,d=a.uniqueValueInfos,c=d[0].symbol;null!=c&&null!=(b=c.symbolLayers)&&b.length&&(a.uniqueValueInfos=d.map(e=>({value:e.value,label:e.label,symbol:e.symbol?Y(e.symbol):null})));return a}"classBreaks"===a.type&&(b=a.classBreakInfos,c=b[0].symbol,null!=c&&null!=(d=c.symbolLayers)&&d.length&&(a.classBreakInfos=b.map(e=>({classMinValue:e.classMinValue,classMaxValue:e.classMaxValue,label:e.label,symbol:e.symbol?Y(e.symbol):null}))));return a};Object.defineProperty(l,
"__esModule",{value:!0})});