// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.22/esri/copyright.txt for details.
//>>built
define(["../../chunks/_rollupPluginBabelHelpers","../../core/Logger","../../core/typedArrayUtil","./checkWebGLError","./enums"],function(r,t,k,l,q){const e=t.getLogger("esri.views.webgl.BufferObject");return function(){function f(a,b,c,d,g){this._context=a;this.bufferType=b;this.usage=c;this._glName=null;this._size=-1;this._indexType=void 0;a.instanceCounter.increment(q.ResourceType.Buffer,this);this._glName=this._context.gl.createBuffer();l.checkWebGLError(this._context.gl);d&&this.setData(d,g)}
f.createIndex=function(a,b,c,d){return new f(a,34963,b,c,d)};f.createVertex=function(a,b,c){return new f(a,34962,b,c)};var m=f.prototype;m.dispose=function(){var a;null!=(a=this._context)&&a.gl?(this._glName&&(this._context.gl.deleteBuffer(this._glName),this._glName=null),this._context.instanceCounter.decrement(q.ResourceType.Buffer,this),this._context=null):this._glName&&e.warn("Leaked WebGL buffer object")};m.setData=function(a,b){if(a){if("number"===typeof a){if(0>a&&e.error("Buffer size cannot be negative!"),
this._size=a,34963===this.bufferType&&b)switch(this._indexType=b,this._size=a,b){case 5123:a*=2;break;case 5125:a*=4}}else b=a.byteLength,k.isUint16Array(a)&&(b/=2,this._indexType=5123),k.isUint32Array(a)&&(b/=4,this._indexType=5125),this._size=b;b=this._context.getBoundVAO();this._context.bindVAO(null);this._context.bindBuffer(this);var c=this._context.gl;c.bufferData(this.bufferType,a,this.usage);l.checkWebGLError(c);this._context.bindVAO(b)}};m.setSubData=function(a,b=0,c=0,d=a.byteLength){if(a){(0>
b||b>=this._size)&&e.error("offset is out of range!");var g=b,h=c,n=d,p=a.byteLength;k.isUint16Array(a)?(p/=2,g*=2,h*=2,n*=2):k.isUint32Array(a)&&(p/=4,g*=4,h*=4,n*=4);void 0===d&&(d=p-1);c>=d&&e.error("end must be bigger than start!");b+c-d>this._size&&e.error("An attempt to write beyond the end of the buffer!");b=this._context.getBoundVAO();this._context.bindVAO(null);this._context.bindBuffer(this);c=this._context.gl;d=ArrayBuffer.isView(a)?a.buffer:a;a=0===h&&n===a.byteLength?d:d.slice(h,n);c.bufferSubData(this.bufferType,
g,a);l.checkWebGLError(c);this._context.bindVAO(b)}};m.setSubDataFromView=function(a,b,c,d){if(a){(0>b||b>=this._size)&&e.error("offset is out of range!");c>=d&&e.error("end must be bigger than start!");b+c-d>this._size&&e.error("An attempt to write beyond the end of the buffer!");var g=this._context.getBoundVAO();this._context.bindVAO(null);this._context.bindBuffer(this);var h=this._context.gl;c=0===c&&d===a.length?a:a.subarray(c,d);h.bufferSubData(this.bufferType,b*a.BYTES_PER_ELEMENT,c);l.checkWebGLError(h);
this._context.bindVAO(g)}};r._createClass(f,[{key:"glName",get:function(){return this._glName}},{key:"size",get:function(){return this._size}},{key:"indexType",get:function(){return this._indexType}},{key:"byteSize",get:function(){return 34962===this.bufferType?this._size:5125===this._indexType?4*this._size:2*this._size}}]);return f}()});