// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.22/esri/copyright.txt for details.
//>>built
require({cache:{"esri/views/2d/engine/flow/AnimatedFlowView2D":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ./dataUtils ./FlowContainer ./FlowStrategy ./FlowStyle".split(" "),function(x,E,r,D,A,G,z,B,H,v,m,w){r=function(C){function J(){var q=
C.apply(this,arguments)||this;q._loadImagery=(L,N,I,F)=>H.loadImagery(q.layer,L,N,I,F);q._createStreamlinesMesh=(L,N,I)=>q.layer.createStreamlinesMesh({flowData:N,rendererSettings:L},{signal:I});q.container=null;q.layer=null;q.type="rasterAnimatedFlow";q.redrawOrRefetch=x._asyncToGenerator(function*(){q._rendererChanged()});return q}x._inheritsLoose(J,C);var t=J.prototype;t.update=function(q){q.stationary?this._strategy.update(q):this.layerView.requestUpdate()};t.install=function(q){this.container=
new v;q.addChild(this.container);this._strategy=new m({flowContainer:this.container});this._rendererChanged()};t.uninstall=function(){this._strategy.destroy();this.container.removeAllChildren();this.container.remove()};t.moveEnd=function(){};t.doRefresh=function(){var q=x._asyncToGenerator(function*(){});return function(){return q.apply(this,arguments)}}();t.attach=function(){};t._rendererChanged=function(){if("animated-flow"===this.layer.renderer.type){var q=new w(this._loadImagery,this._createStreamlinesMesh,
this.layer.renderer);this.container.flowStyle=q;this.layerView.requestUpdate()}};x._createClass(J,[{key:"updating",get:function(){return!this._strategy||this._strategy.updating}}]);return J}(r);E.__decorate([D.property()],r.prototype,"_strategy",void 0);E.__decorate([D.property()],r.prototype,"container",void 0);E.__decorate([D.property()],r.prototype,"layer",void 0);E.__decorate([D.property()],r.prototype,"layerView",void 0);E.__decorate([D.property()],r.prototype,"type",void 0);E.__decorate([D.property()],
r.prototype,"updating",null);return r=E.__decorate([B.subclass("esri.views.2d.engine.flow.AnimatedFlowView2D")],r)})},"esri/views/2d/engine/flow/dataUtils":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../geometry ../../../../core/Logger ../../../../core/mathUtils ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/RandomLCG ../../../../geometry/support/spatialReferenceUtils ../../../../geometry/Extent".split(" "),function(x,E,r,D,A,G,z,B,H,v){function m(){m=
E._asyncToGenerator(function*(b,c,l){const k=performance.now();var a=w(b,c);const d=performance.now();a=J(b,a,c.width,c.height);c=performance.now();var f=q(a,!0);a=performance.now();f=L(f);const h=performance.now();b.profile&&K.info("createStreamlinesMesh profile",{"_createFlowFieldFromData()":Math.round(d-k),"_getStreamlines()":Math.round(c-d),"createAnimatedLinesData()":Math.round(a-c),"createLinesMesh()":Math.round(h-a),"Total elapsed time":Math.round(h-k)});yield Promise.resolve();z.throwIfAborted(l);
return f});return m.apply(this,arguments)}function w(b,c){const l=t(c.data,c.width,c.height,b.smoothing);return b.interpolate?(k,a)=>{const d=Math.floor(k),f=Math.floor(a);if(0>d||d>=c.width||0>f||f>=c.height)return[0,0];k-=d;a-=f;const h=d<c.width-1?d+1:d,p=f<c.height-1?f+1:f;return[(l[2*(f*c.width+d)]*(1-a)+l[2*(p*c.width+d)]*a)*(1-k)+(l[2*(f*c.width+h)]*(1-a)+l[2*(p*c.width+h)]*a)*k,(l[2*(f*c.width+d)+1]*(1-a)+l[2*(p*c.width+d)+1]*a)*(1-k)+(l[2*(f*c.width+h)+1]*(1-a)+l[2*(p*c.width+h)+1]*a)*k]}:
(k,a)=>{k=Math.round(k);a=Math.round(a);return 0>k||k>=c.width||0>a||a>=c.height?[0,0]:[l[2*(a*c.width+k)],l[2*(a*c.width+k)+1]]}}function C(b,c,l,k,a,d,f,h,p){const e=[];let g=0;e.push({x:l,y:k,t:g});for(let P=0;P<b.verticesPerLine;P++){let [O,T]=c(l,k);O*=b.velocityScale;T*=b.velocityScale;var n=Math.sqrt(O*O+T*T);if(n<b.minSpeedThreshold)break;const R=O/n,S=T/n;l+=R*b.segmentLength;k+=S*b.segmentLength;g+=b.segmentLength/n;if(Math.acos(R*u+S*y)>b.maxTurnAngle)break;if(b.mergeLines){var u=Math.round(l*
p);var y=Math.round(k*p);if(0>u||u>f-1||0>y||y>h-1)break;n=d[y*f+u];if(-1!==n&&n!==a)break;d[y*f+u]=a}e.push({x:l,y:k,t:g});u=R;y=S}return e}function J(b,c,l,k){const a=[],d=new B,f=1/Math.max(b.lineCollisionWidth,1),h=Math.round(l*f),p=Math.round(k*f),e=new Int32Array(h*p);for(var g=0;g<e.length;g++)e[g]=-1;g=[];for(let n=0;n<k;n+=b.lineSpacing)for(let u=0;u<l;u+=b.lineSpacing)g.push({x:u,y:n,sort:d.getFloat()});g.sort((n,u)=>n.sort-u.sort);for(const {x:n,y:u}of g)d.getFloat()<b.density&&(l=C(b,
c,n,u,a.length,e,h,p,f),2>l.length||a.push(l));return a}function t(b,c,l,k){if(0===k)return b;const a=Math.round(3*k),d=Array(2*a+1);var f=0;for(var h=-a;h<=a;h++){var p=Math.exp(-h*h/(k*k));d[h+a]=p;f+=p}for(k=-a;k<=a;k++)d[k+a]/=f;f=new Float32Array(b.length);for(k=0;k<l;k++)for(h=0;h<c;h++){var e=p=0;for(var g=-a;g<=a;g++)if(!(0>h+g||h+g>=c)){var n=d[g+a];p+=n*b[2*(k*c+(h+g))];e+=n*b[2*(k*c+(h+g))+1]}f[2*(k*c+h)]=p;f[2*(k*c+h)+1]=e}b=new Float32Array(b.length);for(k=0;k<c;k++)for(h=0;h<l;h++){e=
p=0;for(g=-a;g<=a;g++)0>h+g||h+g>=l||(n=d[g+a],p+=n*f[2*((h+g)*c+k)],e+=n*f[2*((h+g)*c+k)+1]);b[2*(h*c+k)]=p;b[2*(h*c+k)+1]=e}return b}function q(b,c){const l=new B;var k=b.reduce((h,p)=>h+p.length,0);k=new Float32Array(3*k);const a=Array(b.length);let d=0,f=0;for(const h of b){b=d;for(const p of h)k[3*d]=p.x,k[3*d+1]=p.y,k[3*d+2]=p.t,d++;a[f++]={startVertex:b,numberOfVertices:h.length,totalTime:h[h.length-1].t,timeSeed:c?l.getFloat():0}}return{lineVertices:k,lineDescriptors:a}}function L(b,c=10){function l(u,
y,P,O,T,R,S){const Q=8*p;let U=0;h[Q+U++]=u;h[Q+U++]=y;h[Q+U++]=1;h[Q+U++]=P;h[Q+U++]=R;h[Q+U++]=S;h[Q+U++]=O;h[Q+U++]=T;p++;h[Q+U++]=u;h[Q+U++]=y;h[Q+U++]=-1;h[Q+U++]=P;h[Q+U++]=R;h[Q+U++]=S;h[Q+U++]=-O;h[Q+U++]=-T;p++}const {lineVertices:k,lineDescriptors:a}=b;var d=b=0;for(var f of a)b+=2*f.numberOfVertices,d+=6*(f.numberOfVertices-1);const h=new Float32Array(8*b);f=new Uint32Array(d);let p=0;b=0;for(const u of a){const {totalTime:y,timeSeed:P}=u;let O=d=null,T=null;var e=null,g=null;for(let R=
0;R<u.numberOfVertices;R++){const S=k[3*(u.startVertex+R)],Q=k[3*(u.startVertex+R)+1],U=k[3*(u.startVertex+R)+2];let V=null,Y=null;var n=null;let W=null;0<R&&(V=S-d,Y=Q-O,n=Math.sqrt(V*V+Y*Y),V/=n,Y/=n,1<R?(e=V+e,g=Y+g,n=Math.sqrt(e*e+g*g),e/=n,g/=n,n=Math.min(1/(e*V+g*Y),c),e*=n,g*=n,n=-g,W=e):(n=-Y,W=V),null!==n&&null!==W&&(l(d,O,T,n,W,y,P),f[b++]=p-2,f[b++]=p,f[b++]=p-1,f[b++]=p,f[b++]=p+1,f[b++]=p-1));d=S;O=Q;T=U;e=V;g=Y}l(d,O,T,-g,e,y,P)}return{vertexData:h,indexData:f}}function N(b,c){const l=
c.pixels,{width:k,height:a}=c;c=new Float32Array(k*a*2);if("vector-uv"===b)for(b=0;b<k*a;b++)c[2*b]=l[0][b],c[2*b+1]=-l[1][b];else if("vector-magdir"===b)for(b=0;b<k*a;b++){const d=l[0][b],f=A.deg2rad(l[1][b]),h=Math.sin(f-Math.PI/2);c[2*b]=Math.cos(f-Math.PI/2)*d;c[2*b+1]=h*d}return{data:c,width:k,height:a}}function I(){I=E._asyncToGenerator(function*(b,c,l,k,a){var d=H.getInfo(c.spatialReference);if(!d)return F(b,c,l,k,a);const [f,h]=d.valid;d=Math.ceil(c.width/(h-f));const p=c.width/d,e=Math.round(l/
d);let g=c.xmin;const n=[];for(let u=0;u<d;u++){const y=new v({xmin:g,xmax:g+p,ymin:c.ymin,ymax:c.ymax,spatialReference:c.spatialReference});n.push(F(b,y,e,k,a));g+=p}c=yield Promise.all(n);k={data:new Float32Array(l*k*2),width:l,height:k};b=0;for(const u of c){for(c=0;c<u.height;c++)for(a=0;a<u.width;a++)b+a>=l||(k.data[2*(c*l+b+a)]=u.data[2*(c*u.width+a)],k.data[2*(c*l+b+a)+1]=u.data[2*(c*u.width+a)+1]);b+=u.width}return k});return I.apply(this,arguments)}function F(b,c,l,k,a){return M.apply(this,
arguments)}function M(){M=E._asyncToGenerator(function*(b,c,l,k,a){if("imagery"===b.type){yield b.load({signal:a});var d=b.rasterInfo.dataType;b=yield b.fetchImage(c,l,k,{signal:a});return!b||G.isNone(b.pixelData)||G.isNone(b.pixelData.pixelBlock)?{data:new Float32Array(l*k*2),width:l,height:k}:N(d,b.pixelData.pixelBlock)}yield b.load({signal:a});d=b.rasterInfo.dataType;b=yield b.fetchPixels(c,l,k,{signal:a});return!b||G.isNone(b.pixelBlock)?{data:new Float32Array(l*k*2),width:l,height:k}:N(d,b.pixelBlock)});
return M.apply(this,arguments)}const K=D.getLogger("esri.views.2d.engine.flow.dataUtils");x.createAnimatedLinesData=q;x.createLinesMesh=L;x.createStreamlinesMesh=function(b,c,l){return m.apply(this,arguments)};x.fetchPart=F;x.loadImagery=function(b,c,l,k,a){return I.apply(this,arguments)};Object.defineProperty(x,"__esModule",{value:!0})})},"esri/views/2d/engine/flow/FlowContainer":function(){define(["../../../../chunks/_rollupPluginBabelHelpers","./BrushFlow","../webgl/enums","../webgl/WGLContainer"],
function(x,E,r,D){return function(A){function G(){var B=A.apply(this,arguments)||this;B.flowStyle=null;return B}x._inheritsLoose(G,A);var z=G.prototype;z.doRender=function(B){A.prototype.doRender.call(this,B)};z.prepareRenderPasses=function(B){const H=B.registerRenderPass({name:"flow",brushes:[E],target:()=>this.children,drawPhase:r.WGLDrawPhase.MAP});return[...A.prototype.prepareRenderPasses.call(this,B),H]};x._createClass(G,[{key:"requiresDedicatedFBO",get:function(){return!1}}]);return G}(D)})},
"esri/views/2d/engine/flow/FlowStrategy":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../geometry ../../../../core/Accessor ../../../../core/Logger ../../../../core/mathUtils ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/Point ./FlowDisplayData ./FlowDisplayObject ../../../../geometry/Extent".split(" "),
function(x,E,r,D,A,G,z,B,H,v,m,w,C,J,t,q,L){function N(F,M){const K=new J({x:(F.xmax+F.xmin)/2,y:(F.ymax+F.ymin)/2,spatialReference:F.spatialReference});var b=F.xmax-F.xmin;const c=F.ymax-F.ymin,l=Math.abs(Math.cos(G.deg2rad(M))),k=Math.abs(Math.sin(G.deg2rad(M)));M=l*b+k*c;b=k*b+l*c;F=new L({xmin:K.x-M/2,ymin:K.y-b/2,xmax:K.x+M/2,ymax:K.y+b/2,spatialReference:F.spatialReference});F.centerAt(K);return F}const I=A.getLogger("esri.views.2d.engine.flow.FlowStrategy");r=function(F){function M(b){b=F.call(this,
b)||this;b._flowDisplayObject=new q.FlowDisplayObject;b._loading=null;return b}x._inheritsLoose(M,F);var K=M.prototype;K.initialize=function(){this.flowContainer.addChild(this._flowDisplayObject)};K.destroy=function(){this._clear();this.flowContainer.removeAllChildren()};K.update=function(b){var {flowStyle:c}=this.flowContainer;if(z.isNone(c))this._clear();else{var {extent:l,rotation:k,resolution:a,pixelRatio:d}=b.state;b=N(l,k);b.expand(1.15);c=new t(c,b,[Math.round((b.xmax-b.xmin)/a),Math.round((b.ymax-
b.ymin)/a)],d);if(z.isSome(this._loading)){if(this._loading.update(c))return;this._loading.destroy();this._loading=null}if(z.isNone(this._flowDisplayObject.displayData)||!this._flowDisplayObject.displayData.update(c))c.load().then(()=>{this._flowDisplayObject.clear();this._flowDisplayObject.displayData=this._loading;this._loading=null},f=>{B.isAbortError(f)||(I.error("A resource failed to load.",f),this._loading=null)}),this._loading=c}};K._clear=function(){this._flowDisplayObject.clear();z.isSome(this._loading)&&
(this._loading.destroy(),this._loading=null)};x._createClass(M,[{key:"updating",get:function(){return null!=this._loading}}]);return M}(D);E.__decorate([H.property()],r.prototype,"_loading",void 0);E.__decorate([H.property()],r.prototype,"flowContainer",void 0);E.__decorate([H.property()],r.prototype,"updating",null);return r=E.__decorate([C.subclass("esri.views.2d.engine.flow.FlowStrategy")],r)})},"esri/views/2d/engine/flow/FlowDisplayData":function(){define(["../../../../chunks/_rollupPluginBabelHelpers",
"../../../../core/Logger"],function(x,E){const r=E.getLogger("esri.views.2d.engine.flow.FlowDisplayData");return function(){function D(G,z,B,H){this.state={name:"created"};this.flowStyle=G;this.extent=z;this.size=B;this.pixelRatio=H}var A=D.prototype;A.load=function(){var G=x._asyncToGenerator(function*(){const z=new AbortController;this.state={name:"loading",abortController:z};this.state={name:"loaded",resources:yield this.flowStyle.loadResources({extent:this.extent,size:this.size,pixelRatio:this.pixelRatio},
z.signal)}});return function(){return G.apply(this,arguments)}}();A.prepareForRendering=function(G,z,B){if("loaded"!==this.state.name)r.error("Only loaded resources can be attached.");else{var H=this.state.resources;H.prepareForRendering(G,z,B);this.state={name:"attached",resources:H}}};A.destroy=function(){"loading"===this.state.name?(this.state.abortController.abort(),this.state={name:"detached"}):"attached"===this.state.name&&(this.state.resources.detach(),this.state={name:"detached"})};A.update=
function(G){if(!this.flowStyle.areResourcesCompatible(G.flowStyle)||!this.extent.equals(G.extent)||this.size[0]!==G.size[0]||this.size[1]!==G.size[1]||this.pixelRatio!==G.pixelRatio)return!1;this.flowStyle=G.flowStyle;return!0};return D}()})},"esri/views/2d/engine/flow/FlowDisplayObject":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/mathUtils ../../../../core/maybe ../../../../chunks/mat3 ../../../../chunks/mat3f32 ../DisplayObject".split(" "),function(x,
E,r,D,A,G,z){z=function(B){function H(){var m=B.apply(this,arguments)||this;m._displayData=null;return m}E._inheritsLoose(H,B);var v=H.prototype;v.clear=function(){D.isSome(this._displayData)&&(this._displayData.destroy(),this._displayData=null,this.requestRender())};v.setTransform=function(m){var {displayData:w}=this;if(!D.isNone(w)){var C=[0,0];m.toScreen(C,[w.extent.xmin,w.extent.ymax]);w=(w.extent.xmax-w.extent.xmin)/w.size[0]/m.resolution;var J=r.deg2rad(m.rotation),{dvs:t}=this.transforms;A.identity(t);
A.translate(t,t,[-1,1,0]);A.scale(t,t,[2/(m.size[0]*m.pixelRatio),-2/(m.size[1]*m.pixelRatio),1]);A.translate(t,t,[C[0],C[1],0]);A.rotate(t,t,J);A.scale(t,t,[w*m.pixelRatio,w*m.pixelRatio,1])}};v._createTransforms=function(){return{dvs:G.create()}};E._createClass(H,[{key:"displayData",get:function(){return this._displayData},set:function(m){this._displayData=m;this.requestRender()}}]);return H}(z.DisplayObject);x.FlowDisplayObject=z;Object.defineProperty(x,"__esModule",{value:!0})})},"esri/views/2d/engine/flow/FlowStyle":function(){define(["../../../../chunks/_rollupPluginBabelHelpers",
"../../../../core/promiseUtils","./animatedFlowRendererUtils","./FlowGLResources"],function(x,E,r,D){return function(){function A(z,B,H){this._loadImagery=z;this._createStreamlinesMesh=B;this._rendererSettings=r.createAnimatedFlowRendererSettings(H)}var G=A.prototype;G.areResourcesCompatible=function(z){let B;(B=(B=(B=(B=(B=(B=(B=(B=(B=(B=(B=(B=z._loadImagery===this._loadImagery)&&z._createStreamlinesMesh===this._createStreamlinesMesh)&&z._rendererSettings.verticesPerLine===this._rendererSettings.verticesPerLine)&&
z._rendererSettings.segmentLength===this._rendererSettings.segmentLength)&&z._rendererSettings.lineSpacing===this._rendererSettings.lineSpacing)&&z._rendererSettings.density===this._rendererSettings.density)&&z._rendererSettings.smoothing===this._rendererSettings.smoothing)&&z._rendererSettings.velocityScale===this._rendererSettings.velocityScale)&&z._rendererSettings.minWeightThreshold===this._rendererSettings.minWeightThreshold)&&z._rendererSettings.minSpeedThreshold===this._rendererSettings.minSpeedThreshold)&&
z._rendererSettings.mergeLines===this._rendererSettings.mergeLines)&&z._rendererSettings.interpolate===this._rendererSettings.interpolate)&&this._rendererSettings.mergeLines&&(B=z._rendererSettings.lineCollisionWidth===this._rendererSettings.lineCollisionWidth);return B?!0:!1};G.loadResources=function(){var z=x._asyncToGenerator(function*(B,H){const {extent:v,size:m}=B;E.throwIfAborted(H);B=yield this._loadImagery(v,m[0],m[1],H);const {vertexData:w,indexData:C}=yield this._createStreamlinesMesh(this._rendererSettings,
B,H);return new D(w,C)});return function(B,H){return z.apply(this,arguments)}}();x._createClass(A,[{key:"animated",get:function(){return 0<this._rendererSettings.lineSpeed}},{key:"renderSettings",get:function(){return this._rendererSettings}}]);return A}()})},"esri/views/2d/engine/flow/animatedFlowRendererUtils":function(){define(["exports","../../../../core/screenUtils"],function(x,E){x.createAnimatedFlowRendererSettings=function(r){const D=E.pt2px(r.lineWidth),A=2*D,G=Math.round(E.pt2px(r.lineLength)/
A)+1;var z=r.lineColor.toRgba();z=[z[0]/255,z[1]/255,z[2]/255,z[3]];const {lineSpeed:B,fadeDuration:H,density:v}=r;r=E.pt2px(r.smoothing);return{lineRenderWidth:D,segmentLength:A,verticesPerLine:G,lineCollisionWidth:D,lineSpacing:10,lineColor:z,lineSpeed:B,fadeDuration:H,density:v,smoothing:r,velocityScale:1,minWeightThreshold:.001,minSpeedThreshold:.001,maxTurnAngle:1,mergeLines:!0,interpolate:!0,profile:!1}};Object.defineProperty(x,"__esModule",{value:!0})})},"esri/views/2d/engine/flow/FlowGLResources":function(){define("../../../webgl/BufferObject ../../../webgl/FramebufferObject ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/has ../../../webgl/checkWebGLError ../../../webgl/enums ../../../../chunks/builtins ../../../webgl/Texture ../../../webgl/VertexArrayObject".split(" "),
function(x,E,r,D,A,G,z,B,H){return function(){function v(w,C){this._vertexData=w;this._indexData=C}var m=v.prototype;m.prepareForRendering=function(w,C,J){const t=x.createVertex(w,35044,this._vertexData),q=x.createIndex(w,35044,this._indexData);w=new H(w,C,J,{geometry:t},q);this.vertexBuffer=t;this.indexBuffer=q;this.vertexArray=w;this._indexData=this._vertexData=null};m.detach=function(){this.vertexArray.dispose();this.vertexBuffer.dispose();this.indexBuffer.dispose()};return v}()})},"esri/views/2d/layers/LayerView2D":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Collection ../../../core/collectionUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../engine/Container ../../layers/support/ClipArea ../../layers/support/ClipRect ../../layers/support/Geometry ../../layers/support/Path".split(" "),
function(x,E,r,D,A,G,z,B,H,v,m,w,C,J,t,q){const L=D.ofType({key:"type",base:C,typeMap:{rect:J,path:q,geometry:t}});x.LayerView2DMixin=N=>{N=function(I){function F(){var K=I.apply(this,arguments)||this;K.clips=new L;K.moving=!1;K.attached=!1;K.lastUpdateId=-1;K.updateRequested=!1;return K}E._inheritsLoose(F,I);var M=F.prototype;M.initialize=function(){var K;this.container||(this.container=new w.Container);this.container.fadeTransitionEnabled=!0;this.container.opacity=0;this.container.clips=this.clips;
this.handles.add([G.init(this,"suspended",b=>{this.container&&(this.container.visible=!b);this.view&&!b&&this.updateRequested&&this.view.requestUpdate()},!0),G.init(this,["layer.opacity","container"],()=>{if(this.container){var b,c;this.container.opacity=null!=(b=null==(c=this.layer)?void 0:c.opacity)?b:1}},!0),G.init(this,["layer.blendMode"],b=>{this.container&&(this.container.blendMode=b)},!0),G.init(this,["layer.effect"],b=>{this.container&&(this.container.effect=b)},!0),this.clips.on("change",
()=>{this.container.clips=this.clips;this.notifyChange("clips")})]);null!=(K=this.view)&&K.whenLayerView?this.view.whenLayerView(this.layer).then(b=>{b!==this||this.attached||this.destroyed||(this.attach(),this.requestUpdate(),this.attached=!0)},()=>{}):this.when().then(()=>{this.attached||this.destroyed||(this.attach(),this.requestUpdate(),this.attached=!0)},()=>{})};M.destroy=function(){this.attached&&(this.detach(),this.attached=!1);this.handles.remove("initialize");this.updateRequested=!1};M.isVisibleAtScale=
function(K){var b=!0,c=this.layer;const l=c.minScale;c=c.maxScale;if(null!=l&&null!=c){b=!l;let k=!c;!b&&K<=l&&(b=!0);!k&&K>=c&&(k=!0);b=b&&k}return b};M.requestUpdate=function(){this.destroyed||this.updateRequested||(this.updateRequested=!0,this.suspended||this.view.requestUpdate())};M.processUpdate=function(K){this.isFulfilled()&&!this.isResolved()?this.updateRequested=!1:(this._set("updateParameters",K),this.updateRequested&&!this.suspended&&(this.updateRequested=!1,this.update(K)))};M.hitTest=
function(K,b){return Promise.resolve(null)};M.isUpdating=function(){return!1};M.isRendering=function(){return!1};M.canResume=function(){return I.prototype.canResume.call(this)?this.isVisibleAtScale(this.view.scale):!1};E._createClass(F,[{key:"updating",get:function(){return!this.attached||!this.suspended&&(this.updateRequested||this.isUpdating())||!(!this.updatingHandles||!this.updatingHandles.updating)}}]);return F}(N);r.__decorate([z.property({type:L,set(I){I=A.referenceSetter(I,this._get("clips"),
L);this._set("clips",I)}})],N.prototype,"clips",void 0);r.__decorate([z.property()],N.prototype,"moving",void 0);r.__decorate([z.property()],N.prototype,"attached",void 0);r.__decorate([z.property()],N.prototype,"container",void 0);r.__decorate([z.property()],N.prototype,"suspended",void 0);r.__decorate([z.property({readOnly:!0})],N.prototype,"updateParameters",void 0);r.__decorate([z.property()],N.prototype,"updateRequested",void 0);r.__decorate([z.property()],N.prototype,"updating",null);r.__decorate([z.property()],
N.prototype,"view",void 0);return N=r.__decorate([m.subclass("esri.views.2d.layers.LayerView2D")],N)};Object.defineProperty(x,"__esModule",{value:!0})})},"esri/views/layers/support/ClipArea":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/JSONSupport ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/set ../../../core/accessorSupport/decorators/subclass".split(" "),
function(x,E,r,D,A,G,z,B,H){r=function(v){function m(){return v.apply(this,arguments)||this}x._inheritsLoose(m,v);return m}(r.JSONSupport);return r=E.__decorate([H.subclass("esri.views.layers.support.ClipArea")],r)})},"esri/views/layers/support/ClipRect":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ./ClipArea".split(" "),
function(x,E,r,D,A,G,z,B){var H;D=H=function(v){function m(){var w=v.apply(this,arguments)||this;w.type="rect";w.left=null;w.right=null;w.top=null;w.bottom=null;return w}x._inheritsLoose(m,v);m.prototype.clone=function(){return new H({left:this.left,right:this.right,top:this.top,bottom:this.bottom})};x._createClass(m,[{key:"version",get:function(){return(this._get("version")||0)+1}}]);return m}(B);E.__decorate([r.property({type:[Number,String],json:{write:!0}})],D.prototype,"left",void 0);E.__decorate([r.property({type:[Number,
String],json:{write:!0}})],D.prototype,"right",void 0);E.__decorate([r.property({type:[Number,String],json:{write:!0}})],D.prototype,"top",void 0);E.__decorate([r.property({type:[Number,String],json:{write:!0}})],D.prototype,"bottom",void 0);E.__decorate([r.property({readOnly:!0})],D.prototype,"version",null);return D=H=E.__decorate([z.subclass("esri.views.layers.support.ClipRect")],D)})},"esri/views/layers/support/Geometry":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../geometry ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../geometry/Geometry ../../../geometry/support/jsonUtils ./ClipArea ../../../geometry/Extent ../../../geometry/Polygon".split(" "),
function(x,E,r,D,A,G,z,B,H,v,m,w,C){var J;r={base:H,key:"type",typeMap:{extent:w,polygon:C}};m=J=function(t){function q(){var L=t.apply(this,arguments)||this;L.type="geometry";L.geometry=null;return L}x._inheritsLoose(q,t);q.prototype.clone=function(){return new J({geometry:this.geometry.clone()})};x._createClass(q,[{key:"version",get:function(){return(this._get("version")||0)+1}}]);return q}(m);E.__decorate([D.property({types:r,json:{read:v.fromJSON,write:!0}})],m.prototype,"geometry",void 0);E.__decorate([D.property({readOnly:!0})],
m.prototype,"version",null);return m=J=E.__decorate([B.subclass("esri.views.layers.support.Geometry")],m)})},"esri/views/layers/support/Path":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ./ClipArea".split(" "),function(x,E,r,D,A,G,z,B){D=function(H){function v(){var m=H.apply(this,
arguments)||this;m.type="path";m.path=[];return m}x._inheritsLoose(v,H);x._createClass(v,[{key:"version",get:function(){return(this._get("version")||0)+1}}]);return v}(B);E.__decorate([r.property({type:[[[Number]]],json:{write:!0}})],D.prototype,"path",void 0);E.__decorate([r.property({readOnly:!0})],D.prototype,"version",null);return D=E.__decorate([z.subclass("esri.views.layers.support.Path")],D)})},"esri/views/2d/layers/imagery/ImageryTileView2D":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/maybe ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../engine/RasterTileContainer ./BaseImageryTileSubView2D ../support/util".split(" "),
function(x,E,r,D,A,G,z,B,H,v,m){A=function(w){function C(){var t=w.apply(this,arguments)||this;t.container=null;t.layer=null;t.type="raster";return t}x._inheritsLoose(C,w);var J=C.prototype;J.canUseWebGLForProcessing=function(){return this.useWebGLForProcessing&&this.layer.symbolizer.canRenderInWebGL&&!("majority"===this.layer.interpolation&&m.canUseMajorityInterpolationOnDataSource(this.layer))};J.fetchTile=function(t,q){return this.layer.fetchTile(t.level,t.row,t.col,q)};J.updateTileSource=function(){var t=
x._asyncToGenerator(function*(q,L){const {bandIds:N}=this.layer,I=this._getLayerInterpolation(),F=this.canUseWebGLForProcessing(),{source:M,symbolizerParams:K,globalSymbolizerParams:b,suspended:c,coords:l,resolution:k}=L;({bitmap:q}=q);[q.x,q.y]=l;q.resolution=k;M&&r.isSome(M)&&r.isSome(M.pixelBlock)?(L={extent:M.extent,pixelBlock:M.pixelBlock},q.rawPixelData=L,F?(q.source=M.pixelBlock,q.isRendereredSource=!1):(L=yield this.layer.applyRenderer(L,"stretch"===(null==b?void 0:b.type)?b:null),q.source=
L,q.isRendereredSource=!0),q.symbolizerParameters=F?K:null,F?q.transformGrid||(q.transformGrid=M.transformGrid):q.transformGrid=null):(L=this.createEmptyTilePixelBlock(),q.source=L,q.symbolizerParameters=F?K:null,q.transformGrid=null);q.bandIds=F?N:null;q.width=this._tileInfoView.tileInfo.size[0];q.height=this._tileInfoView.tileInfo.size[1];q.interpolation=I;q.suspended=c;q.invalidateTexture()});return function(q,L){return t.apply(this,arguments)}}();J.updateTileSymbolizerParameters=function(){var t=
x._asyncToGenerator(function*(q,L){const {local:N,global:I}=L;({bandIds:L}=this.layer);const F=this._getLayerInterpolation(),M=this.canUseWebGLForProcessing();({bitmap:q}=q);const {rawPixelData:K}=q;!M&&r.isSome(K)?(q.source=yield this.layer.applyRenderer(K,"stretch"===(null==I?void 0:I.type)?I:null),q.isRendereredSource=!0):(q.isRendereredSource&&r.isSome(K)&&(q.source=K.pixelBlock),q.isRendereredSource=!1);q.symbolizerParameters=M?I||N:null;q.bandIds=M?L:null;q.interpolation=F;q.suspended=!1});
return function(q,L){return t.apply(this,arguments)}}();J.install=function(t){this.container=new H.RasterTileContainer(this._tileInfoView);this.container.isCustomTilingScheme=this._isCustomTilingScheme;t.addChild(this.container)};J.uninstall=function(){this.container.removeAllChildren();this.container.remove();w.prototype.uninstall.call(this)};J._getLayerInterpolation=function(){var t=this.layer.renderer.type;if("raster-colormap"===t||"unique-value"===t||"class-breaks"===t)return"nearest";({interpolation:t}=
this.layer);const {renderer:q}=this.layer;return"raster-stretch"===q.type&&null!=q.colorRamp?"bilinear"===t||"cubic"===t?"bilinear":"nearest":t};return C}(v.BaseImageryTileSubView2D);E.__decorate([D.property()],A.prototype,"container",void 0);E.__decorate([D.property()],A.prototype,"layer",void 0);E.__decorate([D.property()],A.prototype,"type",void 0);return A=E.__decorate([B.subclass("esri.views.2d.layers.imagery.ImageryTileView2D")],A)})},"esri/views/2d/engine/RasterTileContainer":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../geometry/support/aaBoundingRect ../viewpointUtils ./brushes ./RasterTile ./webgl/enums ./webgl/TileContainer".split(" "),
function(x,E,r,D,A,G,z,B){B=function(H){function v(){var w=H.apply(this,arguments)||this;w.isCustomTilingScheme=!1;return w}E._inheritsLoose(v,H);var m=v.prototype;m.createTile=function(w){const C=this._getTileBounds(w),[J,t]=this._tileInfoView.tileInfo.size;return new G.RasterTile(w,C[0],C[3],J,t)};m.destroyTile=function(){};m.prepareRenderPasses=function(w){const C=w.registerRenderPass({name:"imagery (tile)",brushes:[A.brushes.raster],target:()=>this.children.map(J=>J.bitmap),drawPhase:z.WGLDrawPhase.MAP});
return[...H.prototype.prepareRenderPasses.call(this,w),C]};m.doRender=function(w){this.visible&&w.drawPhase===z.WGLDrawPhase.MAP&&H.prototype.doRender.call(this,w)};m._getTileBounds=function(w){const C=this._tileInfoView.getTileBounds(r.create(),w);if(this.isCustomTilingScheme&&w.world){var {tileInfo:J}=this._tileInfoView,t=D.getWorldWidth(J.spatialReference);if(t){const {resolution:q}=J.lodAt(w.level);J=(t=t/q%J.size[0])?(J.size[0]-t)*q:0;C[0]-=J*w.world;C[2]-=J*w.world}}return C};return v}(B.default);
x.RasterTileContainer=B;Object.defineProperty(x,"__esModule",{value:!0})})},"esri/views/2d/engine/RasterTile":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../chunks/mat3f32","./RasterBitmap","./webgl/TiledDisplayObject"],function(x,E,r,D,A){A=function(G){function z(H,v,m,w,C,J=null){var t=G.call(this,H,v,m,w,C)||this;t.bitmap=new D.RasterBitmap(J,null,null);t.bitmap.coordScale=[w,C];t.bitmap.once("isReady",()=>t.ready());return t}E._inheritsLoose(z,G);var B=z.prototype;
B.destroy=function(){G.prototype.destroy.call(this);this.bitmap.destroy();this.stage=this.bitmap=null};B.setTransform=function(H,v){G.prototype.setTransform.call(this,H,v);this.bitmap.transforms.dvs=this.transforms.dvs};B._createTransforms=function(){return{dvs:r.create(),tileMat3:r.create()}};B.onAttach=function(){this.bitmap.stage=this.stage};B.onDetach=function(){this.bitmap.stage=null};E._createClass(z,[{key:"stencilRef",get:function(){return this.bitmap.stencilRef},set:function(H){this.bitmap.stencilRef=
H}}]);return z}(A.TiledDisplayObject);x.RasterTile=A;Object.defineProperty(x,"__esModule",{value:!0})})},"esri/views/2d/layers/imagery/BaseImageryTileSubView2D":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../geometry ../../../../core/HandleOwner ../../../../core/Logger ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/Point ../../../../layers/support/PixelBlock ../../../../layers/support/TileInfo ../../../../layers/support/rasterDatasets/RawBlockCache ../../../../layers/support/rasterFunctions/pixelUtils ../../../../layers/support/rasterFunctions/rasterProjectionHelper ../../tiling/PagedTileQueue ../../tiling/TileInfoView ../../tiling/TileKey ../../tiling/TileQueue ../../tiling/TileStrategy ../../../webgl/capabilities ../../../../geometry/Extent".split(" "),
function(x,E,r,D,A,G,z,B,H,v,m,w,C,J,t,q,L,N,I,F,M,K,b,c,l,k){const a=[0,0],d=G.getLogger("esri.views.2d.layers.ImageryTileLayerView2D");x.BaseImageryTileSubView2D=function(f){function h(){var e=f.apply(this,arguments)||this;e._emptyTilePixelBlock=null;e._tileStrategy=null;e._tileInfoView=null;e._fetchQueue=null;e._blockCacheRegistryUrl=null;e._blockCacheRegistryId=null;e._srcResolutions=null;e.previousLOD=null;e._needBlockCacheUpdate=!1;e._globalSymbolizerParams=null;e._symbolizerParams=null;e._abortController=
null;e._isCustomTilingScheme=!1;e._globalUpdateRequested=!1;e.container=null;e.layer=null;e.redrawOrRefetch=B.debounce((g,n)=>!e.previousLOD||e.layerView.suspended?Promise.resolve():g?e.doRefresh():e._redrawImage(n));return e}E._inheritsLoose(h,f);var p=h.prototype;p.update=function(e){this._fetchQueue.pause();this._fetchQueue.state=e.state;this._tileStrategy.update(e);this._fetchQueue.resume();const {extent:g,resolution:n,scale:u}=e.state;e=this._tileInfoView.getClosestInfoForScale(u);if(this.layer.raster){var y;
if(!this.useProgressiveUpdate||this._needBlockCacheUpdate){const P=this._srcResolutions[e.level],O=g.toJSON?g:k.fromJSON(g);L.update(this._blockCacheRegistryUrl,this._blockCacheRegistryId,O,n,P,this.layer.raster.ioConfig.sampling)}this._needBlockCacheUpdate=!1;(null==(y=this.previousLOD)?void 0:y.level)!==e.level&&(this.previousLOD=e,null==this._symbolizerParams||this.layerView.hasTilingEffects||this._updateSymbolizerParams(),this._tileStrategy.updateCacheSize(0))}};p.moveEnd=function(){if(this.layerView.hasTilingEffects||
!this.useProgressiveUpdate)this._abortController&&this._abortController.abort(),this._abortController=new AbortController,0===this._fetchQueue.length&&this._redrawImage(this._abortController.signal).then(()=>{this._globalUpdateRequested=!1;this.layerView.requestUpdate()});const e=this._getCacheSize(this.useProgressiveUpdate);this._tileStrategy.updateCacheSize(e);this.layerView.requestUpdate()};p.attach=function(){l().supportsTextureFloat||(this.useWebGLForProcessing=!1);this._initializeTileInfo();
this._tileInfoView=new M(this.layerView.tileInfo,this.layerView.fullExtent);var e=this._computeFetchConcurrency();this._fetchQueue=new b({tileInfoView:this._tileInfoView,concurrency:e,process:(g,n)=>this._fetchTile1(g,n)});e=this._getCacheSize(this.useProgressiveUpdate);this._tileStrategy=new c({cachePolicy:"purge",acquireTile:g=>this.acquireTile(g),releaseTile:g=>this.releaseTile(g),cacheSize:e,tileInfoView:this._tileInfoView});this._updateBlockCacheRegistry()};p.acquireTile=function(e){e=this.container.createTile(e);
this._enqueueTileFetch(e);this.layerView.requestUpdate();this._needBlockCacheUpdate=!0;this._globalUpdateRequested=this.layerView.hasTilingEffects||!this.useProgressiveUpdate;return e};p.releaseTile=function(e){this._fetchQueue.abort(e.key.id);this.container.removeChild(e);e.once("detach",()=>{e.destroy();this.layerView.requestUpdate()});this.layerView.requestUpdate()};p.uninstall=function(){this._tileStrategy.destroy();this._fetchQueue.clear();this.container.removeAllChildren();this._fetchQueue=
this._tileStrategy=this._tileInfoView=null;this.notifyChange("updating");L.unregister(this._blockCacheRegistryUrl,this._blockCacheRegistryId)};p.createEmptyTilePixelBlock=function(e=null){const g=null==e||e.join(",")===this._tileInfoView.tileInfo.size.join(",");if(g&&z.isSome(this._emptyTilePixelBlock))return this._emptyTilePixelBlock;e=e||this._tileInfoView.tileInfo.size;const [n,u]=e;e=new t({width:n,height:u,pixels:[new Uint8Array(n*u)],mask:new Uint8Array(n*u),pixelType:"u8"});g&&(this._emptyTilePixelBlock=
e);return e};p._fetchTile1=function(e,g){g=!z.isNone(g)&&g.signal;const n=this.canUseWebGLForProcessing();g={allowPartialFill:!0,datumTransformation:this.layerView.datumTransformation,interpolation:n?"nearest":this.layer.interpolation,registryId:this._blockCacheRegistryId,requestRawData:n,signal:z.unwrap(g),srcResolution:this._srcResolutions[e.level],timeExtent:this.layerView.timeExtent,tileInfo:this.layerView.tileInfo};return this.fetchTile(e,g)};p._getCacheSize=function(e){return e?40:0};p._initializeTileInfo=
function(){var e=this.layerView.view.spatialReference;const g=new J({x:this.layerView.fullExtent.xmin,y:this.layerView.fullExtent.ymax,spatialReference:e}),{scales:n,srcResolutions:u,isCustomTilingScheme:y}=I.computeProjectedScales(this.layer.rasterInfo,e);e=q.create({spatialReference:e,size:512,scales:n});if(0===e.origin.x||e.origin.x>g.x)e.origin=g;this._isCustomTilingScheme=y;this.layerView.set("tileInfo",e);this._srcResolutions=null!=u?u:[]};p._computeFetchConcurrency=function(){var {blockBoundary:e}=
this.layer.rasterInfo.storageInfo;e=e[e.length-1];return 64<(e.maxCol-e.minCol+1)*(e.maxRow-e.minRow+1)?2:10};p._enqueueTileFetch=function(){var e=E._asyncToGenerator(function*(g,n){if(!this._fetchQueue.has(g.key.id)){try{const u=yield this._fetchQueue.push(g.key);this.notifyChange("updating");const {bandIds:y}=this.layer;let P=!this.useProgressiveUpdate||this.layerView.hasTilingEffects&&!this._globalSymbolizerParams;if(this._globalUpdateRequested&&!this.layerView.moving&&0===this._fetchQueue.length){P=
!1;try{yield this._redrawImage(this._abortController&&this._abortController.signal)}catch(R){B.isAbortError(R)&&d.error(R)}this._globalUpdateRequested=!1}!this.canUseWebGLForProcessing()&&"rasterVF"!==this.type||this.layerView.hasTilingEffects||null!=this._symbolizerParams||this._updateSymbolizerParams();const O=this._tileInfoView.getTileCoords(a,g.key),T=this._tileInfoView.getTileResolution(g.key);yield this.updateTileSource(g,{source:u,symbolizerParams:this._symbolizerParams,globalSymbolizerParams:this._globalSymbolizerParams,
suspended:P,bandIds:y,coords:O,resolution:T});g.once("attach",()=>this.layerView.requestUpdate());this.container.addChild(g)}catch(u){B.isAbortError(u)||d.error(u)}this.layerView.requestUpdate()}});return function(g,n){return e.apply(this,arguments)}}();p._redrawImage=function(){var e=E._asyncToGenerator(function*(g){var n=this;0!==this.container.children.length&&(yield this.updatingHandles.addPromise(this.layer.updateRenderer()),this.layerView.hasTilingEffects?yield this._updateGlobalSymbolizerParams(g):
(this._updateSymbolizerParams(),this._globalSymbolizerParams=null),g=this.container.children.map(function(){var u=E._asyncToGenerator(function*(y){return n.updateTileSymbolizerParameters(y,{local:n._symbolizerParams,global:n._globalSymbolizerParams})});return function(y){return u.apply(this,arguments)}}()),yield B.eachAlways(g),this.container.requestRender())});return function(g){return e.apply(this,arguments)}}();p._updateGlobalSymbolizerParams=function(){var e=E._asyncToGenerator(function*(g){(g=
yield this.layer.fetchPixels(this.layerView.view.extent,this.layerView.view.width,this.layerView.view.height,{srcResolution:this._srcResolutions[this.previousLOD.level],registryId:this._blockCacheRegistryId,signal:g}))&&g.pixelBlock&&(g=this.layer.symbolizer.generateWebGLParameters({pixelBlock:N.extractBands(g.pixelBlock,this.layer.bandIds),isGCS:this.layerView.view.spatialReference.isGeographic,resolution:{x:this.previousLOD.resolution,y:this.previousLOD.resolution},bandIds:this.layer.bandIds}),
!this.canUseWebGLForProcessing()&&g&&"stretch"===g.type&&this.layer.renderer&&"raster-stretch"===this.layer.renderer.type&&(g.factor=g.factor.map(n=>255*n),g.outMin=Math.round(255*g.outMin),g.outMax=Math.round(255*g.outMax)),this._globalSymbolizerParams=g)});return function(g){return e.apply(this,arguments)}}();p._updateSymbolizerParams=function(){this._symbolizerParams=this.layer.symbolizer.generateWebGLParameters({pixelBlock:null,isGCS:this.layerView.view.spatialReference.isGeographic,resolution:{x:this.previousLOD.resolution,
y:this.previousLOD.resolution},bandIds:this.layer.bandIds})};p._updateBlockCacheRegistry=function(e=!1){const {url:g,rasterInfo:n,raster:u}=this.layer;var {multidimensionalDefinition:y}=this.layer.normalizeRasterFetchOptions({multidimensionalDefinition:this.layer.multidimensionalDefinition,timeExtent:this.layerView.timeExtent});y=null!=n&&n.multidimensionalInfo?u.getSliceIndex(y):null;y=L.getRasterId(g,y);y!==this._blockCacheRegistryUrl&&(null!=this._blockCacheRegistryUrl&&L.unregister(this._blockCacheRegistryUrl,
this._blockCacheRegistryId),this._blockCacheRegistryId=L.register(y,this.layer.raster.rasterInfo),e&&(e=this._tileInfoView.getClosestInfoForScale(this.layerView.view.scale),L.update(y,this._blockCacheRegistryId,this.layerView.view.extent,this.layerView.view.resolution,this._srcResolutions[e.level],this.layer.raster.ioConfig.sampling)),this._blockCacheRegistryUrl=y)};p.doRefresh=function(){var e=E._asyncToGenerator(function*(){yield this.updatingHandles.addPromise(this.layer.updateRenderer());this.layerView.hasTilingEffects||
this._updateSymbolizerParams();this._updateBlockCacheRegistry(!0);this._fetchQueue.reset();this.notifyChange("updating");const g=[];this._tileStrategy.tiles.forEach(n=>g.push(this._enqueueTileFetch(n)));yield B.eachAlways(g)});return function(){return e.apply(this,arguments)}}();E._createClass(h,[{key:"useWebGLForProcessing",get:function(){var e;return null!=(e=this._get("useWebGLForProcessing"))?e:!0},set:function(e){this._set("useWebGLForProcessing",e)}},{key:"useProgressiveUpdate",get:function(){return null==
this._get("useProgressiveUpdate")?!0:this._get("useProgressiveUpdate")},set:function(e){if(this._tileStrategy&&this.useProgressiveUpdate!==e){this._tileStrategy.destroy();this.container.removeAllChildren();const g=this._getCacheSize(e);this._tileStrategy=new c({cachePolicy:"purge",acquireTile:n=>this.acquireTile(n),releaseTile:n=>this.releaseTile(n),cacheSize:g,tileInfoView:this._tileInfoView});this._set("useProgressiveUpdate",e);this.layerView.requestUpdate()}}},{key:"updating",get:function(){return 0<
this._fetchQueue.length||this._globalUpdateRequested||!(!this.updatingHandles||!this.updatingHandles.updating)}}]);return h}(A.HandleOwner);r.__decorate([H.property()],x.BaseImageryTileSubView2D.prototype,"_globalUpdateRequested",void 0);r.__decorate([H.property()],x.BaseImageryTileSubView2D.prototype,"container",void 0);r.__decorate([H.property()],x.BaseImageryTileSubView2D.prototype,"layer",void 0);r.__decorate([H.property()],x.BaseImageryTileSubView2D.prototype,"layerView",void 0);r.__decorate([H.property()],
x.BaseImageryTileSubView2D.prototype,"type",void 0);r.__decorate([H.property()],x.BaseImageryTileSubView2D.prototype,"useWebGLForProcessing",null);r.__decorate([H.property()],x.BaseImageryTileSubView2D.prototype,"useProgressiveUpdate",null);r.__decorate([H.property()],x.BaseImageryTileSubView2D.prototype,"updating",null);x.BaseImageryTileSubView2D=r.__decorate([C.subclass("esri.views.2d.layers.imagery.BaseImageryTileSubView2D")],x.BaseImageryTileSubView2D);Object.defineProperty(x,"__esModule",{value:!0})})},
"esri/layers/support/rasterDatasets/RawBlockCache":function(){define("exports ../../../geometry ../../../core/maybe ./EphemeralBlockCache ../rasterFunctions/rasterProjectionHelper ../../../geometry/Point".split(" "),function(x,E,r,D,A,G){function z(v,m){if(!B.has(v))return null;v=B.get(v);return null==v[m]?null:v[m]}const B=new Map,H=new D;x.decreaseRefCount=function(v,m,w){if(!B.has(v))return null==m?H.decreaseRefCount(v,w):0;const C=B.get(v);if(null==C[m])return H.decreaseRefCount(v,w);m=C[m].cache;
if(m.has(w)){v=m.get(w);v.refCount--;if(0===v.refCount){m.delete(w);for(m=0;m<C.length;m++)C[m]&&C[m].cache.has(w)&&C[m].cache.delete(w);v.controller&&v.controller.abort()}return v.refCount}return 0};x.deleteBlock=function(v,m,w){if(B.has(v)){var C=B.get(v);null==C[m]?H.deleteBlock(v,w):C[m].cache.delete(w)}else null==m&&H.deleteBlock(v,w)};x.deleteRaster=function(v){B.delete(v)};x.getBlock=function(v,m,w){if(!B.has(v))return null==m?H.getBlock(v,w):null;var C=B.get(v);if(null==C[m]){for(m=0;m<C.length;m++)if(C[m]&&
C[m].cache.has(w))return w=C[m].cache.get(w),w.refCount++,w.block;return H.getBlock(v,w)}v=C[m].cache;if(v.has(w))return w=v.get(w),w.refCount++,w.block;for(let J=0;J<C.length;J++)if(J!==m&&C[J]&&C[J]&&C[J].cache.has(w))return C=C[J].cache.get(w),C.refCount++,v.set(w,C),C.block;return null};x.getRasterId=function(v,m){return null==m?v:`${v}?sliceId=${m}`};x.putBlock=function(v,m,w,C,J=null){if(B.has(v)){var t=B.get(v);if(null==t[m])H.putBlock(v,w,C,J);else{var q={refCount:1,block:C,isResolved:!1,
isRejected:!1,controller:J};C.then(()=>q.isResolved=!0).catch(()=>q.isRejected=!0);t[m].cache.set(w,q)}}else null==m&&H.putBlock(v,w,C,J)};x.register=function(v,m){m={extent:null,rasterInfo:m,cache:new Map};if(B.has(v))return v=B.get(v),v.push(m),v.length-1;B.set(v,[m]);return 0};x.unregister=function(v,m){if(B.has(v)){const w=B.get(v);w[m]=null;w.some(C=>null!=C)||B.delete(v)}};x.update=function(v,m,w,C,J,t,q=null){v=z(v,m);m=v.extent;const {cache:L,rasterInfo:N}=v;if(!m||m.xmin!==w.xmin||m.xmax!==
w.xmax||m.ymin!==w.ymin||m.ymax!==w.ymax){m=w.clone().normalize();var {spatialReference:I,transform:F}=N,M=new Set;for(let a=0;a<m.length;a++){var K=m[a];if(K.xmax-K.xmin<=C||K.ymax-K.ymin<=C)continue;var b=A.projectExtent(K,I,q);r.isSome(F)&&(b=F.inverseTransform(b));var c=new G({x:C,y:C,spatialReference:K.spatialReference});if(null==J&&(J=A.projectResolution(c,I,K,q),!J))return;const {pyramidLevel:d,pyramidResolution:f,excessiveReading:h}=A.snapPyramid(J,N,t||"closest");if(h)return;({storageInfo:K}=
N);var {origin:l}=K;c=Math.max(0,Math.floor((b.xmin-l.x)/f.x));l=Math.max(0,Math.floor((l.y-b.ymax)/f.y));const p=0<d?K.pyramidBlockWidth:K.blockWidth,e=0<d?K.pyramidBlockHeight:K.blockHeight;K=Math.max(0,Math.floor(c/p)-1);var k=Math.max(0,Math.floor(l/e)-1);c=Math.floor((c+Math.ceil((b.xmax-b.xmin)/f.x-.1)-1)/p)+1;b=Math.floor((l+Math.ceil((b.ymax-b.ymin)/f.y-.1)-1)/e)+1;for(l=k;l<=b;l++)for(k=K;k<=c;k++)M.add(`${d}/${l}/${k}`)}L.forEach((a,d)=>{M.has(d)||(a=L.get(d),(null==a||a.isResolved||a.isRejected)&&
L.delete(d))});v.extent={xmin:w.xmin,ymin:w.ymin,xmax:w.xmax,ymax:w.ymax}}};Object.defineProperty(x,"__esModule",{value:!0})})},"esri/layers/support/rasterDatasets/EphemeralBlockCache":function(){define(function(){return function(){function x(r=15E3,D=5E3){this._timer=null;this._cachedBlocks=new Map;this._size=-1;this._duration=r;this._interval=Math.min(r,D)}var E=x.prototype;E.decreaseRefCount=function(r,D){r=r+"/"+D;D=this._cachedBlocks;if(D.has(r)){const A=D.get(r);A.refCount--;0>=A.refCount&&
(D.delete(r),A.controller&&A.controller.abort());return A.refCount}return 0};E.getBlock=function(r,D){r=r+"/"+D;D=this._cachedBlocks;if(D.has(r)){const A=D.get(r);A.ts=Date.now();A.refCount++;D.delete(r);D.set(r,A);return A.block}return null};E.putBlock=function(r,D,A,G=null){const z=this._cachedBlocks;r=r+"/"+D;z.has(r)?(A=z.get(r),A.ts=Date.now(),A.refCount++):z.set(r,{block:A,ts:Date.now(),refCount:1,controller:G});this.trim();this.updateTimer()};E.deleteBlock=function(r,D){const A=this._cachedBlocks;
r=r+"/"+D;A.has(r)&&A.delete(r)};E.updateMaxSize=function(r){this._size=r;this.trim()};E.empty=function(){this._cachedBlocks.clear();this.clearTimer()};E.getCurrentSize=function(){return this._cachedBlocks.size};E.updateTimer=function(){if(null==this._timer){var r=this._cachedBlocks;this._timer=setInterval(()=>{const D=Array.from(r),A=Date.now();for(let G=0;G<D.length;G++)if(D[G][1].ts<=A-this._duration)r.delete(D[G][0]);else break;0===r.size&&this.clearTimer()},this._interval)}};E.trim=function(){const r=
this._cachedBlocks;if(!(-1===this._size||this._size>=r.size)){var D=Array.from(r);for(let A=0;A<D.length-this._size;A++)r.delete(D[A][0])}};E.clearTimer=function(){null!=this._timer&&(clearInterval(this._timer),this._timer=null)};return x}()})},"esri/layers/support/rasterFunctions/rasterProjectionHelper":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../geometry ../../../core/Error ../../../core/maybe ../../../core/unitUtils ../../../geometry/projection ../../../geometry/Extent ../../../geometry/Point".split(" "),
function(x,E,r,D,A,G,z,B,H){function v(a,d,f){return!z.canProjectWithoutEngine(a,d,f)}function m(a,d,f){if((a=v(a,d,f))&&!z.isLoaded())throw new D("rasterprojectionhelper-project","projection engine is not loaded");return a}function w(){w=E._asyncToGenerator(function*(){if(z.isLoaded())return null;yield z.load()});return w.apply(this,arguments)}function C(a,d,f,h=null){if(a.spatialReference.equals(d))return a;m(a.spatialReference,d,h);f=f.center;a=new B({xmin:f.x-a.x/2,xmax:f.x+a.x/2,ymin:f.y-a.y/
2,ymax:f.y+a.y/2,spatialReference:a.spatialReference});d=z.project(a,d,h);return A.isNone(d)?null:{x:d.xmax-d.xmin,y:d.ymax-d.ymin}}function J(a,d=.01){return G.getMetersPerUnitForSR(a)?d/G.getMetersPerUnitForSR(a):0}function t(a,d,f=null,h=!0){const p=a.spatialReference;if(p.equals(d))return a;m(p,d,f);f=z.project(a,d,f);if(h&&d.isGeographic){const [e,g]=M(p,!0);(d=J(p))&&null!=e&&null!=g&&(Math.abs(a.x-e)<d&&5E-4>Math.abs(180-f.x)?f.x-=360:Math.abs(a.x-g)<d&&5E-4>Math.abs(180+f.x)&&(f.x+=360))}return f}
function q(a,d,f=null){const h=a[0].spatialReference;if(h.equals(d))return a;m(h,d,f);return z.project(a,d,f)}function L(a){const d=F(a[0].spatialReference);if(2>a.length||!A.isSome(d))return a[0];let {xmin:f,xmax:h,ymin:p,ymax:e}=a[0];for(let g=1;g<a.length;g++){const n=a[g];h=n.xmax+d*g;p=Math.min(p,n.ymin);e=Math.max(e,n.ymax)}return new B({xmin:f,xmax:h,ymin:p,ymax:e,spatialReference:a[0].spatialReference})}function N(a,d,f=null,h=!0){if(a.spatialReference.equals(d))return a;const p=b(a),e=F(a.spatialReference,
!0);if(!A.isSome(e)||0===p)return I(a,d,f,h);a=a.clone().normalize().map(g=>I(g,d,f,h));return L(a)}function I(a,d,f=null,h=!0){const p=a.spatialReference;if(p.equals(d))return a;m(p,d,f);const e=z.project(a,d,f);let [g,n]=M(p,!0);e&&h&&p.isWebMercator&&d.isGeographic&&null!=g&&null!=n&&(.001>Math.abs(a.xmin-g)&&1E3<Math.abs(n-a.xmax)&&5E-4>Math.abs(180-e.xmax)&&(e.xmin=-180,h=[],h.push(new H(a.xmax,a.ymin,p)),h.push(new H(a.xmax,(a.ymin+a.ymax)/2,p)),h.push(new H(a.xmax,a.ymax,p)),h=h.map(u=>t(u,
d,f)).filter(u=>!isNaN(null==u?void 0:u.x)).map(u=>u.x),e.xmax=Math.max.apply(null,h)),.001>Math.abs(a.xmax-n)&&1E3<Math.abs(g-a.xmin)&&5E-4>Math.abs(180+e.xmin)&&(e.xmax=180,h=[],h.push(new H(a.xmin,a.ymin,p)),h.push(new H(a.xmin,(a.ymin+a.ymax)/2,p)),h.push(new H(a.xmin,a.ymax,p)),a=h.map(u=>t(u,d,f)).filter(u=>!isNaN(null==u?void 0:u.x)).map(u=>u.x),e.xmin=Math.min.apply(null,a)));[g,n]=M(d,!0);(a=J(d))&&null!=g&&null!=n&&e&&(Math.abs(e.xmin-g)<a&&(e.xmin=g),Math.abs(e.xmax-n)<a&&(e.xmax=n));return e}
function F(a,d=!1){return a.isWebMercator?2*(d?2.0037508342787E7:2.0037508342788905E7):a.wkid&&a.isGeographic?360:2*k[a.wkid]||null}function M(a,d=!1){const f=[];a=F(a,d);A.isSome(a)&&(f.push(-a/2),f.push(a/2));return f}function K(a,d,f,h){a=(a-d)/f;0!==a-Math.floor(a)?a=Math.floor(a):h&&--a;return a}function b(a,d=!1){const f=F(a.spatialReference);if(!A.isSome(f))return 0;const h=d?0:-(f/2);d=K(a.xmax,h,f,!0);a=K(a.xmin,h,f,!1);return d-a}function c(a){const {projectedExtent:d,srcBufferExtent:f,
pixelSize:h,datumTransformation:p,rasterTransform:e}=a;var g=d.spatialReference,n=f.spatialReference;m(g,n);const {xmin:u,ymin:y,xmax:P,ymax:O}=d,T=F(n),R=a.hasWrapAround||"gcs-shift"===(null==e?void 0:e.type);a=a.spacing||[32,32];var S=a[0]*h.x,Q=a[1]*h.y,U=Math.ceil((P-u)/S-.1/a[0])+1,V=Math.ceil((O-y)/Q-.1/a[1])+1;const Y=[];let W,Z=0;var X=[];for(let ba=0;ba<U;ba++)for(let aa=0;aa<V;aa++)X.push(new H({x:u+S*ba,y:O-Q*aa,spatialReference:g}));g=q(X,n,p);for(n=0;n<U;n++){S=[];for(Q=0;Q<V;Q++)X=g[n*
V+Q],e&&(X=e.inverseTransform(X)),S.push(X),0<n&&R&&X&&W[Q]&&A.isSome(T)&&X.x<W[Q].x&&(X.x+=T),X?(Y.push((X.x-f.xmin)/(f.xmax-f.xmin)),Y.push((f.ymax-X.y)/(f.ymax-f.ymin))):(Y.push(NaN),Y.push(NaN),Z++);W=S}return{offsets:Y,error:null,coefficients:null,outofBoundPointCount:Z,spacing:a,size:[U-1,V-1]}}const l=function(a,d,f){var h=(a[0]+a[4]+a[4*d.cols]+a[4*d.cols+4])/4;const p=(a[1]+a[5]+a[4*d.rows+1]+a[4*d.rows+5])/4,e=(a[4*d.cols]-a[0]+a[4*d.cols+4]-a[4])/f[0]*.5;f=(a[4*d.cols+1]-a[1]+a[4*d.cols+
5]-a[5])/f[1]*.5;h=0===e||isNaN(e)?0:Math.abs(h-a[2*d.rows+2])/Math.abs(e);a=0===f||isNaN(f)?0:Math.abs(p-a[2*d.rows+3])/Math.abs(f);return[h,a]},k={3395:2.0037508342789244E7,3410:1.7334193943686873E7,3857:2.0037508342788905E7,3975:1.7367530445161372E7,4087:2.0037508342789244E7,4088:2.0015108787169147E7,6933:1.7367530445161372E7,32662:2.0037508342789244E7,53001:2.001508679602057E7,53002:1.000754339801029E7,53003:2.001508679602057E7,53004:2.001508679602057E7,53016:1.4152803599503474E7,53017:1.7333573624304302E7,
53034:2.001508679602057E7,53079:2.0015114352186374E7,53080:2.0015114352186374E7,54001:2.0037508342789244E7,54002:1.0018754171394624E7,54003:2.0037508342789244E7,54004:2.0037508342789244E7,54016:1.4168658027268292E7,54017:1.736753044516137E7,54034:2.0037508342789244E7,54079:2.0037508342789244E7,54080:2.0037508342789244E7,54100:2.0037508342789244E7,54101:2.0037508342789244E7};x.computeProjectedScales=function(a,d,f=512,h=!0){const {extent:p,spatialReference:e,pixelSize:g}=a,n=C(new H({x:g.x,y:g.y,spatialReference:e}),
d,p);if(null==n)return{projectedPixelSize:null,scales:null,srcResolutions:null,isCustomTilingScheme:!1};var u=(n.x+n.y)/2,y=G.getMetersPerUnitForSR(d);u=u*y*96*39.37;const P=d.isGeographic?256/f*2.958287637958547E8:256/f*5.91657527591555E8;f="vector-magdir"===a.dataType||"vector-uv"===a.dataType;const O=N(p,d);f||h&&(d.isGeographic||d.isWebMercator)&&(f=0>O.xmin*O.xmax);h=u;if(f)h=P,a=d.isGeographic?1.341104507446289E-6:.29858214164761665,y=96*a*y*39.37,d=C(new H({x:a,y:a,spatialReference:{wkid:d.isGeographic?
4326:3857}}),e,O),d.x*=h/y,d.y*=h/y;else{d={x:g.x,y:g.y};a=Math.ceil(Math.log(Math.min(a.width,a.height)/32)/Math.LN2);for(y=0;h<.5005*P&&y<a;)y++,h*=2,d.x*=2,d.y*=2;1.001>=Math.max(h,P)/Math.min(h,P)&&(h=P)}a=[h];y=[{x:d.x,y:d.y}];for(u=Math.min(70.5310735,u)/1.001;h>=u;)h/=2,d.x/=2,d.y/=2,a.push(h),y.push({x:d.x,y:d.y});return{projectedPixelSize:n,scales:a,srcResolutions:y,isCustomTilingScheme:!f}};x.defaultGridSpacing=32;x.defaultProjectionToleranceInPixels=4;x.getDefaultDatumTransformationForDataset=
function(a,d,f){return m(a.spatialReference,d)?f?z.getTransformation(d,a.spatialReference,a):z.getTransformation(a.spatialReference,d,a):null};x.getProjectionOffsetGrid=function(a){var d=a.isAdaptive&&null==a.spacing,f=a.spacing||[32,32];let h=c(a);var p={cols:h.size[0]+1,rows:h.size[1]+1},e=l(h.offsets,p,f),g=(e[0]+e[1])/2,n=0<h.outofBoundPointCount&&h.outofBoundPointCount<h.offsets.length/2;d&&(n||4<g)&&(h=c({...a,spacing:[4,4]}),p={cols:h.size[0]+1,rows:h.size[1]+1},e=l(h.offsets,p,f));h.error=
e;a=h;{d=h.offsets;const {cols:R,rows:S}=p;p=new Float32Array((R-1)*(S-1)*12);f=new Float32Array([-0,-1,1,-1,1,-0,1,-0,-0]);e=new Float32Array([-1,1,0,0,-1,1,1,0,0]);for(g=0;g<R-1;g++){for(var u=0;u<S-1;u++){var y=g*S*2+2*u,P=d[y];const Q=d[y+1];var O=d[y+2],T=d[y+3];y+=2*S;const U=d[y],V=d[y+1],Y=d[y+2];y=d[y+3];let W=0,Z=12*(u*(R-1)+g);for(let X=0;3>X;X++)p[Z++]=f[W++]*P+f[W++]*O+f[W++]*Y;W=0;for(O=0;3>O;O++)p[Z++]=f[W++]*Q+f[W++]*T+f[W++]*y;W=0;for(T=0;3>T;T++)p[Z++]=e[W++]*P+e[W++]*U+e[W++]*Y;
W=0;for(P=0;3>P;P++)p[Z++]=e[W++]*Q+e[W++]*V+e[W++]*y}if(n)for(u=0;u<p.length;u++)isNaN(p[u])&&(p[u]=-1)}n=p}a.coefficients=n;return h};x.getRasterDatasetAlignmentInfo=function(a){const d=a.storageInfo.origin.x;var f=F(a.spatialReference,!0);if(!A.isSome(f))return{originX:d,halfWorldWidth:null,pyramidsInfo:null};const h=f/2,{nativePixelSize:p,storageInfo:e,extent:g}=a,{maximumPyramidLevel:n,blockWidth:u,pyramidScalingFactor:y}=e;let P=p.x;const O=[];a=A.isSome(a.transform)&&"gcs-shift"===a.transform.type;
const T=d+(a?0:h);f=a?f-d:h-d;for(let R=0;R<=n;R++){const S=(g.xmax-d)/P/u,Q=f/P/u;O.push({resolutionX:P,blockWidth:u,datsetColumnCount:0===S-Math.floor(S)?S:Math.ceil(S),worldColumnCountFromOrigin:0===Q-Math.floor(Q)?Q:Math.ceil(Q),leftMargin:Math.round(T/P)%u,rightPadding:(u-Math.round(f/P)%u)%u,originColumnOffset:Math.floor(T/P/u)});P*=y}return{originX:d,halfWorldWidth:h,pyramidsInfo:O,hasGCSSShiftTransform:a}};x.getWorldWidth=F;x.getWorldWrapCount=b;x.load=function(){return w.apply(this,arguments)};
x.minimumGridSpacing=4;x.projectExtent=N;x.projectPoint=t;x.projectResolution=C;x.requirePE=v;x.snapExtent=function(a){a=a.clone().normalize();return 1===a.length?a[0]:L(a)};x.snapPyramid=function(a,d,f){const {storageInfo:h,pixelSize:p}=d;let e=!1;var {pyramidResolutions:g}=h;if(A.isSome(g)&&g.length){a=(a.x+a.y)/2;var n=g[g.length-1];n=(n.x+n.y)/2;var u=(p.x+p.y)/2;if(a<=u)var y=0;else if(a>=n)y=g.length,e=8<a/n;else{n=u;for(let P=1;P<=g.length;P++){u=(g[P-1].x+g[P-1].y)/2;if(a<=u){a===u?y=P:"down"===
f?(y=P-1,e=8<a/n):y="up"===f?P:a-n>u-a||2<a/n?P:P-1;break}n=u}}f=0===y?p:g[y-1];return{pyramidLevel:y,pyramidResolution:new H({x:f.x,y:f.y,spatialReference:d.spatialReference}),excessiveReading:e}}y=Math.log(a.x/p.x)/Math.LN2;a=Math.log(a.y/p.y)/Math.LN2;g=d.storageInfo.maximumPyramidLevel||0;y="down"===f?Math.floor(Math.min(y,a)):"up"===f?Math.ceil(Math.max(y,a)):Math.round((y+a)/2);0>y?y=0:y>g&&(e=y>g+3,y=g);f=2**y;d=new H({x:f*d.nativePixelSize.x,y:f*d.nativePixelSize.y,spatialReference:d.spatialReference});
return{pyramidLevel:y,pyramidResolution:d,excessiveReading:e}};Object.defineProperty(x,"__esModule",{value:!0})})},"esri/views/2d/layers/imagery/VectorFieldTileView2D":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/maybe ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../layers/support/rasterFunctions/vectorFieldUtils ../../engine/RasterVFTileContainer ./BaseImageryTileSubView2D".split(" "),
function(x,E,r,D,A,G,z,B,H,v,m){A=function(w){function C(){var t=w.apply(this,arguments)||this;t._handle=null;t.container=null;t.layer=null;t.type="rasterVF";return t}x._inheritsLoose(C,w);var J=C.prototype;J.canUseWebGLForProcessing=function(){return!1};J.fetchTile=function(){var t=x._asyncToGenerator(function*(q,L){q=yield this.layer.fetchTile(q.level,q.row,q.col,L);"vector-magdir"===this.layer.rasterInfo.dataType&&null!=q&&q.pixelBlock&&(q.pixelBlock=yield this.layer.convertVectorFieldData(q.pixelBlock,
L));return q});return function(q,L){return t.apply(this,arguments)}}();J.updateTileSource=function(t,q){const L=q.symbolizerParams,{tileData:N}=t;N.key=t.key;N.width=this._tileInfoView.tileInfo.size[0];N.height=this._tileInfoView.tileInfo.size[1];({symbolTileSize:t}=L);({source:q}=q);N.offset=this._getTileSymbolOffset(N.key,t);r.isSome(q)&&r.isSome(q.pixelBlock)?(N.rawPixelData={extent:q.extent,pixelBlock:q.pixelBlock},N.source=this._sampleVectorFieldData(q.pixelBlock,L,N.offset)):(q=this.createEmptyTilePixelBlock([Math.round((this._tileInfoView.tileInfo[0]-
N.offset[0])/t),Math.round((this._tileInfoView.tileInfo[1]-N.offset[1])/t)]),N.source=q);N.symbolizerParameters=L;N.invalidateVAO();return Promise.resolve(null)};J.updateTileSymbolizerParameters=function(t,q){var L;q=q.local;const {symbolTileSize:N}=q;({tileData:t}=t);t.offset=this._getTileSymbolOffset(t.key,N);const I=t.symbolizerParameters.symbolTileSize;t.symbolizerParameters=q;r.isSome(null==(L=t.rawPixelData)?void 0:L.pixelBlock)&&I!==N&&(t.source=this._sampleVectorFieldData(t.rawPixelData.pixelBlock,
t.symbolizerParameters,t.offset));return Promise.resolve(null)};J.install=function(t){this.container=new v.RasterVFTileContainer(this._tileInfoView);this.container.isCustomTilingScheme=this._isCustomTilingScheme;this._updateSymbolType(this.layer.renderer);this._handle=this.layer.watch("renderer",q=>this._updateSymbolType(q));t.addChild(this.container)};J.uninstall=function(){this.container.removeAllChildren();this._handle.remove();this._handle=null;this.container.remove();w.prototype.uninstall.call(this)};
J._getTileSymbolOffset=function(t,q){const L=t.col*this._tileInfoView.tileInfo.size[0]%q;t=t.row*this._tileInfoView.tileInfo.size[1]%q;return[L>q/2?q-L:-L,t>q/2?q-t:-t]};J._sampleVectorFieldData=function(t,q,L){({symbolTileSize:q}=q);return H.sampleVectorField(t,"vector-uv",q,L)};J._updateSymbolType=function(t){"vector-field"===t.type&&(this.container.symbolTypes="wind-barb"===t.style?["scalar","triangle"]:"simple-scalar"===t.style?["scalar"]:["triangle"])};return C}(m.BaseImageryTileSubView2D);E.__decorate([D.property()],
A.prototype,"container",void 0);E.__decorate([D.property()],A.prototype,"layer",void 0);E.__decorate([D.property()],A.prototype,"type",void 0);return A=E.__decorate([B.subclass("esri.views.2d.layers.imagery.VectorFieldTileView2D")],A)})},"esri/layers/support/rasterFunctions/vectorFieldUtils":function(){define(["exports","../../../core/jsonMap","../../../core/maybe","../PixelBlock","./pixelUtils"],function(x,E,r,D,A){function G(b,c){return t.get(b)/t.get(c)||1}function z(b,c="geographic"){const [l,
k]=b;b=Math.sqrt(l*l+k*k);let a=Math.atan2(k,l)*q;a=(360+a)%360;"geographic"===c&&(a=(450-a)%360);return[b,a]}function B(b,c="geographic"){let l=b[1];"geographic"===c&&(l=(450-l)%360);l%=360;b=b[0];return[b*Math.cos(l/q),b*Math.sin(l/q)]}function H(b=0,c=Math.PI,l=!0){l&&(c=(2*Math.PI-c)%(2*Math.PI));var k=l?-1:1;l=5*k;const a=20*k,d=25*k;k*=2;let [f,h]=[5,0-a],[p,e]=[f+2,h],[g,n]=[p-0,e+k],[u,y]=[-5,0-d],[P,O]=[u+0,y-k];b=Math.ceil(b/5);let T=Math.floor(b/10);b-=8*T;const R=[],S=[];for(let aa=0;aa<
b/2;aa++,T--){0>=T&&1===b%2&&aa===(b-1)/2&&(u=0,P=u+0,y=(y+h)/2,O=y-k);const [ha,ia]=v(u,y,c,45);if(0<T){const [ca,da]=v(p,y,c,45),[ea,fa]=v(f,h,c,45);R.push(ca);R.push(da);R.push(ha);R.push(ia);R.push(ea);R.push(fa)}else{const [ca,da]=v(p,e,c,45),[ea,fa]=v(g,n,c,45),[ja,ka]=v(P,O,c,45);S.push(ha);S.push(ia);S.push(ja);S.push(ka);S.push(ea);S.push(fa);S.push(ca);S.push(da)}y+=l;h+=l;e+=l;n+=l;O+=l}const [Q,U]=v(5,0+a,c,45),[V,Y]=v(7,0+a,c,45),[W,Z]=v(5,0-d,c,45),[X,ba]=v(7,0-d,c,45);return{pennants:R,
barbs:S,shaft:[Q,U,V,Y,W,Z,X,ba]}}function v(b,c,l,k=1){return[Math.sqrt(b*b+c*c)/k,(2*Math.PI+(2*Math.PI+Math.atan2(c,b))%(2*Math.PI)-l)%(2*Math.PI)]}function m(b,c,l,k){l=G(k||"knots",l);for(k=1;k<c.length;k++)if(k===c.length-1){if(b<c[k]*l)break}else if(b<=c[k]*l)break;return Math.min(k-1,c.length-2)}function w(b,c,l,k,a){let d=0;switch(c){case "beaufort_kn":d=m(b,I,"knots",l);break;case "beaufort_km":d=m(b,I,"kilometer-per-hour",l);break;case "beaufort_ft":d=m(b,I,"feet-per-second",l);break;case "beaufort_m":d=
m(b,I,"meter-per-second",l);break;case "classified_arrow":d=m(b,a,k,l);break;case "ocean_current_m":d=m(b,F,"meter-per-second",l);break;case "ocean_current_kn":d=m(b,M,"knots",l)}return d}function C(b,c){const {style:l,inputUnit:k,outputUnit:a,breakValues:d}=c;c=L.fromJSON(k);const f=L.fromJSON(a);let h=0,p=0;const {width:e,height:g,mask:n}=b,u=b.pixels[0];b=b.pixels[1];var y=n?n.filter(R=>0<R).length:e*g;const P=new Float32Array(42*y);y=new Uint32Array(15*y);for(let R=0;R<g;R++)for(let S=0;S<e;S++){var O=
R*e+S;if(!n||n[R*e+S]){var T;const Q=null!=(T=(b[O]+360)%360/180*Math.PI)?T:2*Math.PI*Math.random(),U=w(u[O],l,c,f,d);for(let V=0;V<N.length;V+=2)P[h++]=(S+.5)/e,P[h++]=(R+.5)/g,P[h++]=N[V],P[h++]=N[V+1]+Q,P[h++]=U,P[h++]=u[O];O=7*(h/42-1);y[p++]=O;y[p++]=O+1;y[p++]=O+2;y[p++]=O+0;y[p++]=O+4;y[p++]=O+3;y[p++]=O+0;y[p++]=O+2;y[p++]=O+3;y[p++]=O+2;y[p++]=O+5;y[p++]=O+3;y[p++]=O+5;y[p++]=O+6;y[p++]=O+3}}return{vertexData:P,indexData:y}}function J(b,c){let l=0,k=0;const {width:a,height:d,mask:f}=b;b=
b.pixels[0];const h=[],p=[];c="wind_speed"===c.style?5:Number.MAX_VALUE;for(let g=0;g<d;g++)for(let n=0;n<a;n++){var e=g*a+n;if((!f||f[g*a+n])&&b[e]<c){for(let u=0;4>u;u++)h[l++]=(n+.5)/a,h[l++]=(g+.5)/d,h[l++]=2>u?-.5:.5,h[l++]=0===u%2?-.5:.5,h[l++]=0,h[l++]=b[e];e=4*(l/24-1);p[k++]=e;p[k++]=e+1;p[k++]=e+2;p[k++]=e+1;p[k++]=e+2;p[k++]=e+3}}return{vertexData:new Float32Array(h),indexData:new Uint32Array(p)}}const t=new Map;t.set("meter-per-second",1);t.set("kilometer-per-hour",.277778);t.set("knots",
.514444);t.set("feet-per-second",.3048);t.set("mile-per-hour",.44704);const q=180/Math.PI,L=new E.JSONMap({esriMetersPerSecond:"meter-per-second",esriKilometersPerHour:"kilometer-per-hour",esriKnots:"knots",esriFeetPerSecond:"feet-per-second",esriMilesPerHour:"mile-per-hour"}),N=function(b=0,c=0,l=Math.PI,k=!0){k&&(l=(2*Math.PI-l)%(2*Math.PI));k=k?-1:1;const a=-7*k,d=-2*k,f=-16*k,[h,p]=v(0,c+13*k,l,29),[e,g]=v(b-5.5,c+a,l,29),[n,u]=v(b+5.5,c+a,l,29),[y,P]=v(b-1.5,c+d,l,29),[O,T]=v(b+1.5,c+d,l,29),
[R,S]=v(b-1.5,c+f,l,29),[Q,U]=v(b+1.5,c+f,l,29);return[h,p,e,g,y,P,O,T,n,u,R,S,Q,U]}(0,0,0),I=[0,1,3,6,10,16,21,27,33,40,47,55,63],F=[0,.5,1,1.5,2],M=[0,.25,.5,1,1.5,2,2.5,3,3.5,4],K=[];x.convertVectorFieldData=function(b,c,l="geographic",k=1){if(!A.isValidPixelBlock(b))return b;const {pixels:a,width:d,height:f}=b;var h=d*f;const p=a[0],e=a[1],g=D.createEmptyBand(b.pixelType,h);h=D.createEmptyBand(b.pixelType,h);let n=0;for(let u=0;u<f;u++)for(let y=0;y<d;y++)"vector-uv"===c?([g[n],h[n]]=z([p[n],
e[n]],l),g[n]*=k):([g[n],h[n]]=B([p[n],e[n]],l),g[n]*=k,h[n]*=k),n++;b=new D({pixelType:b.pixelType,width:b.width,height:b.height,mask:b.mask,validPixelCount:b.validPixelCount,maskIsAlpha:b.maskIsAlpha,pixels:[g,h]});b.updateStatistics();return b};x.convertVectorFieldUnit=function(b,c,l=1){if(1===l||!A.isValidPixelBlock(b))return b;b=b.clone();const {pixels:k,width:a,height:d}=b,f=k[0],h=k[1];let p=0;for(let e=0;e<d;e++)for(let g=0;g<a;g++)"vector-uv"===c?(f[p]*=l,h[p]*=l):f[p]*=l,p++;b.updateStatistics();
return b};x.createVFMesh=function(b,c){if("simple_scalar"===c.style)var l=J(b,c);else if("wind_speed"===c.style){{if(0===K.length)for(var k=0;30>k;k++)K.push(H(5*k,0));c=L.fromJSON(c.inputUnit);c=G(c,"knots");const {width:h,height:p,mask:e}=b;k=b.pixels[0];b=b.pixels[1];const g=[],n=[];let u=0,y=0;for(let P=0;P<p;P++)for(let O=0;O<h;O++){var a=P*h+O,d=k[a]*c;if((!e||e[P*h+O])&&5<=d){const T=null!=(l=(b[a]+360)%360/180*Math.PI)?l:2*Math.PI*Math.random(),{pennants:R,barbs:S,shaft:Q}=K[Math.min(Math.floor(d/
5),29)];if(0===R.length+S.length)continue;a=g.length/6;const U=(O+.5)/h,V=(P+.5)/p;for(var f=0;f<R.length;f+=2)g[u++]=U,g[u++]=V,g[u++]=R[f],g[u++]=R[f+1]+T,g[u++]=0,g[u++]=d;for(f=0;f<S.length;f+=2)g[u++]=U,g[u++]=V,g[u++]=S[f],g[u++]=S[f+1]+T,g[u++]=0,g[u++]=d;for(f=0;f<Q.length;f+=2)g[u++]=U,g[u++]=V,g[u++]=Q[f],g[u++]=Q[f+1]+T,g[u++]=0,g[u++]=d;for(d=0;d<R.length/6;d++)n[y++]=a,n[y++]=a+1,n[y++]=a+2,a+=3;for(d=0;d<S.length/8;d++)n[y++]=a,n[y++]=a+1,n[y++]=a+2,n[y++]=a+1,n[y++]=a+2,n[y++]=a+3,
a+=4;n[y++]=a+0;n[y++]=a+1;n[y++]=a+2;n[y++]=a+1;n[y++]=a+3;n[y++]=a+2;a+=4}}l={vertexData:new Float32Array(g),indexData:new Uint32Array(n)}}}else l=C(b,c);return l};x.createVFMeshScalar=J;x.getUnitConversionFactor=G;x.sampleVectorField=function(b,c,l,k=[0,0],a=.5){const {width:d,height:f,mask:h}=b,[p,e]=b.pixels,[g,n]=k;b=Math.round((d-g)/l);k=Math.round((f-n)/l);var u=b*k;const y=new Float32Array(u),P=new Float32Array(u);u=new Uint8Array(u);c="vector-uv"===c;for(let T=0;T<k;T++)for(let R=0;R<b;R++){let S=
0;const Q=T*b+R,U=Math.max(0,T*l+n),V=Math.max(0,R*l+g),Y=Math.min(f,U+l),W=Math.min(d,V+l);for(let Z=U;Z<Y;Z++)for(let X=V;X<W;X++){var O=Z*d+X;if(!h||h[O]){S++;O=c?[p[O],e[O]]:[p[O],(360+e[O])%360];const [ba,aa]=c?O:B(O);y[Q]+=ba;P[Q]+=aa}}if(S>=(Y-U)*(W-V)*(1-a)){u[Q]=1;const [Z,X]=z([y[Q]/S,P[Q]/S]);y[Q]=Z;P[Q]=X}else u[Q]=0,y[Q]=0,P[Q]=0}l=new D({width:b,height:k,pixels:[y,P],mask:u});l.updateStatistics();return l};x.snapImageToSymbolTile=function(b,c,l,k,a){if(!r.isSome(a)||!a.spatialReference.equals(b.spatialReference))return{extent:b,
width:c,height:l,resolution:b.width/c};const d=a.xmin;a=a.ymax;k=Math.max(k||0,30);c=((b.xmax-b.xmin)/Math.ceil(1/k*c)+(b.ymax-b.ymin)/Math.ceil(1/k*l))/2;b.xmin=d+Math.floor((b.xmin-d)/c)*c;b.xmax=d+Math.ceil((b.xmax-d)/c)*c;b.ymin=a+Math.floor((b.ymin-a)/c)*c;b.ymax=a+Math.ceil((b.ymax-a)/c)*c;return{extent:b,width:Math.round(b.width/c),height:Math.round(b.height/c),resolution:c}};x.unitKebabDict=L;x.uvComponentToVector=z;Object.defineProperty(x,"__esModule",{value:!0})})},"esri/views/2d/engine/RasterVFTileContainer":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../geometry/support/aaBoundingRect ./RasterVFTile ./webgl/enums ./webgl/TileContainer ./webgl/brushes/raster/BrushVectorField".split(" "),
function(x,E,r,D,A,G,z){G=function(B){function H(){var m=B.apply(this,arguments)||this;m.isCustomTilingScheme=!1;m.symbolTypes=["triangle"];return m}E._inheritsLoose(H,B);var v=H.prototype;v.createTile=function(m){const w=this._tileInfoView.getTileBounds(r.create(),m),[C,J]=this._tileInfoView.tileInfo.size;return new D.RasterVFTile(m,w[0],w[3],C,J)};v.destroyTile=function(){};v.prepareRenderPasses=function(m){const w=m.registerRenderPass({name:"imagery (vf tile)",brushes:[z],target:()=>this.children.map(C=>
C.tileData),drawPhase:A.WGLDrawPhase.MAP});return[...B.prototype.prepareRenderPasses.call(this,m),w]};v.doRender=function(m){this.visible&&m.drawPhase===A.WGLDrawPhase.MAP&&this.symbolTypes.forEach(w=>{m.renderPass=w;B.prototype.doRender.call(this,m)})};return H}(G.default);x.RasterVFTileContainer=G;Object.defineProperty(x,"__esModule",{value:!0})})},"esri/views/2d/engine/RasterVFTile":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/mat3 ../../../chunks/mat3f32 ./RasterVFDisplayObject ./webgl/TiledDisplayObject".split(" "),
function(x,E,r,D,A,G){G=function(z){function B(v,m,w,C,J,t=null){var q=z.call(this,v,m,w,C,J)||this;q.tileData=new A.RasterVFDisplayObject(t);q.tileData.coordScale=[C,J];q.tileData.once("isReady",()=>q.ready());return q}E._inheritsLoose(B,z);var H=B.prototype;H.destroy=function(){z.prototype.destroy.call(this);this.tileData.destroy();this.stage=this.tileData=null};H._createTransforms=function(){return{dvs:D.create(),tileMat3:D.create()}};H.setTransform=function(v,m){z.prototype.setTransform.call(this,
v,m);const w=m/(v.resolution*v.pixelRatio),C=this.transforms.tileMat3,[J,t]=this.tileData.offset,[q,L]=v.toScreenNoRotation([0,0],[this.x+J*m,this.y-t*m]);({symbolTileSize:m}=this.tileData.symbolizerParameters);r.set(C,Math.round((this.width-this.tileData.offset[0])/m)*m/this.rangeX*w,0,0,0,Math.round((this.height-this.tileData.offset[1])/m)*m/this.rangeY*w,0,q,L,1);r.multiply(this.transforms.dvs,v.displayViewMat3,C);this.tileData.transforms.dvs=this.transforms.dvs};H.onAttach=function(){this.tileData.stage=
this.stage};H.onDetach=function(){this.tileData.stage=null};E._createClass(B,[{key:"stencilRef",get:function(){return this.tileData.stencilRef},set:function(v){this.tileData.stencilRef=v}}]);return B}(G.TiledDisplayObject);x.RasterVFTile=G;Object.defineProperty(x,"__esModule",{value:!0})})},"esri/views/2d/engine/RasterVFDisplayObject":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/has ../../../core/maybe ../../../chunks/mat3f32 ../../../layers/support/rasterFunctions/vectorFieldUtils ../../webgl/BufferObject ../../webgl/FramebufferObject ../../webgl/checkWebGLError ../../webgl/enums ../../../chunks/builtins ../../webgl/Texture ../../webgl/VertexArrayObject ./DisplayObject ./webgl/Utils".split(" "),
function(x,E,r,D,A,G,z,B,H,v,m,w,C,J,t){r=function(q){function L(I=null){var F=q.call(this)||this;F._source=null;F._symbolizerParameters=null;F._vaoInvalidated=!0;F.coordScale=[1,1];F.height=null;F.stencilRef=0;F.rawPixelData=null;F.width=null;F.source=I;return F}E._inheritsLoose(L,q);var N=L.prototype;N.destroy=function(){if(D.isSome(this.vaoData)){var I,F;null==(I=this.vaoData.magdir)?void 0:I.vao.dispose();null==(F=this.vaoData.scalar)?void 0:F.vao.dispose();this.vaoData=null}};N.invalidateVAO=
function(){if(!this._vaoInvalidated&&D.isSome(this.vaoData)){var I,F;null==(I=this.vaoData.magdir)?void 0:I.vao.dispose();null==(F=this.vaoData.scalar)?void 0:F.vao.dispose();this.vaoData=null;this._vaoInvalidated=!0;this.requestRender()}};N.updateVectorFieldVAO=function(I){if(this._vaoInvalidated){this._vaoInvalidated=!1;if(D.isSome(this.source)&&!D.isSome(this.vaoData)){var {style:F}=this.symbolizerParameters;switch(F){case "beaufort_ft":case "beaufort_km":case "beaufort_kn":case "beaufort_m":case "beaufort_mi":case "classified_arrow":case "ocean_current_kn":case "ocean_current_m":case "single_arrow":F=
G.createVFMesh(this.source,this.symbolizerParameters);this.vaoData={magdir:this._createVectorFieldVAO(I.context,F)};break;case "simple_scalar":F=G.createVFMeshScalar(this.source,this.symbolizerParameters);this.vaoData={scalar:this._createVectorFieldVAO(I.context,F)};break;case "wind_speed":{F=G.createVFMesh(this.source,this.symbolizerParameters);F=this._createVectorFieldVAO(I.context,F);const M=G.createVFMeshScalar(this.source,this.symbolizerParameters);I=this._createVectorFieldVAO(I.context,M);this.vaoData=
{magdir:F,scalar:I}}}}this.ready();this.requestRender()}};N._createTransforms=function(){return{dvs:A.create()}};N.onAttach=function(){this.invalidateVAO()};N.onDetach=function(){this.invalidateVAO()};N._createVectorFieldVAO=function(I,F){const {vertexData:M,indexData:K}=F;F=z.createVertex(I,35044,new Float32Array(M));const b=z.createIndex(I,35044,new Uint32Array(K)),c=t.createProgramDescriptor("vector-field",{geometry:[{location:0,name:"a_pos",count:2,type:5126,normalized:!1},{location:1,name:"a_offset",
count:2,type:5126,normalized:!1},{location:2,name:"a_vv",count:2,type:5126,normalized:!1}]});return{vao:new C(I,c.attributes,c.bufferLayouts,{geometry:F},b),elementCount:K.length}};E._createClass(L,[{key:"symbolizerParameters",get:function(){return this._symbolizerParameters},set:function(I){JSON.stringify(this._symbolizerParameters)!==JSON.stringify(I)&&(this._symbolizerParameters=I,this.invalidateVAO())}},{key:"source",get:function(){return this._source},set:function(I){this._source=I;this.invalidateVAO()}}]);
return L}(J.DisplayObject);x.RasterVFDisplayObject=r;Object.defineProperty(x,"__esModule",{value:!0})})},"esri/views/layers/ImageryTileLayerView":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../Graphic ../../core/Error ../../core/maybe ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ../../layers/support/commonProperties ../../layers/support/rasterFunctions/rasterProjectionHelper ./support/popupUtils".split(" "),
function(x,E,r,D,A,G,z,B,H,v,m,w,C,J){B=t=>{t=function(q){function L(){var I=q.apply(this,arguments)||this;I._rasterFieldPrefix="Raster.";I.layer=null;I.view=null;I.fullExtent=null;I.tileInfo=null;I.datumTransformation=null;return I}E._inheritsLoose(L,q);var N=L.prototype;N.fetchPopupFeatures=function(){var I=E._asyncToGenerator(function*(F,M){const {layer:K}=this;if(!F)return Promise.reject(new A("imageryTileLayerView:fetchPopupFeatures","Nothing to fetch without area",{layer:K}));var {popupEnabled:b}=
K;M=J.getFetchPopupTemplate(K,M);if(!b||!G.isSome(M))throw new A("imageryTileLayerView:fetchPopupFeatures","Missing required popupTemplate or popupEnabled",{popupEnabled:b,popupTemplate:M});b=[];const {value:c,magdirValue:l}=yield K.identify(F,{timeExtent:this.timeExtent});let k="";if(c&&c.length){var a,d;k="imagery-tile"===K.type&&K.hasStandardTime()&&null!=c[0]?c.map(h=>K.getStandardTimeValue(h)).join(", "):c.join(", ");F={ObjectId:0};F["Raster.ServicePixelValue"]=this._formatAttributeValue(k,"Raster.ServicePixelValue");
if((M=null==(a=K.rasterInfo)?void 0:null==(d=a.attributeTable)?void 0:d.features)&&0<M.length&&(a=M.filter(h=>String(h.attributes.value||h.attributes.Value||h.attributes.VALUE)===k),0<a.length&&(a=a[0])))for(var f in a.attributes)a.attributes.hasOwnProperty(f)&&(d=this._rasterFieldPrefix+f,F[d]=this._formatAttributeValue(a.attributes[f],d));f=K.rasterInfo.dataType;if("vector-magdir"===f||"vector-uv"===f)F["Raster.Magnitude"]=null==l?void 0:l[0],F["Raster.Direction"]=null==l?void 0:l[1];f=new D(this.fullExtent.clone(),
null,F);f.layer=K;f.sourceLayer=f.layer;b.push(f)}return b});return function(F,M){return I.apply(this,arguments)}}();N.updateFullExtent=function(){var I=this.layer.tileInfo;if(!I||!I.spatialReference)return Promise.reject(new A("layerview:tiling-information-missing","The layer doesn't provide tiling information",{layer:this.layer}));if(G.isNone(this.layer.fullExtent))return Promise.reject(new A("layerview:extent-missing","The layer doesn't provide a full extent.",{layer:this.layer}));I=C.getDefaultDatumTransformationForDataset(this.layer.fullExtent,
this.view.spatialReference,!1);I=C.projectExtent(this.layer.fullExtent,this.view.spatialReference,I);if(null==I)return Promise.reject(new A("layerview:projection-not-supported","The layer extent cannot be projected to the view's spatial reference",{layer:this.layer}));this._set("fullExtent",I);this.datumTransformation||(this.datumTransformation=C.getDefaultDatumTransformationForDataset(this.layer.fullExtent,this.view.spatialReference,!0));return Promise.resolve()};N._formatAttributeValue=function(I,
F){if("string"===typeof I&&(F=(F=this._getFieldInfo(this.layer.popupTemplate&&this.layer.popupTemplate.fieldInfos,F))&&F.format)){let M,K;return-1<I.trim().indexOf(",")?(M=",",K=M+" ",this._formatDelimitedString(I,M,K,F)):-1<I.trim().indexOf(" ")?(M=K=" ",this._formatDelimitedString(I,M,K,F)):this._formatNumberFromString(I,F)}return I};N._getFieldInfo=function(I,F){if(I&&I.length&&F){var M=F.toLowerCase(),K=void 0;I.some(b=>!b.fieldName||b.fieldName.toLowerCase()!==M&&b.fieldName.toLowerCase()!==
M.replace(/ /g,"_")?!1:(K=b,!0));return K}};N._formatDelimitedString=function(I,F,M,K){return I&&F&&M&&K?I.trim().split(F).map(b=>this._formatNumberFromString(b,K)).join(M):I};N._formatNumberFromString=function(I,F){if(!I||!F)return I;const M=Number(I);return isNaN(M)?I:F.format(M)};E._createClass(L,[{key:"hasTilingEffects",get:function(){return this.layer.renderer&&"dynamicRangeAdjustment"in this.layer.renderer&&this.layer.renderer.dynamicRangeAdjustment}}]);return L}(t);r.__decorate([z.property()],
t.prototype,"layer",void 0);r.__decorate([z.property(w.combinedViewLayerTimeExtentProperty)],t.prototype,"timeExtent",void 0);r.__decorate([z.property()],t.prototype,"view",void 0);r.__decorate([z.property()],t.prototype,"fullExtent",void 0);r.__decorate([z.property()],t.prototype,"tileInfo",void 0);r.__decorate([z.property({readOnly:!0})],t.prototype,"hasTilingEffects",null);return t=r.__decorate([m.subclass("esri.views.layers.ImageryTileLayerView")],t)};x.ImageryTileLayerView=B;x.default=B;Object.defineProperty(x,
"__esModule",{value:!0})})},"esri/views/layers/support/popupUtils":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/maybe","../../../layers/support/fieldUtils"],function(x,E,r,D){function A(){A=E._asyncToGenerator(function*(G,z=G.popupTemplate){if(!r.isSome(z))return[];const B=yield z.getRequiredFields(G.fieldsIndex);({lastEditInfoEnabled:z}=z);const {objectIdField:H,typeIdField:v,globalIdField:m,relationships:w}=G;if(B.includes("*"))return["*"];z=z?yield D.getFeatureEditFields(G):
[];const C=D.fixFields(G.fieldsIndex,[...B,...z]);v&&C.push(v);C&&H&&G.fieldsIndex.has(H)&&-1===C.indexOf(H)&&C.push(H);C&&m&&G.fieldsIndex.has(m)&&-1===C.indexOf(m)&&C.push(m);w&&w.forEach(J=>{({keyField:J}=J);C&&J&&G.fieldsIndex.has(J)&&-1===C.indexOf(J)&&C.push(J)});return C});return A.apply(this,arguments)}x.getFetchPopupTemplate=function(G,z){return G.popupTemplate?G.popupTemplate:r.isSome(z)&&z.defaultPopupTemplateEnabled&&r.isSome(G.defaultPopupTemplate)?G.defaultPopupTemplate:null};x.getRequiredFields=
function(G){return A.apply(this,arguments)};Object.defineProperty(x,"__esModule",{value:!0})})},"esri/views/layers/RefreshableLayerView":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Logger ../../core/promiseUtils ../../core/watchUtils ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass".split(" "),function(x,E,r,D,A,G,z,B,H,v,m){B=
w=>{w=function(C){function J(){return C.apply(this,arguments)||this}E._inheritsLoose(J,C);J.prototype.initialize=function(){this.handles.add(G.on(this,"layer","refresh",t=>{this.doRefresh(t.dataChanged).catch(q=>{A.isAbortError(q)||D.getLogger(this.declaredClass).error(q)})}),"RefreshableLayerView")};return J}(w);r.__decorate([z.property()],w.prototype,"layer",void 0);return w=r.__decorate([m.subclass("esri.layers.mixins.RefreshableLayerView")],w)};x.RefreshableLayerView=B;x.default=B;Object.defineProperty(x,
"__esModule",{value:!0})})},"*noref":1}});
define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../Graphic ../../../core/Logger ../../../core/promiseUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../engine/flow/AnimatedFlowView2D ./LayerView2D ./imagery/ImageryTileView2D ./imagery/VectorFieldTileView2D ./support/util ../../layers/ImageryTileLayerView ../../layers/LayerView ../../layers/RefreshableLayerView".split(" "),function(x,
E,r,D,A,G,z,B,H,v,m,w,C,J,t,q,L,N,I){const F=D.getLogger("esri.views.2d.layers.ImageryTileLayerView2D");D=function(M){function K(){var c=M.apply(this,arguments)||this;c._useWebGLForProcessing=!0;c._useProgressiveUpdate=!0;c.subview=null;return c}x._inheritsLoose(K,M);var b=K.prototype;b.initialize=function(){const c=this.updateFullExtent();this.addResolvingPromise(c)};b.update=function(c){this.subview.update(c);this.notifyChange("updating")};b.isUpdating=function(){return!this.subview||this.subview.updating};
b.attach=function(){this.layer.increaseRasterJobHandlerUsage();this._updateSubview();this.handles.add([G.watch(this.layer,["bandIds","renderer","interpolation","multidimensionalDefinition"],(c,l,k)=>{const a="multidimensionalDefinition"===k,d="interpolation"===k&&("majority"===c||"majority"===l)&&q.canUseMajorityInterpolationOnDataSource(this.layer);(c="renderer"===k&&l.type!==c.type)&&this._updateSubview();this.subview.redrawOrRefetch(a||d||c).catch(f=>{A.isAbortError(f)||F.error(f)});this.notifyChange("updating")}),
G.init(this,["layer.blendMode"],c=>{this.subview&&(this.subview.container.blendMode=c)},!0),G.init(this,["layer.effect"],c=>{this.subview&&(this.subview.container.effect=c)},!0),G.init(this,"timeExtent",()=>{this.subview.redrawOrRefetch(!0).catch(c=>{A.isAbortError(c)||F.error(c)})})],"attach")};b.detach=function(){this.handles.remove("attach");this.layer.decreaseRasterJobHandlerUsage();this.subview.uninstall()};b.moveStart=function(){this.requestUpdate()};b.viewChange=function(){this.requestUpdate()};
b.moveEnd=function(){this.subview.moveEnd()};b.hitTest=function(){var c=x._asyncToGenerator(function*(l,k){return[new r({attributes:{},geometry:l.clone()})]});return function(l,k){return c.apply(this,arguments)}}();b.doRefresh=function(){return this.subview.doRefresh()};b._updateSubview=function(){var c="vector-field"===this.layer.renderer.type?"rasterVF":"animated-flow"===this.layer.renderer.type?"rasterAnimatedFlow":"raster";if(this.subview){if(this.subview.type===c)return;this.subview.uninstall()}const {layer:l}=
this;c="rasterVF"===c?new t({layer:l,layerView:this}):"rasterAnimatedFlow"===c?new w({layer:l,layerView:this}):new J({layer:l,layerView:this});"useWebGLForProcessing"in c&&(c.useWebGLForProcessing=this._useWebGLForProcessing);"useProgressiveUpdate"in c&&(c.useProgressiveUpdate=this._useProgressiveUpdate);"previousLOD"in c&&(c.previousLOD=this.subview&&"previousLOD"in this.subview&&this.subview.previousLOD);c.attach();c.install(this.container);c.container.blendMode=l.blendMode;c.container.effect=l.effect;
this.subview=c;this.requestUpdate()};x._createClass(K,[{key:"useWebGLForProcessing",get:function(){return this._useWebGLForProcessing},set:function(c){this._useWebGLForProcessing=c;this.subview&&"useWebGLForProcessing"in this.subview&&(this.subview.useWebGLForProcessing=c)}},{key:"useProgressiveUpdate",get:function(){return this._useWebGLForProcessing},set:function(c){this._useProgressiveUpdate=c;this.subview&&"useProgressiveUpdate"in this.subview&&(this.subview.useProgressiveUpdate=c)}}]);return K}(L.ImageryTileLayerView(I.RefreshableLayerView(C.LayerView2DMixin(N))));
E.__decorate([z.property()],D.prototype,"subview",void 0);E.__decorate([z.property()],D.prototype,"useWebGLForProcessing",null);E.__decorate([z.property()],D.prototype,"useProgressiveUpdate",null);return D=E.__decorate([m.subclass("esri.views.2d.layers.ImageryTileLayerView2D")],D)});