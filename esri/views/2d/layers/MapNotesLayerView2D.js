// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.22/esri/copyright.txt for details.
//>>built
define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../Graphic ../../../core/Collection ../../../core/maybe ../../../core/watchUtils ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/set ../../../core/accessorSupport/decorators/subclass ./LayerView2D ./graphics/GraphicContainer ./graphics/GraphicsView2D ../../layers/LayerView".split(" "),function(l,v,w,x,h,k,n,C,D,E,F,y,z,q,r,A){const B=
Object.freeze({remove(){},pause(){},resume(){}});n=function(t){function p(){return t.apply(this,arguments)||this}l._inheritsLoose(p,t);var e=p.prototype;e.fetchPopupFeatures=function(){var a=l._asyncToGenerator(function*(c){return Array.from(this.graphicsViews(),b=>b.hitTest(c).filter(f=>!!f.popupTemplate)).flat()});return function(c){return a.apply(this,arguments)}}();e.graphicsViews=function*(){h.isSome(this._graphicsViewsFeatureCollectionMap)?yield*this._graphicsViewsFeatureCollectionMap.keys():
h.isSome(this._graphicsViews)?yield*this._graphicsViews:yield*[]};e.hitTest=function(){var a=l._asyncToGenerator(function*(c,b){var f=this;b=Array.from(this.graphicsViews(),function(){var g=l._asyncToGenerator(function*(d){const m=yield d.hitTest(c);if(h.isSome(f._graphicsViewsFeatureCollectionMap)){d=f._graphicsViewsFeatureCollectionMap.get(d);for(const u of m)!u.popupTemplate&&d.popupTemplate&&(u.popupTemplate=d.popupTemplate)}return m});return function(d){return g.apply(this,arguments)}}());return(yield Promise.all(b)).flat()});
return function(c,b){return a.apply(this,arguments)}}();e.highlight=function(a){let c;"number"===typeof a?c=[a]:a instanceof w?c=[a.uid]:Array.isArray(a)&&0<a.length?c="number"===typeof a[0]?a:a.map(b=>b&&b.uid):x.isCollection(a)&&(c=a.map(b=>b&&b.uid).toArray());c=c.filter(b=>null!=b);if(!c.length)return B;for(const b of this.graphicsViews())b.addHighlight(c);return{remove:()=>{for(const b of this.graphicsViews())b.removeHighlight(c)}}};e.update=function(a){for(const c of this.graphicsViews())c.processUpdate(a)};
e.attach=function(){const a=this.view,c=()=>this.requestUpdate();var b=this.layer.featureCollections;if(h.isSome(b)&&b.length){this._graphicsViewsFeatureCollectionMap=new Map;for(const f of b){b=new q(this.view.featuresTilingScheme);b.fadeTransitionEnabled=!0;const g=new r({view:a,graphics:f.source,renderer:f.renderer,requestUpdateCallback:c,container:b});this._graphicsViewsFeatureCollectionMap.set(g,f);this.container.addChild(g.container);this.handles.add([k.init(f,"visible",d=>g.container.visible=
d),k.init(g,"updating",()=>this.notifyChange("updating"))],"layerView")}}else h.isSome(this.layer.sublayers)&&this.handles.add(k.on(this.layer,"sublayers","change",()=>this._createGraphicsViews(),()=>this._createGraphicsViews(),()=>this._destroyGraphicsViews()),"sublayers")};e.detach=function(){this._destroyGraphicsViews();this.handles.remove("sublayers")};e.moveStart=function(){};e.moveEnd=function(){};e.viewChange=function(){for(const a of this.graphicsViews())a.viewChange()};e.isUpdating=function(){for(const a of this.graphicsViews())if(a.updating)return!0;
return!1};e._destroyGraphicsViews=function(){this.container.removeAllChildren();this.handles.remove("layerView");for(const a of this.graphicsViews())a.destroy();this._graphicsViewsFeatureCollectionMap=this._graphicsViews=null};e._createGraphicsViews=function(){this._destroyGraphicsViews();if(!h.isNone(this.layer.sublayers)){var a=[],c=this.view,b=()=>this.requestUpdate();for(const f of this.layer.sublayers){const g=new q(this.view.featuresTilingScheme);g.fadeTransitionEnabled=!0;const d=new r({view:c,
graphics:f.graphics,requestUpdateCallback:b,container:g});this.handles.add([f.on("graphic-update",d.graphicUpdateHandler),k.init(f,"visible",m=>d.container.visible=m),k.init(d,"updating",()=>this.notifyChange("updating"))],"layerView");this.container.addChild(d.container);a.push(d)}this._graphicsViews=a}};return p}(z.LayerView2DMixin(A));return n=v.__decorate([y.subclass("esri.views.2d.layers.MapNotesLayerView2D")],n)});