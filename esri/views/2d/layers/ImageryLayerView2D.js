// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.22/esri/copyright.txt for details.
//>>built
require({cache:{"esri/views/2d/engine/flow/AnimatedFlowView2D":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ./dataUtils ./FlowContainer ./FlowStrategy ./FlowStyle".split(" "),function(u,w,r,x,v,z,t,y,A,E,B,K){r=function(Q){function R(){var N=
Q.apply(this,arguments)||this;N._loadImagery=(T,L,G,F)=>A.loadImagery(N.layer,T,L,G,F);N._createStreamlinesMesh=(T,L,G)=>N.layer.createStreamlinesMesh({flowData:L,rendererSettings:T},{signal:G});N.container=null;N.layer=null;N.type="rasterAnimatedFlow";N.redrawOrRefetch=u._asyncToGenerator(function*(){N._rendererChanged()});return N}u._inheritsLoose(R,Q);var I=R.prototype;I.update=function(N){N.stationary?this._strategy.update(N):this.layerView.requestUpdate()};I.install=function(N){this.container=
new E;N.addChild(this.container);this._strategy=new B({flowContainer:this.container});this._rendererChanged()};I.uninstall=function(){this._strategy.destroy();this.container.removeAllChildren();this.container.remove()};I.moveEnd=function(){};I.doRefresh=function(){var N=u._asyncToGenerator(function*(){});return function(){return N.apply(this,arguments)}}();I.attach=function(){};I._rendererChanged=function(){if("animated-flow"===this.layer.renderer.type){var N=new K(this._loadImagery,this._createStreamlinesMesh,
this.layer.renderer);this.container.flowStyle=N;this.layerView.requestUpdate()}};u._createClass(R,[{key:"updating",get:function(){return!this._strategy||this._strategy.updating}}]);return R}(r);w.__decorate([x.property()],r.prototype,"_strategy",void 0);w.__decorate([x.property()],r.prototype,"container",void 0);w.__decorate([x.property()],r.prototype,"layer",void 0);w.__decorate([x.property()],r.prototype,"layerView",void 0);w.__decorate([x.property()],r.prototype,"type",void 0);w.__decorate([x.property()],
r.prototype,"updating",null);return r=w.__decorate([y.subclass("esri.views.2d.engine.flow.AnimatedFlowView2D")],r)})},"esri/views/2d/engine/flow/dataUtils":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../geometry ../../../../core/Logger ../../../../core/mathUtils ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/RandomLCG ../../../../geometry/support/spatialReferenceUtils ../../../../geometry/Extent".split(" "),function(u,w,r,x,v,z,t,y,A,E){function B(){B=
w._asyncToGenerator(function*(b,g,f){const e=performance.now();var a=K(b,g);const c=performance.now();a=R(b,a,g.width,g.height);g=performance.now();var d=N(a,!0);a=performance.now();d=T(d);const h=performance.now();b.profile&&H.info("createStreamlinesMesh profile",{"_createFlowFieldFromData()":Math.round(c-e),"_getStreamlines()":Math.round(g-c),"createAnimatedLinesData()":Math.round(a-g),"createLinesMesh()":Math.round(h-a),"Total elapsed time":Math.round(h-e)});yield Promise.resolve();t.throwIfAborted(f);
return d});return B.apply(this,arguments)}function K(b,g){const f=I(g.data,g.width,g.height,b.smoothing);return b.interpolate?(e,a)=>{const c=Math.floor(e),d=Math.floor(a);if(0>c||c>=g.width||0>d||d>=g.height)return[0,0];e-=c;a-=d;const h=c<g.width-1?c+1:c,l=d<g.height-1?d+1:d;return[(f[2*(d*g.width+c)]*(1-a)+f[2*(l*g.width+c)]*a)*(1-e)+(f[2*(d*g.width+h)]*(1-a)+f[2*(l*g.width+h)]*a)*e,(f[2*(d*g.width+c)+1]*(1-a)+f[2*(l*g.width+c)+1]*a)*(1-e)+(f[2*(d*g.width+h)+1]*(1-a)+f[2*(l*g.width+h)+1]*a)*e]}:
(e,a)=>{e=Math.round(e);a=Math.round(a);return 0>e||e>=g.width||0>a||a>=g.height?[0,0]:[f[2*(a*g.width+e)],f[2*(a*g.width+e)+1]]}}function Q(b,g,f,e,a,c,d,h,l){const p=[];let k=0;p.push({x:f,y:e,t:k});for(let D=0;D<b.verticesPerLine;D++){let [C,S]=g(f,e);C*=b.velocityScale;S*=b.velocityScale;var m=Math.sqrt(C*C+S*S);if(m<b.minSpeedThreshold)break;const O=C/m,M=S/m;f+=O*b.segmentLength;e+=M*b.segmentLength;k+=b.segmentLength/m;if(Math.acos(O*n+M*q)>b.maxTurnAngle)break;if(b.mergeLines){var n=Math.round(f*
l);var q=Math.round(e*l);if(0>n||n>d-1||0>q||q>h-1)break;m=c[q*d+n];if(-1!==m&&m!==a)break;c[q*d+n]=a}p.push({x:f,y:e,t:k});n=O;q=M}return p}function R(b,g,f,e){const a=[],c=new y,d=1/Math.max(b.lineCollisionWidth,1),h=Math.round(f*d),l=Math.round(e*d),p=new Int32Array(h*l);for(var k=0;k<p.length;k++)p[k]=-1;k=[];for(let m=0;m<e;m+=b.lineSpacing)for(let n=0;n<f;n+=b.lineSpacing)k.push({x:n,y:m,sort:c.getFloat()});k.sort((m,n)=>m.sort-n.sort);for(const {x:m,y:n}of k)c.getFloat()<b.density&&(f=Q(b,
g,m,n,a.length,p,h,l,d),2>f.length||a.push(f));return a}function I(b,g,f,e){if(0===e)return b;const a=Math.round(3*e),c=Array(2*a+1);var d=0;for(var h=-a;h<=a;h++){var l=Math.exp(-h*h/(e*e));c[h+a]=l;d+=l}for(e=-a;e<=a;e++)c[e+a]/=d;d=new Float32Array(b.length);for(e=0;e<f;e++)for(h=0;h<g;h++){var p=l=0;for(var k=-a;k<=a;k++)if(!(0>h+k||h+k>=g)){var m=c[k+a];l+=m*b[2*(e*g+(h+k))];p+=m*b[2*(e*g+(h+k))+1]}d[2*(e*g+h)]=l;d[2*(e*g+h)+1]=p}b=new Float32Array(b.length);for(e=0;e<g;e++)for(h=0;h<f;h++){p=
l=0;for(k=-a;k<=a;k++)0>h+k||h+k>=f||(m=c[k+a],l+=m*d[2*((h+k)*g+e)],p+=m*d[2*((h+k)*g+e)+1]);b[2*(h*g+e)]=l;b[2*(h*g+e)+1]=p}return b}function N(b,g){const f=new y;var e=b.reduce((h,l)=>h+l.length,0);e=new Float32Array(3*e);const a=Array(b.length);let c=0,d=0;for(const h of b){b=c;for(const l of h)e[3*c]=l.x,e[3*c+1]=l.y,e[3*c+2]=l.t,c++;a[d++]={startVertex:b,numberOfVertices:h.length,totalTime:h[h.length-1].t,timeSeed:g?f.getFloat():0}}return{lineVertices:e,lineDescriptors:a}}function T(b,g=10){function f(n,
q,D,C,S,O,M){const J=8*l;let U=0;h[J+U++]=n;h[J+U++]=q;h[J+U++]=1;h[J+U++]=D;h[J+U++]=O;h[J+U++]=M;h[J+U++]=C;h[J+U++]=S;l++;h[J+U++]=n;h[J+U++]=q;h[J+U++]=-1;h[J+U++]=D;h[J+U++]=O;h[J+U++]=M;h[J+U++]=-C;h[J+U++]=-S;l++}const {lineVertices:e,lineDescriptors:a}=b;var c=b=0;for(var d of a)b+=2*d.numberOfVertices,c+=6*(d.numberOfVertices-1);const h=new Float32Array(8*b);d=new Uint32Array(c);let l=0;b=0;for(const n of a){const {totalTime:q,timeSeed:D}=n;let C=c=null,S=null;var p=null,k=null;for(let O=
0;O<n.numberOfVertices;O++){const M=e[3*(n.startVertex+O)],J=e[3*(n.startVertex+O)+1],U=e[3*(n.startVertex+O)+2];let V=null,Y=null;var m=null;let W=null;0<O&&(V=M-c,Y=J-C,m=Math.sqrt(V*V+Y*Y),V/=m,Y/=m,1<O?(p=V+p,k=Y+k,m=Math.sqrt(p*p+k*k),p/=m,k/=m,m=Math.min(1/(p*V+k*Y),g),p*=m,k*=m,m=-k,W=p):(m=-Y,W=V),null!==m&&null!==W&&(f(c,C,S,m,W,q,D),d[b++]=l-2,d[b++]=l,d[b++]=l-1,d[b++]=l,d[b++]=l+1,d[b++]=l-1));c=M;C=J;S=U;p=V;k=Y}f(c,C,S,-k,p,q,D)}return{vertexData:h,indexData:d}}function L(b,g){const f=
g.pixels,{width:e,height:a}=g;g=new Float32Array(e*a*2);if("vector-uv"===b)for(b=0;b<e*a;b++)g[2*b]=f[0][b],g[2*b+1]=-f[1][b];else if("vector-magdir"===b)for(b=0;b<e*a;b++){const c=f[0][b],d=v.deg2rad(f[1][b]),h=Math.sin(d-Math.PI/2);g[2*b]=Math.cos(d-Math.PI/2)*c;g[2*b+1]=h*c}return{data:g,width:e,height:a}}function G(){G=w._asyncToGenerator(function*(b,g,f,e,a){var c=A.getInfo(g.spatialReference);if(!c)return F(b,g,f,e,a);const [d,h]=c.valid;c=Math.ceil(g.width/(h-d));const l=g.width/c,p=Math.round(f/
c);let k=g.xmin;const m=[];for(let n=0;n<c;n++){const q=new E({xmin:k,xmax:k+l,ymin:g.ymin,ymax:g.ymax,spatialReference:g.spatialReference});m.push(F(b,q,p,e,a));k+=l}g=yield Promise.all(m);e={data:new Float32Array(f*e*2),width:f,height:e};b=0;for(const n of g){for(g=0;g<n.height;g++)for(a=0;a<n.width;a++)b+a>=f||(e.data[2*(g*f+b+a)]=n.data[2*(g*n.width+a)],e.data[2*(g*f+b+a)+1]=n.data[2*(g*n.width+a)+1]);b+=n.width}return e});return G.apply(this,arguments)}function F(b,g,f,e,a){return P.apply(this,
arguments)}function P(){P=w._asyncToGenerator(function*(b,g,f,e,a){if("imagery"===b.type){yield b.load({signal:a});var c=b.rasterInfo.dataType;b=yield b.fetchImage(g,f,e,{signal:a});return!b||z.isNone(b.pixelData)||z.isNone(b.pixelData.pixelBlock)?{data:new Float32Array(f*e*2),width:f,height:e}:L(c,b.pixelData.pixelBlock)}yield b.load({signal:a});c=b.rasterInfo.dataType;b=yield b.fetchPixels(g,f,e,{signal:a});return!b||z.isNone(b.pixelBlock)?{data:new Float32Array(f*e*2),width:f,height:e}:L(c,b.pixelBlock)});
return P.apply(this,arguments)}const H=x.getLogger("esri.views.2d.engine.flow.dataUtils");u.createAnimatedLinesData=N;u.createLinesMesh=T;u.createStreamlinesMesh=function(b,g,f){return B.apply(this,arguments)};u.fetchPart=F;u.loadImagery=function(b,g,f,e,a){return G.apply(this,arguments)};Object.defineProperty(u,"__esModule",{value:!0})})},"esri/views/2d/engine/flow/FlowContainer":function(){define(["../../../../chunks/_rollupPluginBabelHelpers","./BrushFlow","../webgl/enums","../webgl/WGLContainer"],
function(u,w,r,x){return function(v){function z(){var y=v.apply(this,arguments)||this;y.flowStyle=null;return y}u._inheritsLoose(z,v);var t=z.prototype;t.doRender=function(y){v.prototype.doRender.call(this,y)};t.prepareRenderPasses=function(y){const A=y.registerRenderPass({name:"flow",brushes:[w],target:()=>this.children,drawPhase:r.WGLDrawPhase.MAP});return[...v.prototype.prepareRenderPasses.call(this,y),A]};u._createClass(z,[{key:"requiresDedicatedFBO",get:function(){return!1}}]);return z}(x)})},
"esri/views/2d/engine/flow/FlowStrategy":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../geometry ../../../../core/Accessor ../../../../core/Logger ../../../../core/mathUtils ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/Point ./FlowDisplayData ./FlowDisplayObject ../../../../geometry/Extent".split(" "),
function(u,w,r,x,v,z,t,y,A,E,B,K,Q,R,I,N,T){function L(F,P){const H=new R({x:(F.xmax+F.xmin)/2,y:(F.ymax+F.ymin)/2,spatialReference:F.spatialReference});var b=F.xmax-F.xmin;const g=F.ymax-F.ymin,f=Math.abs(Math.cos(z.deg2rad(P))),e=Math.abs(Math.sin(z.deg2rad(P)));P=f*b+e*g;b=e*b+f*g;F=new T({xmin:H.x-P/2,ymin:H.y-b/2,xmax:H.x+P/2,ymax:H.y+b/2,spatialReference:F.spatialReference});F.centerAt(H);return F}const G=v.getLogger("esri.views.2d.engine.flow.FlowStrategy");r=function(F){function P(b){b=F.call(this,
b)||this;b._flowDisplayObject=new N.FlowDisplayObject;b._loading=null;return b}u._inheritsLoose(P,F);var H=P.prototype;H.initialize=function(){this.flowContainer.addChild(this._flowDisplayObject)};H.destroy=function(){this._clear();this.flowContainer.removeAllChildren()};H.update=function(b){var {flowStyle:g}=this.flowContainer;if(t.isNone(g))this._clear();else{var {extent:f,rotation:e,resolution:a,pixelRatio:c}=b.state;b=L(f,e);b.expand(1.15);g=new I(g,b,[Math.round((b.xmax-b.xmin)/a),Math.round((b.ymax-
b.ymin)/a)],c);if(t.isSome(this._loading)){if(this._loading.update(g))return;this._loading.destroy();this._loading=null}if(t.isNone(this._flowDisplayObject.displayData)||!this._flowDisplayObject.displayData.update(g))g.load().then(()=>{this._flowDisplayObject.clear();this._flowDisplayObject.displayData=this._loading;this._loading=null},d=>{y.isAbortError(d)||(G.error("A resource failed to load.",d),this._loading=null)}),this._loading=g}};H._clear=function(){this._flowDisplayObject.clear();t.isSome(this._loading)&&
(this._loading.destroy(),this._loading=null)};u._createClass(P,[{key:"updating",get:function(){return null!=this._loading}}]);return P}(x);w.__decorate([A.property()],r.prototype,"_loading",void 0);w.__decorate([A.property()],r.prototype,"flowContainer",void 0);w.__decorate([A.property()],r.prototype,"updating",null);return r=w.__decorate([Q.subclass("esri.views.2d.engine.flow.FlowStrategy")],r)})},"esri/views/2d/engine/flow/FlowDisplayData":function(){define(["../../../../chunks/_rollupPluginBabelHelpers",
"../../../../core/Logger"],function(u,w){const r=w.getLogger("esri.views.2d.engine.flow.FlowDisplayData");return function(){function x(z,t,y,A){this.state={name:"created"};this.flowStyle=z;this.extent=t;this.size=y;this.pixelRatio=A}var v=x.prototype;v.load=function(){var z=u._asyncToGenerator(function*(){const t=new AbortController;this.state={name:"loading",abortController:t};this.state={name:"loaded",resources:yield this.flowStyle.loadResources({extent:this.extent,size:this.size,pixelRatio:this.pixelRatio},
t.signal)}});return function(){return z.apply(this,arguments)}}();v.prepareForRendering=function(z,t,y){if("loaded"!==this.state.name)r.error("Only loaded resources can be attached.");else{var A=this.state.resources;A.prepareForRendering(z,t,y);this.state={name:"attached",resources:A}}};v.destroy=function(){"loading"===this.state.name?(this.state.abortController.abort(),this.state={name:"detached"}):"attached"===this.state.name&&(this.state.resources.detach(),this.state={name:"detached"})};v.update=
function(z){if(!this.flowStyle.areResourcesCompatible(z.flowStyle)||!this.extent.equals(z.extent)||this.size[0]!==z.size[0]||this.size[1]!==z.size[1]||this.pixelRatio!==z.pixelRatio)return!1;this.flowStyle=z.flowStyle;return!0};return x}()})},"esri/views/2d/engine/flow/FlowDisplayObject":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/mathUtils ../../../../core/maybe ../../../../chunks/mat3 ../../../../chunks/mat3f32 ../DisplayObject".split(" "),function(u,
w,r,x,v,z,t){t=function(y){function A(){var B=y.apply(this,arguments)||this;B._displayData=null;return B}w._inheritsLoose(A,y);var E=A.prototype;E.clear=function(){x.isSome(this._displayData)&&(this._displayData.destroy(),this._displayData=null,this.requestRender())};E.setTransform=function(B){var {displayData:K}=this;if(!x.isNone(K)){var Q=[0,0];B.toScreen(Q,[K.extent.xmin,K.extent.ymax]);K=(K.extent.xmax-K.extent.xmin)/K.size[0]/B.resolution;var R=r.deg2rad(B.rotation),{dvs:I}=this.transforms;v.identity(I);
v.translate(I,I,[-1,1,0]);v.scale(I,I,[2/(B.size[0]*B.pixelRatio),-2/(B.size[1]*B.pixelRatio),1]);v.translate(I,I,[Q[0],Q[1],0]);v.rotate(I,I,R);v.scale(I,I,[K*B.pixelRatio,K*B.pixelRatio,1])}};E._createTransforms=function(){return{dvs:z.create()}};w._createClass(A,[{key:"displayData",get:function(){return this._displayData},set:function(B){this._displayData=B;this.requestRender()}}]);return A}(t.DisplayObject);u.FlowDisplayObject=t;Object.defineProperty(u,"__esModule",{value:!0})})},"esri/views/2d/engine/flow/FlowStyle":function(){define(["../../../../chunks/_rollupPluginBabelHelpers",
"../../../../core/promiseUtils","./animatedFlowRendererUtils","./FlowGLResources"],function(u,w,r,x){return function(){function v(t,y,A){this._loadImagery=t;this._createStreamlinesMesh=y;this._rendererSettings=r.createAnimatedFlowRendererSettings(A)}var z=v.prototype;z.areResourcesCompatible=function(t){let y;(y=(y=(y=(y=(y=(y=(y=(y=(y=(y=(y=(y=t._loadImagery===this._loadImagery)&&t._createStreamlinesMesh===this._createStreamlinesMesh)&&t._rendererSettings.verticesPerLine===this._rendererSettings.verticesPerLine)&&
t._rendererSettings.segmentLength===this._rendererSettings.segmentLength)&&t._rendererSettings.lineSpacing===this._rendererSettings.lineSpacing)&&t._rendererSettings.density===this._rendererSettings.density)&&t._rendererSettings.smoothing===this._rendererSettings.smoothing)&&t._rendererSettings.velocityScale===this._rendererSettings.velocityScale)&&t._rendererSettings.minWeightThreshold===this._rendererSettings.minWeightThreshold)&&t._rendererSettings.minSpeedThreshold===this._rendererSettings.minSpeedThreshold)&&
t._rendererSettings.mergeLines===this._rendererSettings.mergeLines)&&t._rendererSettings.interpolate===this._rendererSettings.interpolate)&&this._rendererSettings.mergeLines&&(y=t._rendererSettings.lineCollisionWidth===this._rendererSettings.lineCollisionWidth);return y?!0:!1};z.loadResources=function(){var t=u._asyncToGenerator(function*(y,A){const {extent:E,size:B}=y;w.throwIfAborted(A);y=yield this._loadImagery(E,B[0],B[1],A);const {vertexData:K,indexData:Q}=yield this._createStreamlinesMesh(this._rendererSettings,
y,A);return new x(K,Q)});return function(y,A){return t.apply(this,arguments)}}();u._createClass(v,[{key:"animated",get:function(){return 0<this._rendererSettings.lineSpeed}},{key:"renderSettings",get:function(){return this._rendererSettings}}]);return v}()})},"esri/views/2d/engine/flow/animatedFlowRendererUtils":function(){define(["exports","../../../../core/screenUtils"],function(u,w){u.createAnimatedFlowRendererSettings=function(r){const x=w.pt2px(r.lineWidth),v=2*x,z=Math.round(w.pt2px(r.lineLength)/
v)+1;var t=r.lineColor.toRgba();t=[t[0]/255,t[1]/255,t[2]/255,t[3]];const {lineSpeed:y,fadeDuration:A,density:E}=r;r=w.pt2px(r.smoothing);return{lineRenderWidth:x,segmentLength:v,verticesPerLine:z,lineCollisionWidth:x,lineSpacing:10,lineColor:t,lineSpeed:y,fadeDuration:A,density:E,smoothing:r,velocityScale:1,minWeightThreshold:.001,minSpeedThreshold:.001,maxTurnAngle:1,mergeLines:!0,interpolate:!0,profile:!1}};Object.defineProperty(u,"__esModule",{value:!0})})},"esri/views/2d/engine/flow/FlowGLResources":function(){define("../../../webgl/BufferObject ../../../webgl/FramebufferObject ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/has ../../../webgl/checkWebGLError ../../../webgl/enums ../../../../chunks/builtins ../../../webgl/Texture ../../../webgl/VertexArrayObject".split(" "),
function(u,w,r,x,v,z,t,y,A){return function(){function E(K,Q){this._vertexData=K;this._indexData=Q}var B=E.prototype;B.prepareForRendering=function(K,Q,R){const I=u.createVertex(K,35044,this._vertexData),N=u.createIndex(K,35044,this._indexData);K=new A(K,Q,R,{geometry:I},N);this.vertexBuffer=I;this.indexBuffer=N;this.vertexArray=K;this._indexData=this._vertexData=null};B.detach=function(){this.vertexArray.dispose();this.vertexBuffer.dispose();this.indexBuffer.dispose()};return E}()})},"esri/views/2d/layers/LayerView2D":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Collection ../../../core/collectionUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../engine/Container ../../layers/support/ClipArea ../../layers/support/ClipRect ../../layers/support/Geometry ../../layers/support/Path".split(" "),
function(u,w,r,x,v,z,t,y,A,E,B,K,Q,R,I,N){const T=x.ofType({key:"type",base:Q,typeMap:{rect:R,path:N,geometry:I}});u.LayerView2DMixin=L=>{L=function(G){function F(){var H=G.apply(this,arguments)||this;H.clips=new T;H.moving=!1;H.attached=!1;H.lastUpdateId=-1;H.updateRequested=!1;return H}w._inheritsLoose(F,G);var P=F.prototype;P.initialize=function(){var H;this.container||(this.container=new K.Container);this.container.fadeTransitionEnabled=!0;this.container.opacity=0;this.container.clips=this.clips;
this.handles.add([z.init(this,"suspended",b=>{this.container&&(this.container.visible=!b);this.view&&!b&&this.updateRequested&&this.view.requestUpdate()},!0),z.init(this,["layer.opacity","container"],()=>{if(this.container){var b,g;this.container.opacity=null!=(b=null==(g=this.layer)?void 0:g.opacity)?b:1}},!0),z.init(this,["layer.blendMode"],b=>{this.container&&(this.container.blendMode=b)},!0),z.init(this,["layer.effect"],b=>{this.container&&(this.container.effect=b)},!0),this.clips.on("change",
()=>{this.container.clips=this.clips;this.notifyChange("clips")})]);null!=(H=this.view)&&H.whenLayerView?this.view.whenLayerView(this.layer).then(b=>{b!==this||this.attached||this.destroyed||(this.attach(),this.requestUpdate(),this.attached=!0)},()=>{}):this.when().then(()=>{this.attached||this.destroyed||(this.attach(),this.requestUpdate(),this.attached=!0)},()=>{})};P.destroy=function(){this.attached&&(this.detach(),this.attached=!1);this.handles.remove("initialize");this.updateRequested=!1};P.isVisibleAtScale=
function(H){var b=!0,g=this.layer;const f=g.minScale;g=g.maxScale;if(null!=f&&null!=g){b=!f;let e=!g;!b&&H<=f&&(b=!0);!e&&H>=g&&(e=!0);b=b&&e}return b};P.requestUpdate=function(){this.destroyed||this.updateRequested||(this.updateRequested=!0,this.suspended||this.view.requestUpdate())};P.processUpdate=function(H){this.isFulfilled()&&!this.isResolved()?this.updateRequested=!1:(this._set("updateParameters",H),this.updateRequested&&!this.suspended&&(this.updateRequested=!1,this.update(H)))};P.hitTest=
function(H,b){return Promise.resolve(null)};P.isUpdating=function(){return!1};P.isRendering=function(){return!1};P.canResume=function(){return G.prototype.canResume.call(this)?this.isVisibleAtScale(this.view.scale):!1};w._createClass(F,[{key:"updating",get:function(){return!this.attached||!this.suspended&&(this.updateRequested||this.isUpdating())||!(!this.updatingHandles||!this.updatingHandles.updating)}}]);return F}(L);r.__decorate([t.property({type:T,set(G){G=v.referenceSetter(G,this._get("clips"),
T);this._set("clips",G)}})],L.prototype,"clips",void 0);r.__decorate([t.property()],L.prototype,"moving",void 0);r.__decorate([t.property()],L.prototype,"attached",void 0);r.__decorate([t.property()],L.prototype,"container",void 0);r.__decorate([t.property()],L.prototype,"suspended",void 0);r.__decorate([t.property({readOnly:!0})],L.prototype,"updateParameters",void 0);r.__decorate([t.property()],L.prototype,"updateRequested",void 0);r.__decorate([t.property()],L.prototype,"updating",null);r.__decorate([t.property()],
L.prototype,"view",void 0);return L=r.__decorate([B.subclass("esri.views.2d.layers.LayerView2D")],L)};Object.defineProperty(u,"__esModule",{value:!0})})},"esri/views/layers/support/ClipArea":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/JSONSupport ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/set ../../../core/accessorSupport/decorators/subclass".split(" "),
function(u,w,r,x,v,z,t,y,A){r=function(E){function B(){return E.apply(this,arguments)||this}u._inheritsLoose(B,E);return B}(r.JSONSupport);return r=w.__decorate([A.subclass("esri.views.layers.support.ClipArea")],r)})},"esri/views/layers/support/ClipRect":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ./ClipArea".split(" "),
function(u,w,r,x,v,z,t,y){var A;x=A=function(E){function B(){var K=E.apply(this,arguments)||this;K.type="rect";K.left=null;K.right=null;K.top=null;K.bottom=null;return K}u._inheritsLoose(B,E);B.prototype.clone=function(){return new A({left:this.left,right:this.right,top:this.top,bottom:this.bottom})};u._createClass(B,[{key:"version",get:function(){return(this._get("version")||0)+1}}]);return B}(y);w.__decorate([r.property({type:[Number,String],json:{write:!0}})],x.prototype,"left",void 0);w.__decorate([r.property({type:[Number,
String],json:{write:!0}})],x.prototype,"right",void 0);w.__decorate([r.property({type:[Number,String],json:{write:!0}})],x.prototype,"top",void 0);w.__decorate([r.property({type:[Number,String],json:{write:!0}})],x.prototype,"bottom",void 0);w.__decorate([r.property({readOnly:!0})],x.prototype,"version",null);return x=A=w.__decorate([t.subclass("esri.views.layers.support.ClipRect")],x)})},"esri/views/layers/support/Geometry":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../geometry ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../geometry/Geometry ../../../geometry/support/jsonUtils ./ClipArea ../../../geometry/Extent ../../../geometry/Polygon".split(" "),
function(u,w,r,x,v,z,t,y,A,E,B,K,Q){var R;r={base:A,key:"type",typeMap:{extent:K,polygon:Q}};B=R=function(I){function N(){var T=I.apply(this,arguments)||this;T.type="geometry";T.geometry=null;return T}u._inheritsLoose(N,I);N.prototype.clone=function(){return new R({geometry:this.geometry.clone()})};u._createClass(N,[{key:"version",get:function(){return(this._get("version")||0)+1}}]);return N}(B);w.__decorate([x.property({types:r,json:{read:E.fromJSON,write:!0}})],B.prototype,"geometry",void 0);w.__decorate([x.property({readOnly:!0})],
B.prototype,"version",null);return B=R=w.__decorate([y.subclass("esri.views.layers.support.Geometry")],B)})},"esri/views/layers/support/Path":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ./ClipArea".split(" "),function(u,w,r,x,v,z,t,y){x=function(A){function E(){var B=A.apply(this,
arguments)||this;B.type="path";B.path=[];return B}u._inheritsLoose(E,A);u._createClass(E,[{key:"version",get:function(){return(this._get("version")||0)+1}}]);return E}(y);w.__decorate([r.property({type:[[[Number]]],json:{write:!0}})],x.prototype,"path",void 0);w.__decorate([r.property({readOnly:!0})],x.prototype,"version",null);return x=w.__decorate([t.subclass("esri.views.layers.support.Path")],x)})},"esri/views/2d/layers/imagery/ImageryGraphicsView2D":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../Graphic ../../../../request ../../../../core/Accessor ../../../../core/Logger ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/enumeration ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/Extent ../../../../layers/support/rasterFunctions/rasterProjectionHelper ../../../../layers/support/rasterFunctions/vectorFieldUtils ../../../../support/GraphicsCollection ../../engine/Container ../graphics/GraphicContainer ../graphics/GraphicsView2D".split(" "),
function(u,w,r,x,v,z,t,y,A,E,B,K,Q,R,I,N,T,L,G,F,P){const H=z.getLogger("esri.views.2d.layers.imagery.ImageryGraphicsView2D");v=function(b){function g(){var e=b.apply(this,arguments)||this;e.attached=!1;e.container=new G.Container;e.updateRequested=!1;e._graphicsView=null;e._projectFullExtentPromise=null;e._dataParameters={exportParametersVersion:0,extents:[],tileResolution:0,time:"",isOceanStyle:!1,isOceanographic:!1};e.type="Graphics";e._graphics=new L.GraphicsCollection;e._updateGraphics=y.debounce(function(){var a=
u._asyncToGenerator(function*(c,d){if(c.stationary){var h=c.state;h=new I({xmin:h.extent.xmin,ymin:h.extent.ymin,xmax:h.extent.xmax,ymax:h.extent.ymax,spatialReference:h.spatialReference});var [l,p]=c.state.size,k={};k.timeExtent=e.timeExtent;k.requestAsImageElement=!1;k.signal=d;null==e._projectFullExtentPromise&&(e._projectFullExtentPromise=e._getProjectedFullExtent(h.spatialReference));d="vector-field"===e.layer.renderer.type?e.layer.renderer.symbolTileSize:50;var m=yield e._projectFullExtentPromise,
{extent:n,resolution:q,width:D,height:C}=T.snapImageToSymbolTile(h,l,p,d,m);h=yield e.layer.fetchImage(n,D,C,k);k=e.layer.renderer;if("vector-field"===k.type){d=h.pixelData.pixelBlock;m=k.sizeVariables[0];!t.isSome(d)||m.minDataValue&&m.maxDataValue||(m.minDataValue=d.statistics[0].minValue,m.maxDataValue=d.statistics[0].maxValue);e._pixelData={extent:n,pixelBlock:d};const S=n.clone().normalize();d={exportParametersVersion:e.layer.exportImageServiceParameters.version,extents:S,tileResolution:q,time:JSON.stringify(e.timeExtent||
""),isOceanStyle:"flow-to"===k.flowRepresentation,isOceanographic:"ocean-current-kn"===k.style||"ocean-current-m"===k.style};const O=e._canReuseVectorFieldData(d)?e._dataParameters.extents:[];h=yield k.getGraphicsFromPixelData(h.pixelData,"vector-uv"===e.layer.rasterInfo.dataType,O);O.length?(k=e._graphics.items.filter(M=>t.isSome(M.geometry)&&O.some(J=>J.intersects(M.geometry))&&!S.some(J=>J.intersects(M.geometry))),e._graphics.removeMany(k),e._graphics.addMany(h)):e._graphics.set("items",h);e._graphicsView.update(c);
e._dataParameters=d}}});return function(c,d){return a.apply(this,arguments)}}());return e}u._inheritsLoose(g,b);var f=g.prototype;f.destroy=function(){this.attached&&(this.detach(),this.attached=!1);this.updateRequested=!1};f.update=function(e){this._updateGraphics(e).catch(a=>{y.isAbortError(a)||H.error(a)})};f.hitTest=function(e){return new r({attributes:{},geometry:e.clone(),layer:this.layer})};f.attach=function(){this._graphicsView=new P({view:this.view,graphics:this._graphics,requestUpdateCallback:()=>
this.requestUpdate(),container:new F(this.view.featuresTilingScheme)});this.attached=!0};f.detach=function(){this._graphics.destroy();this._graphicsView.destroy();this.container.removeChild(this._graphicsView.container);this._graphicsView=null};f.install=function(e){this.container.addChild(this._graphicsView.container);e.addChild(this.container)};f.uninstall=function(e){this.container.removeChild(this._graphicsView.container);e.removeChild(this.container)};f.isUpdating=function(){return this._graphicsView.updating||
this.updateRequested};f.getPixelData=function(){return this.updating?null:this._pixelData};f.redraw=function(){};f.requestUpdate=function(){this.updateRequested||(this.updateRequested=!0,this.view.requestUpdate())};f._getProjectedFullExtent=function(){var e=u._asyncToGenerator(function*(a){try{return yield N.projectExtent(this.layer.fullExtent,a)}catch(c){try{const d=(yield x(this.layer.url,{query:{option:"footprints",outSR:a.wkid||JSON.stringify(a.toJSON()),f:"json"}})).data.featureCollection.layers[0].layerDefinition.extent;
return d?I.fromJSON(d):null}catch{return null}}});return function(a){return e.apply(this,arguments)}}();f._canReuseVectorFieldData=function(e){const a=this._dataParameters.exportParametersVersion===e.exportParametersVersion,c=this._dataParameters.time===e.time,d=.01>Math.abs(this._dataParameters.tileResolution-e.tileResolution)/e.tileResolution,h=this._dataParameters.extents.some(k=>e.extents.some(m=>k.intersects(m))),l=this._dataParameters.isOceanStyle===e.isOceanStyle,p=this._dataParameters.isOceanographic===
e.isOceanographic;return a&&c&&d&&h&&l&&p};u._createClass(g,[{key:"updating",get:function(){return!this.attached||this.isUpdating()}}]);return g}(v);w.__decorate([A.property()],v.prototype,"attached",void 0);w.__decorate([A.property()],v.prototype,"container",void 0);w.__decorate([A.property()],v.prototype,"layer",void 0);w.__decorate([A.property()],v.prototype,"timeExtent",void 0);w.__decorate([A.property()],v.prototype,"view",void 0);w.__decorate([A.property()],v.prototype,"updateRequested",void 0);
w.__decorate([A.property()],v.prototype,"updating",null);w.__decorate([Q.enumeration({graphics:"Graphics"})],v.prototype,"type",void 0);return v=w.__decorate([R.subclass("esri.views.2d.layers.imagery.ImageryGraphicsView2D")],v)})},"esri/layers/support/rasterFunctions/rasterProjectionHelper":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../geometry ../../../core/Error ../../../core/maybe ../../../core/unitUtils ../../../geometry/projection ../../../geometry/Extent ../../../geometry/Point".split(" "),
function(u,w,r,x,v,z,t,y,A){function E(a,c,d){return!t.canProjectWithoutEngine(a,c,d)}function B(a,c,d){if((a=E(a,c,d))&&!t.isLoaded())throw new x("rasterprojectionhelper-project","projection engine is not loaded");return a}function K(){K=w._asyncToGenerator(function*(){if(t.isLoaded())return null;yield t.load()});return K.apply(this,arguments)}function Q(a,c,d,h=null){if(a.spatialReference.equals(c))return a;B(a.spatialReference,c,h);d=d.center;a=new y({xmin:d.x-a.x/2,xmax:d.x+a.x/2,ymin:d.y-a.y/
2,ymax:d.y+a.y/2,spatialReference:a.spatialReference});c=t.project(a,c,h);return v.isNone(c)?null:{x:c.xmax-c.xmin,y:c.ymax-c.ymin}}function R(a,c=.01){return z.getMetersPerUnitForSR(a)?c/z.getMetersPerUnitForSR(a):0}function I(a,c,d=null,h=!0){const l=a.spatialReference;if(l.equals(c))return a;B(l,c,d);d=t.project(a,c,d);if(h&&c.isGeographic){const [p,k]=P(l,!0);(c=R(l))&&null!=p&&null!=k&&(Math.abs(a.x-p)<c&&5E-4>Math.abs(180-d.x)?d.x-=360:Math.abs(a.x-k)<c&&5E-4>Math.abs(180+d.x)&&(d.x+=360))}return d}
function N(a,c,d=null){const h=a[0].spatialReference;if(h.equals(c))return a;B(h,c,d);return t.project(a,c,d)}function T(a){const c=F(a[0].spatialReference);if(2>a.length||!v.isSome(c))return a[0];let {xmin:d,xmax:h,ymin:l,ymax:p}=a[0];for(let k=1;k<a.length;k++){const m=a[k];h=m.xmax+c*k;l=Math.min(l,m.ymin);p=Math.max(p,m.ymax)}return new y({xmin:d,xmax:h,ymin:l,ymax:p,spatialReference:a[0].spatialReference})}function L(a,c,d=null,h=!0){if(a.spatialReference.equals(c))return a;const l=b(a),p=F(a.spatialReference,
!0);if(!v.isSome(p)||0===l)return G(a,c,d,h);a=a.clone().normalize().map(k=>G(k,c,d,h));return T(a)}function G(a,c,d=null,h=!0){const l=a.spatialReference;if(l.equals(c))return a;B(l,c,d);const p=t.project(a,c,d);let [k,m]=P(l,!0);p&&h&&l.isWebMercator&&c.isGeographic&&null!=k&&null!=m&&(.001>Math.abs(a.xmin-k)&&1E3<Math.abs(m-a.xmax)&&5E-4>Math.abs(180-p.xmax)&&(p.xmin=-180,h=[],h.push(new A(a.xmax,a.ymin,l)),h.push(new A(a.xmax,(a.ymin+a.ymax)/2,l)),h.push(new A(a.xmax,a.ymax,l)),h=h.map(n=>I(n,
c,d)).filter(n=>!isNaN(null==n?void 0:n.x)).map(n=>n.x),p.xmax=Math.max.apply(null,h)),.001>Math.abs(a.xmax-m)&&1E3<Math.abs(k-a.xmin)&&5E-4>Math.abs(180+p.xmin)&&(p.xmax=180,h=[],h.push(new A(a.xmin,a.ymin,l)),h.push(new A(a.xmin,(a.ymin+a.ymax)/2,l)),h.push(new A(a.xmin,a.ymax,l)),a=h.map(n=>I(n,c,d)).filter(n=>!isNaN(null==n?void 0:n.x)).map(n=>n.x),p.xmin=Math.min.apply(null,a)));[k,m]=P(c,!0);(a=R(c))&&null!=k&&null!=m&&p&&(Math.abs(p.xmin-k)<a&&(p.xmin=k),Math.abs(p.xmax-m)<a&&(p.xmax=m));return p}
function F(a,c=!1){return a.isWebMercator?2*(c?2.0037508342787E7:2.0037508342788905E7):a.wkid&&a.isGeographic?360:2*e[a.wkid]||null}function P(a,c=!1){const d=[];a=F(a,c);v.isSome(a)&&(d.push(-a/2),d.push(a/2));return d}function H(a,c,d,h){a=(a-c)/d;0!==a-Math.floor(a)?a=Math.floor(a):h&&--a;return a}function b(a,c=!1){const d=F(a.spatialReference);if(!v.isSome(d))return 0;const h=c?0:-(d/2);c=H(a.xmax,h,d,!0);a=H(a.xmin,h,d,!1);return c-a}function g(a){const {projectedExtent:c,srcBufferExtent:d,
pixelSize:h,datumTransformation:l,rasterTransform:p}=a;var k=c.spatialReference,m=d.spatialReference;B(k,m);const {xmin:n,ymin:q,xmax:D,ymax:C}=c,S=F(m),O=a.hasWrapAround||"gcs-shift"===(null==p?void 0:p.type);a=a.spacing||[32,32];var M=a[0]*h.x,J=a[1]*h.y,U=Math.ceil((D-n)/M-.1/a[0])+1,V=Math.ceil((C-q)/J-.1/a[1])+1;const Y=[];let W,Z=0;var X=[];for(let ba=0;ba<U;ba++)for(let aa=0;aa<V;aa++)X.push(new A({x:n+M*ba,y:C-J*aa,spatialReference:k}));k=N(X,m,l);for(m=0;m<U;m++){M=[];for(J=0;J<V;J++)X=k[m*
V+J],p&&(X=p.inverseTransform(X)),M.push(X),0<m&&O&&X&&W[J]&&v.isSome(S)&&X.x<W[J].x&&(X.x+=S),X?(Y.push((X.x-d.xmin)/(d.xmax-d.xmin)),Y.push((d.ymax-X.y)/(d.ymax-d.ymin))):(Y.push(NaN),Y.push(NaN),Z++);W=M}return{offsets:Y,error:null,coefficients:null,outofBoundPointCount:Z,spacing:a,size:[U-1,V-1]}}const f=function(a,c,d){var h=(a[0]+a[4]+a[4*c.cols]+a[4*c.cols+4])/4;const l=(a[1]+a[5]+a[4*c.rows+1]+a[4*c.rows+5])/4,p=(a[4*c.cols]-a[0]+a[4*c.cols+4]-a[4])/d[0]*.5;d=(a[4*c.cols+1]-a[1]+a[4*c.cols+
5]-a[5])/d[1]*.5;h=0===p||isNaN(p)?0:Math.abs(h-a[2*c.rows+2])/Math.abs(p);a=0===d||isNaN(d)?0:Math.abs(l-a[2*c.rows+3])/Math.abs(d);return[h,a]},e={3395:2.0037508342789244E7,3410:1.7334193943686873E7,3857:2.0037508342788905E7,3975:1.7367530445161372E7,4087:2.0037508342789244E7,4088:2.0015108787169147E7,6933:1.7367530445161372E7,32662:2.0037508342789244E7,53001:2.001508679602057E7,53002:1.000754339801029E7,53003:2.001508679602057E7,53004:2.001508679602057E7,53016:1.4152803599503474E7,53017:1.7333573624304302E7,
53034:2.001508679602057E7,53079:2.0015114352186374E7,53080:2.0015114352186374E7,54001:2.0037508342789244E7,54002:1.0018754171394624E7,54003:2.0037508342789244E7,54004:2.0037508342789244E7,54016:1.4168658027268292E7,54017:1.736753044516137E7,54034:2.0037508342789244E7,54079:2.0037508342789244E7,54080:2.0037508342789244E7,54100:2.0037508342789244E7,54101:2.0037508342789244E7};u.computeProjectedScales=function(a,c,d=512,h=!0){const {extent:l,spatialReference:p,pixelSize:k}=a,m=Q(new A({x:k.x,y:k.y,spatialReference:p}),
c,l);if(null==m)return{projectedPixelSize:null,scales:null,srcResolutions:null,isCustomTilingScheme:!1};var n=(m.x+m.y)/2,q=z.getMetersPerUnitForSR(c);n=n*q*96*39.37;const D=c.isGeographic?256/d*2.958287637958547E8:256/d*5.91657527591555E8;d="vector-magdir"===a.dataType||"vector-uv"===a.dataType;const C=L(l,c);d||h&&(c.isGeographic||c.isWebMercator)&&(d=0>C.xmin*C.xmax);h=n;if(d)h=D,a=c.isGeographic?1.341104507446289E-6:.29858214164761665,q=96*a*q*39.37,c=Q(new A({x:a,y:a,spatialReference:{wkid:c.isGeographic?
4326:3857}}),p,C),c.x*=h/q,c.y*=h/q;else{c={x:k.x,y:k.y};a=Math.ceil(Math.log(Math.min(a.width,a.height)/32)/Math.LN2);for(q=0;h<.5005*D&&q<a;)q++,h*=2,c.x*=2,c.y*=2;1.001>=Math.max(h,D)/Math.min(h,D)&&(h=D)}a=[h];q=[{x:c.x,y:c.y}];for(n=Math.min(70.5310735,n)/1.001;h>=n;)h/=2,c.x/=2,c.y/=2,a.push(h),q.push({x:c.x,y:c.y});return{projectedPixelSize:m,scales:a,srcResolutions:q,isCustomTilingScheme:!d}};u.defaultGridSpacing=32;u.defaultProjectionToleranceInPixels=4;u.getDefaultDatumTransformationForDataset=
function(a,c,d){return B(a.spatialReference,c)?d?t.getTransformation(c,a.spatialReference,a):t.getTransformation(a.spatialReference,c,a):null};u.getProjectionOffsetGrid=function(a){var c=a.isAdaptive&&null==a.spacing,d=a.spacing||[32,32];let h=g(a);var l={cols:h.size[0]+1,rows:h.size[1]+1},p=f(h.offsets,l,d),k=(p[0]+p[1])/2,m=0<h.outofBoundPointCount&&h.outofBoundPointCount<h.offsets.length/2;c&&(m||4<k)&&(h=g({...a,spacing:[4,4]}),l={cols:h.size[0]+1,rows:h.size[1]+1},p=f(h.offsets,l,d));h.error=
p;a=h;{c=h.offsets;const {cols:O,rows:M}=l;l=new Float32Array((O-1)*(M-1)*12);d=new Float32Array([-0,-1,1,-1,1,-0,1,-0,-0]);p=new Float32Array([-1,1,0,0,-1,1,1,0,0]);for(k=0;k<O-1;k++){for(var n=0;n<M-1;n++){var q=k*M*2+2*n,D=c[q];const J=c[q+1];var C=c[q+2],S=c[q+3];q+=2*M;const U=c[q],V=c[q+1],Y=c[q+2];q=c[q+3];let W=0,Z=12*(n*(O-1)+k);for(let X=0;3>X;X++)l[Z++]=d[W++]*D+d[W++]*C+d[W++]*Y;W=0;for(C=0;3>C;C++)l[Z++]=d[W++]*J+d[W++]*S+d[W++]*q;W=0;for(S=0;3>S;S++)l[Z++]=p[W++]*D+p[W++]*U+p[W++]*Y;
W=0;for(D=0;3>D;D++)l[Z++]=p[W++]*J+p[W++]*V+p[W++]*q}if(m)for(n=0;n<l.length;n++)isNaN(l[n])&&(l[n]=-1)}m=l}a.coefficients=m;return h};u.getRasterDatasetAlignmentInfo=function(a){const c=a.storageInfo.origin.x;var d=F(a.spatialReference,!0);if(!v.isSome(d))return{originX:c,halfWorldWidth:null,pyramidsInfo:null};const h=d/2,{nativePixelSize:l,storageInfo:p,extent:k}=a,{maximumPyramidLevel:m,blockWidth:n,pyramidScalingFactor:q}=p;let D=l.x;const C=[];a=v.isSome(a.transform)&&"gcs-shift"===a.transform.type;
const S=c+(a?0:h);d=a?d-c:h-c;for(let O=0;O<=m;O++){const M=(k.xmax-c)/D/n,J=d/D/n;C.push({resolutionX:D,blockWidth:n,datsetColumnCount:0===M-Math.floor(M)?M:Math.ceil(M),worldColumnCountFromOrigin:0===J-Math.floor(J)?J:Math.ceil(J),leftMargin:Math.round(S/D)%n,rightPadding:(n-Math.round(d/D)%n)%n,originColumnOffset:Math.floor(S/D/n)});D*=q}return{originX:c,halfWorldWidth:h,pyramidsInfo:C,hasGCSSShiftTransform:a}};u.getWorldWidth=F;u.getWorldWrapCount=b;u.load=function(){return K.apply(this,arguments)};
u.minimumGridSpacing=4;u.projectExtent=L;u.projectPoint=I;u.projectResolution=Q;u.requirePE=E;u.snapExtent=function(a){a=a.clone().normalize();return 1===a.length?a[0]:T(a)};u.snapPyramid=function(a,c,d){const {storageInfo:h,pixelSize:l}=c;let p=!1;var {pyramidResolutions:k}=h;if(v.isSome(k)&&k.length){a=(a.x+a.y)/2;var m=k[k.length-1];m=(m.x+m.y)/2;var n=(l.x+l.y)/2;if(a<=n)var q=0;else if(a>=m)q=k.length,p=8<a/m;else{m=n;for(let D=1;D<=k.length;D++){n=(k[D-1].x+k[D-1].y)/2;if(a<=n){a===n?q=D:"down"===
d?(q=D-1,p=8<a/m):q="up"===d?D:a-m>n-a||2<a/m?D:D-1;break}m=n}}d=0===q?l:k[q-1];return{pyramidLevel:q,pyramidResolution:new A({x:d.x,y:d.y,spatialReference:c.spatialReference}),excessiveReading:p}}q=Math.log(a.x/l.x)/Math.LN2;a=Math.log(a.y/l.y)/Math.LN2;k=c.storageInfo.maximumPyramidLevel||0;q="down"===d?Math.floor(Math.min(q,a)):"up"===d?Math.ceil(Math.max(q,a)):Math.round((q+a)/2);0>q?q=0:q>k&&(p=q>k+3,q=k);d=2**q;c=new A({x:d*c.nativePixelSize.x,y:d*c.nativePixelSize.y,spatialReference:c.spatialReference});
return{pyramidLevel:q,pyramidResolution:c,excessiveReading:p}};Object.defineProperty(u,"__esModule",{value:!0})})},"esri/layers/support/rasterFunctions/vectorFieldUtils":function(){define(["exports","../../../core/jsonMap","../../../core/maybe","../PixelBlock","./pixelUtils"],function(u,w,r,x,v){function z(b,g){return I.get(b)/I.get(g)||1}function t(b,g="geographic"){const [f,e]=b;b=Math.sqrt(f*f+e*e);let a=Math.atan2(e,f)*N;a=(360+a)%360;"geographic"===g&&(a=(450-a)%360);return[b,a]}function y(b,
g="geographic"){let f=b[1];"geographic"===g&&(f=(450-f)%360);f%=360;b=b[0];return[b*Math.cos(f/N),b*Math.sin(f/N)]}function A(b=0,g=Math.PI,f=!0){f&&(g=(2*Math.PI-g)%(2*Math.PI));var e=f?-1:1;f=5*e;const a=20*e,c=25*e;e*=2;let [d,h]=[5,0-a],[l,p]=[d+2,h],[k,m]=[l-0,p+e],[n,q]=[-5,0-c],[D,C]=[n+0,q-e];b=Math.ceil(b/5);let S=Math.floor(b/10);b-=8*S;const O=[],M=[];for(let aa=0;aa<b/2;aa++,S--){0>=S&&1===b%2&&aa===(b-1)/2&&(n=0,D=n+0,q=(q+h)/2,C=q-e);const [ha,ia]=E(n,q,g,45);if(0<S){const [ca,da]=E(l,
q,g,45),[ea,fa]=E(d,h,g,45);O.push(ca);O.push(da);O.push(ha);O.push(ia);O.push(ea);O.push(fa)}else{const [ca,da]=E(l,p,g,45),[ea,fa]=E(k,m,g,45),[ja,ka]=E(D,C,g,45);M.push(ha);M.push(ia);M.push(ja);M.push(ka);M.push(ea);M.push(fa);M.push(ca);M.push(da)}q+=f;h+=f;p+=f;m+=f;C+=f}const [J,U]=E(5,0+a,g,45),[V,Y]=E(7,0+a,g,45),[W,Z]=E(5,0-c,g,45),[X,ba]=E(7,0-c,g,45);return{pennants:O,barbs:M,shaft:[J,U,V,Y,W,Z,X,ba]}}function E(b,g,f,e=1){return[Math.sqrt(b*b+g*g)/e,(2*Math.PI+(2*Math.PI+Math.atan2(g,
b))%(2*Math.PI)-f)%(2*Math.PI)]}function B(b,g,f,e){f=z(e||"knots",f);for(e=1;e<g.length;e++)if(e===g.length-1){if(b<g[e]*f)break}else if(b<=g[e]*f)break;return Math.min(e-1,g.length-2)}function K(b,g,f,e,a){let c=0;switch(g){case "beaufort_kn":c=B(b,G,"knots",f);break;case "beaufort_km":c=B(b,G,"kilometer-per-hour",f);break;case "beaufort_ft":c=B(b,G,"feet-per-second",f);break;case "beaufort_m":c=B(b,G,"meter-per-second",f);break;case "classified_arrow":c=B(b,a,e,f);break;case "ocean_current_m":c=
B(b,F,"meter-per-second",f);break;case "ocean_current_kn":c=B(b,P,"knots",f)}return c}function Q(b,g){const {style:f,inputUnit:e,outputUnit:a,breakValues:c}=g;g=T.fromJSON(e);const d=T.fromJSON(a);let h=0,l=0;const {width:p,height:k,mask:m}=b,n=b.pixels[0];b=b.pixels[1];var q=m?m.filter(O=>0<O).length:p*k;const D=new Float32Array(42*q);q=new Uint32Array(15*q);for(let O=0;O<k;O++)for(let M=0;M<p;M++){var C=O*p+M;if(!m||m[O*p+M]){var S;const J=null!=(S=(b[C]+360)%360/180*Math.PI)?S:2*Math.PI*Math.random(),
U=K(n[C],f,g,d,c);for(let V=0;V<L.length;V+=2)D[h++]=(M+.5)/p,D[h++]=(O+.5)/k,D[h++]=L[V],D[h++]=L[V+1]+J,D[h++]=U,D[h++]=n[C];C=7*(h/42-1);q[l++]=C;q[l++]=C+1;q[l++]=C+2;q[l++]=C+0;q[l++]=C+4;q[l++]=C+3;q[l++]=C+0;q[l++]=C+2;q[l++]=C+3;q[l++]=C+2;q[l++]=C+5;q[l++]=C+3;q[l++]=C+5;q[l++]=C+6;q[l++]=C+3}}return{vertexData:D,indexData:q}}function R(b,g){let f=0,e=0;const {width:a,height:c,mask:d}=b;b=b.pixels[0];const h=[],l=[];g="wind_speed"===g.style?5:Number.MAX_VALUE;for(let k=0;k<c;k++)for(let m=
0;m<a;m++){var p=k*a+m;if((!d||d[k*a+m])&&b[p]<g){for(let n=0;4>n;n++)h[f++]=(m+.5)/a,h[f++]=(k+.5)/c,h[f++]=2>n?-.5:.5,h[f++]=0===n%2?-.5:.5,h[f++]=0,h[f++]=b[p];p=4*(f/24-1);l[e++]=p;l[e++]=p+1;l[e++]=p+2;l[e++]=p+1;l[e++]=p+2;l[e++]=p+3}}return{vertexData:new Float32Array(h),indexData:new Uint32Array(l)}}const I=new Map;I.set("meter-per-second",1);I.set("kilometer-per-hour",.277778);I.set("knots",.514444);I.set("feet-per-second",.3048);I.set("mile-per-hour",.44704);const N=180/Math.PI,T=new w.JSONMap({esriMetersPerSecond:"meter-per-second",
esriKilometersPerHour:"kilometer-per-hour",esriKnots:"knots",esriFeetPerSecond:"feet-per-second",esriMilesPerHour:"mile-per-hour"}),L=function(b=0,g=0,f=Math.PI,e=!0){e&&(f=(2*Math.PI-f)%(2*Math.PI));e=e?-1:1;const a=-7*e,c=-2*e,d=-16*e,[h,l]=E(0,g+13*e,f,29),[p,k]=E(b-5.5,g+a,f,29),[m,n]=E(b+5.5,g+a,f,29),[q,D]=E(b-1.5,g+c,f,29),[C,S]=E(b+1.5,g+c,f,29),[O,M]=E(b-1.5,g+d,f,29),[J,U]=E(b+1.5,g+d,f,29);return[h,l,p,k,q,D,C,S,m,n,O,M,J,U]}(0,0,0),G=[0,1,3,6,10,16,21,27,33,40,47,55,63],F=[0,.5,1,1.5,
2],P=[0,.25,.5,1,1.5,2,2.5,3,3.5,4],H=[];u.convertVectorFieldData=function(b,g,f="geographic",e=1){if(!v.isValidPixelBlock(b))return b;const {pixels:a,width:c,height:d}=b;var h=c*d;const l=a[0],p=a[1],k=x.createEmptyBand(b.pixelType,h);h=x.createEmptyBand(b.pixelType,h);let m=0;for(let n=0;n<d;n++)for(let q=0;q<c;q++)"vector-uv"===g?([k[m],h[m]]=t([l[m],p[m]],f),k[m]*=e):([k[m],h[m]]=y([l[m],p[m]],f),k[m]*=e,h[m]*=e),m++;b=new x({pixelType:b.pixelType,width:b.width,height:b.height,mask:b.mask,validPixelCount:b.validPixelCount,
maskIsAlpha:b.maskIsAlpha,pixels:[k,h]});b.updateStatistics();return b};u.convertVectorFieldUnit=function(b,g,f=1){if(1===f||!v.isValidPixelBlock(b))return b;b=b.clone();const {pixels:e,width:a,height:c}=b,d=e[0],h=e[1];let l=0;for(let p=0;p<c;p++)for(let k=0;k<a;k++)"vector-uv"===g?(d[l]*=f,h[l]*=f):d[l]*=f,l++;b.updateStatistics();return b};u.createVFMesh=function(b,g){if("simple_scalar"===g.style)var f=R(b,g);else if("wind_speed"===g.style){{if(0===H.length)for(var e=0;30>e;e++)H.push(A(5*e,0));
g=T.fromJSON(g.inputUnit);g=z(g,"knots");const {width:h,height:l,mask:p}=b;e=b.pixels[0];b=b.pixels[1];const k=[],m=[];let n=0,q=0;for(let D=0;D<l;D++)for(let C=0;C<h;C++){var a=D*h+C,c=e[a]*g;if((!p||p[D*h+C])&&5<=c){const S=null!=(f=(b[a]+360)%360/180*Math.PI)?f:2*Math.PI*Math.random(),{pennants:O,barbs:M,shaft:J}=H[Math.min(Math.floor(c/5),29)];if(0===O.length+M.length)continue;a=k.length/6;const U=(C+.5)/h,V=(D+.5)/l;for(var d=0;d<O.length;d+=2)k[n++]=U,k[n++]=V,k[n++]=O[d],k[n++]=O[d+1]+S,k[n++]=
0,k[n++]=c;for(d=0;d<M.length;d+=2)k[n++]=U,k[n++]=V,k[n++]=M[d],k[n++]=M[d+1]+S,k[n++]=0,k[n++]=c;for(d=0;d<J.length;d+=2)k[n++]=U,k[n++]=V,k[n++]=J[d],k[n++]=J[d+1]+S,k[n++]=0,k[n++]=c;for(c=0;c<O.length/6;c++)m[q++]=a,m[q++]=a+1,m[q++]=a+2,a+=3;for(c=0;c<M.length/8;c++)m[q++]=a,m[q++]=a+1,m[q++]=a+2,m[q++]=a+1,m[q++]=a+2,m[q++]=a+3,a+=4;m[q++]=a+0;m[q++]=a+1;m[q++]=a+2;m[q++]=a+1;m[q++]=a+3;m[q++]=a+2;a+=4}}f={vertexData:new Float32Array(k),indexData:new Uint32Array(m)}}}else f=Q(b,g);return f};
u.createVFMeshScalar=R;u.getUnitConversionFactor=z;u.sampleVectorField=function(b,g,f,e=[0,0],a=.5){const {width:c,height:d,mask:h}=b,[l,p]=b.pixels,[k,m]=e;b=Math.round((c-k)/f);e=Math.round((d-m)/f);var n=b*e;const q=new Float32Array(n),D=new Float32Array(n);n=new Uint8Array(n);g="vector-uv"===g;for(let S=0;S<e;S++)for(let O=0;O<b;O++){let M=0;const J=S*b+O,U=Math.max(0,S*f+m),V=Math.max(0,O*f+k),Y=Math.min(d,U+f),W=Math.min(c,V+f);for(let Z=U;Z<Y;Z++)for(let X=V;X<W;X++){var C=Z*c+X;if(!h||h[C]){M++;
C=g?[l[C],p[C]]:[l[C],(360+p[C])%360];const [ba,aa]=g?C:y(C);q[J]+=ba;D[J]+=aa}}if(M>=(Y-U)*(W-V)*(1-a)){n[J]=1;const [Z,X]=t([q[J]/M,D[J]/M]);q[J]=Z;D[J]=X}else n[J]=0,q[J]=0,D[J]=0}f=new x({width:b,height:e,pixels:[q,D],mask:n});f.updateStatistics();return f};u.snapImageToSymbolTile=function(b,g,f,e,a){if(!r.isSome(a)||!a.spatialReference.equals(b.spatialReference))return{extent:b,width:g,height:f,resolution:b.width/g};const c=a.xmin;a=a.ymax;e=Math.max(e||0,30);g=((b.xmax-b.xmin)/Math.ceil(1/e*
g)+(b.ymax-b.ymin)/Math.ceil(1/e*f))/2;b.xmin=c+Math.floor((b.xmin-c)/g)*g;b.xmax=c+Math.ceil((b.xmax-c)/g)*g;b.ymin=a+Math.floor((b.ymin-a)/g)*g;b.ymax=a+Math.ceil((b.ymax-a)/g)*g;return{extent:b,width:Math.round(b.width/g),height:Math.round(b.height/g),resolution:g}};u.unitKebabDict=T;u.uvComponentToVector=t;Object.defineProperty(u,"__esModule",{value:!0})})},"esri/views/2d/layers/imagery/ImageryView2D":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../Graphic ../../../../core/Accessor ../../../../core/Logger ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/enumeration ../../../../core/accessorSupport/decorators/subclass ../../../../layers/support/rasterFunctions/pixelUtils ../../engine/BitmapContainer ../../engine/Container ../../engine/ImageryBitmapSource ../support/ExportStrategy".split(" "),
function(u,w,r,x,v,z,t,y,A,E,B,K,Q,R,I,N,T,L){const G=v.getLogger("esri.views.2d.layers.imagery.ImageryView2D");x=function(F){function P(){var b=F.apply(this,arguments)||this;b.attached=!1;b.container=new N.Container;b.updateRequested=!1;b.type="Imagery";b._bitmapView=null;return b}u._inheritsLoose(P,F);var H=P.prototype;H.destroy=function(){this.attached&&(this.detach(),this.attached=!1);this.updateRequested=!1};H.update=function(b){this.strategy.update(b).catch(g=>{t.isAbortError(g)||G.error(g)})};
H.detach=function(){this.strategy.destroy();this._bitmapView.removeAllChildren();this.container.removeAllChildren()};H.hitTest=function(b){return new r({attributes:{},geometry:b.clone(),layer:this.layer})};H.attach=function(){const b=10<=this.layer.version,g=10.1<=this.layer.version?this.layer.imageMaxHeight:2048,f=10.1<=this.layer.version?this.layer.imageMaxWidth:2048;this._bitmapView=new I.BitmapContainer;this.strategy=new L({container:this._bitmapView,imageNormalizationSupported:b,imageMaxHeight:g,
imageMaxWidth:f,fetchSource:this._fetchImage.bind(this),requestUpdate:()=>this.requestUpdate()});this.attached=!0};H.install=function(b){this.container.addChild(this._bitmapView);b.addChild(this.container)};H.uninstall=function(b){this.container.removeChild(this._bitmapView);b.removeChild(this.container)};H.redraw=function(){this.strategy.updateExports(b=>{b.source instanceof HTMLImageElement?b.requestRender():this.layer.applyRenderer({pixelBlock:b.source.pixelBlock}).then(g=>{const f=b.source;f.pixelBlock=
g.pixelBlock;f.filter=e=>this.layer.applyFilter(e);this.container.requestRender()})})};H.requestUpdate=function(){this.updateRequested||(this.updateRequested=!0,this.view.requestUpdate())};H.isUpdating=function(){return this.strategy.updating||this.updateRequested};H.getPixelData=function(){if(this.updating)return null;var b=this.strategy.bitmaps;if(1===b.length&&b[0].source)return{extent:b[0].source.extent,pixelBlock:b[0].source.originalPixelBlock};if(1<b.length){const g=this.view.extent;b=b.map(f=>
f.source).filter(f=>f.extent&&f.extent.intersects(g)).map(f=>({extent:f.extent,pixelBlock:f.originalPixelBlock}));b=R.mosaicPixelData(b,g);return z.isSome(b)?{extent:b.extent,pixelBlock:b.pixelBlock}:null}return null};H._fetchImage=function(b,g,f,e){e=e||{};e.timeExtent=this.timeExtent;e.requestAsImageElement=!0;return this.layer.fetchImage(b,g,f,e).then(a=>a.imageElement?a.imageElement:this.layer.applyRenderer(a.pixelData,{signal:e.signal}).then(c=>{c=new T(c.pixelBlock,c.extent.clone(),a.pixelData.pixelBlock);
c.filter=d=>this.layer.applyFilter(d);return c}))};u._createClass(P,[{key:"updating",get:function(){return!this.attached||this.isUpdating()}}]);return P}(x);w.__decorate([y.property()],x.prototype,"attached",void 0);w.__decorate([y.property()],x.prototype,"container",void 0);w.__decorate([y.property()],x.prototype,"layer",void 0);w.__decorate([y.property()],x.prototype,"strategy",void 0);w.__decorate([y.property()],x.prototype,"timeExtent",void 0);w.__decorate([y.property()],x.prototype,"view",void 0);
w.__decorate([y.property()],x.prototype,"updateRequested",void 0);w.__decorate([y.property()],x.prototype,"updating",null);w.__decorate([K.enumeration({imagery:"Imagery"})],x.prototype,"type",void 0);return x=w.__decorate([Q.subclass("esri.views.2d.layers.imagery.ImageryView2D")],x)})},"esri/views/2d/layers/support/ExportStrategy":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/promiseUtils ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/Extent ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/spatialReferenceUtils ../../../../layers/support/TileInfo ../../viewStateUtils ../../engine/Bitmap ../../tiling/TileInfoView ../../tiling/TileKey".split(" "),
function(u,w,r,x,v,z,t,y,A,E,B,K,Q,R,I,N,T){const L=B.create(),G=[0,0],F=new T(0,0,0,0);r=function(P){function H(g){var f=P.call(this,g)||this;f._imagePromise=null;f.bitmaps=[];f.hidpi=!1;f.imageMaxWidth=2048;f.imageMaxHeight=2048;f.imageRotationSupported=!1;f.imageNormalizationSupported=!1;f.update=x.debounce(function(){var e=u._asyncToGenerator(function*(a,c){if(!a.stationary||f.destroyed)return null;const d=a.state;var h=K.getInfo(d.spatialReference);a=f.hidpi?a.pixelRatio:1;var l=f.imageNormalizationSupported&&
d.worldScreenWidth&&d.worldScreenWidth<d.size[0];l?(G[0]=d.worldScreenWidth,G[1]=d.size[1]):f.imageRotationSupported?(G[0]=d.size[0],G[1]=d.size[1]):R.getOuterSize(G,d);h=h&&(d.extent.xmin<h.valid[0]||d.extent.xmax>h.valid[1]);h=!f.imageNormalizationSupported&&h;const p=f.imageRotationSupported?d.rotation:0;Math.floor(G[0]*a)>f.imageMaxWidth||Math.floor(G[1]*a)>f.imageMaxHeight||h?(l=Math.min(f.imageMaxWidth,f.imageMaxHeight),h&&(l=Math.min(d.worldScreenWidth,l)),f._imagePromise=f._tiledExport(d,
l,p,a,c)):f._imagePromise=f._singleExport(d,G,l?d.paddedViewState.center:d.center,d.resolution,p,a,c);return f._imagePromise.then(function(){var k=u._asyncToGenerator(function*(m){f._imagePromise=null;if(!f.destroyed){f.bitmaps=null!=m?m:[];for(const n of f.container.children)m.includes(n)||n.fadeOut().then(()=>{n.remove()});for(const n of m)f.container.addChild(n),n.fadeIn()}});return function(m){return k.apply(this,arguments)}}()).catch(k=>{f._imagePromise=null;throw k;})});return function(a,c){return e.apply(this,
arguments)}}(),5E3);return f}u._inheritsLoose(H,P);var b=H.prototype;b.destroy=function(){this.bitmaps=[]};b.updateExports=function(g){for(const f of this.container.children){if(!f.visible||!f.stage)break;g(f);f.invalidateTexture();f.requestRender()}};b._export=function(){var g=u._asyncToGenerator(function*(f,e,a,c,d,h){a=yield this.fetchSource(f,Math.floor(e*d),Math.floor(a*d),{rotation:c,pixelRatio:d,signal:h});a=new I.Bitmap(a,"additive");a.x=f.xmin;a.y=f.ymax;a.resolution=f.width/e;a.rotation=
c;a.pixelRatio=d;return a});return function(f,e,a,c,d,h){return g.apply(this,arguments)}}();b._singleExport=function(){var g=u._asyncToGenerator(function*(f,e,a,c,d,h,l){R.getBBox(L,a,c,e);f=new E(L[0],L[1],L[2],L[3],f.spatialReference);return[yield this._export(f,e[0],e[1],d,h,l)]});return function(f,e,a,c,d,h,l){return g.apply(this,arguments)}}();b._tiledExport=function(g,f,e,a,c){var d=Q.create({size:f,spatialReference:g.spatialReference,scales:[g.scale]});const h=new N(d);d=h.getTileCoverage(g);
if(!d)return null;const l=[];d.forEach((p,k,m,n)=>{F.set(p,k,m,n);h.getTileBounds(L,F);p=new E(L[0],L[1],L[2],L[3],g.spatialReference);l.push(this._export(p,f,f,e,a,c))});return Promise.all(l)};u._createClass(H,[{key:"updating",get:function(){return!this.destroyed&&null!==this._imagePromise}}]);return H}(r);w.__decorate([v.property()],r.prototype,"_imagePromise",void 0);w.__decorate([v.property()],r.prototype,"bitmaps",void 0);w.__decorate([v.property()],r.prototype,"container",void 0);w.__decorate([v.property()],
r.prototype,"fetchSource",void 0);w.__decorate([v.property()],r.prototype,"hidpi",void 0);w.__decorate([v.property()],r.prototype,"imageMaxWidth",void 0);w.__decorate([v.property()],r.prototype,"imageMaxHeight",void 0);w.__decorate([v.property()],r.prototype,"imageRotationSupported",void 0);w.__decorate([v.property()],r.prototype,"imageNormalizationSupported",void 0);w.__decorate([v.property()],r.prototype,"requestUpdate",void 0);w.__decorate([v.property()],r.prototype,"updating",null);return r=w.__decorate([A.subclass("esri.views.2d.layers.support.ExportStrategy")],
r)})},"esri/views/2d/viewStateUtils":function(){define(["exports"],function(u){const w=Math.PI/180;u.bboxIntersects=function(r,x){const [v,z,t,y]=r,[A,E,B,K]=x;return!(v>B||t<A||z>K||y<E)};u.getBBox=function(r,x,v,z){const [t,y]=x,[A,E]=z;x=.5*v;r[0]=t-x*A;r[1]=y-x*E;r[2]=t+x*A;r[3]=y+x*E;return r};u.getOuterSize=function(r,x){var v=x.rotation*w;const z=Math.abs(Math.cos(v));v=Math.abs(Math.sin(v));const [t,y]=x.size;r[0]=Math.round(y*v+t*z);r[1]=Math.round(y*z+t*v);return r};u.snapToPixel=function(r,
x,v){const {resolution:z,size:t}=v;r[0]=z*(Math.round(x[0]/z)+t[0]%2*.5);r[1]=z*(Math.round(x[1]/z)+t[1]%2*.5);return r};Object.defineProperty(u,"__esModule",{value:!0})})},"esri/views/layers/ImageryLayerView":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Error ../../core/maybe ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ../../geometry/Point ../../layers/support/commonProperties ../../rest/support/Query ./support/popupUtils".split(" "),
function(u,w,r,x,v,z,t,y,A,E,B,K,Q,R){t=I=>{I=function(N){function T(){var G=N.apply(this,arguments)||this;G.view=null;return G}w._inheritsLoose(T,N);var L=T.prototype;L.fetchPopupFeatures=function(){var G=w._asyncToGenerator(function*(F,P){const {layer:H}=this;if(!F)throw new x("imagerylayerview:fetchPopupFeatures","Nothing to fetch without area",{layer:H});var {popupEnabled:b}=H;const g=R.getFetchPopupTemplate(H,P);if(!b||!v.isSome(g))throw new x("imagerylayerview:fetchPopupFeatures","Missing required popupTemplate or popupEnabled",
{popupEnabled:b,popupTemplate:g});const f=yield g.getRequiredFields();b=new Q;b.timeExtent=this.timeExtent;b.geometry=F;b.outFields=f;b.outSpatialReference=F.spatialReference;F=this.view.resolution;F="2d"===this.view.type?new B(F,F,this.view.spatialReference):new B(.5*F,.5*F,this.view.spatialReference);const {returnTopmostRaster:e,showNoDataRecords:a}=g.layerOptions||{returnTopmostRaster:!0,showNoDataRecords:!1};P={returnDomainValues:!0,returnTopmostRaster:e,pixelSize:F,showNoDataRecords:a,signal:v.isSome(P)?
P.signal:null};return H.queryVisibleRasters(b,P).then(c=>c)});return function(F,P){return G.apply(this,arguments)}}();L.canResume=function(){var G;return!N.prototype.canResume.call(this)||null!=(G=this.timeExtent)&&G.isEmpty?!1:!0};return T}(I);r.__decorate([z.property()],I.prototype,"layer",void 0);r.__decorate([z.property()],I.prototype,"suspended",void 0);r.__decorate([z.property(K.combinedViewLayerTimeExtentProperty)],I.prototype,"timeExtent",void 0);r.__decorate([z.property()],I.prototype,"view",
void 0);return I=r.__decorate([E.subclass("esri.views.layers.ImageryLayerView")],I)};u.ImageryLayerView=t;u.default=t;Object.defineProperty(u,"__esModule",{value:!0})})},"esri/views/layers/support/popupUtils":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/maybe","../../../layers/support/fieldUtils"],function(u,w,r,x){function v(){v=w._asyncToGenerator(function*(z,t=z.popupTemplate){if(!r.isSome(t))return[];const y=yield t.getRequiredFields(z.fieldsIndex);({lastEditInfoEnabled:t}=
t);const {objectIdField:A,typeIdField:E,globalIdField:B,relationships:K}=z;if(y.includes("*"))return["*"];t=t?yield x.getFeatureEditFields(z):[];const Q=x.fixFields(z.fieldsIndex,[...y,...t]);E&&Q.push(E);Q&&A&&z.fieldsIndex.has(A)&&-1===Q.indexOf(A)&&Q.push(A);Q&&B&&z.fieldsIndex.has(B)&&-1===Q.indexOf(B)&&Q.push(B);K&&K.forEach(R=>{({keyField:R}=R);Q&&R&&z.fieldsIndex.has(R)&&-1===Q.indexOf(R)&&Q.push(R)});return Q});return v.apply(this,arguments)}u.getFetchPopupTemplate=function(z,t){return z.popupTemplate?
z.popupTemplate:r.isSome(t)&&t.defaultPopupTemplateEnabled&&r.isSome(z.defaultPopupTemplate)?z.defaultPopupTemplate:null};u.getRequiredFields=function(z){return v.apply(this,arguments)};Object.defineProperty(u,"__esModule",{value:!0})})},"esri/views/layers/RefreshableLayerView":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Logger ../../core/promiseUtils ../../core/watchUtils ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass".split(" "),
function(u,w,r,x,v,z,t,y,A,E,B){y=K=>{K=function(Q){function R(){return Q.apply(this,arguments)||this}w._inheritsLoose(R,Q);R.prototype.initialize=function(){this.handles.add(z.on(this,"layer","refresh",I=>{this.doRefresh(I.dataChanged).catch(N=>{v.isAbortError(N)||x.getLogger(this.declaredClass).error(N)})}),"RefreshableLayerView")};return R}(K);r.__decorate([t.property()],K.prototype,"layer",void 0);return K=r.__decorate([B.subclass("esri.layers.mixins.RefreshableLayerView")],K)};u.RefreshableLayerView=
y;u.default=y;Object.defineProperty(u,"__esModule",{value:!0})})},"*noref":1}});
define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/watchUtils ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../engine/flow/AnimatedFlowView2D ./LayerView2D ./imagery/ImageryGraphicsView2D ./imagery/ImageryView2D ../../layers/ImageryLayerView ../../layers/LayerView ../../layers/RefreshableLayerView".split(" "),function(u,w,
r,x,v,z,t,y,A,E,B,K,Q,R,I){v=function(N){function T(){var G=N.apply(this,arguments)||this;G._exportImageVersion=-1;return G}u._inheritsLoose(T,N);var L=T.prototype;L.initialize=function(){this.handles.add([r.init(this,["layer.blendMode","layer.effects"],G=>{this.subview&&(this.subview.container.blendMode=G)},!0),r.init(this,"layer.effect",G=>{this.subview&&(this.subview.container.effect=G)},!0)])};L.hitTest=function(){var G=u._asyncToGenerator(function*(F,P){return this.subview?"hitTest"in this.subview?
[this.subview.hitTest(F)]:[]:null});return function(F,P){return G.apply(this,arguments)}}();L.update=function(G){var F;null==(F=this.subview)?void 0:F.update(G)};L.attach=function(){this.layer.increaseRasterJobHandlerUsage();this._setSubView();this.handles.add([r.init(this,"layer.exportImageServiceParameters.version",G=>{this._exportImageVersion!==G&&(this._exportImageVersion=G,this.requestUpdate())}),this.watch("timeExtent",()=>{"timeExtent"in this.subview&&(this.subview.timeExtent=this.timeExtent);
this.requestUpdate()}),this.layer.on("redraw",()=>{"redraw"in this.subview?this.subview.redraw():this.subview.redrawOrRefetch()}),r.watch(this.layer,"renderer",()=>this._setSubView())],"imagerylayerview-update")};L.detach=function(){this.layer.decreaseRasterJobHandlerUsage();this.subview.destroy();this.handles.remove("imagerylayerview-update");this._exportImageVersion=-1};L.moveStart=function(){};L.viewChange=function(){};L.moveEnd=function(){this.requestUpdate()};L.doRefresh=function(){var G=u._asyncToGenerator(function*(){this.requestUpdate()});
return function(){return G.apply(this,arguments)}}();L.isUpdating=function(){return!this.subview||!this.suspended&&this.subview.updating};L._setSubView=function(){var G,F;let P="Imagery";"vector-field"===(null==(G=this.layer.renderer)?void 0:G.type)&&"lerc"===this.layer.format&&(P="Graphics");"animated-flow"===(null==(F=this.layer.renderer)?void 0:F.type)&&(P="Flow");if(!this.subview||this.subview.type!==P){var H,b;null==(H=this.subview)?void 0:H.uninstall(this.container);null==(b=this.subview)?void 0:
b.destroy();this.subview="Imagery"===P?new K({layer:this.layer,view:this.view,timeExtent:this.timeExtent}):"Graphics"===P?new B({layer:this.layer,view:this.view,timeExtent:this.timeExtent}):new A({layer:this.layer,layerView:this});this.subview.attach();this.subview.install(this.container);this.subview.container.blendMode=this.layer.blendMode;this.subview.container.effect=this.layer.effect}this.requestUpdate()};u._createClass(T,[{key:"pixelData",get:function(){return this.updating?null:"getPixelData"in
this.subview?this.subview.getPixelData():null}},{key:"updating",get:function(){return!(this.subview&&!("updating"in this.subview&&this.subview.updating))}}]);return T}(Q.ImageryLayerView(I.RefreshableLayerView(E.LayerView2DMixin(R))));w.__decorate([x.property()],v.prototype,"pixelData",null);w.__decorate([x.property({readOnly:!0})],v.prototype,"updating",null);w.__decorate([x.property()],v.prototype,"subview",void 0);return v=w.__decorate([y.subclass("esri.views.2d.layers.ImageryLayerView2D")],v)});