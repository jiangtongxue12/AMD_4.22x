// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.22/esri/copyright.txt for details.
//>>built
define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/maybe ../../../../webgl/BufferObject ../../../../webgl/FramebufferObject ../../../../../core/has ../../../../webgl/checkWebGLError ../../../../webgl/enums ../../../../../chunks/builtins ../../../../webgl/Texture ../../../../webgl/VertexArrayObject ../BufferPool ./FreeList".split(" "),function(l,p,e,m,n,t,u,v,w,x,y,q,r){n=function(){function k(a,b,c){b=q.TypedBuffer.create(b*c*Uint32Array.BYTES_PER_ELEMENT);this.strideInt=
c;this.bufferType=a;this.dirty={start:Infinity,end:0};this.gpu=null;this._cpu=b;this.clear()}var d=k.prototype;d.destroy=function(){e.andThen(this.gpu,a=>a.dispose());e.andThen(this._cpu,a=>a.destroy());e.andThen(this._cpu2,a=>a.destroy())};d.clear=function(){this.dirty.start=Infinity;this.dirty.end=0;this.freeList=new r.FreeList({start:0,end:this._cpu.length/this.strideInt});this.fillPointer=0};d.ensure=function(a){if(!(this.maxAvailableSpace()>=a)&&a*this.strideInt>this._cpu.length-this.fillPointer){e.isSome(this.gpu)&&
(this.gpu=null);const b=this._cpu.length/this.strideInt;a=Math.round(1.25*(b+a));this._cpu.expand(a*this.strideInt*Uint32Array.BYTES_PER_ELEMENT);this.freeList.free(b,a-b)}};d.set=function(a,b){this._cpu.array[a]!==b&&(this._cpu.array[a]=b,this.dirty.start=Math.min(a,this.dirty.start),this.dirty.end=Math.max(a,this.dirty.end))};d.getBuffer=function(){this._cpu2||(this._cpu2=this._cpu.slice());this._cpu2.length!==this._cpu.length&&this._cpu2.expand(this._cpu.length*this._cpu.array.BYTES_PER_ELEMENT);
this._cpu2.set(this._cpu);return this._cpu2};d.maxAvailableSpace=function(){return this.freeList.maxAvailableSpace()};d.insert=function(a,b,c,g){const f=c*this.strideInt;a=new Uint32Array(a,b*this.strideInt*Uint32Array.BYTES_PER_ELEMENT,f);c=e.unwrapOrThrow(this.freeList.firstFit(c),"First fit region must be defined")*this.strideInt;b=c/this.strideInt-b;if(0!==g)for(let h=0;h<a.length;h++)a[h]+=g;this._cpu.array.set(a,c);this.dirty.start=Math.min(this.dirty.start,c);this.dirty.end=Math.max(this.dirty.end,
c+f);this.fillPointer=Math.max(this.fillPointer,c+f);return b};d.free=function(a,b,c){const g=a*this.strideInt,f=(a+b)*this.strideInt;if(!0===c)for(c=a;c!==a+b;c++)this._cpu.array[c*this.strideInt]=2147450879;this.dirty.start=Math.min(this.dirty.start,g);this.dirty.end=Math.max(this.dirty.end,f);this.freeList.free(a,b)};d.upload=function(a){this.dirty.end&&(e.isNone(this.gpu)?this.gpu=this._createBuffer(a):this.gpu.setSubDataFromView(this._cpu.array,this.dirty.start,this.dirty.start,this.dirty.end),
this.dirty.start=Infinity,this.dirty.end=0)};d._createBuffer=function(a){return"index"===this.bufferType?m.createIndex(a,35048,this._cpu.array):m.createVertex(a,35048,this._cpu.array)};p._createClass(k,[{key:"elementSize",get:function(){return this._cpu.length/this.strideInt}},{key:"bufferSize",get:function(){return this._cpu.length/this.strideInt}}]);return k}();l.Buffer=n;Object.defineProperty(l,"__esModule",{value:!0})});