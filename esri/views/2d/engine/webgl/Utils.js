// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.22/esri/copyright.txt for details.
//>>built
define("exports ../../../../core/Error ../../../../core/Logger ../../../../core/mathUtils ../../../../core/screenUtils ./color ./enums ./SymbolProperties ../../../webgl/Texture".split(" "),function(b,q,r,v,w,x,f,P,Q){function m(a){const c={};for(const d of a)c[d.name]=d.strideInBytes;return c}function y(a){switch(a){case f.WGLGeometryType.MARKER:return R;case f.WGLGeometryType.FILL:return S;case f.WGLGeometryType.LINE:return T;case f.WGLGeometryType.TEXT:return U;case f.WGLGeometryType.LABEL:return V}}
function z(a){switch(a%4){case 0:case 2:return 4;case 1:case 3:return 1}}function A(a){switch(a){case 5120:case 5121:return 1;case 5122:case 5123:return 2;case 5126:case 5124:case 5125:return 4}}function W(a){const c={};for(const d in a){let e=0;c[d]=a[d].map(g=>{const h={...g,normalized:g.normalized||!1,divisor:g.divisor||0,offset:e,stride:0};e+=g.count*A(g.type);return h});c[d].forEach(g=>g.stride=e)}return c}const p=r.getLogger("esri.views.2d.engine.webgl.Utils");r=[{name:"geometry",strideInBytes:36,
divisor:0}];const B=[{name:"geometry",strideInBytes:32,divisor:0}],C=[{name:"geometry",strideInBytes:20,divisor:0}],D=[{name:"geometry",strideInBytes:12,divisor:0}],E=[{name:"geometry",strideInBytes:40,divisor:0}],F=[{name:"geometry",strideInBytes:36,divisor:0}],G=[{name:"geometry",strideInBytes:36,divisor:0}],H=m(r),I=m(B),J=m(C),K=m(D),L=m(E),M=m(F),N=m(G),R=["geometry"],S=["geometry"],T=["geometry"],U=["geometry"],V=["geometry"],t=new Map,O=a=>{if(!a)return!1;a=a.trim();return/^[mzlhvcsqta]\s*[-+.0-9][^mlhvzcsqta]+/i.test(a)&&
/[\dz]$/i.test(a)&&4<a.length?!0:!1};b.C_FILL_STRIDE_SPEC=I;b.C_FILL_STRIDE_SPEC_DD=K;b.C_FILL_STRIDE_SPEC_SIMPLE=J;b.C_FILL_VERTEX_DEF=B;b.C_FILL_VERTEX_DEF_DD=D;b.C_FILL_VERTEX_DEF_SIMPLE=C;b.C_ICON_STRIDE_SPEC=H;b.C_ICON_VERTEX_DEF=r;b.C_LABEL_STRIDE_SPEC=N;b.C_LABEL_VERTEX_DEF=G;b.C_LINE_STRIDE_SPEC=L;b.C_LINE_VERTEX_DEF=E;b.C_TEXT_STRIDE_SPEC=M;b.C_TEXT_VERTEX_DEF=F;b.C_VBO_GEOMETRY="geometry";b.C_VBO_INFO={["geometry"]:35044};b.C_VBO_PERINSTANCE="per_instance";b.C_VBO_PERINSTANCE_VV="per_instance_vv";
b.allocateTypedArrayBuffer=function(a,c){switch(c%4){case 0:case 2:return new Uint32Array(Math.floor(a*c/4));case 1:case 3:return new Uint8Array(a*c)}};b.allocateTypedArrayBufferwithData=function(a,c){switch(c%4){case 0:case 2:return new Uint32Array(a);case 1:case 3:return new Uint8Array(a)}};b.charCodes=function(a){const c=[];for(let d=0;d<a.length;d++)c.push(a.charCodeAt(d));return c};b.copyMeshData=function(a,c,d,e,g,h,k){for(const u in h){var n=h[u].stride,l=z(n);const X=h[u].data,Y=d[u].data,
Z=n*g.vertexCount/l,aa=n*a/l;n=n*g.vertexFrom/l;for(l=0;l<Z;++l)Y[l+aa]=X[l+n]}d=g.indexCount;for(h=0;h<d;++h)e[h+c]=k[h+g.indexFrom]-g.vertexFrom+a};b.createGeometryData=function(a,c){const d=[];for(let e=0;5>e;++e){const g=y(e),h={};for(const k of g)h[k]={data:c(e,k)};d.push({data:a(e),buffers:h})}return d};b.createProgramDescriptor=(a,c)=>{if(!t.has(a)){const g=W(c);var d=g;var e={};for(const h in d){const k=d[h];e[h]=k.length?k[0].stride:0}d=e;e=new Map;for(const h in c)for(const k of c[h])e.set(k.name,
k.location);c=e;t.set(a,{strides:d,bufferLayouts:g,attributes:c})}return t.get(a)};b.createTextureFromTexelData=function(a,c){let d,e;v.isPowerOfTwo(c.width)&&v.isPowerOfTwo(c.height)?(d=!0,e=9987):(d=!1,e=9729);return new Q(a,{target:3553,pixelFormat:6408,internalFormat:6408,dataType:5121,hasMipmap:d,samplingMode:e,wrapMode:33071,flipped:!0},c)};b.forEachGeometryType=function(a){a(f.WGLGeometryType.FILL);a(f.WGLGeometryType.LINE);a(f.WGLGeometryType.MARKER);a(f.WGLGeometryType.TEXT);a(f.WGLGeometryType.LABEL)};
b.geometryToMappedGeometry=function(a){return{vertexFrom:void 0,vertexTo:void 0,geometry:a}};b.getBytes=A;b.getCapType=function(a){switch(a){case "butt":return 0;case "round":return 1;case "square":return 2;default:return p.error(new q("mapview-invalid-type",`Cap type ${a} is not a valid option. Defaulting to round`)),1}};b.getJoinType=function(a){switch(a){case "miter":return 2;case "bevel":return 0;case "round":return 1;default:return p.error(new q("mapview-invalid-type",`Join type ${a} is not a valid option. Defaulting to round`)),
1}};b.getNamedBuffers=y;b.getPMSResourceSize=function(a){const c="maxVVSize"in a&&a.maxVVSize;a="width"in a&&a.width||"size"in a&&a.size||0;return c?c:a};b.getPixelArrayCtor=function(a){switch(a){case 5121:return Uint8Array;case 32819:return Uint16Array;case 5126:return Float32Array;default:p.error(new q("webgl-utils",`Unable to handle type ${a}`))}};b.getPixelBytes=function(a){switch(a){case 5121:return 1;case 32819:return 2;case 5126:return 4;default:p.error(new q("webgl-utils",`Unable to handle type ${a}`))}};
b.getStrides=function(a,{fill:c}){switch(a){case f.WGLGeometryType.MARKER:return H;case f.WGLGeometryType.FILL:return"dot-density"===c?K:"simple"===c?J:I;case f.WGLGeometryType.LINE:return L;case f.WGLGeometryType.TEXT:return M;case f.WGLGeometryType.LABEL:return N}};b.getTextProperties=function(a){return P.TextProperties.pool.acquire(a.color?x.copyAndPremultiply(a.color):[255,255,255,255],a.haloColor?x.copyAndPremultiply(a.haloColor):[255,255,255,255],w.pt2px(a.haloSize),w.pt2px(a.font.size),a.angle*
Math.PI/180,a.xoffset/a.font.size,a.yoffset/a.font.size,"left"===a.horizontalAlignment?0:"right"===a.horizontalAlignment?1:.5,"top"===a.verticalAlignment?0:"bottom"===a.verticalAlignment?1:.5)};b.getTransformParams=function(a){const {transform:c,hasZ:d,hasM:e}=a;return{transform:c,hasZ:d,hasM:e}};b.getUrl=a=>"imageData"in a&&a.imageData&&"contentType"in a&&a.contentType?`data:${a.contentType};base64,${a.imageData}`:"url"in a?a.url:null;b.getVVType=function(a){switch(a){case "opacity":return f.VVType.OPACITY;
case "color":return f.VVType.COLOR;case "rotation":return f.VVType.ROTATION;case "size":return f.VVType.SIZE;default:return p.error(`Cannot interpret unknown vv: ${a}`),null}};b.is3D=a=>a.type&&-1!==a.type.toLowerCase().indexOf("3d");b.isDefined=function(a){return null!=a};b.isGIF=a=>"url"in a&&a.url&&a.url.includes(".gif")||"contentType"in a&&"image/gif"===a.contentType||"imageData"in a&&a.imageData.includes("data:image/gif");b.isImageResource=a=>"url"in a&&a.url||"imageData"in a&&a.imageData;b.isNumber=
function(a){return"number"===typeof a};b.isPNG=a=>"url"in a&&a.url&&a.url.includes(".png")||"contentType"in a&&"image/png"===a.contentType||"imageData"in a&&a.imageData.includes("data:image/png");b.isSVGImage=a=>a.includes("data:image/svg+xml");b.isSVGResource=a=>"path"in a&&O(a.path);b.isSimple=function(a){switch(a.type){case "line":return"CIMSolidStroke"===a.cim.type&&!a.dashTemplate;case "fill":return"CIMSolidFill"===a.cim.type;case "esriSFS":return"esriSFSSolid"===a.style||"esriSFSNull"===a.style;
case "esriSLS":return"esriSLSSolid"===a.style||"esriSLSNull"===a.style;default:return!1}};b.isValidSVG=O;b.shouldRepeat=function(a){switch("cim"in a?a.cim.type:a.type){case "esriSMS":case "esriPMS":case "CIMPointSymbol":case "CIMVectorMarker":case "CIMPictureMarker":case "CIMCharacterMarker":return!1;default:return!0}};b.strideToPackingFactor=z;Object.defineProperty(b,"__esModule",{value:!0})});