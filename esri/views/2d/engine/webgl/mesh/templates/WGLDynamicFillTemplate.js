// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.22/esri/copyright.txt for details.
//>>built
define("../../../../../../chunks/_rollupPluginBabelHelpers ../../../../../../core/screenUtils ../../color ../../definitions ../../GeometryUtils ../../number ../../materialKey/MaterialKey ./util ./WGLBaseFillTemplate ./WGLDynamicMeshTemplate ../../util/Result".split(" "),function(A,p,x,w,y,r,B,g,C,D,E){return function(z){function t(a,h,q){var m;var c=z.call(this,a)||this;c._minMaxZoom=r.i1616to32(Math.round(h*w.MIN_MAX_ZOOM_PRECISION_FACTOR),Math.round(q*w.MIN_MAX_ZOOM_PRECISION_FACTOR));g.isFunction(a.color)?
c._dynamicPropertyMap.set("fillColor",(b,d,e)=>(b=a.color(b,d,e))&&x.premultiplyAlphaRGBA(b)||0):(h=a.color,c.fillColor=h&&x.premultiplyAlphaRGBA(h)||0);let f=0;g.isFunction(a.height)||(f=a.height||0);const n="CIMMarkerPlacementInsidePolygon"===(null==(m=a.cim.placement)?void 0:m.type)&&a.cim.placement.shiftOddRows?2:1;c._dynamicPropertyMap.set("_height",(b,d,e)=>g.isFunction(a.height)?a.height(b,d,e)*n:f*n);let k=0;g.isFunction(a.offsetX)||(k=p.pt2px(a.offsetX||0)+128,255<k&&(k=255));c._dynamicPropertyMap.set("_offsetX",
(b,d,e)=>g.isFunction(a.offsetX)?(b=p.pt2px(a.offsetX(b,d,e))+128,255<b&&(b=255),b):k);let u=1;g.isFunction(a.scaleX)||(u=a.scaleX||1);c._dynamicPropertyMap.set("_scaleX",(b,d,e)=>g.isFunction(a.scaleX)?a.scaleX(b,d,e):u);let l=0;g.isFunction(a.offsetY)||(l=p.pt2px(-a.offsetY||0)+128,255<l&&(l=255));c._dynamicPropertyMap.set("_offsetY",(b,d,e)=>g.isFunction(a.offsetY)?(b=p.pt2px(-a.offsetY(b,d,e))+128,255<b&&(b=255),b):l);let v=0;g.isFunction(a.angle)||(v=y.radToByte(a.angle)||0);c._dynamicPropertyMap.set("_angle",
(b,d,e)=>g.isFunction(a.angle)?y.radToByte(a.angle(b,d,e)):v);c._effects=a.effects;c._cimFillLayer=a;c._fillMaterialKey=B.FillMaterialKey.load(a.materialKey);return c}A._inheritsLoose(t,z);t.fromCIMFill=function(a,h){const [q,m]=g.getMinMaxZoom(a.scaleInfo,h);return new t(a,q,m)};t.prototype.bindFeature=function(a,h,q){const m=a.readLegacyFeature();this._dynamicPropertyMap.forEach((n,k)=>{this[k]=n(m,h,q)});a=this._fillMaterialKey;var c=this._materialCache,f=this._cimFillLayer.materialHash;f=f(m,
h,q);f=c.get(f);c=null;f&&E.ok(f.spriteMosaicItem)&&(c=f.spriteMosaicItem);if(c){const {rect:n,width:k,height:u}=c;f=n.x+w.SPRITE_PADDING;const l=n.y+w.SPRITE_PADDING,v=f+k,b=l+u;let d=Math.round(p.pt2px(this._height));255<d?d=255:0>=d&&(d=b-l);let e=Math.round(p.pt2px(this._height/u*k||0));255<e?e=255:0>=e&&(e=v-f);const F=this._scaleX;this.tl=r.i1616to32(f,l);this.br=r.i1616to32(v,b);this.aux2=r.i8888to32(e,d,this._offsetX,this._offsetY);this.aux3=r.i8888to32(F,1,this._angle,0);a.sdf=c.sdf;a.pattern=
!0;a.textureBinding=c.textureBinding}else this.aux3=this.aux2=this.br=this.tl=0,a.sdf=!1,a.pattern=!1,a.textureBinding=0;this._materialKey=a.data};return t}(C(D))});