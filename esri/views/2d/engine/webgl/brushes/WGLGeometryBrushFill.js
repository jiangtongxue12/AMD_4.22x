// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.22/esri/copyright.txt for details.
//>>built
define("../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/RandomLCG ../../../../webgl/BufferObject ../../../../webgl/FramebufferObject ../../../../../core/has ../../../../webgl/checkWebGLError ../../../../webgl/enums ../../../../../chunks/builtins ../../../../webgl/Texture ../../../../webgl/VertexArrayObject ../definitions ../enums ../Utils ./WGLGeometryBrush ../materialKey/MaterialKey".split(" "),function(t,u,C,D,E,F,G,H,v,I,l,w,x,y,z){return function(n){function m(){var b=n.apply(this,
arguments)||this;b._dotTextureSize=0;b._dotTextures=null;b._dotSamplers=new Int32Array([l.TEXTURE_BINDING_RENDERER_0,l.TEXTURE_BINDING_RENDERER_1]);return b}t._inheritsLoose(m,n);var k=m.prototype;k.dispose=function(){this._disposeTextures()};k.getGeometryType=function(){return w.WGLGeometryType.FILL};k.drawGeometry=function(b,a,d,c){const {context:h,painter:p,rendererInfo:g,requiredLevel:q}=b;var e=z.FillMaterialKey.load(d.materialKey);var f={geometry:[{location:0,name:"a_pos",count:2,type:5122},
{location:1,name:"a_id",count:3,type:5121},{location:2,name:"a_bitset",count:1,type:5121}]};e.dotDensity?f.geometry.push({location:3,name:"a_inverseArea",count:1,type:5126}):(f.geometry.push({location:3,name:"a_color",count:4,type:5121,normalized:!0}),e.simple||f.geometry.push({location:4,name:"a_aux1",count:4,type:5123}),f.geometry.push({location:5,name:"a_aux2",count:4,type:5121},{location:6,name:"a_aux3",count:4,type:5121}),e.simple||f.geometry.push({location:7,name:"a_zoomRange",count:2,type:5123}));
f=x.createProgramDescriptor(e.data,f);const {bufferLayouts:A,attributes:r}=f;c=p.materialManager.getMaterialProgram(b,e,"materials/fill",r,c);h.useProgram(c);this._setSharedUniforms(c,b,a);c.setUniform2f("u_tileOffset",512*a.key.col,512*a.key.row);e.textureBinding&&(p.textureManager.bindTextures(h,c,e),c.setUniform1f("u_zoomFactor",1/2**(q-a.key.level)/b.pixelRatio));f=1/b.pixelRatio;c.setUniform1f("u_blur",f);c.setUniform1f("u_antialiasing",f);this._setSizeVVUniforms(e,c,g,a);this._setColorAndOpacityVVUniforms(e,
c,g);if(e.dotDensity){e=l.TILE_SIZE/g.ddDotSize;f=e*window.devicePixelRatio*e*window.devicePixelRatio;a=1/2**(q-a.key.level);const B=1/a*(1/a);b=g.ddDotScale?b.state.scale/g.ddDotScale:1;c.setUniform1f("u_tileZoomFactor",a);c.setUniform1f("u_tileDotsOverArea",f/(l.TILE_SIZE*window.devicePixelRatio*l.TILE_SIZE*window.devicePixelRatio));c.setUniformMatrix4fv("u_dotColors",g.ddColors);c.setUniform4fv("u_isActive",g.ddActiveDots);c.setUniform4fv("u_dotBackgroundColor",g.ddBackgroundColor);c.setUniform1f("u_dotValue",
Math.max(1,g.ddDotValue*b*B));this._bindDotDensityTextures(h,c,g,e)}d.draw(h,A,r)};k._disposeTextures=function(){if(this._dotTextures){for(let b=0;b<this._dotTextures.length;b++)this._dotTextures[b].dispose();this._dotTextures=null}};k._bindDotDensityTextures=function(b,a,d,c){d=this._createDotDensityTextures(b,c,d.ddSeed);a.setUniform1iv("u_dotTextures",this._dotSamplers);for(a=0;a<d.length;a++)b.bindTexture(d[a],this._dotSamplers[a])};k._createDotDensityTextures=function(b,a,d){if(this._dotTextureSize!==
a||this._seed!==d)this._disposeTextures(),this._dotTextureSize=a,this._seed=d;null===this._dotTextures&&(d=new u(d),this._dotTextures=[this._allocDotDensityTexture(b,a,d),this._allocDotDensityTexture(b,a,d)]);return this._dotTextures};k._allocDotDensityTexture=function(b,a,d){const c=new Float32Array(a*a*4);for(let h=0;h<c.length;h++)c[h]=d.getFloat();return new v(b,{wrapMode:10497,pixelFormat:6408,dataType:5126,samplingMode:9728,width:a,height:a},c)};return m}(y)});