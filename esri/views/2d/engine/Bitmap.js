// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.22/esri/copyright.txt for details.
//>>built
define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/maybe ../../../chunks/mat3 ../../../chunks/mat3f32 ../../../chunks/vec2f32 ./DisplayObject ./ImageryBitmapSource ../../webgl/Texture".split(" "),function(k,m,v,g,w,l,n,x,y){function r(e){return e&&"render"in e}function t(e){const f=document.createElement("canvas");f.width=e.width;f.height=e.height;e.render(f.getContext("2d"));return f}function u(e,f,d){const a={target:3553,pixelFormat:6408,internalFormat:6408,dataType:5121,wrapMode:33071};
f&&d&&(a.width=f,a.height=d);return new y(e,a)}n=function(e){function f(a=null,c,p=!0){var b=e.call(this)||this;b.requestRenderOnSourceChangedEnabled=p;b._textureInvalidated=!0;b.stencilRef=0;b.coordScale=[1,1];b._height=void 0;b.pixelRatio=1;b.resolution=0;b.rotation=0;b._source=null;b._width=void 0;b.x=0;b.y=0;b.blendFunction=c;b.source=a;b.requestRender=b.requestRender.bind(m._assertThisInitialized(b));return b}m._inheritsLoose(f,e);var d=f.prototype;d.destroy=function(){this._texture&&(this._texture.dispose(),
this._texture=null)};d.beforeRender=function(a){e.prototype.beforeRender.call(this,a);this.updateTexture(a.context)};d.invalidateTexture=function(){this._textureInvalidated||(this._textureInvalidated=!0,this.requestRenderOnSourceChangedEnabled&&this.requestRender())};d._createTransforms=function(){return{dvs:w.create()}};d.setTransform=function(a){const c=g.identity(this.transforms.dvs),[p,b]=a.toScreenNoRotation([0,0],[this.x,this.y]);var h=this.resolution/this.pixelRatio/a.resolution;const q=h*
this.width;h*=this.height;const z=Math.PI*this.rotation/180;g.translate(c,c,l.fromValues(p,b));g.translate(c,c,l.fromValues(q/2,h/2));g.rotate(c,c,-z);g.translate(c,c,l.fromValues(-q/2,-h/2));g.scaleByVec2(c,c,l.fromValues(q,h));g.multiply(this.transforms.dvs,a.displayViewMat3,c)};d.setSamplingProfile=function(a){this._texture&&(a.mips&&!this._texture.descriptor.hasMipmap&&this._texture.generateMipmap(),this._texture.setSamplingMode(a.samplingMode))};d.bind=function(a,c){this._texture&&a.bindTexture(this._texture,
c)};d.updateTexture=function(a){if(this.stage)this._textureInvalidated&&(this._textureInvalidated=!1,this._texture||(this._texture=this.source?u(a,this.sourceWidth,this.sourceHeight):u(a)),(a=this.source)?(this._texture.resize(this.sourceWidth,this.sourceHeight),r(a)?a instanceof x?(a=a.getRenderedRasterPixels(),this._texture.setData(v.isSome(a)?a.renderedRasterPixels:null)):this._texture.setData(t(a)):!a||"render"in a||this._texture.setData(a),this.ready()):this._texture.setData(null));else{var c;
null==(c=this._texture)?void 0:c.dispose();this._texture=null}};d.onAttach=function(){this.invalidateTexture()};d.onDetach=function(){this.invalidateTexture()};m._createClass(f,[{key:"isSourceScaled",get:function(){return this.width!==this.sourceWidth||this.height!==this.sourceHeight}},{key:"height",get:function(){return void 0!==this._height?this._height:this.sourceHeight},set:function(a){this._height=a}},{key:"source",get:function(){return this._source},set:function(a){this._source=a;this.invalidateTexture()}},
{key:"sourceHeight",get:function(){return this._source instanceof HTMLImageElement?this._source.naturalHeight:this._source.height}},{key:"sourceWidth",get:function(){return this._source instanceof HTMLImageElement?this._source.naturalWidth:this._source.width}},{key:"width",get:function(){return void 0!==this._width?this._width:this.sourceWidth},set:function(a){this._width=a}}]);return f}(n.DisplayObject);k.Bitmap=n;k.isImageSource=r;k.rasterize=t;Object.defineProperty(k,"__esModule",{value:!0})});