// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.22/esri/copyright.txt for details.
//>>built
define("../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/lang ../../../../../core/urlUtils ../../../../../geometry/Extent ../../../../../layers/support/serviceTileInfoProperty ../../../../../layers/support/TilemapCache ../TilemapIndex ../TilemapRequest".split(" "),function(l,m,g,n,p,q,r,t){return function(){function k(b,a,c){this.fullExtent=this.capabilities=this.tileInfo=this.tilemap=null;this.name=b;this.sourceUrl=a;b=g.urlToObject(this.sourceUrl);a=m.clone(c);var d=a.tiles;if(b)for(var e=
0;e<d.length;e++){var f=g.urlToObject(d[e]);f&&(g.isAbsolute(f.path)||(f.path=g.join(b.path,f.path)),d[e]=g.addQueryParameters(f.path,{...b.query,...f.query}))}this.tileServers=d;e=c.capabilities&&c.capabilities.split(",").map(u=>u.toLowerCase().trim());d=!0===(null==c?void 0:c.exportTilesAllowed);e=!0===(null==e?void 0:e.includes("tilemap"));f=d&&c.hasOwnProperty("maxExportTilesCount")?c.maxExportTilesCount:0;this.capabilities={operations:{supportsExportTiles:d,supportsTileMap:e},exportTiles:d?{maxExportTilesCount:+f}:
null};this.tileInfo=p.readServiceTileInfo(a.tileInfo,a,null,{ignoreMinMaxLOD:!0});a=c.tileMap?g.addQueryParameters(g.join(b.path,c.tileMap),b.query):null;e?(this.type="vector-tile",this.tilemap=new t(new q.TilemapCache({layer:{parsedUrl:b,tileInfo:this.tileInfo,type:"vector-tile",tileServers:this.tileServers}}),a)):a&&(this.tilemap=new r(a));this.fullExtent=n.fromJSON(c.fullExtent)}var h=k.prototype;h.getRefKey=function(){var b=l._asyncToGenerator(function*(a,c){var d,e;return null!=(d=null==(e=this.tilemap)?
void 0:e.dataKey(a,c))?d:a});return function(a,c){return b.apply(this,arguments)}}();h.getSourceTileUrl=function(b,a,c){return this.tileServers[a%this.tileServers.length].replace(/\{z\}/gi,b.toString()).replace(/\{y\}/gi,a.toString()).replace(/\{x\}/gi,c.toString())};h.isCompatibleWith=function(b){var a=this.tileInfo;b=b.tileInfo;if(!a.spatialReference.equals(b.spatialReference)||!a.origin.equals(b.origin)||Math.round(a.dpi)!==Math.round(b.dpi))return!1;a=a.lods;b=b.lods;const c=Math.min(a.length,
b.length);for(let d=0;d<c;d++){const e=a[d],f=b[d];if(e.level!==f.level||Math.round(e.scale)!==Math.round(f.scale))return!1}return!0};return k}()});