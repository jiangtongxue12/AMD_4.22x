// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.22/esri/copyright.txt for details.
//>>built
define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/maybe","../../support/Scheduler"],function(f,k,g,h){let l=function(){function e(a,b){this._stage=a;this._textureRequests=new Map;this._frameTask=g.isSome(b)?b.registerTask(h.TaskPriority.TEXTURE_UNLOAD):h.ImmediateTask}var c=e.prototype;c.destroy=function(){this._frameTask.remove();this._textureRequests.forEach(a=>this._releaseTextureRequest(a));this._textureRequests.clear()};c.fromData=function(a,b){const d=this.makeUid(a);
a=this._textureRequests.get(d);a||(a={referenceCount:0,texture:b(),textureAsync:null,abortController:null},this._stage&&(this._stage.add(a.texture),this._stage.loadSynchronous(a.texture)),this._textureRequests.set(d,a));a.referenceCount++;return{uid:d,texture:a.texture,release:()=>this._release(d)}};c._release=function(a){if(this._textureRequests){var b=this._textureRequests.get(a);b?(1>b.referenceCount&&console.warn("TextureCollection: reference count is \x3c 1 for "+a),b.referenceCount--,1>b.referenceCount&&
this._frameTask.schedule(()=>this._releaseNow(a))):console.warn(`TextureCollection: texture doesn't exist: '${a}'`)}};c._releaseNow=function(a){if(this._textureRequests){var b=this._textureRequests.get(a);!b||0<b.referenceCount||(this._releaseTextureRequest(b),this._textureRequests.delete(a))}};c._releaseTextureRequest=function(a){if(a.texture){var b;null==(b=this._stage)?void 0:b.remove(a.texture)}else a.abortController&&(a.abortController.abort(),a.abortController=null)};c.makeUid=function(a,b=
null){return g.isSome(b)?`${a}.${b}px`:a};k._createClass(e,[{key:"test",get:function(){return{textureRequests:this._textureRequests}}}]);return e}();f.TextureCollection=l;Object.defineProperty(f,"__esModule",{value:!0})});