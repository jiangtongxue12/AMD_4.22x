// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.22/esri/copyright.txt for details.
//>>built
define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Evented ../../../core/maybe ../../../core/promiseUtils ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../layers/graphics/ElevationQuery".split(" "),function(l,t,r,w,x,n,u,v,B,C,D,y,z){function p(k,f,h,a,b,d,g){for(const e of f)f=e.getElevation(h,
a,b,d,g),n.isSome(f)&&(k=n.isSome(k)?Math.max(f,k):f);return k}l.CombinedElevationProvider=function(k){function f(a){a=k.call(this,a)||this;a.im=[];a.ground=[];a.scene=[];a.handles=new Map;a.lastElevationQuery=null;a.elevationCacheEnabled=!1;return a}t._inheritsLoose(f,k);var h=f.prototype;h.destroy=function(){this._elevationQuery=n.destroyMaybe(this._elevationQuery)};h.enableElevationCache=function(a){a||(this.lastElevationQuery=null);this.elevationCacheEnabled=a};h.getElevation=function(a,b,d,g,
e){if(this.elevationCacheEnabled&&null!=this.lastElevationQuery){var c=this.lastElevationQuery;if(a===c.x&&b===c.y&&d===c.z&&g.equals(c.spatialReference)&&e===c.queryContext)return c.result}c=p(null,this.im,a,b,d,g,e);n.isNone(c)&&(c=p(c,this.ground,a,b,d,g,e));"scene"===e&&(c=p(c,this.scene,a,b,d,g,e));this.elevationCacheEnabled&&(this.lastElevationQuery={x:a,y:b,z:d,spatialReference:g,queryContext:e,result:c});return c};h.queryElevation=function(a,b,d,g,e,c=null,A=0){const q=u.createResolver();
this.elevationQuery.queryElevation(a,b,c,A).then(m=>{"scene"===e&&(m=p(m,this.scene,a,b,d,g,e));q.resolve(m)}).catch(m=>{u.isAbortError(m)?q.reject(m):q.resolve(this.getElevation(a,b,d,g,e))});return q.promise};h.register=function(a,b){this.handles.set(b,b.on("elevation-change",d=>this.emit("elevation-change",d)));this[a].push(b)};h.unregister=function(a){this.handles.has(a)&&(this.handles.get(a).remove(),this.handles.delete(a));for(const b of[this.im,this.ground,this.scene]){const d=b.indexOf(a);
-1<d&&b.splice(d,1)}};t._createClass(f,[{key:"elevationQuery",get:function(){n.isNone(this._elevationQuery)&&(this._elevationQuery=new z.ElevationQuery(this.view.resourceController.scheduler,this.view.spatialReference,()=>this.view.map&&this.view.map.ground,{maximumAutoTileRequests:4}));return this._elevationQuery}}]);return f}(x.EventedMixin(w));r.__decorate([v.property({constructOnly:!0})],l.CombinedElevationProvider.prototype,"view",void 0);r.__decorate([v.property({readOnly:!0,aliasOf:"view.basemapTerrain.spatialReference"})],
l.CombinedElevationProvider.prototype,"spatialReference",void 0);l.CombinedElevationProvider=r.__decorate([y.subclass("esri.views.3d.support.CombinedElevationProvider")],l.CombinedElevationProvider);Object.defineProperty(l,"__esModule",{value:!0})});