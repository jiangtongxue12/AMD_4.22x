// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.22/esri/copyright.txt for details.
//>>built
define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/Logger ../../../core/maybe ../../../core/promiseUtils ../../../chunks/mat4 ../../../chunks/mat4f64 ../../../support/requestImageUtils ./SimpleAtmosphereTechnique ./resources/SimpleAtmosphereTexture ../support/buffer/glUtil ../support/buffer/InterleavedLayout ../webgl-engine/core/shaderLibrary/util/View.glsl ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/GeometryUtil ../../webgl/BufferObject ../../webgl/Texture ../../webgl/Util ../../webgl/VertexArrayObject".split(" "),
function(n,u,h,k,p,v,w,x,q,y,z,A,B,C,D,E,F,G,H){const I=h.getLogger("esri.views.3d.environment.PanoramicAtmosphere");h=function(){function l(){this.type="panoramic";this._atmosphereTechniqueConfig=new q.SimpleAtmosphereTechniqueConfiguration;this._readyResolver=p.createResolver();this._readyController=new AbortController}var e=l.prototype;e.destroy=function(){this._readyResolver.reject();this._texture=k.disposeMaybe(this._texture);this._vao=k.disposeMaybe(this._vao);this._readyController=k.abortMaybe(this._readyController)};
e.when=function(){return this._readyResolver.promise};e.initializeRenderContext=function(d){this._atmosphereTechniqueConfig.geometry=1;this._atmosphereTechnique=d.shaderTechniqueRep.acquire(q.SimpleAtmosphereTechnique,this._atmosphereTechniqueConfig);const c=d.renderContext.rctx;this._vao=this._createVertexArrayObject(c);this._vaoCount=G.vertexCount(this._vao,"geometry");x.requestImage(y,{signal:this._readyController.signal}).then(a=>{this._texture=new F(c,{pixelFormat:6408,dataType:5121,wrapMode:33071,
samplingMode:9729,flipped:!0},a);d.requestRender();this._readyController=null;this._readyResolver.resolve()}).catch(a=>{p.isAbortError(a)||I.error("Unable to initialize atmosphere: image request failed",a);this._readyResolver.reject()})};e.render=function(d){const c=d.rctx,a=this._atmosphereTechnique.program;c.useProgram(a);this._atmosphereTechnique.bindPipelineState(c);a.bindTexture(this._texture,"tex");B.bindProjectionMatrix(a,d.camera.projectionMatrix);var b=r;v.copy(b,d.camera.viewMatrix);b[12]=
0;b[13]=0;b[14]=0;b[15]=1;a.setUniformMatrix4fv("view",r);a.setUniform4f("color",1,1,1,1);d.scenelightingData.setLightDirectionUniform(a);c.bindVAO(this._vao);a.assertCompatibleVertexAttributeLocations(this._vao);c.drawArrays(4,0,this._vaoCount);return!0};e.renderHaze=function(){return!1};e._createVertexArrayObject=function(d){var c=D.createPolySphereGeometry(1,2,!1);const a=c.indices.get("position");for(var b=0;b<a.length;b+=3){var g=a[b];a[b]=a[b+2];a[b+2]=g}c=c.vertexAttributes.get("position").data;
b=t.createBuffer(a.length);g=b.position;for(let f=0;f<a.length;++f){const m=3*a[f];g.set(f,0,c[m]);g.set(f,1,c[m+1]);g.set(f,2,c[m+2])}return new H(d,C.Default3D,{geometry:z.glLayout(t)},{geometry:E.createVertex(d,35044,b.buffer)})};u._createClass(l,[{key:"canRender",get:function(){return null!=this._texture}}]);return l}();const r=w.create(),t=A.newLayout().vec3f("position");n.PanoramicAtmosphere=h;Object.defineProperty(n,"__esModule",{value:!0})});