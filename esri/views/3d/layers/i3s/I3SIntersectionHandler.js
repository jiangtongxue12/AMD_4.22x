// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.22/esri/copyright.txt for details.
//>>built
define(["exports","../../../../core/maybe","../../support/orientedBoundingBox","../../webgl-engine/lib/Intersector","../../webgl-engine/lib/verticalOffsetUtils"],function(u,m,v,y,z){function A(d,a,e,f=0){f=d[3]+f;const g=a[0]-d[0],c=a[1]-d[1];d=a[2]-d[2];a=e[0];const l=e[1];e=e[2];const h=a*g+l*c+e*d;return 0<=h*h-(a*a+l*l+e*e)*(g*g+c*c+d*d-f*f)}let E=function(){function d(a){this.type=4;this.layerUid=a.layerUid;this.sublayerUid=a.sublayerUid;this.collection=a.collection;this.traverseNodeHierarchy=
a.traverseNodeHierarchy;this.slicePlaneEnabled=a.slicePlaneEnabled;this.isGround=a.isGround}d.prototype.intersect=function(a,e,f,g){const c=a.results,l=2===a.options.store,h=a.ray.direction,n=a.tolerance;let w=b=>b,t=b=>b;const p=z.getVerticalOffsetI3S(a.verticalOffset);m.isSome(p)&&(w=b=>p.applyToMbs(b),t=b=>p.applyToObb(b));this.traverseNodeHierarchy((b,x)=>{if(m.isSome(b.serviceObbInRenderSR)&&!v.intersectLine(t(b.serviceObbInRenderSR),f,h,n))return!1;!x||m.isSome(b.geometryObb)&&!v.intersectLine(t(b.geometryObb),
f,h,n)||!m.isSome(b.serviceObbInRenderSR)&&!A(w(b.renderMbs),f,h,n)||this.collection.intersect(x,f,g,n,p,(B,k,C,D)=>{if(0<=k&&(null==e||e(f,g,k))){var r=q=>{q.set(this.type,{layerUid:this.layerUid,sublayerUid:this.sublayerUid,nodeIndex:b.index,componentIndex:B,triangleNr:D},k,C)};this.isGround&&(null==c.ground.dist||k<c.ground.dist)&&r(c.ground);if(!a.options.isFiltered&&((null==c.min.dist||k<c.min.dist)&&r(c.min),(null==c.max.dist||k>c.max.dist)&&r(c.max),l)){const q=y.newIntersectorResult(a.ray);
r(q);a.results.all.push(q)}}});return!0})};return d}();u.I3SIntersectionHandler=E;Object.defineProperty(u,"__esModule",{value:!0})});