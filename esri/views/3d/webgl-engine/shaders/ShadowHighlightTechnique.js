// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.22/esri/copyright.txt for details.
//>>built
define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4f64 ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/DefaultVertexAttributeLocations ../lib/Program ../lib/Util ../../../../chunks/ShadowHighlight.glsl ../../../webgl/renderState".split(" "),function(u,d,n,k,p,v,
w,q,x,y,z,e,A,B,C,D,l){e=function(f){function c(){return f.apply(this,arguments)||this}n._inheritsLoose(c,f);var m=c.prototype;m.initializeProgram=function(b){const a=c.shader.get().build({highlightedThreshold:.99999,selfShadowThreshold:.025});return new B.Program(b.rctx,a,A.Default3D)};m.initializePipeline=function(b){return l.makePipelineState({blending:l.separateBlendingParams(770,1,771,771),colorWrite:l.defaultColorWriteParams,depthTest:null,depthWrite:null})};m.bindPass=function(b,a){k.isNone(a.linearDepthTexture)||
(this.program.bindTexture(a.linearDepthTexture,"depthMap"),this.program.bindTexture(a.highlightColorTexture,"highlightMap"),q.transformMat4(g,a.lighting.lightingMainDirection,a.camera.viewInverseTransposeMatrix),q.normalize(g,g),C.inverseProjectionInfo(a.camera.projectionMatrix,a.camera.fullWidth,a.camera.fullHeight,r,t),p.translate(h,a.camera.viewMatrix,a.camera.center),p.invert(h,h),this.program.setUniform4fv("color",b.shadowColor),this.program.setUniform1f("opacity",b.shadowOpacity),this.program.setUniform1f("occludedOpacity",
b.occludedShadowOpacity),this.program.setUniform1f("terminationFactor",b.opacityElevation*b.dayNightTerminator),this.program.setUniform2fv("nearFar",a.camera.nearFar),this.program.setUniformMatrix4fv("inverseView",h),this.program.setUniform4fv("projInfo",r),this.program.setUniform2fv("zScale",t),this.program.setUniform3fv("lightingMainDirectionView",g),this.program.setUniform2f("texelSize",1/a.linearDepthTexture.descriptor.width,1/a.linearDepthTexture.descriptor.height),a.shadowMap.bind(this.program),
a.shadowMap.bindView(this.program,a.camera.center),b=a.shadowMap.getSnapshot(0),k.isSome(b)&&this.program.bindTexture(b,"highlightDepthTex"),b=a.shadowMap.getSnapshot(1),k.isSome(b)&&this.program.bindTexture(b,"defaultDepthTex"))};n._createClass(c,[{key:"primitiveType",get:function(){return 5}}]);return c}(e.ShaderTechnique);e.shader=new z.ReloadableShaderModule(D.ShadowHighlightShader,()=>new Promise((f,c)=>u(["./ShadowHighlight.glsl"],f,c)));const g=x.create(),t=w.create(),r=y.create(),h=v.create();
d.DefaultSnapshotSlot=1;d.HighlightShadowMapSlot=0;d.ShadowHighlightTechnique=e;Object.defineProperty(d,"__esModule",{value:!0})});