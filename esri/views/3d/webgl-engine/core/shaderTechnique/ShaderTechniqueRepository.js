// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.22/esri/copyright.txt for details.
//>>built
define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../core/maybe","../../../../../core/NestedMap"],function(m,l,g,p){let q=function(f){this.technique=f;this.refZeroFrame=this.refCount=0},v=function(){function f(a){this._context=a;this._perConstructorInstances=new p.NestedMap;this._frameCounter=0;this._keepAliveFrameCount=-1}var e=f.prototype;e.dispose=function(){this._perConstructorInstances.forEach(a=>a.forEach(c=>c.technique.dispose()));this._perConstructorInstances.clear()};
e.acquire=function(a,c){const b=c.key;let d=this._perConstructorInstances.get(a,b);if(g.isNone(d)){const h=new a(this._context,c,()=>this.release(h));d=new q(h);this._perConstructorInstances.set(a,b,d)}++d.refCount;return d.technique};e.releaseAndAcquire=function(a,c,b){if(g.isSome(b)){if(c.key===b.key)return b;b.release()}return this.acquire(a,c)};e.release=function(a){g.isNone(a)||this._perConstructorInstances.empty||(a=this._perConstructorInstances.get(a.constructor,a.key),g.isNone(a)||(--a.refCount,
0===a.refCount&&(a.refZeroFrame=this._frameCounter)))};e.frameUpdate=function(){this._frameCounter++;-1!==this._keepAliveFrameCount&&this._perConstructorInstances.forEach((a,c)=>{a.forEach((b,d)=>{0===b.refCount&&b.refZeroFrame+this._keepAliveFrameCount<this._frameCounter&&(b.technique.dispose(),this._perConstructorInstances.delete(c,d))})})};e.reloadAll=function(){var a=l._asyncToGenerator(function*(){var c=this;const b=[];this._perConstructorInstances.forEach((d,h)=>{const u=function(){var t=l._asyncToGenerator(function*(n,
k){if(k=k.shader)yield k.reload(),n.forEach(r=>{r.technique.reload(c._context)})});return function(n,k){return t.apply(this,arguments)}}();b.push(u(d,h))});yield Promise.all(b)});return function(){return a.apply(this,arguments)}}();l._createClass(f,[{key:"viewingMode",get:function(){return this._context.viewingMode}},{key:"constructionContext",get:function(){return this._context}}]);return f}();m.ShaderTechniqueRepository=v;Object.defineProperty(m,"__esModule",{value:!0})});