// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.22/esri/copyright.txt for details.
//>>built
define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/sphere ../../support/mathUtils ./ContentObject ./GeometryRecord ./Object3DStateID ./Util ../materials/renderers/utils".split(" "),function(y,t,m,v,q,k,r,z,A,w,B,C,x,u){w=function(n){function p(b={}){var a=n.call(this)||this;a.type=1;a._geometryRecords=[];a._geometries=[];a._objectTransformation=
q.create();a._bvObjectSpace=new D;a._bvWorldSpace=new D;a._bvDirty=!0;a._hasVolatileTransformation=!1;a._visible=!0;a.castShadow=null!=b.castShadow?b.castShadow:!0;a.metadata=b.metadata;a.metadata&&a.metadata.isElevationSource&&(a.metadata.lastValidElevationBB=new E);a.transformation=q.create();const {geometries:c,materials:h,transformations:e,origins:g}=b;if(!Array.isArray(c))return t._assertThisInitialized(a);x.assert(h.length===c.length,"Object3D: materials don't match geometries");x.assert(e.length===
c.length,"Object3D: transformations don't match geometries");a._geometryRecords.length=c.length;a._geometries.length=c.length;for(b=0;b<c.length;b++)a._geometries[b]=c[b],a._geometryRecords[b]=B.GeometryRecord.pool.acquire(c[b],h[b],q.clone(e[b]),{highlights:null,occludees:null,visible:a._visible},g&&g[b]);return a}t._inheritsLoose(p,n);var f=p.prototype;f.dispose=function(){this._geometryRecords.length=0;this._geometries.length=0};f.addGeometry=function(b,a,c,h,e){c=c?c:q.IDENTITY;this._geometries.push(b);
b=B.GeometryRecord.pool.acquire(b,a,c,{highlights:null,occludees:null,visible:this._visible},h,e);this._geometryRecords.push(b);this._hasVolatileTransformation=this._hasVolatileTransformation||m.isSome(b.shaderTransformation);this._emit("objectGeometryAdded",{object:this,record:b});this._invalidateBoundingVolume();return b};f.removeGeometry=function(b){const a=this._geometryRecords.splice(b,1)[0];this._hasVolatileTransformation=m.isSome(a.shaderTransformation)?this._geometryRecords.some(c=>m.isSome(c.shaderTransformation)):
this._hasVolatileTransformation;a.dispose();this._geometries.splice(b,1);this._emit("objectGeometryRemoved",{object:this,record:a});this._invalidateBoundingVolume();return a};f.removeAllGeometries=function(){for(;0<this.geometryRecords.length;)this.removeGeometry(0)};f.geometryVertexAttrsUpdated=function(b){this._emit("vertexAttrsUpdated",{object:this,record:b});this._invalidateBoundingVolume()};f.setVisible=function(b){if(this._visible!==b){this._visible=b;for(const a of this._geometryRecords)a.instanceParameters.visible=
this._visible;this._emit("visibilityChanged",this)}};f.maskOccludee=function(){const b=new C.Object3DStateID(1);for(const a of this._geometryRecords)a.instanceParameters.occludees=u.addObject3DStateID(a.instanceParameters.occludees,b);this._emit("occlusionChanged",this);return b};f.removeOcclude=function(b){for(const a of this._geometryRecords)a.instanceParameters.occludees=u.removeObject3DStateID(a.instanceParameters.occludees,b);this._emit("occlusionChanged",this)};f.highlight=function(){const b=
new C.Object3DStateID(0);for(const a of this._geometryRecords)a.instanceParameters.highlights=u.addObject3DStateID(a.instanceParameters.highlights,b);this._emit("highlightChanged",this);return b};f.removeHighlight=function(b){for(const a of this._geometryRecords)a.instanceParameters.highlights=u.removeObject3DStateID(a.instanceParameters.highlights,b);this._emit("highlightChanged",this)};f.getCombinedStaticTransformation=function(b,a){return v.multiply(m.unwrapOr(a,q.create()),this.transformation,
b.getStaticTransformation())};f.getCombinedShaderTransformation=function(b,a){a=a||q.create();v.multiply(a,this.transformation,b.getShaderTransformation());return a};f.hasVolativeTransformation=function(){return this._hasVolatileTransformation};f._validateBoundingVolume=function(){if(this._bvDirty||this._hasVolatileTransformation){this._bvObjectSpace.init();this._bvWorldSpace.init();for(var b=0;b<this._geometryRecords.length;++b){var a=this._geometryRecords[b],c=this._geometries[b].boundingInfo;m.isSome(c)&&
(this._calculateTransformedBoundingVolume(c,this._bvObjectSpace,a.getShaderTransformation()),this._calculateTransformedBoundingVolume(c,this._bvWorldSpace,this.getCombinedShaderTransformation(a)))}k.lerp(this._bvObjectSpace.bounds,this._bvObjectSpace.min,this._bvObjectSpace.max,.5);k.lerp(this._bvWorldSpace.bounds,this._bvWorldSpace.min,this._bvWorldSpace.max,.5);b=r.create();a=r.create();c=A.maxScale(this.transformation);for(let d=0;d<this._geometryRecords.length;++d){var h=this._geometries[d].boundingInfo;
if(!m.isNone(h)){var e=this._geometryRecords[d].getShaderTransformation(),g=A.maxScale(e);k.transformMat4(b,h.getCenter(),e);e=k.distance(b,this._bvObjectSpace.bounds);h=h.getBSRadius()*g;this._bvObjectSpace.bounds[3]=Math.max(this._bvObjectSpace.bounds[3],e+h);k.transformMat4(a,b,this.transformation);g=k.distance(a,this._bvWorldSpace.bounds);this._bvWorldSpace.bounds[3]=Math.max(this._bvWorldSpace.bounds[3],g+h*c)}}this._bvDirty=!1}};f._calculateTransformedBoundingVolume=function(b,a,c){const h=
b.getBBMin();b=b.getBBMax();const e=r.clone(h),g=r.clone(b);k.transformMat4(e,e,c);k.transformMat4(g,g,c);for(var d=0;3>d;++d)a.min[d]=Math.min(a.min[d],e[d],g[d]),a.max[d]=Math.max(a.max[d],e[d],g[d]);for(d=0;3>d;++d){k.copy(e,h);k.copy(g,b);e[d]=b[d];g[d]=h[d];k.transformMat4(e,e,c);k.transformMat4(g,g,c);for(let l=0;3>l;++l)a.min[l]=Math.min(a.min[l],e[l],g[l]),a.max[l]=Math.max(a.max[l],e[l],g[l])}};f._invalidateBoundingVolume=function(){this._bvDirty=!0;m.isSome(this._parentLayer)&&this._parentLayer.notifyObjectBBChanged(this,
this._bvWorldSpace.bounds)};f._emit=function(b,a){m.isSome(this._parentLayer)&&this._parentLayer.events.emit(b,a)};t._createClass(p,[{key:"geometryRecords",get:function(){return this._geometryRecords}},{key:"geometries",get:function(){return this._geometries}},{key:"transformation",get:function(){return this._objectTransformation},set:function(b){v.copy(this._objectTransformation,b);this._invalidateBoundingVolume();this._emit("objectTransformation",this)}},{key:"parentLayer",get:function(){return this._parentLayer},
set:function(b){x.assert(null==this._parentLayer||null==b,"Object3D can only be added to a single Layer");this._parentLayer=b}},{key:"isVisible",get:function(){return this._visible}},{key:"boundingVolumeWorldSpace",get:function(){this._validateBoundingVolume();return this._bvWorldSpace}},{key:"boundingVolumeObjectSpace",get:function(){this._validateBoundingVolume();return this._bvObjectSpace}},{key:"test",get:function(){const b=this;return{hasGeometry:a=>-1<b._geometries.indexOf(a),getGeometryIndex:a=>
b._geometries.indexOf(a)}}}]);return p}(w.ContentObject);let E=function(){function n(){this.min=r.fromValues(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);this.max=r.fromValues(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE)}n.prototype.isEmpty=function(){return this.max[0]<this.min[0]&&this.max[1]<this.min[1]&&this.max[2]<this.min[2]};return n}(),D=function(n){function p(){var f=n.apply(this,arguments)||this;f.bounds=z.create();return f}t._inheritsLoose(p,n);p.prototype.init=function(){k.set(this.min,
Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);k.set(this.max,-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);z.clear(this.bounds)};return p}(E);y.Object3D=w;Object.defineProperty(y,"__esModule",{value:!0})});