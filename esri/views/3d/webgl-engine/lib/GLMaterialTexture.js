// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.22/esri/copyright.txt for details.
//>>built
define(["../../../../chunks/_rollupPluginBabelHelpers","../../../../core/maybe","./GLMaterial"],function(h,c,k){return function(g){function f(a){var b=g.call(this,a)||this;b._numLoading=0;b._disposed=!1;b._textureRepository=a.textureRep;b._textureId=a.textureId;b._acquire(a.textureId).then(d=>b._texture=d);b._acquire(a.normalTextureId).then(d=>b._textureNormal=d);b._acquire(a.emissiveTextureId).then(d=>b._textureEmissive=d);b._acquire(a.occlusionTextureId).then(d=>b._textureOcclusion=d);b._acquire(a.metallicRoughnessTextureId).then(d=>
b._textureMetallicRoughness=d);return b}h._inheritsLoose(f,g);var e=f.prototype;e.dispose=function(){this._texture=c.releaseMaybe(this._texture);this._textureNormal=c.releaseMaybe(this._textureNormal);this._textureEmissive=c.releaseMaybe(this._textureEmissive);this._textureOcclusion=c.releaseMaybe(this._textureOcclusion);this._textureMetallicRoughness=c.releaseMaybe(this._textureMetallicRoughness);this._disposed=!0};e.ensureResources=function(a){return 0===this._numLoading?2:1};e.updateTexture=function(a){if(c.isNone(this._texture)||
a!==this._texture.id)this._texture=c.releaseMaybe(this._texture),this._textureId=a,this._acquire(this._textureId).then(b=>this._texture=b)};e.bindTextures=function(a){c.isSome(this._texture)&&a.bindTexture(this._texture.glTexture,"tex");c.isSome(this._textureNormal)&&a.bindTexture(this._textureNormal.glTexture,"normalTexture");c.isSome(this._textureEmissive)&&a.bindTexture(this._textureEmissive.glTexture,"texEmission");c.isSome(this._textureOcclusion)&&a.bindTexture(this._textureOcclusion.glTexture,
"texOcclusion");c.isSome(this._textureMetallicRoughness)&&a.bindTexture(this._textureMetallicRoughness.glTexture,"texMetallicRoughness")};e.bindTextureScale=function(a){const b=c.isSome(this._texture)?this._texture.glTexture:null;c.isSome(b)&&b.descriptor.textureCoordinateScaleFactor?a.setUniform2fv("textureCoordinateScaleFactor",b.descriptor.textureCoordinateScaleFactor):a.setUniform2f("textureCoordinateScaleFactor",1,1)};e._acquire=function(a){if(c.isNone(a))return Promise.resolve(null);++this._numLoading;
return this._textureRepository.acquire(a).then(b=>this._disposed?(c.releaseMaybe(b),null):b).finally(()=>--this._numLoading)};return f}(k)});