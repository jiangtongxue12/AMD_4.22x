// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.22/esri/copyright.txt for details.
//>>built
define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/maybe ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec4 ../../../../chunks/vec4f64 ./glUtil3D ../shaders/ShadowCastTechnique ../../../webgl/Util".split(" "),function(d,f,g,p,q,r,A,B,C,t,h,u,v,k,w){const x=
u.fromValues(.01,0,.25,1),l=1/512;d.ShadowCastRenderer=function(m){function e(a,n,y,z){var b=m.call(this,{})||this;b._techniqueRepository=a;b._rctx=n;b._shadowAccumulator=y;b._requestRender=z;b._visualizationParams={shadowCastMap:b._shadowCastTexture,sampleScale:0,color:x,threshold:.5,bandSize:.1,opacityFromElevation:1};b._techniqueConfig=new k.ShadowCastTechniqueConfiguration;b._enabled=!1;b._vao=v.createQuadVAO(n);b._techniqueConfig.pass=1;b._techniqueConfig.visualization=0;return b}f._inheritsLoose(e,
m);var c=e.prototype;c.normalizeCtorArgs=function(){return{}};c.dispose=function(){this._stop();this._vao=q.disposeMaybe(this._vao);this._techniqueRepository.release(this._technique);this._shadowAccumulator=this._technique=null};c.render=function(){if(this._isRenderingVisualization){this._sampleScale=1/this._computedSamples;this._rctx.bindVAO(this._vao);var a=this.visualizeShadowCastTechnique;this._rctx.useProgram(a.program);a.bindPipelineState(this._rctx);a.bindPass(this._visualizationParams);this._rctx.drawArrays(a.primitiveType,
0,w.vertexCount(this._vao,"geometry"))}};c.setOptions=function(a){void 0!==a.enabled&&this._setEnabled(a.enabled);void 0!==a.color&&this._setColor(a.color);void 0!==a.threshold&&(this._threshold=a.threshold);void 0!==a.visualization&&(this._visualization=a.visualization);void 0!==a.bandSize&&(this._bandSize=a.bandSize);void 0!==a.bandsEnabled&&(this._bandsEnabled=a.bandsEnabled)};c._setColor=function(a){h.exactEquals(a,this._visualizationParams.color)||(h.copy(this._visualizationParams.color,a),this._requestRenderIfRunning())};
c._setEnabled=function(a){a!==this._enabled&&(a?this._start():this._stop())};c._requestRenderIfRunning=function(){this._enabled&&this._requestRender()};c._start=function(){this._enabled=!0;this._requestRender()};c._stop=function(){this._enabled=!1;this._requestRender()};f._createClass(e,[{key:"visualizeShadowCastTechnique",get:function(){return this._technique=this._techniqueRepository.releaseAndAcquire(k.ShadowCastTechnique,this._techniqueConfig,this._technique)}},{key:"opacityFromElevation",get:function(){return this._visualizationParams.opacityFromElevation},
set:function(a){this._visualizationParams.opacityFromElevation!==a&&(this._visualizationParams.opacityFromElevation=a,this.notifyChange("opacityFromElevation"))}},{key:"_isRenderingVisualization",get:function(){return this._enabled&&0<this._computedSamples&&this.opacityFromElevation>l}},{key:"_computedSamples",get:function(){return this._shadowAccumulator.computedSamples}},{key:"_shadowCastTexture",get:function(){return this._shadowAccumulator.shadowCastTexture}},{key:"_sampleScale",get:function(){return this._visualizationParams.sampleScale},
set:function(a){this._visualizationParams.sampleScale=a}},{key:"_threshold",get:function(){return this._visualizationParams.threshold},set:function(a){this._threshold!==a&&(this._visualizationParams.threshold=a,this._requestRenderIfRunning())}},{key:"_visualization",get:function(){return this._techniqueConfig.visualization},set:function(a){a!==this._visualization&&(this._techniqueConfig.visualization=a,this._techniqueRepository.release(this._technique),this._technique=null,this._requestRenderIfRunning())}},
{key:"_bandSize",get:function(){return this._visualizationParams.bandSize},set:function(a){a!==this._bandSize&&(this._visualizationParams.bandSize=a,this._requestRenderIfRunning())}},{key:"_bandsEnabled",get:function(){return this._techniqueConfig.bandsEnabled},set:function(a){a!==this._bandsEnabled&&(this._techniqueConfig.bandsEnabled=a,this._techniqueRepository.release(this._technique),this._technique=null,this._requestRenderIfRunning())}}]);return e}(p);g.__decorate([r.property()],d.ShadowCastRenderer.prototype,
"opacityFromElevation",null);d.ShadowCastRenderer=g.__decorate([t.subclass("esri.views.3d.webgl-engine.lib.ShadowCastRenderer")],d.ShadowCastRenderer);d.shadowCastDisableElevationMax=5E4;d.shadowCastDisableElevationMin=4E4;d.shadowCastDisabledElevationThreshold=l;Object.defineProperty(d,"__esModule",{value:!0})});