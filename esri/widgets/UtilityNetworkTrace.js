// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.22/esri/copyright.txt for details.
//>>built
define("require ../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/HandleOwner ../core/watchUtils ../core/accessorSupport/decorators/aliasOf ../core/arrayUtils ../core/has ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/property ../core/accessorSupport/decorators/subclass ./Widget ./support/widgetUtils ./support/decorators/messageBundle ../core/Logger ./support/jsxFactory ./UtilityNetworkTrace/UtilityNetworkTraceViewModel ./UtilityNetworkTrace/support/GraphicHandler".split(" "),
function(k,u,m,l,v,p,F,G,H,q,B,C,D,x,I,d,y,E){l=function(z){function w(a,b){a=z.call(this,a,b)||this;a._tracesExists=!0;a._graphicHandler=null;a._selectToolActive=!1;a._activeTrace=null;a._activeSwatch="";a._traceHeaderForFlow="";a._assetGroupHeader="";a._assetTypeHeader="";a._traceResultsFunctions=[];a._traceResultsAssetGroup=[];a._traceResultsAssetType=[];a._traceResultsIndividual=[];a._showTraceResultFunctions=!1;a._showTraceResultAssetGroup=!1;a._showTraceResultAssetType=!1;a._showIndividualRecords=
!1;a._activeTab="input";a._flagViewType="starting-point";a._alertRemoveModal=!1;a._warningNoFlag=!1;a._warningNoTraceSelected=!1;a._warningNoStartAssetFound=!1;a._warningNoBarrierAssetFound=!1;a._confirmReset=!1;a._showResultOptions=!1;a._resultDisplayField="objectid";a._resultSortField="objectid";a._resultSortOrder="desc";a._swatchNode=null;a._individualResultNode=null;a.disabled=!0;a.flags=[];a.gdbVersion="sde.DEFAULT";a.goToOverride=null;a.iconClass="esri-icon-UtilityNetworkTrace";a.label=void 0;
a.messages=null;a.messagesCommon=null;a.selectedTraces=[];a.selectOnComplete=!0;a.showGraphicsOnComplete=!0;a.showSelectionAttributes=!0;a.view=null;a.viewModel=new y;return a}u._inheritsLoose(w,z);var g=w.prototype;g.initialize=function(){this._UtilityNetworkTraceInitialized();this._graphicHandler=new E.GraphicHandler};g.checkCanTrace=function(){var a=u._asyncToGenerator(function*(){this._confirmReset=!1;const b=this.viewModel.checkCanTrace();b.status?(this._showIndividualRecords=this._showTraceResultAssetType=
this._showTraceResultAssetGroup=this._showTraceResultFunctions=this._warningNoTraceSelected=this._warningNoTraceSelected=this._warningNoFlag=!1,this.switchTab("result"),this.viewModel._activeProgress=!0,yield this.viewModel.callTrace(),this.viewModel._activeProgress=!1):b.issues.forEach(c=>{"noStart"===c?this._warningNoFlag=!0:this._warningNoTraceSelected=!0});this.scheduleRender()});return function(){return a.apply(this,arguments)}}();g.confirmReset=function(){this._confirmReset=!0};g.render=function(){var {state:a}=
this.viewModel;a="loading"===a?this.renderLoading():this.renderUtilityNetworkTrace();return d.tsx("div",{class:this.classes("esri-utility-trace-network","esri-widget","esri-widget--panel",{["esri-widget--disabled"]:this.disabled})},a)};g.loadDependencies=function(){return Promise.all([new Promise((a,b)=>k(["../chunks/calcite-action"],a,b)),new Promise((a,b)=>k(["../chunks/calcite-action-group"],a,b)),new Promise((a,b)=>k(["../chunks/calcite-action-pad"],a,b)),new Promise((a,b)=>k(["../chunks/calcite-checkbox"],
a,b)),new Promise((a,b)=>k(["../chunks/calcite-color-picker-swatch"],a,b)),new Promise((a,b)=>k(["../chunks/calcite-combobox"],a,b)),new Promise((a,b)=>k(["../chunks/calcite-combobox-item"],a,b)),new Promise((a,b)=>k(["../chunks/calcite-block"],a,b)),new Promise((a,b)=>k(["../chunks/calcite-block-section"],a,b)),new Promise((a,b)=>k(["../chunks/calcite-button"],a,b)),new Promise((a,b)=>k(["../chunks/calcite-flow"],a,b)),new Promise((a,b)=>k(["../chunks/calcite-icon"],a,b)),new Promise((a,b)=>k(["../chunks/calcite-label"],
a,b)),new Promise((a,b)=>k(["../chunks/calcite-list"],a,b)),new Promise((a,b)=>k(["../chunks/calcite-list-item"],a,b)),new Promise((a,b)=>k(["../chunks/calcite-modal"],a,b)),new Promise((a,b)=>k(["../chunks/calcite-notice"],a,b)),new Promise((a,b)=>k(["../chunks/calcite-option"],a,b)),new Promise((a,b)=>k(["../chunks/calcite-panel"],a,b)),new Promise((a,b)=>k(["../chunks/calcite-popover"],a,b)),new Promise((a,b)=>k(["../chunks/calcite-popover-manager"],a,b)),new Promise((a,b)=>k(["../chunks/calcite-select"],
a,b)),new Promise((a,b)=>k(["../chunks/calcite-tabs"],a,b)),new Promise((a,b)=>k(["../chunks/calcite-tab"],a,b)),new Promise((a,b)=>k(["../chunks/calcite-tab-nav"],a,b)),new Promise((a,b)=>k(["../chunks/calcite-tab-title"],a,b))])};g.switchTab=function(a){this._activeTab=a;this.scheduleRender()};g.switchToFunctions=function(a,b){this._traceResultsFunctions=a;this._showTraceResultFunctions=b;this.scheduleRender()};g.switchToAssetGroup=function(a,b,c){this._traceHeaderForFlow=b;this._traceResultsAssetGroup=
a;this._showTraceResultAssetGroup=c;this.scheduleRender()};g.switchToAssetType=function(a,b,c){this._assetGroupHeader=b;this._traceResultsAssetType=a;this._showTraceResultAssetType=c;this.scheduleRender()};g.switchToIndividualRecords=function(a,b,c){this._assetTypeHeader=b;this._traceResultsIndividual=a;this._showIndividualRecords=c;this.scheduleRender()};g.renderLoading=function(){return d.tsx("div",{class:"esri-utility-trace-network__loader-container",key:"loader"},d.tsx("div",{class:"esri-utility-trace-network__loader"}))};
g.renderUtilityNetworkTrace=function(){var {messages:a}=this;a=d.tsx("calcite-tabs",{position:"above",layout:"center",class:"esri-match-height"},d.tsx("calcite-tab-nav",{slot:"tab-nav"},d.tsx("calcite-tab-title",{active:"input"===this._activeTab?!0:!1,onclick:()=>{this.switchTab("input")}},a.inputsStrings.headerTabInputs),d.tsx("calcite-tab-title",{active:"result"===this._activeTab?!0:!1,onclick:()=>{this.switchTab("result")}},a.resultsStrings.headerTabResults)),d.tsx("calcite-tab",{active:"input"===
this._activeTab?!0:!1,class:"esri-match-height"},this.renderInputPanel()),d.tsx("calcite-tab",{active:"result"===this._activeTab?!0:!1,class:"esri-match-height"},this.viewModel._activeProgress?d.tsx("calcite-loader",{active:!0,label:a.alertsStrings.traceExecuting,text:a.alertsStrings.traceExecuting,type:"indeterminate"}):0<this.viewModel._traceResults.length?this.renderResultPanel():this.renderWarningMessage("noTraceExecuted",!1),d.tsx("calcite-modal",{active:this._confirmReset,color:"blue",scale:"m",
width:"s","intl-close":"Close",onCalciteModalClose:()=>{this._confirmReset=!1}},d.tsx("h3",{slot:"header"},a.resultsStrings.startOverButton),d.tsx("div",{slot:"content"},a.resultsStrings.startOverValidation),d.tsx("calcite-button",{slot:"secondary",width:"full",appearance:"outline",onclick:()=>{this._confirmReset=!1}},a.globalStrings.cancel),d.tsx("calcite-button",{slot:"primary",width:"full",onclick:()=>{this._confirmReset=!1;this.viewModel.reset();this.switchTab("input")}},a.globalStrings.ok))));
this._tracesExists||(a=d.tsx("calcite-panel",null,this.renderWarningMessage("noTraceConfig",!1)));return a};g.renderInputPanel=function(){const {messages:a}=this;return d.tsx("calcite-flow",{class:"esri-utility-trace-network__flow"},d.tsx("calcite-panel",null,this._warningNoFlag?this.renderWarningMessage("flag",!0):null,this._warningNoTraceSelected?this.renderWarningMessage("trace",!0):null,this.renderTraceSelectorContainer(),this.renderStartFlagsContainer(),this.renderBarriersFlagsContainer(),this._warningNoFlag&&
this._warningNoTraceSelected?d.tsx("div",{styles:{height:"10px"}}):null,d.tsx("calcite-button",{slot:"footer",scale:"m",color:"blue",width:"full",onclick:()=>{this.checkCanTrace()}},a.tracingStrings.runTrace)),this._selectToolActive?this.renderActiveTool():null)};g.renderResultPanel=function(){return d.tsx("div",{class:this.classes("esri-match-height","esri-utility-trace-network__results-container")},d.tsx("calcite-flow",null,this.renderTraceResults(),this._showTraceResultFunctions?this.renderTraceResultFunctions():
null,this._showTraceResultAssetGroup?this.renderTraceResultByAssetGroup():null,this._showTraceResultAssetType?this.renderTraceResultByAssetType():null,this._showIndividualRecords?this.renderTraceResultIndividual():null))};g.renderStartFlagsContainer=function(){const {messages:a}=this,b=[];let c=[];c=this.viewModel._flags.filter(e=>"starting-point"===e.type);c.forEach(e=>{e.displayValue&&b.push(this.renderFlagRow(e,"start"))});return d.tsx("calcite-block",{heading:a.inputsStrings.headerStartingPoint+
" ("+c.length+")",open:!0,collapsible:!0},d.tsx("div",{slot:"icon"},d.tsx("calcite-icon",{icon:"pin",scale:"s"})),d.tsx("div",null,a.inputsStrings.startingPointHint),d.tsx("div",{class:"esri-utility-trace-network__list-container"},b),this._warningNoStartAssetFound?this.renderWarningMessage("noStartAsset",!0):null,d.tsx("div",{class:"esri-utility-trace-network__add-button-container"},d.tsx("calcite-button",{alignment:"center",appearance:"outline","icon-start":"plus",scale:"m",href:"",label:a.inputsStrings.addPointOption,
onclick:()=>{this._flagViewType="starting-point";this._selectToolActive=!0;this._warningNoStartAssetFound=!1;this.viewModel.addFlagByHit("starting-point").then(e=>{e||(this._warningNoStartAssetFound=!0);this._selectToolActive=!1;this.scheduleRender()})},round:!0})))};g.renderBarriersFlagsContainer=function(){const {messages:a}=this,b=[];let c=[];c=this.viewModel._flags.filter(e=>"barrier"===e.type);c.forEach(e=>{e.displayValue&&b.push(this.renderFlagRow(e,"barrier"))});return d.tsx("calcite-block",
{heading:a.inputsStrings.headerBarrier+" ("+c.length+")",open:!1,collapsible:!0},d.tsx("div",{slot:"icon"},d.tsx("calcite-icon",{icon:"x-circle-f",scale:"s"})),d.tsx("div",null,a.inputsStrings.barrierPointHint),d.tsx("div",{class:"esri-utility-trace-network__list-container"},b),this._warningNoBarrierAssetFound?this.renderWarningMessage("noBarrierAsset",!0):null,d.tsx("div",{class:"esri-utility-trace-network__add-button-container"},d.tsx("calcite-button",{alignment:"center",appearance:"outline",color:"blue",
"icon-start":"plus",scale:"m",href:"",round:!0,label:a.inputsStrings.addPointOption,onclick:()=>{this._flagViewType="barrier";this._selectToolActive=!0;this._warningNoBarrierAssetFound=!1;this.viewModel.addFlagByHit("barrier").then(e=>{e||(this._warningNoBarrierAssetFound=!0);this._selectToolActive=!1;this.scheduleRender()})}})))};g.renderFlagRow=function(a,b){const {messages:c}=this,e=[];let f=!1;null!==a.allTerminals&&"undefined"!==typeof a.allTerminals&&0<a.allTerminals.terminals.length&&(f=!0,
a.allTerminals.terminals.forEach(h=>{let r=!1;a.selectedTerminals.find(t=>t===h.id)&&(r=!0);e.push(d.tsx("calcite-combobox-item",{key:h.name,selected:r,value:h.id,"text-label":h.name,onclick:t=>{this.viewModel.addTerminal(t.target.value,a)}}))}));return d.tsx("calcite-block",{key:"pop"+a.globalId+a.type+a.id+b,heading:a.displayValue.value,collapsible:null!==a.allTerminals?!0:"barrier"===a.type?!0:!1},d.tsx("calcite-action",{textEnabled:!0,slot:"header-menu-actions",text:c.globalStrings.remove,label:c.globalStrings.remove,
onCalciteListItemChange:()=>{this.viewModel.removeFlag(a)},onclick:()=>{this.viewModel.removeFlag(a)},scale:"s",icon:"trash"}),d.tsx("calcite-action",{textEnabled:!0,slot:"header-menu-actions",text:c.globalStrings.zoomToFeature,label:c.globalStrings.zoomToFeature,onCalciteListItemChange:()=>{this.viewModel.zoomToAsset(a.details.geometry)},onclick:()=>{this.viewModel.zoomToAsset(a.details.geometry)},scale:"s",icon:"zoom-to-object"}),"barrier"===a.type?d.tsx("calcite-label",{scale:"s",layout:"inline"},
d.tsx("calcite-checkbox",{checked:a.isFilterBarrier,scale:"s",onclick:()=>{this.viewModel.manageFilterBarrier(!a.isFilterBarrier,a)}}),c.inputsStrings.barrierFilter):null,f?d.tsx("calcite-combobox",{label:c.globalStrings.selectTerminalPlaceholder,placeholder:c.globalStrings.selectTerminalPlaceholder,"selection-mode":"multi",scale:"s",maxItems:0,onCalciteComboboxChipDismiss:h=>{this.viewModel.removeTerminal(h.target.value,a)}},e):null)};g.renderActiveTool=function(){const {messages:a}=this;return d.tsx("calcite-panel",
{"height-scale":"s",onCalcitePanelBackClick:()=>{this.viewModel._clickHandler&&(this.viewModel._clickHandler.remove(),this.view.popup.autoOpenEnabled=!0);this._selectToolActive=!1},heading:a.inputsStrings.addPointOption},d.tsx("calcite-block",{open:!0,collapsible:!1,heading:""},d.tsx("div",{styles:{textAlign:"center"}},d.tsx("calcite-icon",{icon:"starting-point"===this._flagViewType?"pin":"x-circle-f",scale:"s"})),d.tsx("div",{styles:{textAlign:"center"}},a.inputsStrings.addPointHint)))};g.renderTraceSelectorContainer=
function(){const {messages:a}=this,b=[];0<this.viewModel._traces.length&&this.viewModel._traces.forEach(c=>{b.push(d.tsx("calcite-combobox-item",{key:c.globalId,selected:c.selected,value:c.globalId,"text-label":c.title,onCalciteComboboxItemChange:e=>{this.viewModel.selectTraces(e.target.selected,c.globalId);0<this.viewModel._traces.length&&(this._warningNoTraceSelected=!1)}}))});return d.tsx("calcite-block",{heading:a.tracingStrings.traceOperation,open:!0,collapsible:!0},d.tsx("calcite-combobox",
{label:a.inputsStrings.selectTraces,placeholder:a.inputsStrings.selectTraces,"selection-mode":"multi",scale:"s",maxItems:0,onCalciteComboboxChipDismiss:c=>{this.viewModel.selectTraces(!1,c.target.value);0<this.viewModel._traces.length&&(this._warningNoTraceSelected=!1)}},b))};g.renderStartOverContainer=function(){const {messages:a}=this;return d.tsx("calcite-button",{slot:"footer",scale:"m",color:"blue",width:"full",onclick:()=>{this.confirmReset()}},a.resultsStrings.startOverButton)};g.renderWarningMessage=
function(a,b,c){const {messages:e}=this;let f=e.alertsStrings.NoRunAlertHeader,h=e.alertsStrings.noResultsInfo;switch(a){case "flag":f=e.alertsStrings.startingPointAlertHeader;h=e.alertsStrings.startingPointAlert;break;case "trace":f=e.alertsStrings.selectTraceAlertHeader;h=e.alertsStrings.selectTraceAlert;break;case "noTraceExecuted":f=e.alertsStrings.NoRunAlertHeader;h=e.alertsStrings.noResultsInfo;break;case "noBarrierAsset":case "noStartAsset":f=e.alertsStrings.noAssetsFoundHeader;h=e.alertsStrings.noAssetFound;
break;case "noTraceConfig":f="";h=e.alertsStrings.noTraceSupported;break;default:f=e.alertsStrings.genericResultHeader,h=c?c:""}return d.tsx("div",{class:"esri-utility-trace-network__notice-container",key:a},d.tsx("calcite-notice",{open:!0,key:a,active:!0,dismissible:b,icon:!0,scale:"s",width:"auto",color:"red",onCalciteNoticeClose:()=>{switch(a){case "flag":this._warningNoFlag=!1;break;case "trace":this._warningNoTraceSelected=!1;break;case "noStartAsset":this._warningNoStartAssetFound=!1;break;
case "noBarrierAsset":this._warningNoBarrierAssetFound=!1}}},d.tsx("div",{slot:"title"},f),d.tsx("div",{slot:"message"},h)))};g.renderRemoveTraceContainer=function(a){const {messages:b}=this;return d.tsx("calcite-action",{textEnabled:!0,slot:"header-menu-actions",text:b.globalStrings.clearResults,label:b.globalStrings.clearResults,onCalciteListItemChange:()=>{this._alertRemoveModal=!0;this._activeTrace=a.trace},onclick:()=>{this._alertRemoveModal=!0;this._activeTrace=a.trace},scale:"s",icon:"trash"})};
g.renderHighlightColorPicker=function(a,b){const {messages:c}=this;return d.tsx("calcite-action-pad",{position:"start",layout:"grid",expandDisabled:!0},d.tsx("calcite-action-group",{layout:"grid",columns:4},d.tsx("calcite-action",{text:c.resultsStrings.graphicColor,label:c.resultsStrings.graphicColor,scale:"s",onclick:()=>{this.viewModel.changeResultGraphicColor(this._graphicHandler.getHighlightColor(0),b)}},d.tsx("calcite-color-picker-swatch",{scale:"s",color:this._graphicHandler.getHighlightColor(0).hex,
active:a.color===this._graphicHandler.getHighlightColor(0).color?!0:!1})),d.tsx("calcite-action",{text:"",scale:"s",onclick:()=>{this.viewModel.changeResultGraphicColor(this._graphicHandler.getHighlightColor(1),b)}},d.tsx("calcite-color-picker-swatch",{scale:"s",color:this._graphicHandler.getHighlightColor(1).hex,active:a.color===this._graphicHandler.getHighlightColor(1).color?!0:!1})),d.tsx("calcite-action",{text:"",scale:"s",onclick:()=>{this.viewModel.changeResultGraphicColor(this._graphicHandler.getHighlightColor(2),
b)}},d.tsx("calcite-color-picker-swatch",{scale:"s",color:this._graphicHandler.getHighlightColor(2).hex,active:a.color===this._graphicHandler.getHighlightColor(2).color?!0:!1})),d.tsx("calcite-action",{text:"",scale:"s",onclick:()=>{this.viewModel.changeResultGraphicColor(this._graphicHandler.getHighlightColor(3),b)}},d.tsx("calcite-color-picker-swatch",{scale:"s",color:this._graphicHandler.getHighlightColor(3).hex,active:a.color===this._graphicHandler.getHighlightColor(3).color?!0:!1})),d.tsx("calcite-action",
{text:"",scale:"s",onclick:()=>{this.viewModel.changeResultGraphicColor(this._graphicHandler.getHighlightColor(4),b)}},d.tsx("calcite-color-picker-swatch",{scale:"s",color:this._graphicHandler.getHighlightColor(4).hex,active:a.color===this._graphicHandler.getHighlightColor(4).color?!0:!1}))))};g.renderTraceResults=function(){const {messages:a}=this,b=[];this.viewModel._traceResults.forEach((c,e)=>{let f=[],h=[],r=!1,t=!1,A=!1;null!==c.results?c.results.hasOwnProperty("elements")?(null!==c.results.aggregatedGeometry&&
(t=!0),null!==c.results.globalFunctionResults&&0<c.results.globalFunctionResults.length&&(h=c.results.globalFunctionResults,0<h.length&&(A=!0)),0<c.results.elements.length&&(f=c.results.elements,0<f.length&&(r=!0)),b.push(d.tsx("calcite-block",{key:c.trace.title,heading:c.trace.title,summary:c.trace.description,collapsible:!1,open:!0,intlOptions:a.resultsStrings.ellipsesOptions},this.renderRemoveTraceContainer(c),d.tsx("calcite-list",null,A?d.tsx("calcite-list-item",{label:a.resultsStrings.functionHeader+
" ("+h.length+")",onclick:()=>{this.switchToFunctions(h,!0)}},d.tsx("calcite-icon",{icon:"chevron-right",scale:"s",slot:"content-end"})):null,r&&this.viewModel.showSelectionAttributes?d.tsx("calcite-list-item",{label:a.resultsStrings.viewFeatures+" ("+f.length+")",onclick:()=>{this.switchToAssetGroup(this._groupResultsByAssetGroup(c),c.trace.title+" ("+f.length+")",!0)}},d.tsx("calcite-icon",{icon:"chevron-right",scale:"s",slot:"content-end"})):this.viewModel.showSelectionAttributes?d.tsx("calcite-label",
{layout:"inline",scale:"s"},a.resultsStrings.noSelectionResults):null),d.tsx("div",{styles:{height:"10px"}}),r?d.tsx("calcite-label",{layout:"inline",scale:"s",onclick:n=>{n.preventDefault();n.stopPropagation();this.viewModel.mergeSelection(!c.selectionEnabled,c.trace)}},d.tsx("calcite-checkbox",{checked:c.selectionEnabled,scale:"m",onclick:n=>{n.preventDefault();n.stopPropagation();this.viewModel.mergeSelection(!c.selectionEnabled,c.trace)}}),this.viewModel.showSelectionAttributes?a.resultsStrings.selectFeatures:
a.resultsStrings.selectFeatures+" ("+f.length+")"):null,t?d.tsx("calcite-block-section",{"toggle-display":"switch",text:a.resultsStrings.highlightTrace,open:c.graphicEnabled,onCalciteBlockSectionToggle:n=>{n.target.open?this.viewModel.changeResultGraphicColor(c.graphicColor,c):this.viewModel.removeResultGraphicFromView(c)}},d.tsx("calcite-popover-manager",{key:"aggGeom_"+c.trace.globalId,autoClose:!0},d.tsx("calcite-action",{text:a.resultsStrings.graphicColor,label:a.resultsStrings.graphicColor,scale:"s",
onclick:n=>{this._swatchNode=n.target;this._activeSwatch="aggGeom_"+e;this.scheduleRender()}},d.tsx("calcite-color-picker-swatch",{scale:"s",color:c.graphicColor.hex})),d.tsx("calcite-popover",{label:a.resultsStrings.graphicColor,text:a.resultsStrings.graphicColor,referenceElement:this._swatchNode,placement:"auto",offsetDistance:5,offsetSkidding:0,open:this._activeSwatch==="aggGeom_"+e?!0:!1,onCalcitePopoverClose:()=>{this._activeSwatch=this._swatchNode=null}},this.renderHighlightColorPicker(c.graphicColor,
c)))):null))):b.push(d.tsx("calcite-block",{key:"error-"+e,heading:c.trace.title,collapsible:!1,open:!0},this.renderRemoveTraceContainer(c),this.renderWarningMessage("noController",!1,c.status))):b.push(d.tsx("calcite-block",{key:"error-"+e,heading:c.trace.title,collapsible:!1,open:!0},this.renderRemoveTraceContainer(c),this.renderWarningMessage("noController",!1,c.status)))});return d.tsx("calcite-panel",{key:"traceResults"},b,this.renderStartOverContainer(),d.tsx("calcite-modal",{active:this._alertRemoveModal,
color:"blue",scale:"m",width:"s","intl-close":"Close",onCalciteModalClose:()=>{this._alertRemoveModal=!1;this.scheduleRender()}},d.tsx("h3",{slot:"header"},a.globalStrings.clearResults),d.tsx("div",{slot:"content"},a.alertsStrings.clearResultsAlert),d.tsx("calcite-button",{slot:"secondary",width:"full",appearance:"outline",onclick:()=>{this._alertRemoveModal=!1;this.scheduleRender()}},a.globalStrings.cancel),d.tsx("calcite-button",{slot:"primary",width:"full",onclick:()=>{this.viewModel.clearResult(this._activeTrace);
this._alertRemoveModal=!1;0===this.viewModel._traceResults.length?this.switchTab("input"):(this._activeTrace=this.viewModel._traceResults[0].trace,this._showIndividualRecords=this._showTraceResultAssetType=this._showTraceResultAssetGroup=this._showTraceResultFunctions=!1);this.scheduleRender()}},a.globalStrings.ok)))};g.renderTraceResultFunctions=function(){const {messages:a}=this,b=[];this._traceResultsFunctions.forEach(c=>{b.push(this.renderResultRowFunctions(c))});return d.tsx("calcite-panel",
{key:"functionResultMultiple",onCalcitePanelBackClick:()=>{this.switchToFunctions([],!1)},heading:a.resultsStrings.functionHeader},b,this.renderStartOverContainer())};g.renderTraceResultByAssetGroup=function(){const a=this._traceResultsAssetGroup,b=[];for(const c in a){const e=a[c];for(const f in e)b.push(this.renderResultRowAssetGroup(e[f]))}return d.tsx("calcite-panel",{key:"assetGroupResultMultiple",onCalcitePanelBackClick:()=>{this.switchToAssetGroup([],"",!1)},heading:this._traceHeaderForFlow},
d.tsx("calcite-list",null,b),this.renderStartOverContainer())};g.renderTraceResultByAssetType=function(){const a=this._traceResultsAssetType,b=[];for(const c in a)0<a[c].length&&b.push(this.renderResultRowAssetType(a[c]));return d.tsx("calcite-panel",{key:"assetTypeResult",onCalcitePanelBackClick:()=>{this.switchToAssetType([],"",!1)},heading:this._assetGroupHeader},b,this.renderStartOverContainer())};g.renderTraceResultIndividual=function(){const {messages:a}=this,b=this._traceResultsIndividual;
b.sort(this._compare(this._resultSortField,this._resultSortOrder));const c=[],e=[],f=[];0<b.length&&(b[0].details.fields.forEach(h=>{e.push(d.tsx("calcite-option",{key:"display"+h.name,label:h.alias,value:h.name,selected:h.name===this._resultDisplayField?!0:!1}));f.push(d.tsx("calcite-option",{key:"sort"+h.name,label:h.alias,value:h.name,selected:h.name===this._resultSortField?!0:!1}))}),b.forEach(h=>{c.push(this.renderResultRowIndividual(h))}));return d.tsx("calcite-popover-manager",{class:"esri-match-height",
key:"popIndividualResult",autoClose:!0},d.tsx("calcite-panel",{key:"individualResult",onCalcitePanelBackClick:()=>{this._showResultOptions=!1;this.switchToIndividualRecords([],"",!1)},heading:this._assetTypeHeader},d.tsx("calcite-action",{"text-enabled":!0,slot:"header-actions-end",text:a.resultsStrings.displayAttribute,onCalciteListItemChange:()=>{this._showResultOptions=!0},onclick:()=>{this._showResultOptions=!0},scale:"s",icon:"gear",label:a.resultsStrings.displayAttribute,id:"field_options",
afterCreate:D.storeNode,bind:this,"data-node-ref":"_individualResultNode"}),c,this.renderStartOverContainer()),d.tsx("calcite-popover",{label:a.resultsStrings.displayAttribute,referenceElement:this._individualResultNode,placement:"auto",offsetDistance:5,offsetSkidding:0,open:this._showResultOptions,styles:{width:.75*this.domNode.clientWidth+"px"}},d.tsx("calcite-block",{heading:a.resultsStrings.resultsListOptions,collapsible:!1,open:!0},d.tsx("calcite-label",{scale:"s"},a.resultsStrings.displayAttribute,
d.tsx("calcite-select",{label:a.resultsStrings.displayAttribute,onCalciteSelectChange:h=>{this._resultDisplayField=h.target.selectedOption.value;this._showResultOptions=!1}},e)),d.tsx("calcite-label",null,a.resultsStrings.sortBy,d.tsx("calcite-select",{label:a.resultsStrings.sortBy,onCalciteSelectChange:h=>{this._resultSortField=h.target.selectedOption.value;b.sort(this._compare(this._resultSortField,this._resultSortOrder));this._traceResultsIndividual=b;this._showResultOptions=!1}},f)))))};g.renderResultRow=
function(a){let b=a[0].assetGroupCode;var c=this.viewModel.getValidSources().filter(e=>e.sourceId===a[0].networkSourceId);0<c.length&&(c=c[0].assetGroups.filter(e=>e.assetGroupCode===a[0].assetGroupCode),0<c.length&&(b=c[0].assetGroupName));return d.tsx("calcite-list-item",{label:b+" ("+a.length+")",onclick:()=>{this.switchToAssetType(this._groupResultsByAssetType(a),b+" ("+a.length+")",!0)}},d.tsx("calcite-icon",{icon:"chevron-right",scale:"s",slot:"content-end"}))};g.renderResultRowFunctions=function(a){return d.tsx("calcite-block",
{heading:a.functionType+" \x3d "+a.result,collapsible:!1})};g.renderResultRowAssetGroup=function(a){let b=a[0].assetGroupCode;const c=a[0].assetGroupCode;var e=this.viewModel.getValidSources().filter(f=>f.sourceId===a[0].networkSourceId);0<e.length&&(e=e[0].assetGroups.filter(f=>f.assetGroupCode===c),0<e.length&&(b=e[0].assetGroupName));return d.tsx("calcite-list-item",{label:b+" ("+a.length+")",onclick:()=>{this.switchToAssetType(this._groupResultsByAssetType(a),b+" ("+a.length+")",!0)}},d.tsx("calcite-icon",
{slot:"content-end",icon:"chevron-right",scale:"s"}))};g.renderResultRowAssetType=function(a){let b=a[0].assetTypeCode;const c=a[0].assetGroupCode;var e=this.viewModel.getValidSources().filter(f=>f.sourceId===a[0].networkSourceId);0<e.length&&(e=e[0].assetGroups.filter(f=>f.assetGroupCode===c),0<e.length&&(e=e[0].assetTypes.filter(f=>f.assetTypeCode===a[0].assetTypeCode),0<e.length&&(b=e[0].assetTypeName)));return d.tsx("calcite-list-item",{label:b+" ("+a.length+")",onclick:()=>{this.viewModel.queryFeaturesById(a).then(f=>
{null!==f?(f=this._appendAttributes(a,f.featureSet,"objectId"),this.switchToIndividualRecords(f,b+" ("+a.length+")",!0)):this.switchToIndividualRecords(a,b+" ("+a.length+")",!0)})}},d.tsx("calcite-icon",{slot:"content-end",icon:"chevron-right",scale:"s"}))};g.renderResultRowIndividual=function(a){const {messages:b}=this;let c=a.details.attributes[this._resultDisplayField];c&&""!==c&&null!==c||(c=b.resultsStrings.noValue);return d.tsx("calcite-list-item",{label:c,onclick:()=>{this.viewModel.zoomToAsset(a.details.geometry)}},
d.tsx("calcite-icon",{icon:"zoom-to-object","text-label":b.globalStrings.zoomToFeature,scale:"s",slot:"content-end"}))};g._UtilityNetworkTraceInitialized=function(){var a=this;return this.viewModel.loadUtilityNetwork().then(b=>{if(b)return this.viewModel.selectTracesOnLoad(),0>=this.viewModel._traces.length&&(this._tracesExists=!1),0<this.viewModel.flags.length?this.view.when().then(()=>{const c=v.whenFalse(this.view,"updating",u._asyncToGenerator(function*(){a._warningNoFlag=!1;a._warningNoBarrierAssetFound=
!1;a._warningNoStartAssetFound=!1;const e=yield a.viewModel.addFlagsOnLoad();e.includes("barrier")&&(a._warningNoBarrierAssetFound=!0);e.includes("starting-point")&&(a._warningNoStartAssetFound=!0);a.disabled=!1;c.remove();a.scheduleRender()}))}):this.view.when().then(()=>{const c=v.whenFalse(this.view,"updating",()=>{this.disabled=!1;c.remove()})});this._tracesExists=!1;return this.view.when().then(()=>{const c=v.whenFalse(this.view,"updating",()=>{this.disabled=!1;c.remove()})})})};g._groupResultsByAssetGroup=
function(a){const b=[];a=this._groupBy(a.results.elements,"networkSourceId");for(const c in a)b.push(this._groupBy(a[c],"assetGroupCode"));return b};g._groupResultsByAssetType=function(a){return this._groupBy(a,"assetTypeCode")};g._appendAttributes=function(a,b,c){const e=[];a.forEach(f=>{b.features.forEach(h=>{f[c]===h.attributes[c.toLowerCase()]&&(f.details=h,f.details.fields=b.fields,e.push(f))})});return e};g._compare=function(a,b){return(c,e)=>{let f=0;c=c.details.attributes[a];e=e.details.attributes[a];
isNaN(c)&&(c=c.toLowerCase());isNaN(e)&&(e=e.toLowerCase());"desc"===b?c>e?f=1:c<e&&(f=-1):c<e?f=1:c>e&&(f=-1);return f}};g._groupBy=function(a,b){return a.reduce(function(c,e){(c[e[b]]=c[e[b]]||[]).push(e);return c},{})};return w}(l.HandleOwnerMixin(C));m.__decorate([q.property()],l.prototype,"_confirmReset",void 0);m.__decorate([q.property()],l.prototype,"disabled",void 0);m.__decorate([p.aliasOf("viewModel.flags")],l.prototype,"flags",void 0);m.__decorate([p.aliasOf("viewModel.gdbVersion")],l.prototype,
"gdbVersion",void 0);m.__decorate([p.aliasOf("viewModel.goToOverride")],l.prototype,"goToOverride",void 0);m.__decorate([q.property()],l.prototype,"iconClass",void 0);m.__decorate([q.property({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],l.prototype,"label",void 0);m.__decorate([q.property(),x.messageBundle("esri/widgets/UtilityNetworkTrace/t9n/UtilityNetworkTrace")],l.prototype,"messages",void 0);m.__decorate([q.property(),x.messageBundle("esri/t9n/common")],l.prototype,"messagesCommon",
void 0);m.__decorate([p.aliasOf("viewModel.selectedTraces")],l.prototype,"selectedTraces",void 0);m.__decorate([p.aliasOf("viewModel.selectOnComplete")],l.prototype,"selectOnComplete",void 0);m.__decorate([p.aliasOf("viewModel.showGraphicsOnComplete")],l.prototype,"showGraphicsOnComplete",void 0);m.__decorate([p.aliasOf("viewModel.showSelectionAttributes")],l.prototype,"showSelectionAttributes",void 0);m.__decorate([p.aliasOf("viewModel.view")],l.prototype,"view",void 0);m.__decorate([q.property({type:y})],
l.prototype,"viewModel",void 0);return l=m.__decorate([B.subclass("esri.widgets.UtilityNetworkTrace")],l)});