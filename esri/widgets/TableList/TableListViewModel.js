// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.22/esri/copyright.txt for details.
//>>built
define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Collection ../../core/Evented ../../core/Handles ../../core/promiseUtils ../../core/watchUtils ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ../LayerList/support/layerListUtils ./ListItem".split(" "),function(g,h,e,t,u,n,k,l,x,y,z,v,w,p){const q=e.ofType(p);e=function(r){function m(a){var b=r.call(this,
a)||this;b._handles=new u;b.listItemCreatedFunction=null;b.tableItems=new q;b.map=null;b._callListItemsCreatedDebounced=n.debounce(g._asyncToGenerator(function*(){return b._callListItemsCreated()}),300);return b}g._inheritsLoose(m,r);var d=m.prototype;d.initialize=function(){this._handles.add([k.init(this,["map","map.loaded"],()=>this._mapHandles())],"map")};d.destroy=function(){this._handles.destroy();this.map=this._handles=null;this.tableItems.removeAll()};d.triggerAction=function(a,b){a&&!a.disabled&&
this.emit("trigger-action",{action:a,item:b})};d._mapHandles=function(){const {_handles:a,map:b}=this;a.remove("tables");this._compileList();b&&a.add([k.on(this,"map.allTables","change",()=>this._compileList()),k.init(this,"map.allTables",()=>this._compileList()),k.init(this,"listItemCreatedFunction",()=>this._compileList())],"tables")};d._callListItemCreated=function(a){"function"===typeof this.listItemCreatedFunction&&this.listItemCreatedFunction.call(null,{item:a})};d._removeAllItems=function(){this.tableItems.removeAll()};
d._getViewableTables=function(a){if(a)return a.filter(b=>"hide"!==w.findLayerListMode(b))};d._watchTablesListMode=function(a){const {_handles:b}=this;b.remove("layer-list-mode");a&&a.forEach(c=>{b.add(k.watch(c,"listMode",()=>this._compileList()),"layer-list-mode")})};d._compileList=function(){var a;const b=null==(a=this.map)?void 0:a.tables;this._watchTablesListMode(b);(a=this._getViewableTables(b))&&a.length?(this._createNewItems(a),this._removeItems(a),this._sortItems(a),this._beforeCallListItemsCreated()):
this._removeAllItems()};d._beforeCallListItemsCreated=function(){var a=g._asyncToGenerator(function*(){return this._callListItemsCreatedDebounced().catch(n.throwIfNotAbortError)});return function(){return a.apply(this,arguments)}}();d._callListItemsCreated=function(){var a=g._asyncToGenerator(function*(){var b;yield null==(b=this.map)?void 0:b.when();this.tableItems.forEach(c=>this._callListItemCreated(c))});return function(){return a.apply(this,arguments)}}();d._createNewItems=function(a){const {tableItems:b}=
this;a.forEach(c=>{b.find(f=>f.layer===c)||b.add(new p({layer:c}))})};d._removeItems=function(a){const {tableItems:b}=this;b.forEach(c=>{c&&(a&&a.find(f=>c.layer===f)||b.remove(c))})};d._sortItems=function(a){const {tableItems:b}=this;b.sort((c,f)=>{c=a.indexOf(c.layer);f=a.indexOf(f.layer);return c>f?-1:c<f?1:0})};g._createClass(m,[{key:"state",get:function(){var a;const b=null==(a=this.map)?void 0:a.loadStatus;return"string"===typeof b?"loaded"===b?"ready":"loading"===b?"loading":"disabled":"disabled"}}]);
return m}(t.EventedAccessor);h.__decorate([l.property()],e.prototype,"listItemCreatedFunction",void 0);h.__decorate([l.property({type:q})],e.prototype,"tableItems",void 0);h.__decorate([l.property()],e.prototype,"map",void 0);h.__decorate([l.property({readOnly:!0})],e.prototype,"state",null);return e=h.__decorate([v.subclass("esri.widgets.TableList.TableListViewModel")],e)});