// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.22/esri/copyright.txt for details.
//>>built
define(["exports","./aaBoundingRect","./boundsUtils","./jsonUtils","./spatialReferenceUtils"],function(A,w,t,B,H){function I(b,c){let a,e;const [m,,k]=t.getBoundsXY(w.create(),b);if(k<=c)a=b;else if(m>=c)e=b;else{const d=[],l=[],n=[];for(var g of b.rings){const [q,,r]=t.getPointsBounds(w.create(),g);if(r<=c)d.push(g);else if(q>=c)l.push(g);else{var f=g[g.length-1];b=y(f,c);let p=[];for(var h of g){const u=y(h,c);u===b?p.push(h):(f=C(f,h,c),p.push(f),b?d.push(p):l.push(p),n.push(f[1]),p=[],p.push([f[0],
f[1]]),p.push(h),b=u);f=h}b?d.push(p):l.push(p)}}n.sort((q,r)=>q-r);for(g=0;g<n.length-1;g+=2)h=[],h.push([c,n[g]]),h.push([c,n[g+1]]),0<d.length&&d.push(h),0<l.length&&l.push(h);0<d.length&&(a=D(d));0<l.length&&(e=D(l))}return[a,e]}function D(b){const c={rings:[]};for(;0<b.length;){const e=b[0];var a=!1;const [m,k]=e[0],[g,f]=e[e.length-1];if(m!==g||k!==f)for(let h=1;h<b.length;h++){const d=b[h],[l,n]=d[0],[q,r]=d[d.length-1];if(f===n&&g===l){for(a=1;a<d.length;a++)e.push([d[a][0],d[a][1]]);a=!0}else if(f===
r&&g===q){for(a=d.length-2;0<=a;a--)e.push([d[a][0],d[a][1]]);a=!0}else if(k===r&&m===q){for(a=0;a<d.length-1;a++)e.splice(a,0,[d[a][0],d[a][1]]);a=!0}else if(k===n&&m===l){for(a=1;a<d.length;a++)e.unshift([d[a][0],d[a][1]]);a=!0}if(a){b.splice(h,1);J(e[0],e[e.length-1])&&(b.shift(),0<t.getPointsBoundsWidth(e)&&c.rings.push(e));break}}a||(b.shift(),c.rings.push(e))}return c}function y([b],c){return b<c}function C([b,c],[a,e],m){return[m,c+(e-c)/(a-b)*(m-b)]}function E(b,c){b=(b+c)/(2*c);1===b%2&&
b--;return Math.floor(b)}function J([b,c],[a,e]){return b===a&&c===e}const F=w.create();A.normalize=function(b){if(!b)return null;if(!b.spatialReference)return b;var c=H.getInfo(b.spatialReference);if(!c)return b;c=c.valid[1];if(B.isPolygon(b)){{var a=b,e={rings:[],spatialReference:a.spatialReference};const [r,,p]=t.getBoundsXY(w.create(),a);var m=2*Math.ceil((r-c)/(2*c))*c+c;if(m>p)e=a;else{for(var k;m<p;){[a,k]=I(a,m);if(a)for(var g of a.rings)e.rings.push(g);if(null==k)break;a=k;m+=2*c}if(k)for(var f of k.rings)e.rings.push(f)}for(var h of e.rings){m=
E(t.getPointsBoundsCenterX(h),c);for(var d of h)d[0]-=2*m*c}c=e}return c}if(B.isPolyline(b)){{f=b;h={paths:[],spatialReference:f.spatialReference};const [r,,p]=t.getBoundsXY(w.create(),f);d=2*Math.ceil((r-c)/(2*c))*c+c;if(d>p)h=f;else{for(var l;d<p;){{g=k=void 0;var n=f;f=d;const [u,,K]=t.getBoundsXY(F,n);if(K<=f)g=n;else if(u>=f)k=n;else{g={paths:[]};k={paths:[]};l=g.paths;b=k.paths;for(a of n.paths){const [L,,M]=t.getPointsBounds(F,a);if(M<=f)l.push(a);else if(L>=f)b.push(a);else{var q=a[0];n=y(q,
f);let v=[];v.push(q);for(let z=1;z<a.length;z++){const x=a[z],G=y(x,f);G===n?v.push(x):(q=C(q,x,f),v.push(q),n?l.push(v):b.push(v),v=[q,x],n=G);q=x}n?l.push(v):b.push(v)}}}k=[g,k]}g=k;k=g[0];l=g[1];if(k)for(const u of k.paths)h.paths.push(u);if(null==l)break;f=l;d+=2*c}if(l)for(const u of l.paths)h.paths.push(u)}for(e of h.paths){a=E(t.getPointsBoundsCenterX(e),c);for(m of e)m[0]-=2*a*c}c=h}return c}return b};Object.defineProperty(A,"__esModule",{value:!0})});