// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.22/esri/copyright.txt for details.
//>>built
define("exports ../../colorUtils ../../core/Error ./effects ../../chunks/_commonjsHelpers ./utils".split(" "),function(X,O,z,J,Ba,Y){function Z(f){let n;if(!f)return[];try{n=aa.exports.parse(f)}catch(q){throw new z("effect:invalid-syntax","Invalid effect syntax",{value:f,error:q});}return n.map(q=>Ca(q))}function Ca(f){try{switch(f.name){case "grayscale":case "sepia":case "saturate":case "invert":case "brightness":case "contrast":var n,q=1;K(f.parameters,1);1===f.parameters.length&&(q=E(f.parameters[0]));
return n=new J.ColorMatrixEffect(f.name,q);case "opacity":var d;q=1;K(f.parameters,1);1===f.parameters.length&&(q=E(f.parameters[0]));return d=new J.OpacityEffect(q);case "hue-rotate":var p;q=0;K(f.parameters,1);if(1===f.parameters.length){var m=f.parameters[0];if("quantity"!==m.type||!(0===m.value&&null===m.unit||m.unit&&null!=R[m.unit]))throw new z("effect:type-error",`Expected <angle>, Actual: ${P(m)}`,{term:m});q=m.value*R[m.unit]||0}return p=new J.HueRotateEffect(q);case "blur":var v;q=0;K(f.parameters,
1);1===f.parameters.length&&(q=S(f.parameters[0]),L(q,f.parameters[0]));return v=new J.BlurEffect(q);case "drop-shadow":d=[];p=null;for(var t of f.parameters)if("color"===t.type){d.length&&Object.freeze(d);if(p)throw new z("effect:type-error","Accepts only one color",{});a:{var C=void 0;n=t;switch(n.colorType){case "hex":p=O.hex2rgba(n.value);break a;case "named":p=ba(n.value);break a;case "function":var u=n.value;K(u.parameters,4);if(Da.test(u.name))C=[E(u.parameters[0]),E(u.parameters[1]),E(u.parameters[2]),
u.parameters[3]?E(u.parameters[3]):1];else if(Ea.test(u.name))C=O.hsla2rgba(Fa(u.parameters[0]),E(u.parameters[1]),E(u.parameters[2]),u.parameters[3]?E(u.parameters[3]):1);else throw new z("effect:syntax-error",`Invalid color function '${u.name}'`,{colorFunction:u});p=C;break a}p=void 0}}else{const g=S(t);if(Object.isFrozen(d))throw new z("effect:type-error","\x3clength\x3e parameters not consecutive",{lengths:d});d.push(g);3===d.length&&L(g,t)}if(2>d.length||3<d.length)throw new z("effect:type-error",
`Expected <length>{2,3}, Actual: <length>{${d.length}}`,{lengths:d});return q=new J.DropShadowEffect(d[0],d[1],d[2]||0,p||ba("black"));case "bloom":return q=1,t=u=0,K(f.parameters,3),f.parameters[0]&&(q=E(f.parameters[0])),f.parameters[1]&&(u=S(f.parameters[1]),L(u,f.parameters[1])),f.parameters[2]&&(t=E(f.parameters[2])),C=new J.BloomEffect(q,u,t)}}catch(g){throw g.details.filter=f,g;}throw new z("effect:unknown-effect",`Effect '${f.name}' is not supported`,{effect:f});}function K(f,n){if(f.length>
n)throw new z("effect:type-error",`Function supports up to ${n} parameters, Actual: ${f.length}`,{parameters:f});}function P(f){if("color"===f.type)return"\x3ccolor\x3e";if(f.unit){if(T[f.unit])return"\x3clength\x3e";if(R[f.unit])return"\x3cangle\x3e";if("%"===f.unit)return"\x3cpercentage\x3e"}return"\x3cdouble\x3e"}function L(f,n){if(0>f)throw new z("effect:type-error",`Negative values are not allowed, Actual: ${f}`,{term:n});}function E(f){if("quantity"!==f.type||null!==f.unit&&"%"!==f.unit)throw new z("effect:type-error",
`Expected <double> or <percentage>, Actual: ${P(f)}`,{term:f});const n=f.value;L(n,f);return"%"===f.unit?.01*n:n}function Fa(f){if("quantity"!==f.type||null!==f.unit)throw new z("effect:type-error",`Expected <double>, Actual: ${P(f)}`,{term:f});L(f.value,f);return f.value}function S(f){if("quantity"!==f.type||!(0===f.value&&null===f.unit||f.unit&&null!=T[f.unit]))throw new z("effect:type-error",`Expected <length>, Actual: ${P(f)}`,{term:f});return f.value*T[f.unit]||0}function ba(f){if(!O.isNamedColor(f))throw new z("effect:unknown-color",
`color '${f}' isn't valid`,{namedColor:f});return O.getNamedColorCopy(f)}var aa={exports:{}};(function(f){(function(n,q){f.exports&&(f.exports=q())})(Ba.commonjsGlobal,function(){function n(d,p,m,v){d=Error.call(this,d);Object.setPrototypeOf&&Object.setPrototypeOf(d,n.prototype);d.expected=p;d.found=m;d.location=v;d.name="SyntaxError";return d}function q(d,p,m){m=m||" ";if(d.length>p)return d;p-=d.length;m+=m.repeat(p);return d+m.slice(0,p)}(function(d,p){function m(){this.constructor=d}m.prototype=
p.prototype;d.prototype=new m})(n,Error);n.prototype.format=function(d){var p="Error: "+this.message;if(this.location){var m=null,v;for(v=0;v<d.length;v++)if(d[v].source===this.location.source){m=d[v].text.split(/\r\n|\n|\r/g);break}d=this.location.start;v=this.location.source+":"+d.line+":"+d.column;if(m){var t=this.location.end,C=q("",d.line.toString().length);m=m[d.line-1];t=d.line===t.line?t.column:m.length+1;p+="\n --\x3e "+v+"\n"+C+" |\n"+d.line+" | "+m+"\n"+C+" | "+q("",d.column-1)+q("",t-
d.column,"^")}else p+="\n at "+v}return p};n.buildMessage=function(d,p){function m(g){return g.charCodeAt(0).toString(16).toUpperCase()}function v(g){return g.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(x){return"\\x0"+m(x)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(x){return"\\x"+m(x)})}function t(g){return g.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,
"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(x){return"\\x0"+m(x)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(x){return"\\x"+m(x)})}function C(g){return u[g.type](g)}var u={literal:function(g){return'"'+v(g.text)+'"'},class:function(g){var x=g.parts.map(function(A){return Array.isArray(A)?t(A[0])+"-"+t(A[1]):t(A)});return"["+(g.inverted?"^":"")+x+"]"},any:function(){return"any character"},end:function(){return"end of input"},
other:function(g){return g.description}};return"Expected "+function(g){g=g.map(C);var x,A;g.sort();if(0<g.length){for(A=x=1;x<g.length;x++)g[x-1]!==g[x]&&(g[A]=g[x],A++);g.length=A}switch(g.length){case 1:return g[0];case 2:return g[0]+" or "+g[1];default:return g.slice(0,-1).join(", ")+", or "+g[g.length-1]}}(d)+" but "+(p?'"'+v(p)+'"':"end of input")+" found."};return{SyntaxError:n,parse:function(d,p){function m(l,a){return{type:"literal",text:l,ignoreCase:a}}function v(l,a,e){return{type:"class",
parts:l,inverted:a,ignoreCase:e}}function t(l){return{type:"other",description:l}}function C(l){var a=Q[l],e;if(!a){for(e=l-1;!Q[e];)e--;a=Q[e];for(a={line:a.line,column:a.column};e<l;)10===d.charCodeAt(e)?(a.line++,a.column=1):a.column++,e++;Q[l]=a}return a}function u(l,a){var e=C(l),h=C(a);return{source:Ga,start:{offset:l,line:e.line,column:e.column},end:{offset:a,line:h.line,column:h.column}}}function g(l){c<F||(c>F&&(F=c,U=[]),U.push(l))}function x(){k++;var l=c;y();if(d.substr(c,4)===ca){var a=
ca;c+=4}else a=b,0===k&&g(Ha);a!==b?(y(),r=l,l=[]):(c=l,l=b);k--;l===b&&0===k&&g(Ia);if(l===b)if(l=[],a=A(),a!==b)for(;a!==b;)l.push(a),a=A();else l=b;return l}function A(){var l=c;y();k++;var a=c;var e=da();if(e!==b){if(40===d.charCodeAt(c)){var h=Ja;c++}else h=b,0===k&&g(Ka);h!==b?(r=a,a=e):(c=a,a=b)}else c=a,a=b;k--;a===b&&(e=b,0===k&&g(La));if(a!==b){y();e=c;h=V();if(h!==b){var B=[];var w=c;var M=y();if(44===d.charCodeAt(c)){var G=ea;c++}else G=b,0===k&&g(fa);G===b&&(G=null);var W=y();var N=V();
N!==b?w=M=[M,G,W,N]:(c=w,w=b);for(;w!==b;)B.push(w),w=c,M=y(),44===d.charCodeAt(c)?(G=ea,c++):(G=b,0===k&&g(fa)),G===b&&(G=null),W=y(),N=V(),N!==b?w=M=[M,G,W,N]:(c=w,w=b);r=e;e=0<B.length?[h].concat(Ma(B,3)):[h]}else c=e,e=b;e===b&&(e=null);y();41===d.charCodeAt(c)?(h=Na,c++):(h=b,0===k&&g(Oa));h!==b?(y(),r=l,l={type:"function",name:a,parameters:e||[]}):(c=l,l=b)}else c=l,l=b;return l}function V(){var l=c;k++;var a=c;y();var e=D();if(e!==b){if(37===d.charCodeAt(c)){var h=Pa;c++}else h=b,0===k&&g(Qa);
h!==b?(r=a,a={value:e,unit:"%"}):(c=a,a=b)}else c=a,a=b;k--;a===b&&0===k&&g(Ra);a===b&&(k++,a=c,y(),e=D(),e!==b?(d.substr(c,2)===ha?(h=ha,c+=2):(h=b,0===k&&g(Sa)),h!==b?(r=a,a={value:e,unit:"px"}):(c=a,a=b)):(c=a,a=b),a===b&&(a=c,y(),e=D(),e!==b?(d.substr(c,2)===ia?(h=ia,c+=2):(h=b,0===k&&g(Ta)),h!==b?(r=a,a={value:e,unit:"cm"}):(c=a,a=b)):(c=a,a=b),a===b&&(a=c,y(),e=D(),e!==b?(d.substr(c,2)===ja?(h=ja,c+=2):(h=b,0===k&&g(Ua)),h!==b?(r=a,a={value:e,unit:"mm"}):(c=a,a=b)):(c=a,a=b),a===b&&(a=c,y(),
e=D(),e!==b?(d.substr(c,2)===ka?(h=ka,c+=2):(h=b,0===k&&g(Va)),h!==b?(r=a,a={value:e,unit:"in"}):(c=a,a=b)):(c=a,a=b),a===b&&(a=c,y(),e=D(),e!==b?(d.substr(c,2)===la?(h=la,c+=2):(h=b,0===k&&g(Wa)),h!==b?(r=a,a={value:e,unit:"pt"}):(c=a,a=b)):(c=a,a=b),a===b&&(a=c,y(),e=D(),e!==b?(d.substr(c,2)===ma?(h=ma,c+=2):(h=b,0===k&&g(Xa)),h!==b?(r=a,a={value:e,unit:"pc"}):(c=a,a=b)):(c=a,a=b)))))),k--,a===b&&0===k&&g(Ya),a===b&&(k++,a=c,e=D(),e!==b?(d.substr(c,3)===na?(h=na,c+=3):(h=b,0===k&&g(Za)),h!==b?(r=
a,a={value:e,unit:"deg"}):(c=a,a=b)):(c=a,a=b),a===b&&(a=c,e=D(),e!==b?(d.substr(c,3)===oa?(h=oa,c+=3):(h=b,0===k&&g($a)),h!==b?(r=a,a={value:e,unit:"rad"}):(c=a,a=b)):(c=a,a=b),a===b&&(a=c,e=D(),e!==b?(d.substr(c,4)===pa?(h=pa,c+=4):(h=b,0===k&&g(ab)),h!==b?(r=a,a={value:e,unit:"grad"}):(c=a,a=b)):(c=a,a=b),a===b&&(a=c,e=D(),e!==b?(d.substr(c,4)===qa?(h=qa,c+=4):(h=b,0===k&&g(bb)),h!==b?(r=a,a={value:e,unit:"turn"}):(c=a,a=b)):(c=a,a=b)))),k--,a===b&&(e=b,0===k&&g(cb)),a===b&&(k++,a=c,y(),e=D(),
e!==b?(r=a,a={value:e,unit:null}):(c=a,a=b),k--,a===b&&0===k&&g(db))));a!==b&&(r=l,a={type:"quantity",value:a.value,unit:a.unit});l=a;if(l===b){l=c;k++;a=c;35===d.charCodeAt(c)?(e=eb,c++):(e=b,0===k&&g(fb));if(e!==b){e=[];ra.test(d.charAt(c))?(h=d.charAt(c),c++):(h=b,0===k&&g(sa));if(h!==b)for(;h!==b;)e.push(h),ra.test(d.charAt(c))?(h=d.charAt(c),c++):(h=b,0===k&&g(sa));else e=b;e!==b?(r=a,a={type:"hex",value:d.substring(r,c)}):(c=a,a=b)}else c=a,a=b;a===b&&(a=c,e=A(),e!==b&&(r=a,e={type:"function",
value:e}),a=e,a===b&&(a=c,e=da(),e!==b&&(r=a,e={type:"named",value:d.substring(r,c)}),a=e));k--;a===b&&(e=b,0===k&&g(gb));a!==b&&(r=l,a={type:"color",colorType:a.type,value:a.value});l=a}return l}function y(){k++;var l=[];if(ta.test(d.charAt(c))){var a=d.charAt(c);c++}else a=b,0===k&&g(ua);for(;a!==b;)l.push(a),ta.test(d.charAt(c))?(a=d.charAt(c),c++):(a=b,0===k&&g(ua));k--;a=b;0===k&&g(hb);return l}function da(){k++;var l=c;var a=[];if(va.test(d.charAt(c))){var e=d.charAt(c);c++}else e=b,0===k&&
g(wa);if(e!==b)for(;e!==b;)a.push(e),va.test(d.charAt(c))?(e=d.charAt(c),c++):(e=b,0===k&&g(wa));else a=b;a!==b&&(r=l,a=d.substring(r,c));l=a;k--;l===b&&(a=b,0===k&&g(ib));return l}function D(){var l=c;xa.test(d.charAt(c))?(d.charAt(c),c++):0===k&&g(ya);var a=c;var e=[];if(H.test(d.charAt(c))){var h=d.charAt(c);c++}else h=b,0===k&&g(I);for(;h!==b;)e.push(h),H.test(d.charAt(c))?(h=d.charAt(c),c++):(h=b,0===k&&g(I));46===d.charCodeAt(c)?(h=jb,c++):(h=b,0===k&&g(kb));if(h!==b){var B=[];if(H.test(d.charAt(c))){var w=
d.charAt(c);c++}else w=b,0===k&&g(I);if(w!==b)for(;w!==b;)B.push(w),H.test(d.charAt(c))?(w=d.charAt(c),c++):(w=b,0===k&&g(I));else B=b;B!==b?a=e=[e,h,B]:(c=a,a=b)}else c=a,a=b;if(a===b)if(a=[],H.test(d.charAt(c))?(e=d.charAt(c),c++):(e=b,0===k&&g(I)),e!==b)for(;e!==b;)a.push(e),H.test(d.charAt(c))?(e=d.charAt(c),c++):(e=b,0===k&&g(I));else a=b;if(a!==b){e=c;101===d.charCodeAt(c)?(h=lb,c++):(h=b,0===k&&g(mb));if(h!==b){xa.test(d.charAt(c))?(B=d.charAt(c),c++):(B=b,0===k&&g(ya));B===b&&(B=null);w=[];
H.test(d.charAt(c))?(a=d.charAt(c),c++):(a=b,0===k&&g(I));if(a!==b)for(;a!==b;)w.push(a),H.test(d.charAt(c))?(a=d.charAt(c),c++):(a=b,0===k&&g(I));else w=b;w!==b?e=h=[h,B,w]:(c=e,e=b)}else c=e,e=b;e===b&&(e=null);r=l;l=parseFloat(d.substring(r,c))}else c=l,l=b;return l}function Ma(l,a){return l.map(function(e){return e[a]})}p=void 0!==p?p:{};var b={},Ga=p.grammarSource,za={start:x},Aa=x,ca="none",Na=")",ea=",",Ja="(",Pa="%",ha="px",ia="cm",ja="mm",ka="in",la="pt",ma="pc",na="deg",oa="rad",pa="grad",
qa="turn",eb="#",jb=".",lb="e",ta=/^[ \t\n\r]/,va=/^[a-z\-]/,ra=/^[0-9a-fA-F]/,xa=/^[+\-]/,H=/^[0-9]/,Ia=t("none"),Ha=m("none",!1),Oa=m(")",!1),fa=m(",",!1),hb=t("whitespace"),ua=v([" ","\t","\n","\r"],!1,!1),La=t("function"),Ka=m("(",!1),ib=t("identifier"),wa=v([["a","z"],"-"],!1,!1),Ra=t("percentage"),Qa=m("%",!1),Ya=t("length"),Sa=m("px",!1),Ta=m("cm",!1),Ua=m("mm",!1),Va=m("in",!1),Wa=m("pt",!1),Xa=m("pc",!1),cb=t("angle"),Za=m("deg",!1),$a=m("rad",!1),ab=m("grad",!1),bb=m("turn",!1),db=t("number"),
gb=t("color"),fb=m("#",!1),sa=v([["0","9"],["a","f"],["A","F"]],!1,!1),ya=v(["+","-"],!1,!1),I=v([["0","9"]],!1,!1),kb=m(".",!1),mb=m("e",!1),c=0,r=0,Q=[{line:1,column:1}],F=0,U=[],k=0;if("startRule"in p){if(!(p.startRule in za))throw Error("Can't start parsing from rule \""+p.startRule+'".');Aa=za[p.startRule]}p=Aa();if(p!==b&&c===d.length)return p;p!==b&&c<d.length&&g({type:"end"});throw function(l,a,e){return new n(n.buildMessage(l,a),l,a,e)}(U,F<d.length?d.charAt(F):null,F<d.length?u(F,F+1):u(F,
F));}}})})(aa);const R={deg:1,grad:.9,rad:180/Math.PI,turn:360},T={px:1,cm:96/2.54,mm:96/2.54/10,in:96,pc:16,pt:96/72},Da=/^rgba?/i,Ea=/^hsla?/i;X.parse=function(f){if(!f||0===f.length)return null;if("string"===typeof f)return(f=Z(f))&&0!==f.length?f:null;f=f.map(n=>{if(!Number.isFinite(n.scale)||0>=n.scale)throw new z("effect:invalid-scale","scale must be finite and greater than 0",{stop:n});return{scale:n.scale,effects:Z(n.value)}});f.sort((n,q)=>q.effects.length-n.effects.length);for(let n=0;n<
f.length-1;n++){if(!Y.canInterpolateEffects(f[n].effects,f[n+1].effects))throw new z("effect:interpolation-impossible","Cannot interpolate by scale between 2 lists of mixed effects",{a:f[n].effects,b:f[n+1].effects});Y.normalizeEffects(f[n].effects,f[n+1].effects)}f.sort((n,q)=>q.scale-n.scale);return f};Object.defineProperty(X,"__esModule",{value:!0})});