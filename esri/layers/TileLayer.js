// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.22/esri/copyright.txt for details.
//>>built
require({cache:{"esri/layers/mixins/ArcGISCachedService":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../geometry ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ../support/serviceTileInfoProperty ../support/TilemapCache ../../geometry/SpatialReference".split(" "),function(y,k,b,h,u,v,w,
p,G,z,x,K,R){y.ArcGISCachedService=B=>{B=function(H){function T(){var D=H.apply(this,arguments)||this;D.copyright=null;D.minScale=0;D.maxScale=0;D.spatialReference=null;D.tileInfo=null;D.tilemapCache=null;return D}k._inheritsLoose(T,H);var J=T.prototype;J.readMinScale=function(D,V){return null!=V.minLOD&&null!=V.maxLOD?D:0};J.readMaxScale=function(D,V){return null!=V.minLOD&&null!=V.maxLOD?D:0};J.readTilemapCache=function(D,V){return V.capabilities&&-1<V.capabilities.indexOf("Tilemap")?new K.TilemapCache({layer:this}):
null};k._createClass(T,[{key:"supportsBlankTile",get:function(){return 10.2<=this.version}}]);return T}(B);b.__decorate([u.property({json:{read:{source:"copyrightText"}}})],B.prototype,"copyright",void 0);b.__decorate([u.property()],B.prototype,"minScale",void 0);b.__decorate([G.reader("service","minScale")],B.prototype,"readMinScale",null);b.__decorate([u.property()],B.prototype,"maxScale",void 0);b.__decorate([G.reader("service","maxScale")],B.prototype,"readMaxScale",null);b.__decorate([u.property({type:R})],
B.prototype,"spatialReference",void 0);b.__decorate([u.property({readOnly:!0})],B.prototype,"supportsBlankTile",null);b.__decorate([u.property(x.serviceTileInfoProperty)],B.prototype,"tileInfo",void 0);b.__decorate([u.property()],B.prototype,"tilemapCache",void 0);b.__decorate([G.reader("service","tilemapCache",["capabilities"])],B.prototype,"readTilemapCache",null);b.__decorate([u.property()],B.prototype,"version",void 0);return B=b.__decorate([z.subclass("esri.layers.mixins.ArcGISCachedService")],
B)};Object.defineProperty(y,"__esModule",{value:!0})})},"esri/layers/support/serviceTileInfoProperty":function(){define(["exports","./TileInfo"],function(y,k){function b(u,v,w,p){if(!u)return null;const {minScale:G,maxScale:z,minLOD:x,maxLOD:K}=v;if(null!=x&&null!=K)return p&&p.ignoreMinMaxLOD?k.fromJSON(u):k.fromJSON({...u,lods:u.lods.filter(({level:R})=>null!=R&&R>=x&&R<=K)});if(0!==G&&0!==z){const R=G?Math.round(1E4*G)/1E4:Infinity,B=z?Math.round(1E4*z)/1E4:-Infinity;return k.fromJSON({...u,lods:u.lods.filter(H=>
{H=Math.round(1E4*H.scale)/1E4;return H<=R&&H>=B})})}return k.fromJSON(u)}const h={type:k,json:{origins:{service:{read:{source:["tileInfo","minScale","maxScale","minLOD","maxLOD"],reader:b}}}}};y.readServiceTileInfo=b;y.serviceTileInfoProperty=h;Object.defineProperty(y,"__esModule",{value:!0})})},"esri/layers/support/TileInfo":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/jsonMap ../../core/JSONSupport ../../core/maybe ../../core/unitUtils ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/decorators/writer ../../geometry/Point ../../geometry/SpatialReference ../../geometry/support/aaBoundingRect ../../geometry/support/spatialReferenceUtils ../../geometry/support/webMercatorUtils ./LOD".split(" "),
function(y,k,b,h,u,v,w,p,G,z,x,K,R,B,H,T,J,D,V){var U;b=new b.JSONMap({PNG:"png",PNG8:"png8",PNG24:"png24",PNG32:"png32",JPEG:"jpg",JPG:"jpg",DIB:"dib",TIFF:"tiff",EMF:"emf",PS:"ps",PDF:"pdf",GIF:"gif",SVG:"svg",SVGZ:"svgz",Mixed:"mixed",MIXED:"mixed",LERC:"lerc",LERC2D:"lerc2d",RAW:"raw",pbf:"pbf"});h=U=function(t){function E(e){e=t.call(this,e)||this;e.dpi=96;e.format=null;e.origin=null;e.minScale=0;e.maxScale=0;e.size=null;e.spatialReference=null;return e}y._inheritsLoose(E,t);E.create=function(e=
{}){const {resolutionFactor:g=1,scales:d,size:c=256,spatialReference:l=H.WebMercator,numLODs:r=24}=e;if(!J.isValid(l)){e=[];if(d)for(var q=0;q<d.length;q++){var M=d[q];e.push({level:q,scale:M,resolution:M})}else for(q=5E-4,M=r-1;0<=M;M--)e.unshift({level:M,scale:q,resolution:q}),q*=2;return new U({dpi:96,lods:e,origin:new B(0,0,l),size:[c,c],spatialReference:l})}q=J.getInfo(l);e=e.origin?new B({x:e.origin.x,y:e.origin.y,spatialReference:l}):q?new B({x:q.origin[0],y:q.origin[1],spatialReference:l}):
new B({x:0,y:0,spatialReference:l});q=1/(39.37*v.getMetersPerUnitForSR(l)*96);M=[];if(d)for(var P=0;P<d.length;P++){var L=d[P];M.push({level:P,scale:L,resolution:L*q})}else{var S=J.isGeographic(l)?512/c*5.916575275917094E8:256/c*5.91657527591555E8;P=Math.ceil(r/g);M.push({level:0,scale:S,resolution:S*q});for(L=1;L<P;L++)S/=2**g,M.push({level:L,scale:S,resolution:S*q})}return new U({dpi:96,lods:M,origin:e,size:[c,c],spatialReference:l})};var A=E.prototype;A.readOrigin=function(e,g){return B.fromJSON({spatialReference:g.spatialReference,
...e})};A.readSize=function(e,g){return[g.cols,g.rows]};A.writeSize=function(e,g){g.cols=e[0];g.rows=e[1]};A.zoomToScale=function(e){const g=this.scales;if(0>=e)return g[0];if(e>=g.length-1)return g[g.length-1];{const d=Math.floor(e);return g[d]/(g[d]/g[d+1])**(e-d)}};A.scaleToZoom=function(e){const g=this.scales,d=g.length-1;let c=0;for(;c<d;c++){const l=g[c],r=g[c+1];if(l<=e)break;if(r===e)return c+1;if(l>e&&r<e)return c+Math.log(l/e)/Math.log(l/r)}return c};A.snapScale=function(e,g=.95){e=this.scaleToZoom(e);
return e%Math.floor(e)>=g?this.zoomToScale(Math.ceil(e)):this.zoomToScale(Math.floor(e))};A.tileAt=function(e,g,d,c){var l=this.lodAt(e);if(!l)return null;let r;if("number"===typeof g)r=g,g=d;else{if(J.equals(g.spatialReference,this.spatialReference))r=g.x,g=g.y;else{c=D.project(g,this.spatialReference);if(u.isNone(c))return null;r=c.x;g=c.y}c=d}d=l.resolution*this.size[0];l=l.resolution*this.size[1];c||(c={id:null,level:0,row:0,col:0,extent:T.create()});c.level=e;c.row=Math.floor((this.origin.y-
g)/l+.001);c.col=Math.floor((r-this.origin.x)/d+.001);this.updateTileInfo(c);return c};A.updateTileInfo=function(e,g=0){var d=this.lodAt(e.level);d||1!==g||(g=this.lods[this.lods.length-1],g.level<e.level&&(d=g));if(d){var c=e.level-d.level;g=d.resolution*this.size[0]/2**c;d=d.resolution*this.size[1]/2**c;e.id=`${e.level}/${e.row}/${e.col}`;e.extent||(e.extent=T.create());e.extent[0]=this.origin.x+e.col*g;e.extent[1]=this.origin.y-(e.row+1)*d;e.extent[2]=e.extent[0]+g;e.extent[3]=e.extent[1]+d}};
A.upsampleTile=function(e){const g=this._upsampleLevels[e.level];if(!g||-1===g.parentLevel)return!1;e.level=g.parentLevel;e.row=Math.floor(e.row/g.factor+.001);e.col=Math.floor(e.col/g.factor+.001);this.updateTileInfo(e);return!0};A.getTileBounds=function(e,g){var {resolution:d}=this.lodAt(g.level);const c=d*this.size[0];d*=this.size[1];e[0]=this.origin.x+g.col*c;e[1]=this.origin.y-(g.row+1)*d;e[2]=e[0]+c;e[3]=e[1]+d;return e};A.lodAt=function(e){return this._levelToLOD&&this._levelToLOD[e]||null};
A.clone=function(){return U.fromJSON(this.write({}))};A._initializeUpsampleLevels=function(){const e=this.lods;this._upsampleLevels=[];let g=null;for(let d=0;d<e.length;d++){const c=e[d];this._upsampleLevels[c.level]={parentLevel:g?g.level:-1,factor:g?g.resolution/c.resolution:0};g=c}};y._createClass(E,[{key:"isWrappable",get:function(){const {spatialReference:e,origin:g}=this;if(e&&g){const d=J.getInfo(e);return e.isWrappable&&Math.abs(d.origin[0]-g.x)<=d.dx}return!1}},{key:"lods",set:function(e){let g=
0,d=0;const c=[];this._levelToLOD={};e&&(g=-Infinity,d=Infinity,e.forEach(l=>{c.push(l.scale);g=l.scale>g?l.scale:g;d=l.scale<d?l.scale:d;this._levelToLOD[l.level]=l}));this._set("scales",c);this._set("minScale",g);this._set("maxScale",d);this._set("lods",e);this._initializeUpsampleLevels()}}]);return E}(h.JSONSupport);k.__decorate([w.property({type:Number,json:{write:!0}})],h.prototype,"compressionQuality",void 0);k.__decorate([w.property({type:Number,json:{write:!0}})],h.prototype,"dpi",void 0);
k.__decorate([w.property({type:String,json:{read:b.read,write:b.write,origins:{"web-scene":{read:!1,write:!1}}}})],h.prototype,"format",void 0);k.__decorate([w.property({readOnly:!0})],h.prototype,"isWrappable",null);k.__decorate([w.property({type:B,json:{write:!0}})],h.prototype,"origin",void 0);k.__decorate([x.reader("origin")],h.prototype,"readOrigin",null);k.__decorate([w.property({type:[V],value:null,json:{write:!0}})],h.prototype,"lods",null);k.__decorate([w.property({readOnly:!0})],h.prototype,
"minScale",void 0);k.__decorate([w.property({readOnly:!0})],h.prototype,"maxScale",void 0);k.__decorate([w.property({readOnly:!0})],h.prototype,"scales",void 0);k.__decorate([w.property({cast:t=>Array.isArray(t)?t:"number"===typeof t?[t,t]:[256,256]})],h.prototype,"size",void 0);k.__decorate([x.reader("size",["rows","cols"])],h.prototype,"readSize",null);k.__decorate([R.writer("size",{cols:{type:z.Integer},rows:{type:z.Integer}})],h.prototype,"writeSize",null);k.__decorate([w.property({type:H,json:{write:!0}})],
h.prototype,"spatialReference",void 0);return h=U=k.__decorate([K.subclass("esri.layers.support.TileInfo")],h)})},"esri/layers/support/LOD":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass".split(" "),function(y,k,b,h,u,v,w,p){var G;b=G=function(z){function x(K){K=z.call(this,
K)||this;K.cols=null;K.level=0;K.levelValue=null;K.origin=null;K.resolution=0;K.rows=null;K.scale=0;return K}y._inheritsLoose(x,z);x.prototype.clone=function(){return new G({cols:this.cols,level:this.level,levelValue:this.levelValue,resolution:this.resolution,rows:this.rows,scale:this.scale})};return x}(b.JSONSupport);k.__decorate([h.property({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],b.prototype,"cols",void 0);k.__decorate([h.property({type:w.Integer,
json:{write:!0}})],b.prototype,"level",void 0);k.__decorate([h.property({type:String,json:{write:!0}})],b.prototype,"levelValue",void 0);k.__decorate([h.property({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],b.prototype,"origin",void 0);k.__decorate([h.property({type:Number,json:{write:!0}})],b.prototype,"resolution",void 0);k.__decorate([h.property({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],b.prototype,
"rows",void 0);k.__decorate([h.property({type:Number,json:{write:!0}})],b.prototype,"scale",void 0);return b=G=k.__decorate([p.subclass("esri.layers.support.LOD")],b)})},"esri/layers/support/TilemapCache":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../request ../../core/Accessor ../../core/Error ../../core/HandleOwner ../../core/Logger ../../core/LRUCache ../../core/PooledArray ../../core/promiseUtils ../../core/scheduling ../../core/urlUtils ../../core/watchUtils ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/cast ../../core/accessorSupport/decorators/subclass ./Tilemap".split(" "),
function(y,k,b,h,u,v,w,p,G,z,x,K,R,B,H,T,J,D,V,U){var t;const E=p.getLogger("esri.layers.support.TilemapCache");y.TilemapCache=t=function(A){function e(d){d=A.call(this,d)||this;d._pendingTilemapRequests={};d._availableLevels={};d.levels=5;d.cacheByteSize=2097152;d.request=h;d._prefetchingEnabled=!0;return d}k._inheritsLoose(e,A);var g=e.prototype;g.initialize=function(){this._tilemapCache=new G(this.cacheByteSize);this.handles.add([this.watch(["layer.parsedUrl","layer.tileServers?","layer.apiKey?",
"layer.customParameters?"],()=>this._initializeTilemapDefinition()),B.init(this,"layer.tileInfo.lods",d=>this._initializeAvailableLevels(d),!0)]);this._initializeTilemapDefinition()};g.castLevels=function(d){return 2>=d?(E.error("Minimum levels for Tilemap is 3, but got ",d),3):d};g.fetchTilemap=function(d,c,l,r){if(!this._availableLevels[d])return Promise.reject(new v("tilemap-cache:level-unavailable",`Level ${d} is unavailable in the service`));const q=this._tmpTilemapDefinition;if(d=this._tilemapFromCache(d,
c,l,q))return Promise.resolve(d);const M=r&&r.signal;r={...r,signal:null};return new Promise((P,L)=>{x.onAbort(M,()=>L(x.createAbortError()));const S=U.tilemapDefinitionId(q);let Y=this._pendingTilemapRequests[S];if(!Y){Y=U.Tilemap.fromDefinition(q,r).then(W=>{this._tilemapCache.put(S,W,W.byteSize);return W});const N=()=>delete this._pendingTilemapRequests[S];this._pendingTilemapRequests[S]=Y;Y.then(N,N)}Y.then(P,L)})};g.getAvailability=function(d,c,l){return this._availableLevels[d]?(d=this._tilemapFromCache(d,
c,l,this._tmpTilemapDefinition))?d.getAvailability(c,l):"unknown":"unavailable"};g.fetchAvailability=function(d,c,l,r){return this._availableLevels[d]?this.fetchTilemap(d,c,l,r).catch(q=>q).then(q=>{if(q instanceof U.Tilemap)return q=q.getAvailability(c,l),"unavailable"===q?Promise.reject(new v("tile-map:tile-unavailable","Tile is not available",{level:d,row:c,col:l})):q;if(x.isAbortError(q))throw q;return"unknown"}):Promise.reject(new v("tilemap-cache:level-unavailable",`Level ${d} is unavailable in the service`))};
g.fetchAvailabilityUpsample=function(d,c,l,r,q){r.level=d;r.row=c;r.col=l;const M=this.layer.tileInfo;M.updateTileInfo(r);const P=this.fetchAvailability(d,c,l,q).catch(L=>{if(x.isAbortError(L))throw L;if(M.upsampleTile(r))return this.fetchAvailabilityUpsample(r.level,r.row,r.col,r);throw L;});this._fetchAvailabilityUpsamplePrefetch(r.id,d,c,l,q,P);return P};g._fetchAvailabilityUpsamplePrefetch=function(){var d=k._asyncToGenerator(function*(c,l,r,q,M,P){if(this._prefetchingEnabled){var L=`prefetch-${c}`;
if(!this.handles.has(L)){var S=new AbortController;P.then(()=>S.abort(),()=>S.abort());var Y=!1;this.handles.add({remove(){Y||(Y=!0,S.abort())}},L);yield K.waitTicks(10,S.signal).catch(()=>{});Y||(Y=!0,this.handles.remove(L));if(!x.isAborted(S))for(c={id:c,level:l,row:r,col:q},M={...M,signal:S.signal},l=this.layer.tileInfo,r=0;t._prefetches.length<t._maxPrefetch&&l.upsampleTile(c);++r){const N=this.fetchAvailability(c.level,c.row,c.col,M);t._prefetches.push(N);q=()=>{t._prefetches.removeUnordered(N)};
N.then(q,q)}}}});return function(c,l,r,q,M,P){return d.apply(this,arguments)}}();g._initializeTilemapDefinition=function(){var d;if(this.layer.parsedUrl){var {parsedUrl:c,apiKey:l,customParameters:r}=this.layer;this._tilemapCache.clear();this._tmpTilemapDefinition={service:{url:c.path,query:R.objectToQuery({...c.query,...r,token:null!=l?l:null==(d=c.query)?void 0:d.token}),tileServers:this.layer.tileServers,request:this.request,type:this.layer.type},width:this.size,height:this.size,level:0,row:0,
col:0}}};g._tilemapFromCache=function(d,c,l,r){r.level=d;r.row=c-c%this.size;r.col=l-l%this.size;d=U.tilemapDefinitionId(r);return this._tilemapCache.get(d)};g._initializeAvailableLevels=function(d){this._availableLevels={};d&&d.forEach(c=>this._availableLevels[c.level]=!0)};k._createClass(e,[{key:"size",get:function(){return 1<<this.levels}},{key:"test",get:function(){const d=this;return{get prefetchingEnabled(){return d._prefetchingEnabled},set prefetchingEnabled(c){d._prefetchingEnabled=c},hasTilemap(c,
l,r){return!!d._tilemapFromCache(c,l,r,d._tmpTilemapDefinition)}}}}]);return e}(w.HandleOwnerMixin(u));y.TilemapCache._maxPrefetch=4;y.TilemapCache._prefetches=new z({initialSize:t._maxPrefetch});b.__decorate([H.property({constructOnly:!0,type:Number})],y.TilemapCache.prototype,"levels",void 0);b.__decorate([D.cast("levels")],y.TilemapCache.prototype,"castLevels",null);b.__decorate([H.property({readOnly:!0,type:Number})],y.TilemapCache.prototype,"size",null);b.__decorate([H.property({constructOnly:!0,
type:Number})],y.TilemapCache.prototype,"cacheByteSize",void 0);b.__decorate([H.property({constructOnly:!0})],y.TilemapCache.prototype,"layer",void 0);b.__decorate([H.property({constructOnly:!0})],y.TilemapCache.prototype,"request",void 0);y.TilemapCache=t=b.__decorate([V.subclass("esri.layers.support.TilemapCache")],y.TilemapCache);Object.defineProperty(y,"__esModule",{value:!0})})},"esri/layers/support/Tilemap":function(){define(["exports","../../request","../../core/arrayUtils","../../core/Error",
"../../core/lang"],function(y,k,b,h,u){function v(p){if("vector-tile"===p.service.type)var G=`${p.service.url}/tilemap/${p.level}/${p.row}/${p.col}/${p.width}/${p.height}`;else G=p.service.tileServers,G=`${G&&G.length?G[p.row%G.length]:p.service.url}/tilemap/${p.level}/${p.row}/${p.col}/${p.width}/${p.height}`;(p=p.service.query)&&(G=`${G}?${p}`);return G}let w=function(){function p(){this.location={left:0,top:0,width:0,height:0};this._allAvailability="unknown";this.byteSize=40}var G=p.prototype;
G.getAvailability=function(z,x){if("unknown"!==this._allAvailability)return this._allAvailability;z=(z-this.location.top)*this.location.width+(x-this.location.left);x=z>>3;const K=this._tileAvailabilityBitSet;return 0>x||x>K.length?"unknown":K[x]&1<<z%8?"available":"unavailable"};G._updateFromData=function(z){let x=!0,K=!0;const R=new Uint8Array(Math.ceil(this.location.width*this.location.height/8));let B=0;for(let H=0;H<z.length;H++){const T=H%8;z[H]?(K=!1,R[B]|=1<<T):x=!1;7===T&&++B}K?this._allAvailability=
"unavailable":x?this._allAvailability="available":(this._allAvailability="unknown",this._tileAvailabilityBitSet=R,this.byteSize+=R.length)};p.fromDefinition=function(z,x){const K=z.service.request||k,{row:R,col:B,width:H,height:T}=z,J={query:{f:"json"}};x=x?{...J,...x}:J;return K(v(z),x).then(D=>D.data).catch(D=>{if(D&&D.details&&422===D.details.httpStatus)return{location:{top:R,left:B,width:H,height:T},valid:!0,data:b.constant(H*T,0)};throw D;}).then(D=>{if(D.location&&(D.location.top!==R||D.location.left!==
B||D.location.width!==H||D.location.height!==T))throw new h("tilemap:location-mismatch","Tilemap response for different location than requested",{response:D,definition:{top:R,left:B,width:H,height:T}});return p.fromJSON(D)})};p.fromJSON=function(z){p.validateJSON(z);const x=new p;x.location=Object.freeze(u.clone(z.location));x._updateFromData(z.data);return Object.freeze(x)};p.validateJSON=function(z){if(!z||!z.location)throw new h("tilemap:missing-location","Location missing from tilemap response");
if(!1===z.valid)throw new h("tilemap:invalid","Tilemap response was marked as invalid");if(!z.data)throw new h("tilemap:missing-data","Data missing from tilemap response");if(!Array.isArray(z.data))throw new h("tilemap:data-mismatch","Data must be an array of numbers");if(z.data.length!==z.location.width*z.location.height)throw new h("tilemap:data-mismatch","Number of data items does not match width/height of tilemap");};return p}();y.Tilemap=w;y.default=w;y.tilemapDefinitionId=function(p){return`${p.level}/${p.row}/${p.col}/${p.width}/${p.height}`};
Object.defineProperty(y,"__esModule",{value:!0})})},"esri/layers/mixins/ArcGISMapService":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../request ../../core/promiseUtils ../../core/urlUtils ../../core/Version ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ../../geometry/Extent ../../geometry/SpatialReference ../support/commonProperties".split(" "),
function(y,k,b,h,u,v,w,p,G,z,x,K,R,B,H,T){y.ArcGISMapService=J=>{J=function(D){function V(){var t=D.apply(this,arguments)||this;t.capabilities=void 0;t.copyright=null;t.fullExtent=null;t.legendEnabled=!0;t.spatialReference=null;t.version=null;return t}k._inheritsLoose(V,D);var U=V.prototype;U.readCapabilities=function(t,E){var A=E.capabilities&&E.capabilities.split(",").map(M=>M.toLowerCase().trim());if(!A)return{operations:{supportsQuery:!1,supportsExportMap:!1,supportsExportTiles:!1,supportsTileMap:!1},
exportMap:null,exportTiles:null};var e=this.type;t=-1!==A.indexOf("query");const g=-1!==A.indexOf("map"),d=!!E.exportTilesAllowed;A=-1!==A.indexOf("tilemap");const c="tile"!==e&&!!E.supportsDynamicLayers,l="tile"!==e&&(!E.tileInfo||c),r="tile"!==e&&(!E.tileInfo||c);e="tile"!==e;const q=E.cimVersion?w.Version.parse(E.cimVersion).since(1,4):!1;return{operations:{supportsQuery:t,supportsExportMap:g,supportsExportTiles:d,supportsTileMap:A},exportMap:g?{supportsArcadeExpressionForLabeling:q,supportsSublayersChanges:e,
supportsDynamicLayers:c,supportsSublayerVisibility:l,supportsSublayerDefinitionExpression:r}:null,exportTiles:d?{maxExportTilesCount:+E.maxExportTilesCount}:null}};U.readVersion=function(t,E){(t=E.currentVersion)||(t=E.hasOwnProperty("capabilities")||E.hasOwnProperty("tables")?10:E.hasOwnProperty("supportedImageFormatTypes")?9.31:9.3);return t};U.fetchSublayerInfo=function(){var t=k._asyncToGenerator(function*(E,A){yield this.fetchAllLayersAndTables(A);return this._allLayersAndTablesMap.get(E)});
return function(E,A){return t.apply(this,arguments)}}();U.fetchAllLayersAndTables=function(){var t=k._asyncToGenerator(function*(E){yield this.load(E);this._allLayersAndTablesPromise||(this._allLayersAndTablesPromise=h(v.urlToObject(this.url).path+"/layers",{responseType:"json",query:{f:"json",...this.customParameters,token:this.apiKey}}).then(e=>{this._allLayersAndTablesMap=new Map;for(const g of e.data.layers)this._allLayersAndTablesMap.set(g.id,g);return{result:e.data}},e=>({error:e})));const A=
yield this._allLayersAndTablesPromise;u.throwIfAborted(E);if("result"in A)return A.result;throw A.error;});return function(E){return t.apply(this,arguments)}}();return V}(J);b.__decorate([p.property({readOnly:!0})],J.prototype,"capabilities",void 0);b.__decorate([K.reader("service","capabilities",["capabilities","exportTilesAllowed","maxExportTilesCount","supportsDynamicLayers","tileInfo"])],J.prototype,"readCapabilities",null);b.__decorate([p.property({json:{read:{source:"copyrightText"}}})],J.prototype,
"copyright",void 0);b.__decorate([p.property({type:B})],J.prototype,"fullExtent",void 0);b.__decorate([p.property(T.id)],J.prototype,"id",void 0);b.__decorate([p.property({type:Boolean,json:{origins:{service:{read:{enabled:!1}}},read:{source:"showLegend"},write:{target:"showLegend"}}})],J.prototype,"legendEnabled",void 0);b.__decorate([p.property(T.popupEnabled)],J.prototype,"popupEnabled",void 0);b.__decorate([p.property({type:H})],J.prototype,"spatialReference",void 0);b.__decorate([p.property()],
J.prototype,"version",void 0);b.__decorate([K.reader("version",["currentVersion","capabilities","tables","supportedImageFormatTypes"])],J.prototype,"readVersion",null);return J=b.__decorate([R.subclass("esri.layers.mixins.ArcGISMapService")],J)};Object.defineProperty(y,"__esModule",{value:!0})})},"esri/core/Version":function(){define(["exports","./Error"],function(y,k){let b=function(){function h(v,w,p=""){this.major=v;this.minor=w;this._context=p}var u=h.prototype;u.lessThan=function(v,w){return this.major<
v||v===this.major&&this.minor<w};u.since=function(v,w){return!this.lessThan(v,w)};u.validate=function(v){if(this.major!==v.major)throw new k((this._context&&this._context+":")+"unsupported-version",`Required major ${this._context&&this._context+" "}version is '${this.major}', but got '\${version.major}.\${version.minor}'`,{version:v});};u.clone=function(){return new h(this.major,this.minor,this._context)};h.parse=function(v,w=""){const [p,G]=v.split(".");var z=/^\s*\d+\s*$/;if(!p||!p.match||!p.match(z))throw new k((w&&
w+":")+"invalid-version","Expected major version to be a number, but got '${version}'",{version:v});if(!G||!G.match||!G.match(z))throw new k((w&&w+":")+"invalid-version","Expected minor version to be a number, but got '${version}'",{version:v});v=parseInt(p,10);z=parseInt(G,10);return new h(v,z,w)};return h}();y.Version=b;Object.defineProperty(y,"__esModule",{value:!0})})},"esri/layers/mixins/SublayersOwner":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Collection ../../core/CollectionFlattener ../../core/Error ../../core/Logger ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/utils ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/PropertyOrigin ../support/Sublayer ../support/sublayerUtils".split(" "),
function(y,k,b,h,u,v,w,p,G,z,x,K,R,B,H,T){function J(t,E){const A=[],e={};if(!t)return A;t.forEach(g=>{const d=new H;d.read(g,E);e[d.id]=d;null!=g.parentLayerId&&-1!==g.parentLayerId?(g=e[g.parentLayerId],g.sublayers||(g.sublayers=[]),g.sublayers.unshift(d)):A.unshift(d)});return A}function D(t,E){t&&t.forEach(A=>{E(A);A.sublayers&&A.sublayers.length&&D(A.sublayers,E)})}const V=w.getLogger("esri.layers.TileLayer"),U=h.ofType(H);y.SublayersOwner=t=>{t=function(E){function A(...g){var d=E.call(this,
...g)||this;d.allSublayers=new u({getCollections:()=>[d.sublayers],getChildrenFunction(c){return c.sublayers}});d.sublayersSourceJSON={[2]:{},[3]:{},[4]:{},[5]:{}};d.handles.add(d.watch("sublayers",(c,l)=>d._handleSublayersChange(c,l),!0));return d}k._inheritsLoose(A,E);var e=A.prototype;e.readSublayers=function(g,d){if(d&&g){var {sublayersSourceJSON:c}=this,l=B.nameToId(d.origin);if(!(2>l||(c[l]={context:d,visibleLayers:g.visibleLayers||c[l].visibleLayers,layers:g.layers||c[l].layers},2<l))){this._set("serviceSublayers",
this.createSublayersForOrigin("service").sublayers);var {sublayers:r,origin:q}=this.createSublayersForOrigin("web-document");g=x.getProperties(this);g.setDefaultOrigin(q);this._set("sublayers",new U(r));g.setDefaultOrigin("user")}}};e.findSublayerById=function(g){return this.allSublayers.find(d=>d.id===g)};e.createServiceSublayers=function(){return this.createSublayersForOrigin("service").sublayers};e.createSublayersForOrigin=function(g){const d="web-document"===g?B.nameToId("web-map"):B.nameToId(g);
let c=2;g=this.sublayersSourceJSON[2].layers;let l=this.sublayersSourceJSON[2].context,r=null;var q=[3,4,5].filter(N=>N<=d);for(var M of q)q=this.sublayersSourceJSON[M],T.isSublayerOverhaul(q.layers)&&(c=M,g=q.layers,l=q.context,q.visibleLayers&&(r={visibleLayers:q.visibleLayers,context:q.context}));M=[3,4,5].filter(N=>N>c&&N<=d);let P=null;for(var L of M){const {layers:N,visibleLayers:W,context:n}=this.sublayersSourceJSON[L];N&&(P={layers:N,context:n});W&&(r={visibleLayers:W,context:n})}L=J(g,l);
const S=new Map,Y=new Set;if(P)for(const N of P.layers)S.set(N.id,N);if(r)for(const N of r.visibleLayers)Y.add(N);D(L,N=>{P&&N.read(S.get(N.id),P.context);r&&N.read({defaultVisibility:Y.has(N.id)},r.context)});return{origin:B.idToName(c),sublayers:new U({items:L})}};e.read=function(g,d){E.prototype.read.call(this,g,d);this.readSublayers(g,d)};e._handleSublayersChange=function(g,d){d&&(d.forEach(c=>{c.parent=null;c.layer=null}),this.handles.remove("sublayers-owner"));g&&(g.forEach(c=>{c.parent=this;
c.layer=this}),this.handles.add([g.on("after-add",({item:c})=>{c.parent=this;c.layer=this}),g.on("after-remove",({item:c})=>{c.parent=null;c.layer=null})],"sublayers-owner"),"tile"===this.type&&this.handles.add(g.on("before-changes",c=>{V.error(new v("tilelayer:sublayers-non-modifiable","ISublayer can't be added, moved, or removed from the layer's sublayers",{layer:this}));c.preventDefault()}),"sublayers-owner"))};return A}(t);b.__decorate([p.property({readOnly:!0})],t.prototype,"allSublayers",void 0);
b.__decorate([p.property({readOnly:!0,type:h.ofType(H)})],t.prototype,"serviceSublayers",void 0);b.__decorate([p.property({value:null,type:U,json:{read:!1,write:{allowNull:!0,ignoreOrigin:!0}}})],t.prototype,"sublayers",void 0);b.__decorate([p.property({readOnly:!0})],t.prototype,"sublayersSourceJSON",void 0);return t=b.__decorate([R.subclass("esri.layers.mixins.SublayersOwner")],t)};y.forEachSublayer=D;Object.defineProperty(y,"__esModule",{value:!0})})},"esri/layers/support/Sublayer":function(){define("require ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../geometry ../../PopupTemplate ../../renderers/ClassBreaksRenderer ../../renderers/DictionaryRenderer ../../renderers/DotDensityRenderer ../../renderers/HeatmapRenderer ../../renderers/Renderer ../../renderers/SimpleRenderer ../../renderers/UniqueValueRenderer ../../renderers/support/jsonUtils ../../renderers/support/types ../../request ../../symbols ../../core/Collection ../../core/Error ../../core/HandleOwner ../../core/Identifiable ../../core/lang ../../core/Loadable ../../core/Logger ../../core/maybe ../../core/MultiOriginJSONSupport ../../core/urlUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/utils ../../core/accessorSupport/decorators/cast ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/decorators/writer ../../core/accessorSupport/ensureType ../../core/accessorSupport/PropertyOrigin ./FeatureType ./Field ./FieldsIndex ./LabelClass ./LayerFloorInfo ./source/DataLayerSource ./source/MapLayerSource ../../rest/support/Query ../../support/popupUtils ../../views/support/floorFilterUtils ../../geometry/Extent".split(" "),
function(y,k,b,h,u,v,w,p,G,z,x,K,R,B,H,T,J,D,V,U,t,E,A,e,g,d,c,l,r,q,M,P,L,S,Y,N,W,n,I,X,aa,ca,la,ea,ra){function ma(Q){return Q&&"esriSMS"===Q.type}function na(Q,ba,C){var a;Q=this.originIdOf(ba)>=S.nameToId(C.origin);return{ignoreOrigin:!0,allowNull:Q,enabled:C?"map-image"===(null==(a=C.layer)?void 0:a.type)&&(C.writeSublayerStructure||Q):!1}}function qa(Q,ba,C){var a;return{enabled:C?"tile"===(null==(a=C.layer)?void 0:a.type)&&this._isOverridden(ba):!1}}function da(Q,ba,C){return{ignoreOrigin:!0,
enabled:C&&C.writeSublayerStructure||!1}}function ja(Q,ba,C){return{ignoreOrigin:!0,enabled:C?C.writeSublayerStructure||this.originIdOf(ba)>=S.nameToId(C.origin):!1}}var ka;const oa=A.getLogger("esri.layers.support.Sublayer");let sa=0;const ha=new Set;ha.add("layer");ha.add("parent");ha.add("loaded");ha.add("loadStatus");ha.add("loadError");ha.add("loadWarnings");h=ka=function(Q){function ba(a){a=Q.call(this,a)||this;a.capabilities=void 0;a.fields=null;a.fullExtent=null;a.globalIdField=null;a.legendEnabled=
!0;a.objectIdField=null;a.popupEnabled=!0;a.popupTemplate=null;a.sourceJSON=null;a.title=null;a.typeIdField=null;a.types=null;return a}k._inheritsLoose(ba,Q);var C=ba.prototype;C.load=function(){var a=k._asyncToGenerator(function*(f){var m=this;this.addResolvingPromise(k._asyncToGenerator(function*(){var F;if(!m.layer&&!m.url)throw new D("sublayer:missing-layer","Sublayer can't be loaded without being part of a layer",{sublayer:m});let O=null;if(!m.layer||2<m.originIdOf("url")||"data-layer"===(null==
(F=m.source)?void 0:F.type))O=(yield H(m.url,{responseType:"json",query:{f:"json"},...f})).data;else{var Z;F=m.id;"map-layer"===(null==(Z=m.source)?void 0:Z.type)&&(F=m.source.mapLayerId);O=yield m.layer.fetchSublayerInfo(F,f)}O&&(m.sourceJSON=O,m.read({layerDefinition:O},{origin:"service"}))})());return this});return function(f){return a.apply(this,arguments)}}();C.readCapabilities=function(a,f){f=f.layerDefinition||f;a=(a=f.capabilities||a)?a.toLowerCase().split(",").map(m=>m.trim()):[];return{exportMap:{supportsModification:!!f.canModifyLayer},
operations:{supportsQuery:-1!==a.indexOf("query")}}};C.readGlobalIdFieldFromService=function(a,f){f=f.layerDefinition||f;if(f.globalIdField)return f.globalIdField;if(f.fields)for(const m of f.fields)if("esriFieldTypeGlobalID"===m.type)return m.name};C.writeLabelingInfo=function(a,f,m,F){a&&a.length&&(f.layerDefinition={drawingInfo:{labelingInfo:a.map(O=>O.write({},F))}})};C.readMinScale=function(a,f){return f.minScale||f.layerDefinition&&f.layerDefinition.minScale||0};C.readMaxScale=function(a,f){return f.maxScale||
f.layerDefinition&&f.layerDefinition.maxScale||0};C.readObjectIdFieldFromService=function(a,f){f=f.layerDefinition||f;if(f.objectIdField)return f.objectIdField;if(f.fields)for(const m of f.fields)if("esriFieldTypeOID"===m.type)return m.name};C.readOpacity=function(a,f){a=f.layerDefinition;return 1-.01*(null!=a.transparency?a.transparency:a.drawingInfo.transparency)};C.writeOpacity=function(a,f,m,F){f.layerDefinition={drawingInfo:{transparency:100-100*a}}};C.writeParent=function(a,f){f.parentLayerId=
this.parent&&this.parent!==this.layer?L.ensureInteger(this.parent.id):-1};C.castSublayers=function(a){return L.ensureType(J.ofType(ka),a)};C.writeSublayers=function(a,f,m){this.get("sublayers.length")&&(f[m]=this.sublayers.map(F=>F.id).toArray().reverse())};C.readTypeIdField=function(a,f){f=f.layerDefinition||f;let m=f.typeIdField;m&&f.fields&&(m=m.toLowerCase(),a=f.fields.find(F=>F.name.toLowerCase()===m))&&(m=a.name);return null};C.writeVisible=function(a,f,m,F){f[m]=this.getAtOrigin("defaultVisibility",
"service")||a};C.clone=function(){const {store:a}=l.getProperties(this),f=new ka;l.getProperties(f).store=a.clone(ha);this.commitProperty("url");f._lastParsedUrl=this._lastParsedUrl;return f};C.createPopupTemplate=function(a){return la.createPopupTemplate(this,a)};C.createQuery=function(){return new ca({returnGeometry:!0,where:this.definitionExpression||"1\x3d1"})};C.createFeatureLayer=function(){var a=k._asyncToGenerator(function*(){var f,m;if(this.hasOwnProperty("sublayers"))return null;const F=
null==(f=this.layer)?void 0:f.parsedUrl;f=new (yield new Promise((O,Z)=>y(["../FeatureLayer"],fa=>O(Object.freeze({__proto__:null,default:fa})),Z))).default({url:F.path});F&&this.source&&("map-layer"===this.source.type?f.layerId=this.source.mapLayerId:f.dynamicDataSource=this.source);null!=this.layer.refreshInterval&&(f.refreshInterval=this.layer.refreshInterval);this.definitionExpression&&(f.definitionExpression=this.definitionExpression);this.floorInfo&&(f.floorInfo=t.clone(this.floorInfo));2<this.originIdOf("labelingInfo")&&
(f.labelingInfo=t.clone(this.labelingInfo));0<this.originIdOf("labelsVisible")&&(f.labelsVisible=this.labelsVisible);0<this.originIdOf("legendEnabled")&&(f.legendEnabled=this.legendEnabled);0<this.originIdOf("visible")&&(f.visible=this.visible);0<this.originIdOf("minScale")&&(f.minScale=this.minScale);0<this.originIdOf("maxScale")&&(f.maxScale=this.maxScale);0<this.originIdOf("opacity")&&(f.opacity=this.opacity);0<this.originIdOf("popupTemplate")&&(f.popupTemplate=t.clone(this.popupTemplate));2<this.originIdOf("renderer")&&
(f.renderer=t.clone(this.renderer));"data-layer"===(null==(m=this.source)?void 0:m.type)&&(f.dynamicDataSource=this.source.clone());0<this.originIdOf("title")&&(f.title=this.title);"map-image"===this.layer.type&&0<this.layer.originIdOf("customParameters")&&(f.customParameters=this.layer.customParameters);"tile"===this.layer.type&&0<this.layer.originIdOf("customParameters")&&(f.customParameters=this.layer.customParameters);return f});return function(){return a.apply(this,arguments)}}();C.getField=
function(a){return this.fieldsIndex.get(a)};C.getFeatureType=function(a){const {typeIdField:f,types:m}=this;if(!f||!a)return null;const F=a.attributes?a.attributes[f]:void 0;if(null==F)return null;let O=null;m.some(Z=>{const {id:fa}=Z;if(null==fa)return!1;fa.toString()===F.toString()&&(O=Z);return!!O});return O};C.getFieldDomain=function(a,f){return(f=this.getFeatureType(f&&f.feature))&&(f=f.domains&&f.domains[a])&&"inherited"!==f.type?f:this._getLayerDomain(a)};C.queryFeatures=function(){var a=k._asyncToGenerator(function*(f=
this.createQuery(),m){var F,O,Z,fa;yield this.load();if(!this.get("capabilities.operations.supportsQuery"))throw new D("Sublayer.queryFeatures","this layer doesn't support queries.");const [{executeQuery:ta},{default:ua}]=yield Promise.all([new Promise((ia,pa)=>y(["../../rest/query/operations/query"],ia,pa)),new Promise((ia,pa)=>y(["../../rest/support/FeatureSet"],va=>ia(Object.freeze({__proto__:null,default:va})),pa))]);f=yield ta(this.url,ca.from(f),null!=(F=null==(O=this.layer)?void 0:O.spatialReference)?
F:null,{...m,query:{...null==(Z=this.layer)?void 0:Z.customParameters,token:null==(fa=this.layer)?void 0:fa.apiKey}});F=ua.fromJSON(f.data);if(null!=F&&F.features)for(const ia of F.features)ia.sourceLayer=this;return F});return function(){return a.apply(this,arguments)}}();C.toExportImageJSON=function(a){var f;const m={id:this.id,source:(null==(f=this.source)?void 0:f.toJSON())||{mapLayerId:this.id,type:"mapLayer"}};this.definitionExpression?(a=e.isSome(a)?ea.combineFloorsDefinitionExpression(a,this):
this.definitionExpression,m.definitionExpression=a):e.isSome(a)&&(m.definitionExpression=a);const F=["renderer","labelingInfo","opacity","labelsVisible"].reduce((O,Z)=>{O[Z]=this.originIdOf(Z);return O},{});Object.keys(F).some(O=>2<F[O])&&(a=m.drawingInfo={},2<F.renderer&&(a.renderer=this.renderer?this.renderer.toJSON():null),2<F.labelsVisible&&(a.showLabels=this.labelsVisible),this.labelsVisible&&2<F.labelingInfo&&(a.labelingInfo=this.labelingInfo?this.labelingInfo.map(O=>O.write({},{origin:"service",
layer:this.layer})):null,a.showLabels=!0),2<F.opacity&&(a.transparency=100-100*this.opacity),this._assignDefaultSymbolColors(a.renderer));return m};C._assignDefaultSymbolColors=function(a){this._forEachSimpleMarkerSymbols(a,f=>{f.color||"esriSMSX"!==f.style&&"esriSMSCross"!==f.style||(f.color=f.outline&&f.outline.color?f.outline.color:[0,0,0,0])})};C._forEachSimpleMarkerSymbols=function(a,f){if(a){const m="uniqueValueInfos"in a?a.uniqueValueInfos:"classBreakInfos"in a?a.classBreakInfos:[];for(const F of m)ma(F.symbol)&&
f(F.symbol);"symbol"in a&&ma(a.symbol)&&f(a.symbol);"defaultSymbol"in a&&ma(a.defaultSymbol)&&f(a.defaultSymbol)}};C._setAndNotifyLayer=function(a,f){const m=this.layer,F=this._get(a);let O,Z;switch(a){case "definitionExpression":case "floorInfo":O="supportsSublayerDefinitionExpression";case "minScale":case "maxScale":case "visible":O="supportsSublayerVisibility";break;case "labelingInfo":case "labelsVisible":case "opacity":case "renderer":case "source":O="supportsDynamicLayers",Z="supportsModification"}const fa=
l.getProperties(this).getDefaultOrigin();if("service"!==fa){if(O&&!1===this.get(`layer.capabilities.exportMap.${O}`)){this._logLockedError(a,`capability not available 'layer.capabilities.exportMap.${O}'`);return}if(Z&&!1===this.get(`capabilities.exportMap.${Z}`)){this._logLockedError(a,`capability not available 'capabilities.exportMap.${Z}'`);return}}"source"===a&&"not-loaded"!==this.loadStatus?this._logLockedError(a,"'source' can't be changed after calling sublayer.load()"):(this._set(a,f),"service"!==
fa&&F!==f&&m&&m.emit&&m.emit("sublayer-update",{propertyName:a,target:this}))};C._handleSublayersChange=function(a,f){f&&(f.forEach(m=>{m.parent=null;m.layer=null}),this.handles.removeAll());a&&(a.forEach(m=>{m.parent=this;m.layer=this.layer}),this.handles.add([a.on("after-add",({item:m})=>{m.parent=this;m.layer=this.layer}),a.on("after-remove",({item:m})=>{m.parent=null;m.layer=null}),a.on("before-changes",m=>{const F=this.get("layer.capabilities.exportMap.supportsSublayersChanges");null==F||F||
(oa.error(new D("sublayer:sublayers-non-modifiable","Sublayer can't be added, moved, or removed from the layer's sublayers",{sublayer:this,layer:this.layer})),m.preventDefault())})]))};C._logLockedError=function(a,f){oa.error(new D("sublayer:locked",`Property '${a}' can't be changed on Sublayer from the layer '${this.layer.id}'`,{reason:f,sublayer:this,layer:this.layer}))};C._getLayerDomain=function(a){return(a=this.fieldsIndex.get(a))?a.domain:null};k._createClass(ba,[{key:"definitionExpression",
set:function(a){this._setAndNotifyLayer("definitionExpression",a)}},{key:"fieldsIndex",get:function(){return new W(this.fields||[])}},{key:"floorInfo",set:function(a){this._setAndNotifyLayer("floorInfo",a)}},{key:"id",get:function(){const a=this._get("id");return null==a?sa++:a},set:function(a){this._get("id")!==a&&(!1===this.get("layer.capabilities.exportMap.supportsDynamicLayers")?this._logLockedError("id","capability not available 'layer.capabilities.exportMap.supportsDynamicLayers'"):this._set("id",
a))}},{key:"labelingInfo",set:function(a){this._setAndNotifyLayer("labelingInfo",a)}},{key:"labelsVisible",set:function(a){this._setAndNotifyLayer("labelsVisible",a)}},{key:"layer",set:function(a){this._set("layer",a);this.sublayers&&this.sublayers.forEach(f=>f.layer=a)}},{key:"listMode",set:function(a){this._set("listMode",a)}},{key:"minScale",set:function(a){this._setAndNotifyLayer("minScale",a)}},{key:"maxScale",set:function(a){this._setAndNotifyLayer("maxScale",a)}},{key:"opacity",set:function(a){this._setAndNotifyLayer("opacity",
a)}},{key:"defaultPopupTemplate",get:function(){return this.createPopupTemplate()}},{key:"renderer",set:function(a){if(a)for(const f of a.getSymbols())if(T.isSymbol3D(f)){oa.warn("Sublayer renderer should use 2D symbols");break}this._setAndNotifyLayer("renderer",a)}},{key:"source",get:function(){return this._get("source")||new aa.MapLayerSource({mapLayerId:this.id})},set:function(a){this._setAndNotifyLayer("source",a)}},{key:"sublayers",set:function(a){this._handleSublayersChange(a,this._get("sublayers"));
this._set("sublayers",a)}},{key:"url",get:function(){var a,f;const m=null!=(a=null==(f=this.layer)?void 0:f.parsedUrl)?a:this._lastParsedUrl;a=this.source;if(!m)return null;this._lastParsedUrl=m;if("map-layer"===(null==a?void 0:a.type))return`${m.path}/${a.mapLayerId}`;a={layer:JSON.stringify({source:this.source})};return`${m.path}/dynamicLayer?${d.objectToQuery(a)}`},set:function(a){a?this._override("url",a):this._clearOverride("url")}},{key:"visible",set:function(a){this._setAndNotifyLayer("visible",
a)}}]);return ba}(V.HandleOwnerMixin(g.MultiOriginJSONMixin(U.IdentifiableMixin(E))));h.test={isMapImageLayerOverridePolicy:Q=>Q===da||Q===na,isTileImageLayerOverridePolicy:Q=>Q===qa};b.__decorate([c.property({readOnly:!0})],h.prototype,"capabilities",void 0);b.__decorate([q.reader("service","capabilities",["layerDefinition.canModifyLayer","layerDefinition.capabilities"])],h.prototype,"readCapabilities",null);b.__decorate([c.property({type:String,value:null,json:{name:"layerDefinition.definitionExpression",
write:{allowNull:!0,overridePolicy:na}}})],h.prototype,"definitionExpression",null);b.__decorate([c.property({type:[N],json:{origins:{service:{read:{source:"layerDefinition.fields"}}}}})],h.prototype,"fields",void 0);b.__decorate([c.property({readOnly:!0})],h.prototype,"fieldsIndex",null);b.__decorate([c.property({type:I,value:null,json:{name:"layerDefinition.floorInfo",read:{source:"layerDefinition.floorInfo"},write:{target:"layerDefinition.floorInfo",overridePolicy:na},origins:{"web-scene":{read:!1,
write:!1}}}})],h.prototype,"floorInfo",null);b.__decorate([c.property({type:ra,json:{read:{source:"layerDefinition.extent"}}})],h.prototype,"fullExtent",void 0);b.__decorate([c.property({type:String})],h.prototype,"globalIdField",void 0);b.__decorate([q.reader("service","globalIdField",["layerDefinition.globalIdField","layerDefinition.fields"])],h.prototype,"readGlobalIdFieldFromService",null);b.__decorate([c.property({type:L.Integer,json:{write:{ignoreOrigin:!0}}})],h.prototype,"id",null);b.__decorate([c.property({value:null,
type:[n],json:{read:{source:"layerDefinition.drawingInfo.labelingInfo"},write:{target:"layerDefinition.drawingInfo.labelingInfo",overridePolicy:da}}})],h.prototype,"labelingInfo",null);b.__decorate([P.writer("labelingInfo")],h.prototype,"writeLabelingInfo",null);b.__decorate([c.property({type:Boolean,value:!0,json:{read:{source:"layerDefinition.drawingInfo.showLabels"},write:{target:"layerDefinition.drawingInfo.showLabels",overridePolicy:da}}})],h.prototype,"labelsVisible",null);b.__decorate([c.property({value:null})],
h.prototype,"layer",null);b.__decorate([c.property({type:Boolean,value:!0,json:{origins:{service:{read:{enabled:!1}}},read:{source:"showLegend"},write:{target:"showLegend",overridePolicy:ja}}})],h.prototype,"legendEnabled",void 0);b.__decorate([c.property({type:["show","hide","hide-children"],value:"show",json:{read:!1,write:!1,origins:{"web-scene":{read:!0,write:!0}}}})],h.prototype,"listMode",null);b.__decorate([c.property({type:Number,value:0,json:{write:{overridePolicy:da}}})],h.prototype,"minScale",
null);b.__decorate([q.reader("minScale",["minScale","layerDefinition.minScale"])],h.prototype,"readMinScale",null);b.__decorate([c.property({type:Number,value:0,json:{write:{overridePolicy:da}}})],h.prototype,"maxScale",null);b.__decorate([q.reader("maxScale",["maxScale","layerDefinition.maxScale"])],h.prototype,"readMaxScale",null);b.__decorate([c.property({type:String})],h.prototype,"objectIdField",void 0);b.__decorate([q.reader("service","objectIdField",["layerDefinition.objectIdField","layerDefinition.fields"])],
h.prototype,"readObjectIdFieldFromService",null);b.__decorate([c.property({type:Number,value:1,json:{write:{target:"layerDefinition.drawingInfo.transparency",overridePolicy:da}}})],h.prototype,"opacity",null);b.__decorate([q.reader("opacity",["layerDefinition.drawingInfo.transparency","layerDefinition.transparency"])],h.prototype,"readOpacity",null);b.__decorate([P.writer("opacity")],h.prototype,"writeOpacity",null);b.__decorate([c.property({json:{type:L.Integer,write:{target:"parentLayerId",writerEnsuresNonNull:!0,
overridePolicy:da}}})],h.prototype,"parent",void 0);b.__decorate([P.writer("parent")],h.prototype,"writeParent",null);b.__decorate([c.property({type:Boolean,value:!0,json:{read:{source:"disablePopup",reader(Q,ba){return!ba.disablePopup}},write:{target:"disablePopup",overridePolicy:ja,writer(Q,ba,C){ba[C]=!Q}}}})],h.prototype,"popupEnabled",void 0);b.__decorate([c.property({type:u,json:{read:{source:"popupInfo"},write:{target:"popupInfo",overridePolicy:ja}}})],h.prototype,"popupTemplate",void 0);b.__decorate([c.property({readOnly:!0})],
h.prototype,"defaultPopupTemplate",null);b.__decorate([c.property({types:B.rendererTypes,value:null,json:{name:"layerDefinition.drawingInfo.renderer",write:{overridePolicy:da},origins:{"web-scene":{types:B.webSceneRendererTypes,name:"layerDefinition.drawingInfo.renderer",write:{overridePolicy:da}}}}})],h.prototype,"renderer",null);b.__decorate([c.property({types:{key:"type",base:null,typeMap:{"data-layer":X.DataLayerSource,"map-layer":aa.MapLayerSource}},cast(Q){if(Q){if("mapLayerId"in Q)return L.ensureClass(aa.MapLayerSource,
Q);if("dataSource"in Q)return L.ensureClass(X.DataLayerSource,Q)}return Q},json:{name:"layerDefinition.source",write:{overridePolicy:da}}})],h.prototype,"source",null);b.__decorate([c.property()],h.prototype,"sourceJSON",void 0);b.__decorate([c.property({value:null,json:{type:[L.Integer],write:{target:"subLayerIds",allowNull:!0,overridePolicy:da}}})],h.prototype,"sublayers",null);b.__decorate([r.cast("sublayers")],h.prototype,"castSublayers",null);b.__decorate([P.writer("sublayers")],h.prototype,
"writeSublayers",null);b.__decorate([c.property({type:String,json:{name:"name",write:{overridePolicy:ja}}})],h.prototype,"title",void 0);b.__decorate([c.property({type:String})],h.prototype,"typeIdField",void 0);b.__decorate([q.reader("typeIdField",["layerDefinition.typeIdField"])],h.prototype,"readTypeIdField",null);b.__decorate([c.property({type:[Y],json:{origins:{service:{read:{source:"layerDefinition.types"}}}}})],h.prototype,"types",void 0);b.__decorate([c.property({type:String,json:{read:{source:"layerUrl"},
write:{target:"layerUrl",overridePolicy:qa}}})],h.prototype,"url",null);b.__decorate([c.property({type:Boolean,value:!0,json:{read:{source:"defaultVisibility"},write:{target:"defaultVisibility",overridePolicy:da}}})],h.prototype,"visible",null);b.__decorate([P.writer("visible")],h.prototype,"writeVisible",null);return h=ka=b.__decorate([M.subclass("esri.layers.support.Sublayer")],h)})},"esri/layers/support/sublayerUtils":function(){define(["exports"],function(y){function k(b,h){if(!b||!b.length)return!0;
h=h.slice().reverse().flatten(({sublayers:w})=>w&&w.toArray().reverse()).map(w=>w.id).toArray();if(b.length>h.length)return!1;let u=0;const v=h.length;for(const {id:w}of b){for(;u<v&&h[u]!==w;)u++;if(u>=v)return!1}return!0}y.isExportDynamic=function(b,h,u){return b.some(v=>{const w=v.source;return!(!w||"map-layer"===w.type&&w.mapLayerId===v.id&&(!w.gdbVersion||w.gdbVersion===u.gdbVersion))||2<v.originIdOf("renderer")||2<v.originIdOf("labelingInfo")||2<v.originIdOf("opacity")||2<v.originIdOf("labelsVisible")})?
!0:!k(b,h)};y.isSublayerOverhaul=function(b){return!!b&&b.some(h=>null!=h.minScale||h.layerDefinition&&null!=h.layerDefinition.minScale)};y.shouldWriteSublayerStructure=function(b,h,u){return h.flatten(({sublayers:v})=>v).length!==b.length||b.some(v=>v.originIdOf("minScale")>u||v.originIdOf("maxScale")>u||v.originIdOf("renderer")>u||v.originIdOf("labelingInfo")>u||v.originIdOf("opacity")>u||v.originIdOf("labelsVisible")>u||v.originIdOf("source")>u)?!0:!k(b,h)};Object.defineProperty(y,"__esModule",
{value:!0})})},"*noref":1}});
define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../geometry ../request ../core/Error ../core/HandleOwner ../core/maybe ../core/MultiOriginJSONSupport ../core/promiseUtils ../core/urlUtils ../core/accessorSupport/decorators/property ../core/arrayUtils ../core/has ../core/accessorSupport/decorators/cast ../core/accessorSupport/decorators/reader ../core/accessorSupport/decorators/subclass ../core/accessorSupport/decorators/writer ./Layer ./mixins/APIKeyMixin ./mixins/ArcGISCachedService ./mixins/ArcGISMapService ./mixins/ArcGISService ./mixins/BlendLayer ./mixins/CustomParametersMixin ./mixins/OperationalLayer ./mixins/PortalLayer ./mixins/RefreshableLayer ./mixins/ScaleRangeLayer ./mixins/SublayersOwner ./support/arcgisLayerUrl ./support/commonProperties ./support/Sublayer ../geometry/SpatialReference".split(" "),function(y,
k,b,h,u,v,w,p,G,z,x,K,R,B,H,T,J,D,V,U,t,E,A,e,g,d,c,l,r,q,M,P,L){const S="Canvas/World_Dark_Gray_Base Canvas/World_Dark_Gray_Reference Canvas/World_Light_Gray_Base Canvas/World_Light_Gray_Reference Elevation/World_Hillshade Elevation/World_Hillshade_Dark Ocean/World_Ocean_Base Ocean/World_Ocean_Reference Ocean_Basemap Reference/World_Boundaries_and_Places Reference/World_Boundaries_and_Places_Alternate Reference/World_Transportation World_Imagery World_Street_Map World_Topo_Map".split(" ");b=function(Y){function N(...n){n=
Y.call(this,...n)||this;n.listMode="show";n.isReference=null;n.operationalLayerType="ArcGISTiledMapServiceLayer";n.resampling=!0;n.sourceJSON=null;n.spatialReference=null;n.path=null;n.sublayers=null;n.type="tile";n.url=null;return n}y._inheritsLoose(N,Y);var W=N.prototype;W.normalizeCtorArgs=function(n,I){return"string"===typeof n?{url:n,...I}:n};W.load=function(n){const I=w.isSome(n)?n.signal:null;this.addResolvingPromise(this.loadFromPortal({supportedTypes:["Map Service"]},n).catch(G.throwIfAbortError).then(()=>
this._fetchService(I)));return Promise.resolve(this)};W.readSpatialReference=function(n,I){return(n=n||I.tileInfo&&I.tileInfo.spatialReference)&&L.fromJSON(n)};W.writeSublayers=function(n,I,X,aa){if(this.loaded&&n){n=n.slice().reverse().flatten(({sublayers:ea})=>ea&&ea.toArray().reverse()).toArray();var ca=[],la={writeSublayerStructure:!1,...aa};n.forEach(ea=>{ea=ea.write({},la);ca.push(ea)});ca.some(ea=>1<Object.keys(ea).length)&&(I.layers=ca)}};W.castTileServers=function(n){return Array.isArray(n)?
n.map(I=>z.urlToObject(I).path):null};W.fetchTile=function(n,I,X,aa={}){({signal:aa}=aa);n=this.getTileUrl(n,I,X);return h(n,{responseType:"image",signal:aa,query:{...this.refreshParameters}}).then(ca=>ca.data)};W.getTileUrl=function(n,I,X){const aa=z.objectToQuery({...this.parsedUrl.query,blankTile:!this.tilemapCache&&this.supportsBlankTile?!1:null,...this.customParameters,token:this.apiKey}),ca=this.tileServers;return`${ca&&ca.length?ca[I%ca.length]:this.parsedUrl.path}/tile/${n}/${I}/${X}${aa?
"?"+aa:""}`};W._fetchService=function(n){return(new Promise((I,X)=>{if(this.sourceJSON){if(null!=this.sourceJSON.bandCount&&null!=this.sourceJSON.pixelSizeX)throw new u("tile-layer:unsupported-url","use ImageryTileLayer to open a tiled image service");I({data:this.sourceJSON})}else{if(!this.parsedUrl)throw new u("tile-layer:undefined-url","layer's url is not defined");var aa=q.parse(this.parsedUrl.path);if(w.isSome(aa)&&"ImageServer"===aa.serverType)throw new u("tile-layer:unsupported-url","use ImageryTileLayer to open a tiled image service");
h(this.parsedUrl.path,{query:{f:"json",...this.parsedUrl.query,...this.customParameters,token:this.apiKey},responseType:"json",signal:n}).then(I,X)}})).then(I=>{I.ssl&&(this.url=this.url.replace(/^http:/i,"https:"));this.sourceJSON=I.data;this.read(I.data,{origin:"service",url:this.parsedUrl});if(10.1===this.version&&!q.isHostedAgolService(this.url))return this._fetchServerVersion(this.url,n).then(X=>{this.read({currentVersion:X})}).catch(()=>{})})};W._fetchServerVersion=function(n,I){if(!q.isArcGISUrl(n))return Promise.reject();
n=n.replace(/(.*\/rest)\/.*/i,"$1")+"/info";return h(n,{query:{f:"json",...this.customParameters,token:this.apiKey},responseType:"json",signal:I}).then(X=>{if(X.data&&X.data.currentVersion)return X.data.currentVersion;throw new u("tile-layer:version-not-available");})};W._getMapName=function(n){return(n=n.match(/^(?:https?:)?\/\/(server\.arcgisonline\.com|services\.arcgisonline\.com|ibasemaps-api\.arcgis\.com)\/arcgis\/rest\/services\/([^\/]+(\/[^\/]+)*)\/mapserver/i))&&n[2]};W._getDefaultAttribution=
function(n){if(n){n=n.toLowerCase();for(let X=0,aa=S.length;X<aa;X++){var I=S[X];if(-1<I.toLowerCase().indexOf(n))return z.makeAbsolute("//static.arcgis.com/attribution/"+I)}}};W._getDefaultTileServers=function(n){const I=-1!==n.search(/^(?:https?:)?\/\/server\.arcgisonline\.com/i),X=-1!==n.search(/^(?:https?:)?\/\/services\.arcgisonline\.com/i);return I||X?[n,n.replace(I?/server\.arcgisonline/i:/services\.arcgisonline/i,I?"services.arcgisonline":"server.arcgisonline")]:[]};y._createClass(N,[{key:"attributionDataUrl",
get:function(){var n;const I=null==(n=this.parsedUrl)?void 0:n.path.toLowerCase();return I&&this._getDefaultAttribution(this._getMapName(I))}},{key:"tileServers",get:function(){return this._getDefaultTileServers(this.parsedUrl.path)}},{key:"hasOverriddenFetchTile",get:function(){return!this.fetchTile.__isDefault__}}]);return N}(A.BlendLayer(r.SublayersOwner(l.ScaleRangeLayer(g.OperationalLayer(d.PortalLayer(U.ArcGISCachedService(t.ArcGISMapService(E.ArcGISService(p.MultiOriginJSONMixin(v.HandleOwnerMixin(c.RefreshableLayer(V.APIKeyMixin(e.CustomParametersMixin(D))))))))))))));
k.__decorate([x.property({readOnly:!0})],b.prototype,"attributionDataUrl",null);k.__decorate([x.property({type:["show","hide","hide-children"]})],b.prototype,"listMode",void 0);k.__decorate([x.property({type:Boolean,json:{read:!1,write:{enabled:!0,overridePolicy:()=>({enabled:!1})}}})],b.prototype,"isReference",void 0);k.__decorate([x.property({readOnly:!0,type:["ArcGISTiledMapServiceLayer"]})],b.prototype,"operationalLayerType",void 0);k.__decorate([x.property({type:Boolean})],b.prototype,"resampling",
void 0);k.__decorate([x.property()],b.prototype,"sourceJSON",void 0);k.__decorate([x.property({type:L})],b.prototype,"spatialReference",void 0);k.__decorate([H.reader("spatialReference",["spatialReference","tileInfo"])],b.prototype,"readSpatialReference",null);k.__decorate([x.property({type:String,json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],b.prototype,"path",void 0);k.__decorate([x.property({readOnly:!0})],b.prototype,"sublayers",void 0);k.__decorate([J.writer("sublayers",{layers:{type:[P]}})],
b.prototype,"writeSublayers",null);k.__decorate([x.property({json:{read:!1,write:!1}})],b.prototype,"popupEnabled",void 0);k.__decorate([x.property()],b.prototype,"tileServers",null);k.__decorate([B.cast("tileServers")],b.prototype,"castTileServers",null);k.__decorate([x.property({readOnly:!0,json:{read:!1}})],b.prototype,"type",void 0);k.__decorate([x.property(M.url)],b.prototype,"url",void 0);b=k.__decorate([T.subclass("esri.layers.TileLayer")],b);b.prototype.fetchTile.__isDefault__=!0;return b});