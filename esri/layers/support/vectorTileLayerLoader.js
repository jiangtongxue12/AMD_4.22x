// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.22/esri/copyright.txt for details.
//>>built
define("exports ../../chunks/_rollupPluginBabelHelpers ../../config ../../request ../../core/promiseUtils ../../core/urlUtils ../../views/2d/engine/vectorTiles/style/VectorTileSource".split(" "),function(y,q,z,D,E,k,F){function t(){t=q._asyncToGenerator(function*(a,c){const b={source:null,sourceBase:null,sourceUrl:null,validatedSource:null,style:null,styleBase:null,styleUrl:null,sourceNameToSource:{},primarySourceName:"",spriteFormat:"png"},[g,e]="string"===typeof a?[a,null]:[null,a.jsonUrl];yield m(b,
"esri",a,e,c);a={layerDefinition:b.validatedSource,url:g,serviceUrl:b.sourceUrl,style:b.style,styleUrl:b.styleUrl,spriteUrl:b.style.sprite&&n(b.styleBase,b.style.sprite),spriteFormat:b.spriteFormat,glyphsUrl:b.style.glyphs&&n(b.styleBase,b.style.glyphs),sourceNameToSource:b.sourceNameToSource,primarySourceName:b.primarySourceName};p(a.spriteUrl);p(a.glyphsUrl);return a});return t.apply(this,arguments)}function p(a){a&&(a=k.getOrigin(a),u&&!u.includes(a)&&u.push(a))}function n(...a){let c=void 0;for(let b=
0;b<a.length;++b)k.isProtocolRelative(a[b])?c&&(c=c.split("://")[0]+":"+a[b].trim()):c=k.isAbsolute(a[b])?a[b]:k.join(c,a[b]);return k.removeTrailingSlash(c)}function m(a,c,b,g,e){return v.apply(this,arguments)}function v(){v=q._asyncToGenerator(function*(a,c,b,g,e){E.throwIfAborted(e);let d,h;if("string"===typeof b){b=k.normalize(b);p(b);var f=yield D(b,{...e,responseType:"json",query:{f:"json",...null==e?void 0:e.query}});f.ssl&&(d&&(d=d.replace(/^http:/i,"https:")),h&&(h=h.replace(/^http:/i,"https:")));
h=d=b}else f={data:b},d=b.jsonUrl||null,h=g;f=f.data;return f.sources?(a.styleUrl=d||null,G(a,f,h,e)):f.sources?Promise.reject("You must specify the URL or the JSON for a service or for a style."):a.sourceUrl?A(a,f,h,!1,c,e):(a.sourceUrl=d||null,A(a,f,h,!0,c,e))});return v.apply(this,arguments)}function G(a,c,b,g){return w.apply(this,arguments)}function w(){w=q._asyncToGenerator(function*(a,c,b,g){b=b?k.removeFile(b):k.appBaseUrl;a.styleBase=b;a.style=c;a.styleUrl&&p(a.styleUrl);c["sprite-format"]&&
"webp"===c["sprite-format"].toLowerCase()&&(a.spriteFormat="webp");const e=[];if(c.sources&&c.sources.esri){const d=c.sources.esri;d.url?yield m(a,"esri",n(b,d.url),void 0,g):e.push(m(a,"esri",d,b,g))}for(const d of Object.keys(c.sources))"esri"!==d&&"vector"===c.sources[d].type&&(c.sources[d].url?e.push(m(a,d,n(b,c.sources[d].url),void 0,g)):c.sources[d].tiles&&e.push(m(a,d,c.sources[d],b,g)));yield Promise.all(e)});return w.apply(this,arguments)}function A(a,c,b,g,e,d){return x.apply(this,arguments)}
function x(){x=q._asyncToGenerator(function*(a,c,b,g,e,d){b=b?k.removeTrailingSlash(b)+"/":k.appBaseUrl;if(c.hasOwnProperty("tileInfo"))var h=c;else{var f={xmin:-2.0037507067161843E7,ymin:-2.0037507067161843E7,xmax:2.0037507067161843E7,ymax:2.0037507067161843E7,spatialReference:{wkid:102100}},l=78271.51696400007,B=2.958287637957775E8,C=[],H=c.hasOwnProperty("minzoom")?+c.minzoom:0,I=c.hasOwnProperty("maxzoom")?+c.maxzoom:22;for(let r=0;r<=I;r++)r>=H&&C.push({level:r,scale:B,resolution:l}),l/=2,B/=
2;for(h of c.tiles)p(n(b,h));h={capabilities:"TilesOnly",initialExtent:f,fullExtent:f,minScale:0,maxScale:0,tiles:c.tiles,tileInfo:{rows:512,cols:512,dpi:96,format:"pbf",origin:{x:-2.0037508342787E7,y:2.0037508342787E7},lods:C,spatialReference:{wkid:102100}}}}f=new F(e,k.addQueryParameters(b,null==d?void 0:d.query),h);if(!g&&a.primarySourceName in a.sourceNameToSource){l=a.sourceNameToSource[a.primarySourceName];if(!l.isCompatibleWith(f))return Promise.resolve();null!=f.fullExtent&&(null!=l.fullExtent?
l.fullExtent.union(f.fullExtent):l.fullExtent=f.fullExtent.clone());l.tileInfo.lods.length<f.tileInfo.lods.length&&(l.tileInfo=f.tileInfo)}g?(a.sourceBase=b,a.source=c,a.validatedSource=h,a.primarySourceName=e,a.sourceUrl&&p(a.sourceUrl)):p(b);a.sourceNameToSource[e]=f;if(!a.style)return null==c.defaultStyles?Promise.reject():"string"===typeof c.defaultStyles?m(a,"",n(b,c.defaultStyles,"root.json"),void 0,d):m(a,"",c.defaultStyles,n(b,"root.json"),d)});return x.apply(this,arguments)}const u=z.defaults&&
z.defaults.io.corsEnabledServers;y.loadMetadata=function(a,c){return t.apply(this,arguments)};Object.defineProperty(y,"__esModule",{value:!0})});