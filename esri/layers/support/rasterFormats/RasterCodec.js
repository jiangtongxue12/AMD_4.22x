// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.22/esri/copyright.txt for details.
//>>built
define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/Error ../PixelBlock ./ImageCanvasDecoder ./JpgPlus ../../../chunks/TiffDecoder ../../../chunks/LercCodec ./Lzw ../../../chunks/Zlib ./Raw ./utils".split(" "),function(A,F,y,w,M,N,C,O,P,G,Q,H){function R(a,c){if(!H.isPlatformLittleEndian)throw new y("rasterCoded:decode","lerc decoder is not supported on big endian platform");const {width:m,height:l,pixelType:r}=c;var b=I(r);const f=b.pixelTypeCtor;c=null==c.noDataValue?b.noDataValue:
c.noDataValue;b=0;let e,d=0,h;const k=a.byteLength-10;for(;d<k;){var g=O.decode(a,{inputOffset:d,encodedMaskData:e,returnMask:0===b?!0:!1,returnEncodedMask:0===b?!0:!1,returnFileInfo:!0,pixelType:f,noDataValue:c});if(m&&l&&(g.width!==m||g.height!==l))throw new y("rasterCoded:decode","lerc decoded result has width or height different from specified in options");d=g.fileInfo.eofOffset;0===b&&(e=g.encodedMaskData,h=new w({width:g.width,height:g.height,pixels:[],pixelType:r,mask:g.maskData,statistics:[]}));
b++;h.addData({pixels:g.pixelData,statistics:{minValue:g.minValue,maxValue:g.maxValue,noDataValue:g.noDataValue}});10<k-d&&(g=String.fromCharCode.apply(null,new Uint8Array(a,d,10)),d+=-1<g.indexOf("CntZ")?g.indexOf("CntZ"):0)}return h}function J(a,c){if(!H.isPlatformLittleEndian)throw new y("rasterCoded:decode","lerc decoder is not supported on big endian platform");var m=0,l=c.offset||0,r=0;let b;let f;const e=c.eof||a.byteLength-10,d=[],{width:h,height:k}=c;for(c=0;l<e;){var g;var n=C.Lerc2Codec.decode(a,
{inputOffset:l,maskData:b,returnFileInfo:!0});if(h&&k&&(n.width!==h||n.height!==k))throw new y("rasterCoded:decode","lerc2 decoded result has width or height different from what's specified in options");l=n.fileInfo.eofOffset;b=n.maskData;0===m&&(r=n.fileInfo.numValidPixel,f=new w({width:n.width,height:n.height,pixels:[],pixelType:n.fileInfo.pixelType,mask:b,statistics:[]}));n.fileInfo.mask&&0<n.fileInfo.mask.numBytes&&c++;b&&d.push(b);if(1<n.dimCount&&(null==(g=n.pixelData)?void 0:g.length)===n.width*
n.height*n.dimCount){var p,q,t,u;n.pixelData=n.pixelData.slice(-n.width*n.height);const B=null==(p=n.dimStats)?void 0:null==(q=p.minValues)?void 0:q[n.dimCount-1],v=null==(t=n.dimStats)?void 0:null==(u=t.maxValues)?void 0:u[n.dimCount-1];null!=B&&null!=v&&(n.minValue=B,n.maxValue=v)}m++;f.addData({pixels:n.pixelData,statistics:{minValue:n.minValue,maxValue:n.maxValue}});10<e-l&&(n=String.fromCharCode.apply(null,new Uint8Array(a,l,10)),l+=-1<n.indexOf("Lerc")?n.indexOf("Lerc"):0)}l=m=a=0;if(1<c){l=
f.width*f.height;b=new Uint8Array(l);b.set(d[0]);for(a=1;a<d.length;a++)for(r=d[a],m=0;m<l;m++)b[m]&=r[m];for(m=r=0;m<l;m++)r+=b[m];f.mask=b}f.validPixelCount=r;return f}function S(a,c){a=C.decode(a,c.pyramidLevel||0);a=new w({width:a.width,height:a.height,pixels:a.pixels,pixelType:a.pixelType.toLowerCase(),mask:a.mask,statistics:null});a.updateStatistics();return a}function K(a,c){const m=c.pixelType||"u8",l=w.getPixelArrayConstructor(m),r="u8"===m?a:new l(a.buffer),b=[],f=c.planes||1;if(1===f)b.push(r);
else for(let e=0;e<f;e++){const d=(c.width||1)*(c.height||a.length),h=new l(d);for(let k=0;k<d;k++)h[k]=r[k*f+e];b.push(h)}a=new w({width:c.width||1,height:c.height||a.length,pixels:b,pixelType:m,statistics:null});a.updateStatistics();return a}function T(a,c){a=(new G.Zlib(new Uint8Array(a))).getBytes();return K(a,c)}function U(a,c){a=P.decode(a,c.offset,c.eof,!c.isInputBigEndian);return K(a,c)}function V(a){a=N.decode(a);a=new w({width:a.width,height:a.height,pixels:a.pixels,pixelType:"U8",mask:a.mask,
statistics:null});a.updateStatistics();return a}function W(a,c){a=new Uint8Array(a);a=new X(a);const {width:m,height:l}=c;c=m*l;a=a.decode();let r=0;var b=0;let f;b=new Uint8Array(c);for(r=0;r<c;r++)b[r]=a[4*r+3];const e=new w({width:m,height:l,pixels:[],pixelType:"U8",mask:b,statistics:[]});for(r=0;3>r;r++){f=new Uint8Array(c);for(b=0;b<c;b++)f[b]=a[4*b+r];e.addData({pixels:f})}e.updateStatistics();return e}function Y(a,c,m,l){return D.apply(this,arguments)}function D(){D=F._asyncToGenerator(function*(a,
c,m,l){a=yield(new M).decode(a,{applyJpegMask:!1,format:c,...m},l);a=new w(a);a.updateStatistics();return a});return D.apply(this,arguments)}function L(a){if(null==a)throw new y("rasterCodec:decode","parameter encodeddata is required.");a=new Uint8Array(a,0,10);let c="";255===a[0]&&216===a[1]?c="jpg":137===a[0]&&80===a[1]&&78===a[2]&&71===a[3]?c="png":67===a[0]&&110===a[1]&&116===a[2]&&90===a[3]&&73===a[4]&&109===a[5]&&97===a[6]&&103===a[7]&&101===a[8]&&32===a[9]?c="lerc":76===a[0]&&101===a[1]&&114===
a[2]&&99===a[3]&&50===a[4]&&32===a[5]?c="lerc2":73===a[0]&&73===a[1]&&42===a[2]&&0===a[3]||77===a[0]&&77===a[1]&&0===a[2]&&42===a[3]||73===a[0]&&73===a[1]&&43===a[2]&&0===a[3]||77===a[0]&&77===a[1]&&0===a[2]&&43===a[3]?c="tiff":71===a[0]&&73===a[1]&&70===a[2]?c="gif":66===a[0]&&77===a[1]?c="bmp":-1<String.fromCharCode.apply(null,a).toLowerCase().indexOf("error")&&(c="error");return c}function Z(a){let c=null;switch(a){case "lerc":c=R;break;case "lerc2":c=J;break;case "jpg":c=V;break;case "png":c=
W;break;case "bsq":case "bip":c=(m,l)=>{{const {pixelTypeCtor:r}=I(l.pixelType),b=Q.decode;m=b(m,{width:l.width,height:l.height,pixelType:r,format:a});l=new w({width:l.width,height:l.height,pixels:m.pixels,pixelType:l.pixelType,mask:m.mask,statistics:null});l.updateStatistics()}return l};break;case "tiff":c=S;break;case "deflate":c=T;break;case "lzw":c=U;break;case "error":c=()=>{throw new y("rasterCodec:decode","input data contains error");};break;default:c=()=>{throw new y("rasterCodec:decode",
"unsupported raster format");}}return c}function I(a){let c=null,m=null;switch(a?a.toLowerCase():"f32"){case "u1":case "u2":case "u4":case "u8":m=255;c=Uint8Array;break;case "u16":m=m||65535;c=Uint16Array;break;case "u32":m=m||2**32-1;c=Uint32Array;break;case "s8":m=m||-128;c=Int8Array;break;case "s16":m=m||-32768;c=Int16Array;break;case "s32":m=m||-(2**31);c=Int32Array;break;default:c=Float32Array}return{pixelTypeCtor:c,noDataValue:m}}function aa(a,c=1){if(a){var {pixels:m,width:l,height:r,mask:b}=
a;if(m&&0!==m.length){var f=m.length,e=l-1,d=r-1,h=[],k,g,n=w.getPixelArrayConstructor(a.pixelType);if(0===c){for(c=0;c<f;c++){var p=m[c];var q=new n(e*d);for(k=0;k<d;k++){var t=k*l;for(g=0;g<e;g++)q[k*e+g]=p[t+g]}h.push(q)}if(b){var u=new Uint8Array(e*d);for(k=0;k<d;k++)for(t=k*l,g=0;g<e;g++)u[k*e+g]=b[t+g]}}else{for(c=0;c<f;c++){p=m[c];q=new n(e*d);for(k=0;k<d;k++)for(t=k*l,g=0;g<e;g++)q[k*e+g]=(p[t+g]+p[t+g+1]+p[t+l+g]+p[t+l+g+1])/4;h.push(q)}if(b)for(u=new Uint8Array(e*d),k=0;k<d;k++)for(t=k*
l,g=0;g<e;g++)u[k*e+g]=Math.min.apply(null,[b[t+g],b[t+g+1],b[t+l+g],b[t+l+g+1]])}a.width=e;a.height=d;a.mask=u;a.pixels=h}}}function E(){E=F._asyncToGenerator(function*(a,c={},m){if(null==a)throw new y("rasterCodec:decode","missing encodeddata parameter.");let l=c.format&&c.format.toLowerCase();if(!("bsq"!==l&&"bip"!==l||null!=c.width&&null!=c.height))throw new y("rasterCodec:decode","requires width and height in options parameter.");if("tiff"===l&&c.customOptions)return c=C.decodeTileOrStrip(a,
c.customOptions),c=new w({width:c.width,height:c.height,pixels:c.pixels,pixelType:c.pixelType.toLowerCase(),mask:c.mask,statistics:null}),c.updateStatistics(),c;if(!l||"bsq"!==l&&"bip"!==l&&"deflate"!==l&&"lzw"!==l)l=L(a);c.useCanvas&&ba.has(l)?a=yield Y(a,l,c,m):(m=Z(l),c.isPoint&&(c={...c},c.width++,c.height++),a=m(a,c),c.isPoint&&aa(a));return a});return E.apply(this,arguments)}var X=function(a){function c(b){var f,e;this.data=b;this.pos=8;this.palette=[];this.imgData=[];this.transparency={};this.animation=
null;this.text={};for(e=null;;){var d=this.readUInt32();var h=b=void 0;b=[];for(h=0;4>h;++h)b.push(String.fromCharCode(this.data[this.pos++]));b=b.join("");switch(b){case "IHDR":this.width=this.readUInt32();this.height=this.readUInt32();this.bits=this.data[this.pos++];this.colorType=this.data[this.pos++];this.compressionMethod=this.data[this.pos++];this.filterMethod=this.data[this.pos++];this.interlaceMethod=this.data[this.pos++];break;case "acTL":this.animation={numFrames:this.readUInt32(),numPlays:this.readUInt32()||
Infinity,frames:[]};break;case "PLTE":this.palette=this.read(d);break;case "fcTL":e&&this.animation.frames.push(e);this.pos+=4;e={width:this.readUInt32(),height:this.readUInt32(),xOffset:this.readUInt32(),yOffset:this.readUInt32()};b=this.readUInt16();d=this.readUInt16()||100;e.delay=1E3*b/d;e.disposeOp=this.data[this.pos++];e.blendOp=this.data[this.pos++];e.data=[];break;case "IDAT":case "fdAT":"fdAT"===b&&(this.pos+=4,d-=4);b=(null!=e?e.data:void 0)||this.imgData;for(h=0;0<=d?h<d:h>d;0<=d?++h:--h)b.push(this.data[this.pos++]);
break;case "tRNS":this.transparency={};switch(this.colorType){case 3:this.transparency.indexed=this.read(d);d=255-this.transparency.indexed.length;if(0<d)for(b=0;0<=d?b<d:b>d;0<=d?++b:--b)this.transparency.indexed.push(255);break;case 0:this.transparency.grayscale=this.read(d)[0];break;case 2:this.transparency.rgb=this.read(d)}break;case "tEXt":h=this.read(d);d=h.indexOf(0);b=String.fromCharCode.apply(String,h.slice(0,d));this.text[b]=String.fromCharCode.apply(String,h.slice(d+1));break;case "IEND":e&&
this.animation.frames.push(e);a:{switch(this.colorType){case 0:case 3:case 4:e=1;break a;case 2:case 6:e=3;break a}e=void 0}this.colors=e;this.hasAlphaChannel=4===(f=this.colorType)||6===f;f=this.colors+(this.hasAlphaChannel?1:0);this.pixelBitlength=this.bits*f;a:{switch(this.colors){case 1:f="DeviceGray";break a;case 3:f="DeviceRGB";break a}f=void 0}this.colorSpace=f;this.imgData=new Uint8Array(this.imgData);return;default:this.pos+=d}this.pos+=4;if(this.pos>this.data.length)throw Error("Incomplete or corrupt PNG file");
}}var m;c.load=function(b,f,e){"function"===typeof f&&(e=f);var d=new XMLHttpRequest;d.open("GET",b,!0);d.responseType="arraybuffer";d.onload=function(){var h=new Uint8Array(d.response||d.mozResponseArrayBuffer);h=new c(h);"function"===typeof(null!=f?f.getContext:void 0)&&h.render(f);return"function"===typeof e?e(h):void 0};return d.send(null)};c.prototype.read=function(b){var f;var e=[];for(f=0;0<=b?f<b:f>b;0<=b?++f:--f)e.push(this.data[this.pos++]);return e};c.prototype.readUInt32=function(){var b=
this.data[this.pos++]<<24;var f=this.data[this.pos++]<<16;var e=this.data[this.pos++]<<8;var d=this.data[this.pos++];return b|f|e|d};c.prototype.readUInt16=function(){var b=this.data[this.pos++]<<8;var f=this.data[this.pos++];return b|f};c.prototype.decodePixels=function(b){var f,e,d,h,k,g,n,p;null==b&&(b=this.imgData);if(0===b.length)return new Uint8Array(0);b=new G.Zlib(b);b=b.getBytes();var q=this.pixelBitlength/8;var t=q*this.width;var u=new Uint8Array(t*this.height);var B=b.length;for(e=h=k=
0;h<B;){switch(b[h++]){case 0:for(d=f=0;f<t;d=f+=1)u[e++]=b[h++];break;case 1:for(d=g=0;g<t;d=g+=1){f=b[h++];var v=d<q?0:u[e-q];u[e++]=(f+v)%256}break;case 2:for(d=v=0;v<t;d=v+=1){f=b[h++];var x=(d-d%q)/q;g=k&&u[(k-1)*t+x*q+d%q];u[e++]=(g+f)%256}break;case 3:for(d=p=0;p<t;d=p+=1)f=b[h++],x=(d-d%q)/q,v=d<q?0:u[e-q],g=k&&u[(k-1)*t+x*q+d%q],u[e++]=(f+Math.floor((v+g)/2))%256;break;case 4:for(d=p=0;p<t;d=p+=1){f=b[h++];x=(d-d%q)/q;v=d<q?0:u[e-q];0===k?g=n=0:(g=u[(k-1)*t+x*q+d%q],n=x&&u[(k-1)*t+(x-1)*
q+d%q]);var z=v+g-n;d=Math.abs(z-v);x=Math.abs(z-g);z=Math.abs(z-n);v=d<=x&&d<=z?v:x<=z?g:n;u[e++]=(f+v)%256}break;default:throw Error("Invalid filter algorithm: "+b[h-1]);}k++}return u};c.prototype.decodePalette=function(){var b,f,e,d,h;var k=this.palette;var g=this.transparency.indexed||[];var n=new Uint8Array((g.length||0)+k.length);var p=e=b=f=0;for(d=k.length;e<d;p=e+=3)n[f++]=k[p],n[f++]=k[p+1],n[f++]=k[p+2],n[f++]=null!=(h=g[b++])?h:255;return n};c.prototype.copyToImageData=function(b,f){var e,
d;var h=this.colors;var k=null;var g=this.hasAlphaChannel;this.palette.length&&(k=null!=(e=this._decodedPalette)?e:this._decodedPalette=this.decodePalette(),h=4,g=!0);b=b.data||b;var n=b.length;var p=k||f;e=d=0;if(1===h)for(;e<n;)h=k?4*f[e/4]:d,d=p[h++],b[e++]=d,b[e++]=d,b[e++]=d,b[e++]=g?p[h++]:this.transparency.grayscale&&this.transparency.grayscale===d?0:255,d=h;else for(;e<n;)h=k?4*f[e/4]:d,b[e++]=p[h++],b[e++]=p[h++],b[e++]=p[h++],b[e++]=g?p[h++]:this.transparency.rgb&&this.transparency.rgb[1]===
p[h-3]&&this.transparency.rgb[3]===p[h-2]&&this.transparency.rgb[5]===p[h-1]?0:255,d=h};c.prototype.decode=function(){var b=new Uint8Array(this.width*this.height*4);this.copyToImageData(b,this.decodePixels());return b};var l=(m=a.document&&a.document.createElement("canvas"))&&m.getContext("2d");var r=function(b){l.width=b.width;l.height=b.height;l.clearRect(0,0,b.width,b.height);l.putImageData(b,0,0);b=new Image;b.src=m.toDataURL();return b};c.prototype.decodeFrames=function(b){var f,e;if(this.animation){var d=
this.animation.frames;var h=[];var k=f=0;for(e=d.length;f<e;k=++f){k=d[k];var g=b.createImageData(k.width,k.height);var n=this.decodePixels(new Uint8Array(k.data));this.copyToImageData(g,n);k.imageData=g;h.push(k.image=r(g))}return h}};c.prototype.renderFrame=function(b,f){var e=this.animation.frames;var d=e[f];e=e[f-1];0===f&&b.clearRect(0,0,this.width,this.height);1===(null!=e?e.disposeOp:void 0)?b.clearRect(e.xOffset,e.yOffset,e.width,e.height):2===(null!=e?e.disposeOp:void 0)&&b.putImageData(e.imageData,
e.xOffset,e.yOffset);0===d.blendOp&&b.clearRect(d.xOffset,d.yOffset,d.width,d.height);return b.drawImage(d.image,d.xOffset,d.yOffset)};c.prototype.animate=function(b){var f,e=this;var d=0;var h=this.animation;var k=h.numFrames;var g=h.frames;var n=h.numPlays;return(f=function(){var p=d++%k;var q=g[p];e.renderFrame(b,p);if(1<k&&d/k<n)return e.animation._timeout=setTimeout(f,q.delay)})()};c.prototype.stopAnimation=function(){var b;return clearTimeout(null!=(b=this.animation)?b._timeout:void 0)};c.prototype.render=
function(b){b._png&&b._png.stopAnimation();b._png=this;b.width=this.width;b.height=this.height;b=b.getContext("2d");if(this.animation)return this.decodeFrames(b),this.animate(b);var f=b.createImageData(this.width,this.height);this.copyToImageData(f,this.decodePixels());return b.putImageData(f,0,0)};return c}(self);const ba=new Set(["jpg","png","bmp","gif"]);A.decode=function(a){return E.apply(this,arguments)};A.decodeLerc2=J;A.getFormat=function(a){a=L(a);"lerc2"===a?a="lerc":"error"===a&&(a="");
return a};Object.defineProperty(A,"__esModule",{value:!0})});