// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.22/esri/copyright.txt for details.
//>>built
define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../geometry ../../../core/Error ../../../core/maybe ../../../core/unitUtils ../../../geometry/projection ../../../geometry/Extent ../../../geometry/Point".split(" "),function(p,X,ba,Y,y,G,w,N,v){function O(a,b,c){return!w.canProjectWithoutEngine(a,b,c)}function D(a,b,c){if((a=O(a,b,c))&&!w.isLoaded())throw new Y("rasterprojectionhelper-project","projection engine is not loaded");return a}function H(){H=X._asyncToGenerator(function*(){if(w.isLoaded())return null;
yield w.load()});return H.apply(this,arguments)}function I(a,b,c,d=null){if(a.spatialReference.equals(b))return a;D(a.spatialReference,b,d);c=c.center;a=new N({xmin:c.x-a.x/2,xmax:c.x+a.x/2,ymin:c.y-a.y/2,ymax:c.y+a.y/2,spatialReference:a.spatialReference});b=w.project(a,b,d);return y.isNone(b)?null:{x:b.xmax-b.xmin,y:b.ymax-b.ymin}}function P(a,b=.01){return G.getMetersPerUnitForSR(a)?b/G.getMetersPerUnitForSR(a):0}function J(a,b,c=null,d=!0){const f=a.spatialReference;if(f.equals(b))return a;D(f,
b,c);c=w.project(a,b,c);if(d&&b.isGeographic){const [e,g]=K(f,!0);(b=P(f))&&null!=e&&null!=g&&(Math.abs(a.x-e)<b&&5E-4>Math.abs(180-c.x)?c.x-=360:Math.abs(a.x-g)<b&&5E-4>Math.abs(180+c.x)&&(c.x+=360))}return c}function Z(a,b,c=null){const d=a[0].spatialReference;if(d.equals(b))return a;D(d,b,c);return w.project(a,b,c)}function Q(a){const b=B(a[0].spatialReference);if(2>a.length||!y.isSome(b))return a[0];let {xmin:c,xmax:d,ymin:f,ymax:e}=a[0];for(let g=1;g<a.length;g++){const l=a[g];d=l.xmax+b*g;f=
Math.min(f,l.ymin);e=Math.max(e,l.ymax)}return new N({xmin:c,xmax:d,ymin:f,ymax:e,spatialReference:a[0].spatialReference})}function R(a,b,c=null,d=!0){if(a.spatialReference.equals(b))return a;const f=S(a),e=B(a.spatialReference,!0);if(!y.isSome(e)||0===f)return T(a,b,c,d);a=a.clone().normalize().map(g=>T(g,b,c,d));return Q(a)}function T(a,b,c=null,d=!0){const f=a.spatialReference;if(f.equals(b))return a;D(f,b,c);const e=w.project(a,b,c);let [g,l]=K(f,!0);e&&d&&f.isWebMercator&&b.isGeographic&&null!=
g&&null!=l&&(.001>Math.abs(a.xmin-g)&&1E3<Math.abs(l-a.xmax)&&5E-4>Math.abs(180-e.xmax)&&(e.xmin=-180,d=[],d.push(new v(a.xmax,a.ymin,f)),d.push(new v(a.xmax,(a.ymin+a.ymax)/2,f)),d.push(new v(a.xmax,a.ymax,f)),d=d.map(h=>J(h,b,c)).filter(h=>!isNaN(null==h?void 0:h.x)).map(h=>h.x),e.xmax=Math.max.apply(null,d)),.001>Math.abs(a.xmax-l)&&1E3<Math.abs(g-a.xmin)&&5E-4>Math.abs(180+e.xmin)&&(e.xmax=180,d=[],d.push(new v(a.xmin,a.ymin,f)),d.push(new v(a.xmin,(a.ymin+a.ymax)/2,f)),d.push(new v(a.xmin,a.ymax,
f)),a=d.map(h=>J(h,b,c)).filter(h=>!isNaN(null==h?void 0:h.x)).map(h=>h.x),e.xmin=Math.min.apply(null,a)));[g,l]=K(b,!0);(a=P(b))&&null!=g&&null!=l&&e&&(Math.abs(e.xmin-g)<a&&(e.xmin=g),Math.abs(e.xmax-l)<a&&(e.xmax=l));return e}function B(a,b=!1){return a.isWebMercator?2*(b?2.0037508342787E7:2.0037508342788905E7):a.wkid&&a.isGeographic?360:2*aa[a.wkid]||null}function K(a,b=!1){const c=[];a=B(a,b);y.isSome(a)&&(c.push(-a/2),c.push(a/2));return c}function U(a,b,c,d){a=(a-b)/c;0!==a-Math.floor(a)?a=
Math.floor(a):d&&--a;return a}function S(a,b=!1){const c=B(a.spatialReference);if(!y.isSome(c))return 0;const d=b?0:-(c/2);b=U(a.xmax,d,c,!0);a=U(a.xmin,d,c,!1);return b-a}function V(a){const {projectedExtent:b,srcBufferExtent:c,pixelSize:d,datumTransformation:f,rasterTransform:e}=a;var g=b.spatialReference,l=c.spatialReference;D(g,l);const {xmin:h,ymin:k,xmax:m,ymax:u}=b,x=B(l),z=a.hasWrapAround||"gcs-shift"===(null==e?void 0:e.type);a=a.spacing||[32,32];var t=a[0]*d.x,q=a[1]*d.y,F=Math.ceil((m-
h)/t-.1/a[0])+1,E=Math.ceil((u-k)/q-.1/a[1])+1;const A=[];let n,C=0;var r=[];for(let L=0;L<F;L++)for(let M=0;M<E;M++)r.push(new v({x:h+t*L,y:u-q*M,spatialReference:g}));g=Z(r,l,f);for(l=0;l<F;l++){t=[];for(q=0;q<E;q++)r=g[l*E+q],e&&(r=e.inverseTransform(r)),t.push(r),0<l&&z&&r&&n[q]&&y.isSome(x)&&r.x<n[q].x&&(r.x+=x),r?(A.push((r.x-c.xmin)/(c.xmax-c.xmin)),A.push((c.ymax-r.y)/(c.ymax-c.ymin))):(A.push(NaN),A.push(NaN),C++);n=t}return{offsets:A,error:null,coefficients:null,outofBoundPointCount:C,spacing:a,
size:[F-1,E-1]}}const W=function(a,b,c){var d=(a[0]+a[4]+a[4*b.cols]+a[4*b.cols+4])/4;const f=(a[1]+a[5]+a[4*b.rows+1]+a[4*b.rows+5])/4,e=(a[4*b.cols]-a[0]+a[4*b.cols+4]-a[4])/c[0]*.5;c=(a[4*b.cols+1]-a[1]+a[4*b.cols+5]-a[5])/c[1]*.5;d=0===e||isNaN(e)?0:Math.abs(d-a[2*b.rows+2])/Math.abs(e);a=0===c||isNaN(c)?0:Math.abs(f-a[2*b.rows+3])/Math.abs(c);return[d,a]},aa={3395:2.0037508342789244E7,3410:1.7334193943686873E7,3857:2.0037508342788905E7,3975:1.7367530445161372E7,4087:2.0037508342789244E7,4088:2.0015108787169147E7,
6933:1.7367530445161372E7,32662:2.0037508342789244E7,53001:2.001508679602057E7,53002:1.000754339801029E7,53003:2.001508679602057E7,53004:2.001508679602057E7,53016:1.4152803599503474E7,53017:1.7333573624304302E7,53034:2.001508679602057E7,53079:2.0015114352186374E7,53080:2.0015114352186374E7,54001:2.0037508342789244E7,54002:1.0018754171394624E7,54003:2.0037508342789244E7,54004:2.0037508342789244E7,54016:1.4168658027268292E7,54017:1.736753044516137E7,54034:2.0037508342789244E7,54079:2.0037508342789244E7,
54080:2.0037508342789244E7,54100:2.0037508342789244E7,54101:2.0037508342789244E7};p.computeProjectedScales=function(a,b,c=512,d=!0){const {extent:f,spatialReference:e,pixelSize:g}=a,l=I(new v({x:g.x,y:g.y,spatialReference:e}),b,f);if(null==l)return{projectedPixelSize:null,scales:null,srcResolutions:null,isCustomTilingScheme:!1};var h=(l.x+l.y)/2,k=G.getMetersPerUnitForSR(b);h=h*k*96*39.37;const m=b.isGeographic?256/c*2.958287637958547E8:256/c*5.91657527591555E8;c="vector-magdir"===a.dataType||"vector-uv"===
a.dataType;const u=R(f,b);c||d&&(b.isGeographic||b.isWebMercator)&&(c=0>u.xmin*u.xmax);d=h;if(c)d=m,a=b.isGeographic?1.341104507446289E-6:.29858214164761665,k=96*a*k*39.37,b=I(new v({x:a,y:a,spatialReference:{wkid:b.isGeographic?4326:3857}}),e,u),b.x*=d/k,b.y*=d/k;else{b={x:g.x,y:g.y};a=Math.ceil(Math.log(Math.min(a.width,a.height)/32)/Math.LN2);for(k=0;d<.5005*m&&k<a;)k++,d*=2,b.x*=2,b.y*=2;1.001>=Math.max(d,m)/Math.min(d,m)&&(d=m)}a=[d];k=[{x:b.x,y:b.y}];for(h=Math.min(70.5310735,h)/1.001;d>=h;)d/=
2,b.x/=2,b.y/=2,a.push(d),k.push({x:b.x,y:b.y});return{projectedPixelSize:l,scales:a,srcResolutions:k,isCustomTilingScheme:!c}};p.defaultGridSpacing=32;p.defaultProjectionToleranceInPixels=4;p.getDefaultDatumTransformationForDataset=function(a,b,c){return D(a.spatialReference,b)?c?w.getTransformation(b,a.spatialReference,a):w.getTransformation(a.spatialReference,b,a):null};p.getProjectionOffsetGrid=function(a){var b=a.isAdaptive&&null==a.spacing,c=a.spacing||[32,32];let d=V(a);var f={cols:d.size[0]+
1,rows:d.size[1]+1},e=W(d.offsets,f,c),g=(e[0]+e[1])/2,l=0<d.outofBoundPointCount&&d.outofBoundPointCount<d.offsets.length/2;b&&(l||4<g)&&(d=V({...a,spacing:[4,4]}),f={cols:d.size[0]+1,rows:d.size[1]+1},e=W(d.offsets,f,c));d.error=e;a=d;{b=d.offsets;const {cols:z,rows:t}=f;f=new Float32Array((z-1)*(t-1)*12);c=new Float32Array([-0,-1,1,-1,1,-0,1,-0,-0]);e=new Float32Array([-1,1,0,0,-1,1,1,0,0]);for(g=0;g<z-1;g++){for(var h=0;h<t-1;h++){var k=g*t*2+2*h,m=b[k];const q=b[k+1];var u=b[k+2],x=b[k+3];k+=
2*t;const F=b[k],E=b[k+1],A=b[k+2];k=b[k+3];let n=0,C=12*(h*(z-1)+g);for(let r=0;3>r;r++)f[C++]=c[n++]*m+c[n++]*u+c[n++]*A;n=0;for(u=0;3>u;u++)f[C++]=c[n++]*q+c[n++]*x+c[n++]*k;n=0;for(x=0;3>x;x++)f[C++]=e[n++]*m+e[n++]*F+e[n++]*A;n=0;for(m=0;3>m;m++)f[C++]=e[n++]*q+e[n++]*E+e[n++]*k}if(l)for(h=0;h<f.length;h++)isNaN(f[h])&&(f[h]=-1)}l=f}a.coefficients=l;return d};p.getRasterDatasetAlignmentInfo=function(a){const b=a.storageInfo.origin.x;var c=B(a.spatialReference,!0);if(!y.isSome(c))return{originX:b,
halfWorldWidth:null,pyramidsInfo:null};const d=c/2,{nativePixelSize:f,storageInfo:e,extent:g}=a,{maximumPyramidLevel:l,blockWidth:h,pyramidScalingFactor:k}=e;let m=f.x;const u=[];a=y.isSome(a.transform)&&"gcs-shift"===a.transform.type;const x=b+(a?0:d);c=a?c-b:d-b;for(let z=0;z<=l;z++){const t=(g.xmax-b)/m/h,q=c/m/h;u.push({resolutionX:m,blockWidth:h,datsetColumnCount:0===t-Math.floor(t)?t:Math.ceil(t),worldColumnCountFromOrigin:0===q-Math.floor(q)?q:Math.ceil(q),leftMargin:Math.round(x/m)%h,rightPadding:(h-
Math.round(c/m)%h)%h,originColumnOffset:Math.floor(x/m/h)});m*=k}return{originX:b,halfWorldWidth:d,pyramidsInfo:u,hasGCSSShiftTransform:a}};p.getWorldWidth=B;p.getWorldWrapCount=S;p.load=function(){return H.apply(this,arguments)};p.minimumGridSpacing=4;p.projectExtent=R;p.projectPoint=J;p.projectResolution=I;p.requirePE=O;p.snapExtent=function(a){a=a.clone().normalize();return 1===a.length?a[0]:Q(a)};p.snapPyramid=function(a,b,c){const {storageInfo:d,pixelSize:f}=b;let e=!1;var {pyramidResolutions:g}=
d;if(y.isSome(g)&&g.length){a=(a.x+a.y)/2;var l=g[g.length-1];l=(l.x+l.y)/2;var h=(f.x+f.y)/2;if(a<=h)var k=0;else if(a>=l)k=g.length,e=8<a/l;else{l=h;for(let m=1;m<=g.length;m++){h=(g[m-1].x+g[m-1].y)/2;if(a<=h){a===h?k=m:"down"===c?(k=m-1,e=8<a/l):k="up"===c?m:a-l>h-a||2<a/l?m:m-1;break}l=h}}c=0===k?f:g[k-1];return{pyramidLevel:k,pyramidResolution:new v({x:c.x,y:c.y,spatialReference:b.spatialReference}),excessiveReading:e}}k=Math.log(a.x/f.x)/Math.LN2;a=Math.log(a.y/f.y)/Math.LN2;g=b.storageInfo.maximumPyramidLevel||
0;k="down"===c?Math.floor(Math.min(k,a)):"up"===c?Math.ceil(Math.max(k,a)):Math.round((k+a)/2);0>k?k=0:k>g&&(e=k>g+3,k=g);c=2**k;b=new v({x:c*b.nativePixelSize.x,y:c*b.nativePixelSize.y,spatialReference:b.spatialReference});return{pyramidLevel:k,pyramidResolution:b,excessiveReading:e}};Object.defineProperty(p,"__esModule",{value:!0})});