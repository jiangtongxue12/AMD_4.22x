// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.22/esri/copyright.txt for details.
//>>built
define("exports ../../chunks/_rollupPluginBabelHelpers ../../assets ../../core/colorUtils ../../core/has ../../core/Error ../../core/Logger ../../core/maybe ../../core/promiseUtils ../../core/screenUtils ./gfxUtils ./IconSymbol3DLayerResource ./ObjectSymbol3DLayerResource ./previewUtils ./renderUtils ./utils ./webStyleSymbolUtils".split(" "),function(z,K,L,M,ea,N,S,w,T,x,A,U,V,u,B,O,W){function y(a){const b=a.outline;var d=w.isSome(a.material)?a.material.color:null;d=w.isSome(d)?d.toHex():null;if(w.isNone(b)||
"pattern"in b&&w.isSome(b.pattern)&&"style"===b.pattern.type&&"none"===b.pattern.style)return"fill"===a.type&&"#ffffff"===d?{color:"#bdc3c7",width:.75}:null;a=x.pt2px(b.size)||0;return{color:"rgba("+(w.isSome(b.color)?b.color.toRgba():"255,255,255,1")+")",width:Math.min(a,80),style:"pattern"in b&&w.isSome(b.pattern)&&"style"===b.pattern.type?A.dekebabifyLineStyle(b.pattern.style):null,join:"butt",cap:"patternCap"in b?b.patternCap:"butt"}}function X(a,b){var d=b&&b.resource;d=d&&d.href;if(a.thumbnail&&
a.thumbnail.url)return Promise.resolve(a.thumbnail.url);if(d&&"object"!==b.type)return Promise.resolve(O.getIconHref(a,b));const e=L.getAssetUrl("esri/images/Legend/legend3dsymboldefault.png");return a.styleOrigin&&(a.styleOrigin.styleName||a.styleOrigin.styleUrl)?W.resolveWebStyleSymbol(a.styleOrigin,{portal:a.styleOrigin.portal},"webRef").catch(n=>n).then(n=>{var v;return(null==n?void 0:null==(v=n.thumbnail)?void 0:v.url)||e}):Promise.resolve(e)}function G(a,b=1){const d=a.a;a=M.toHSV(a);const {r:e,
g:n,b:v}=M.toRGB({h:a.h,s:a.s/b,v:100-(100-a.v)/b});return[e,n,v,d]}function C(a){return"water"===a.type?w.isNone(a.color)?null:a.color:w.isNone(a.material)||w.isNone(a.material.color)?null:a.material.color}function g(a,b=0){var d=C(a);if(!d){if("fill"===a.type)return null;b=u.adjustColorComponentBrightness(A.defaultThematicColor.r,b);return[b,b,b,100]}a=d.toRgba();for(d=0;3>d;d++)a[d]=u.adjustColorComponentBrightness(a[d],b);return a}function P(a,b){return H.apply(this,arguments)}function H(){H=
K._asyncToGenerator(function*(a,b){a=a.style;return"none"===a?null:{type:"pattern",x:0,y:0,src:yield A.getPatternUrlWithColor(L.getAssetUrl(`esri/symbols/patterns/${a}.png`),b.toCss(!0)),width:5,height:5}});return H.apply(this,arguments)}function Q(a){return a.outline?y(a):{color:"rgba(0, 0, 0, 1)",width:1.5}}function R(a,b){a=C(a);if(!a)return null;let d;d="rgba("+(u.adjustColorComponentBrightness(a.r,b)+",");d+=u.adjustColorComponentBrightness(a.g,b)+",";d+=u.adjustColorComponentBrightness(a.b,
b)+",";return d+a.a+");"}function I(a,b){b=R(a,b);if(!b)return{};if("pattern"in a&&w.isSome(a.pattern)&&"style"===a.pattern.type&&"none"===a.pattern.style)return null;const d=Math.min(a.size?x.pt2px(a.size):.75,80);return{color:b,width:d,style:"pattern"in a&&w.isSome(a.pattern)&&"style"===a.pattern.type?A.dekebabifyLineStyle(a.pattern.style):null,cap:"cap"in a?a.cap:null,join:"join"in a?"miter"===a.join?x.pt2px(2):a.join:null}}function D(a,b,d){d*=.75;return{type:"linear",x1:d?.25*d:0,y1:d?.5*d:0,
x2:d||4,y2:d?.5*d:4,colors:[{color:a,offset:0},{color:b,offset:1}]}}function Y(a){const b=a.depth,d=a.height;return(a=a.width)&&b&&d&&a===b&&a<d}function Z(a,b,d){const e=[];if(!a)return e;switch(a.type){case "icon":switch(a.resource&&a.resource.primitive||U.defaultPrimitive){case "circle":e.push({shape:{type:"circle",cx:0,cy:0,r:.5*b},fill:g(a,0),stroke:y(a)});break;case "square":e.push({shape:{type:"path",path:[{command:"M",values:[0,b]},{command:"L",values:[0,0]},{command:"L",values:[b,0]},{command:"L",
values:[b,b]},{command:"Z",values:[]}]},fill:g(a,0),stroke:y(a)});break;case "triangle":e.push({shape:{type:"path",path:[{command:"M",values:[0,b]},{command:"L",values:[.5*b,0]},{command:"L",values:[b,b]},{command:"Z",values:[]}]},fill:g(a,0),stroke:y(a)});break;case "cross":e.push({shape:{type:"path",path:[{command:"M",values:[.5*b,0]},{command:"L",values:[.5*b,b]},{command:"M",values:[0,.5*b]},{command:"L",values:[b,.5*b]}]},stroke:Q(a)});break;case "x":e.push({shape:{type:"path",path:[{command:"M",
values:[0,0]},{command:"L",values:[b,b]},{command:"M",values:[b,0]},{command:"L",values:[0,b]}]},stroke:Q(a)});break;case "kite":e.push({shape:{type:"path",path:[{command:"M",values:[0,.5*b]},{command:"L",values:[.5*b,0]},{command:"L",values:[b,.5*b]},{command:"L",values:[.5*b,b]},{command:"Z",values:[]}]},fill:g(a,0),stroke:y(a)})}break;case "object":switch(a.resource&&a.resource.primitive||V.defaultPrimitive){case "cone":var n=g(a,0);a=g(a,-.6);a=D(n,a,d?20:b);b=u.getConeShapes(b,d);e.push({shape:b[0],
fill:a});e.push({shape:b[1],fill:a});break;case "inverted-cone":d=g(a,0);a=g(a,-.6);a=D(d,a,b);b=u.getInvertedConeShapes(b);e.push({shape:b[0],fill:a});e.push({shape:b[1],fill:d});break;case "cube":b=u.getCubeShapes(b,d);e.push({shape:b[0],fill:g(a,0)});e.push({shape:b[1],fill:g(a,-.3)});e.push({shape:b[2],fill:g(a,-.5)});break;case "cylinder":{n=g(a,0);const v=g(a,-.6);n=D(n,v,d?20:b);b=u.getCylinderShapes(b,d);e.push({shape:b[0],fill:n});e.push({shape:b[1],fill:n});e.push({shape:b[2],fill:g(a,0)});
break}case "diamond":b=u.getDiamondShapes(b);e.push({shape:b[0],fill:g(a,-.3)});e.push({shape:b[1],fill:g(a,0)});e.push({shape:b[2],fill:g(a,-.3)});e.push({shape:b[3],fill:g(a,-.7)});break;case "sphere":d=g(a,0);a=g(a,-.6);a=D(d,a);a.x1=0;a.y1=0;a.x2=.25*b;a.y2=.25*b;e.push({shape:{type:"circle",cx:0,cy:0,r:.5*b},fill:a});break;case "tetrahedron":b=u.getTetrahedronShapes(b),e.push({shape:b[0],fill:g(a,-.3)}),e.push({shape:b[1],fill:g(a,0)}),e.push({shape:b[2],fill:g(a,-.6)})}}return e}function aa(a,
b){const d=b&&b.size?x.pt2px(b.size):null,e=b&&b.maxSize?x.pt2px(b.maxSize):null,n=b&&b.disableUpsampling,v=a.symbolLayers,q=[];let p=0,r=0;const c=v.getItemAt(v.length-1);let l;c&&"icon"===c.type&&(l=c.size&&x.pt2px(c.size));v.forEach(f=>{if("icon"===f.type||"object"===f.type){var h="icon"===f.type?f.size&&x.pt2px(f.size):0,k=d||h?Math.ceil(Math.min(d||h,e||120)):22;if(f&&f.resource&&f.resource.href){var t=X(a,f).then(function(m){const E=f.get("material.color");var F="icon"===f.type?"multiply":"tint";
return B.tintImageWithColor(m,k,E,F,n)}).then(function(m){const E=m.width,F=m.height;p=Math.max(p,E);r=Math.max(r,F);return[{shape:{type:"image",x:0,y:0,width:E,height:F,src:m.url},fill:null,stroke:null}]});q.push(t)}else{let m=k;"icon"===f.type&&l&&d&&(m=h/l*k);h="tall"===(null==b?void 0:b.symbolConfig)||(null==b?void 0:null==(t=b.symbolConfig)?void 0:t.isTall)||("object"===f.type?Y(f):!1);p=Math.max(p,h?20:m);r=Math.max(r,m);q.push(Promise.resolve(Z(f,m,h)))}}});return T.eachAlways(q).then(function(f){const h=
[];f.forEach(function(k){k.value?h.push(k.value):k.error&&ba.warn("error while building swatchInfo!",k.error)});return B.renderSymbol(h,[p,r],{node:b&&b.node,scale:!1,opacity:b&&b.opacity})})}function ca(a,b){const d=a.symbolLayers,e=[];a=O.isVolumetricSymbol(a);const n=b&&b.size?x.pt2px(b.size):null,v=(b&&b.maxSize?x.pt2px(b.maxSize):null)||80;let q=0,p=0,r;d.forEach((c,l)=>{if(c&&("line"===c.type||"path"===c.type)){var f=[];switch(c.type){case "line":var h=I(c,0);if(w.isNone(h))break;var k=h&&h.width||
0;0===l&&(r=k);c=Math.min(n||k,v);l=0===l?c:n?k/r*c:c;k=20<l?2*l:40;p=Math.max(p,l);q=Math.max(q,k);h.width=l;f.push({shape:{type:"path",path:[{command:"M",values:[0,.5*p]},{command:"L",values:[q,.5*p]}]},stroke:h});break;case "path":h=Math.min(n||22,v);l=g(c,0);k=g(c,-.2);var t=R(c,-.4);t=t?{color:t,width:1}:{};if("quad"===c.profile){const m=c.width;c=c.height;c=u.getPathSymbolShapes(m&&c?m/c:1,0===c,0===m);t={...t,join:"bevel"};f.push({shape:c[0],fill:k,stroke:t});f.push({shape:c[1],fill:k,stroke:t});
f.push({shape:c[2],fill:l,stroke:t})}else f.push({shape:u.shapes.pathSymbol3DLayer[0],fill:k,stroke:t}),f.push({shape:u.shapes.pathSymbol3DLayer[1],fill:l,stroke:t});q=p=Math.max(p,h)}e.push(f)}});return Promise.resolve(B.renderSymbol(e,[q,p],{node:b&&b.node,scale:a,opacity:b&&b.opacity}))}function da(a,b){return J.apply(this,arguments)}function J(){J=K._asyncToGenerator(function*(a,b){const d="mesh-3d"===a.type;a=a.symbolLayers;var e=b&&b.size?x.pt2px(b.size):null;const n=b&&b.maxSize?x.pt2px(b.maxSize):
null;e=e||22;const v=[];let q=0,p=0;var r=!1;for(let t=0;t<a.length;t++){var c=a.getItemAt(t);const m=[];if(!d||"fill"===c.type){var l=u.shapes.fill[0];switch(c.type){case "fill":var f=y(c);r=Math.min(e,n||120);q=Math.max(q,r);p=Math.max(p,r);r=!0;var h=g(c,0),k="pattern"in c&&c.pattern;c=C(c);!d&&w.isSome(k)&&"style"===k.type&&"solid"!==k.style&&c&&(h=yield P(k,c));m.push({shape:l,fill:h,stroke:f});break;case "line":c=I(c,0);if(w.isNone(c))break;c={stroke:c,shape:l};q=Math.max(q,22);p=Math.max(p,
22);m.push(c);break;case "extrude":l={join:"round",width:1,...I(c,-.4)};f=g(c,0);c=g(c,-.2);h=Math.min(e,n||120);k=u.getExtrudeSymbolShapes(h);l.width=1;m.push({shape:k[0],fill:c,stroke:l});m.push({shape:k[1],fill:c,stroke:l});m.push({shape:k[2],fill:f,stroke:l});c=22*.7+.5*h;q=Math.max(q,22);p=Math.max(p,c);break;case "water":r=C(c),c=G(r),l=G(r,2),f=G(r,3),h=u.getWaterSymbolShapes(),r=!0,m.push({shape:h[0],fill:c}),m.push({shape:h[1],fill:l}),m.push({shape:h[2],fill:f}),c=Math.min(e,n||120),q=Math.max(q,
c),p=Math.max(p,c)}v.push(m)}}return Promise.resolve(B.renderSymbol(v,[q,p],{node:b&&b.node,scale:r,opacity:b&&b.opacity}))});return J.apply(this,arguments)}const ba=S.getLogger("esri.symbols.support.previewSymbol3D");z.getPatternDescriptor=P;z.getSymbolLayerFill=g;z.previewSymbol3D=function(a,b){if(0===a.symbolLayers.length)return Promise.reject(new N("symbolPreview: renderPreviewHTML3D","No symbolLayers in the symbol."));switch(a.type){case "point-3d":return aa(a,b);case "line-3d":return ca(a,b);
case "polygon-3d":case "mesh-3d":return da(a,b)}return Promise.reject(new N("symbolPreview: swatchInfo3D","symbol not supported."))};Object.defineProperty(z,"__esModule",{value:!0})});